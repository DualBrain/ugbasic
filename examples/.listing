dgrpnpgmjbchktd.asm:
     1                          SECTION code_user
     2                          ORG $4000
     3                          SECTION data_user
     4                          ORG $C000
     5                          SECTION code_user
     6  0000  0000              	DEFB $41, $42
     7  0002  0000              	DEFW CODESTART
     8  0004  0000              	DEFW $0
     9  0006  0000              	DEFW $0
    10  0008  0000              	DEFW $0
    11  000a  0000              	DEFW $0
    12  000c  0000              	DEFW $0
    13  000e  0000              	DEFW $0
    14                          CODESTART:
    15  0010  cd0000            	CALL $0138
    16  0013  0f                	RRCA
    17  0014  0f                	RRCA
    18  0015  e600              	AND 3
    19  0017  4f                	LD C, A
    20  0018  0600              	LD B, 0
    21  001a  210000            	LD HL, $FCC1
    22  001d  09                	ADD HL, BC
    23  001e  7e                	LD A, (HL)
    24  001f  e600              	AND $80
    25  0021  b1                	OR C
    26  0022  4f                	LD C, A
    27  0023  23                	INC HL
    28  0024  23                	INC HL
    29  0025  23                	INC HL
    30  0026  23                	INC HL
    31  0027  7e                	LD A, (HL)
    32  0028  e600              	AND $C
    33  002a  b1                	OR C
    34  002b  2600              	LD H, $80
    35  002d  cd0000            	CALL $0024
    36  0030  cd0000            	CALL VARINIT2
    37  0033  cd0000            	CALL VARINIT
    38  0036  cd0000            	CALL PROTOTHREADINIT
    39  0039  210000            	LD HL, DUFFDEVICEL0
    40  003c  110000            	LD DE, 35
    41  003f  19                	ADD HL, DE
    42  0040  110000            	LD DE, DUFFDEVICEL0
    43  0043  13                	INC DE
    44  0044  13                	INC DE
    45  0045  7323722b          	LD (HL), DE
    46  0049  c30000            	jp startup_after
    47                          ; /*****************************************************************************
    48                          ;  * ugBASIC - an isomorphic BASIC language compiler for retrocomputers        *
    49                          ;  *****************************************************************************
    50                          ;  * Copyright 2021-2023 Marco Spedaletti (asimov@mclink.it)
    51                          ;  *
    52                          ;  * Licensed under the Apache License, Version 2.0 (the "License
    53                          ;  * you may not use this file except in compliance with the License.
    54                          ;  * You may obtain a copy of the License at
    55                          ;  *
    56                          ;  * http://www.apache.org/licenses/LICENSE-2.0
    57                          ;  *
    58                          ;  * Unless required by applicable law or agreed to in writing, software
    59                          ;  * distributed under the License is distributed on an "AS IS" BASIS,
    60                          ;  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    61                          ;  * See the License for the specific language governing permissions and
    62                          ;  * limitations under the License.
    63                          ;  *----------------------------------------------------------------------------
    64                          ;  * Concesso in licenza secondo i termini della Licenza Apache, versione 2.0
    65                          ;  * (la "Licenza è proibito usare questo file se non in conformità alla
    66                          ;  * Licenza. Una copia della Licenza è disponibile all'indirizzo:
    67                          ;  *
    68                          ;  * http://www.apache.org/licenses/LICENSE-2.0
    69                          ;  *
    70                          ;  * Se non richiesto dalla legislazione vigente o concordato per iscritto,
    71                          ;  * il software distribuito nei termini della Licenza è distribuito
    72                          ;  * "COSì COM'è", SENZA GARANZIE O CONDIZIONI DI ALCUN TIPO, esplicite o
    73                          ;  * implicite. Consultare la Licenza per il testo specifico che regola le
    74                          ;  * autorizzazioni e le limitazioni previste dalla medesima.
    75                          ;  ****************************************************************************/
    76                          ;* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
    77                          ;*                                                                             *
    78                          ;*                          STARTUP ROUTINE FOR MSX1                           *
    79                          ;*                                                                             *
    80                          ;*                             by Marco Spedaletti                             *
    81                          ;*                                                                             *
    82                          ;* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
    83                          ISRSVC:
    84  004c  cd0000            	CALL MUSICPLAYER
    85  004f  f5                	PUSH AF
    86  0050  e5                	PUSH HL
    87  0051  3e00              	LD A, 1
    88  0053  320000            	LD (VBLFLAG), A
    89  0056  2a0000            	LD HL, ($FC9E)
    90  0059  d511000019d1      	ADD HL, 1
    91  005f  220000            	LD ($FC9E), HL
    92  0062  e1                	POP HL
    93  0063  f1                	POP AF
    94  0064  c9                	RET
    95                          MSX1STARTUP:
    96  0065  f3                	DI
    97                              ; LD HL, ($fd9f+1)
    98                              ; LD DE, HL
    99                              ; LD HL, ISRSVC2
   100                              ; LD A, $c3
   101                              ; LD (HL), A
   102                              ; INC HL
   103                              ; LD A, E
   104                              ; LD (HL), A
   105                              ; INC HL
   106                              ; LD A, D
   107                              ; LD (HL), A
   108  0066  210000            	LD HL, ISRSVC
   109  0069  220000            	LD ($fd9f+1), HL
   110  006c  3e00              	LD A, $c3
   111  006e  320000            	LD ($fd9f), A
   112  0071  fb                	EI
   113  0072  c9                	RET
   114                          startup_after:
   115  0073  cd0000            	CALL MSX1STARTUP
   116  0076  c30000            	jp tms9918vars_after
   117                          ; /*****************************************************************************
   118                          ;  * ugBASIC - an isomorphic BASIC language compiler for retrocomputers        *
   119                          ;  *****************************************************************************
   120                          ;  * Copyright 2021-2023 Marco Spedaletti (asimov@mclink.it)
   121                          ;  *
   122                          ;  * Licensed under the Apache License, Version 2.0 (the "License");
   123                          ;  * you may not use this file except in compliance with the License.
   124                          ;  * You may obtain a copy of the License at
   125                          ;  *
   126                          ;  * http://www.apache.org/licenses/LICENSE-2.0
   127                          ;  *
   128                          ;  * Unless required by applicable law or agreed to in writing, software
   129                          ;  * distributed under the License is distributed on an "AS IS" BASIS,
   130                          ;  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   131                          ;  * See the License for the specific language governing permissions and
   132                          ;  * limitations under the License.
   133                          ;  *----------------------------------------------------------------------------
   134                          ;  * Concesso in licenza secondo i termini della Licenza Apache, versione 2.0
   135                          ;  * (la "Licenza"); è proibito usare questo file se non in conformità alla
   136                          ;  * Licenza. Una copia della Licenza è disponibile all'indirizzo:
   137                          ;  *
   138                          ;  * http://www.apache.org/licenses/LICENSE-2.0
   139                          ;  *
   140                          ;  * Se non richiesto dalla legislazione vigente o concordato per iscritto,
   141                          ;  * il software distribuito nei termini della Licenza è distribuito
   142                          ;  * "COSì COM'è", SENZA GARANZIE O CONDIZIONI DI ALCUN TIPO, esplicite o
   143                          ;  * implicite. Consultare la Licenza per il testo specifico che regola le
   144                          ;  * autorizzazioni e le limitazioni previste dalla medesima.
   145                          ;  ****************************************************************************/
   146                          ;* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
   147                          ;*                                                                             *
   148                          ;*                          INTERNAL VARIABLES FOR TMS9918                     *
   149                          ;*                                                                             *
   150                          ;*                             by Marco Spedaletti                             *
   151                          ;*                                                                             *
   152                          ;* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
   153                          ; SECTION data_user
   154                          ; ORG $c000
   155                          ; TEXTADDRESS: DEFW FRAMEBUFFER
   156                          ; BITMAPADDRESS: DEFW FRAMEBUFFER
   157                          ; COLORMAPADDRESS: DEFW COLORBUFFER
   158                          ; COPYOFTEXTADDRESS: DEFW $0000
   159                          ; COPYOFBITMAPADDRESS: DEFW $0000
   160                          ; COPYOFCOLORMAPADDRESS: DEFW $0000
   161                          ; TABCOUNT:   DEFB    4
   162                          ; XCURSYS:      DEFB    0
   163                          ; YCURSYS:      DEFB    0
   164                          ; EMPTYTILE:  DEFB   0
   165                          ; EVERYSTATUS:DEFB   0
   166                          ; XCURSYS:      DEFB    0
   167                          ; YCURSYS:      DEFB    0
   168                          ; CLINEX:      DEFB    0
   169                          ; CLINEY:      DEFB    0
   170                          ; XGR:    DEFW 0
   171                          ; YGR:    DEFW 0
   172                          ; LINE:   DEFB $ff, $ff
   173                          ; CLIPX1:    DEFW 0
   174                          ; CLIPY1:    DEFW 0
   175                          ; CLIPX2:    DEFW 255
   176                          ; CLIPY2:    DEFW 191
   177                          ; CURRENTWIDTH:   DEFW    256
   178                          ; CURRENTHEIGHT:   DEFW    192
   179                          ; CURRENTTILESWIDTH:   DEFB   32
   180                          ; CURRENTTILESHEIGHT:   DEFB    24
   181                          ; CURRENTTILES:   DEFB    255
   182                          ; CURRENTMODE:        DEFB 0
   183                          ; TEXTWW:             DEFB 3
   184                          ; FONTWIDTH:          DEFB 8
   185                          ; FONTHEIGHT:         DEFB 8
   186                          ; CPURANDOM_SEED:     DEFB $FF, $FF, $FF, $FF
   187                          ; TABSTODRAW: DEFB 0
   188                          ; SECTION code_user
   189                          ; TMS9918VARINIT:
   190                          ;     LD HL, FRAMEBUFFER
   191                          ;     LD (TEXTADDRESS), HL
   192                          ;     LD HL, FRAMEBUFFER
   193                          ;     LD (BITMAPADDRESS), HL
   194                          ;     LD HL, COLORBUFFER
   195                          ;     LD (COLORMAPADDRESS), HL
   196                          ;     LD HL, 0
   197                          ;     LD (COPYOFTEXTADDRESS), HL
   198                          ;     LD (COPYOFBITMAPADDRESS), HL
   199                          ;     LD (COPYOFCOLORMAPADDRESS), HL
   200                          ;     LD (XGR), HL
   201                          ;     LD (YGR), HL
   202                          
   203                          ;     LD A, 4
   204                          ;     LD (TABCOUNT), A
   205                          ;     LD A, 0
   206                          ;     LD (XCURSYS), A
   207                          ;     LD (YCURSYS), A
   208                          ;     LD (EVERYSTATUS), A
   209                          ;     LD (XCURSYS), A
   210                          ;     LD (YCURSYS), A
   211                          ;     LD (CLINEX), A
   212                          ;     LD (CLINEY), A
   213                          ;     LD (YGR), A
   214                          ;     LD (CLIPX1), HL
   215                          ;     LD (CLIPY1), HL
   216                          ;     LD HL, 255
   217                          ;     LD (CLIPX2), HL
   218                          ;     LD HL, 191
   219                          ;     LD (CLIPY2), HL
   220                          ;     LD HL, 256
   221                          ;     LD (CURRENTWIDTH), HL
   222                          ;     LD HL, 192
   223                          ;     LD (CURRENTHEIGHT), HL
   224                          ;     LD A, 32
   225                          ;     LD (EMPTYTILE), A
   226                          ;     LD HL, $ffff
   227                          ;     LD (LINE), HL
   228                          ;     LD A, 32
   229                          ;     LD (CURRENTTILESWIDTH), A
   230                          ;     LD A, 24
   231                          ;     LD (CURRENTTILESHEIGHT), A
   232                          ;     LD A, 255
   233                          ;     LD (CURRENTTILES), A
   234                          ;     LD A, 0
   235                          ;     LD (CURRENTMODE), A
   236                          ;     LD A, 3
   237                          ;     LD (TEXTWW), A
   238                          ;     LD A, 8
   239                          ;     LD (FONTWIDTH), A
   240                          ;     LD A, 8
   241                          ;     LD (FONTHEIGHT), A
   242                          ;     LD A, $ff
   243                          ;     LD HL, CPURANDOM_SEED
   244                          ;     LD (HL),A
   245                          ;     INC HL
   246                          ;     LD (HL),A
   247                          ;     INC HL
   248                          ;     LD (HL),A
   249                          ;     INC HL
   250                          ;     LD (HL),A
   251                          ;     INC HL
   252                          ;     LD A, 098H
   253                          ;     LD (VDPDATAPORTREAD), A
   254                          ;     LD (VDPDATAPORTWRITE), A
   255                          ;     LD A, 099H
   256                          ;     LD (VDPCONTROLPORTREAD), A
   257                          ;     LD (VDPCONTROLPORTWRITE), A
   258                          ;     LD A, (EMPTYTILE)
   259                          ;     LD HL, FRAMEBUFFER
   260                          ;     LD (HL), A
   261                          ;     LD DE, FRAMEBUFFER
   262                          ;     INC DE
   263                          ;     LD BC, 40*24
   264                          ;     LDIR
   265                          ;     LD A, 0
   266                          ;     LD HL, COLORBUFFER
   267                          ;     LD (HL), A
   268                          ;     LD DE, COLORBUFFER
   269                          ;     INC DE
   270                          ;     LD BC, 32*24
   271                          ;     LDIR
   272                          ;     LD A, 0
   273                          ;     LD HL, TILEBUFFER
   274                          ;     LD (HL), A
   275                          ;     LD DE, TILEBUFFER
   276                          ;     INC DE
   277                          ;     LD BC, 32*24
   278                          ;     LDIR
   279                          ;     RET
   280                          tms9918vars_after:
   281  0079  c30000            	jp tms9918startup_after
   282                          ; /*****************************************************************************
   283                          ;  * ugBASIC - an isomorphic BASIC language compiler for retrocomputers        *
   284                          ;  *****************************************************************************
   285                          ;  * Copyright 2021-2023 Marco Spedaletti (asimov@mclink.it)
   286                          ;  *
   287                          ;  * Licensed under the Apache License, Version 2.0 (the "License");
   288                          ;  * you may not use this file except in compliance with the License.
   289                          ;  * You may obtain a copy of the License at
   290                          ;  *
   291                          ;  * http://www.apache.org/licenses/LICENSE-2.0
   292                          ;  *
   293                          ;  * Unless required by applicable law or agreed to in writing, software
   294                          ;  * distributed under the License is distributed on an "AS IS" BASIS,
   295                          ;  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   296                          ;  * See the License for the specific language governing permissions and
   297                          ;  * limitations under the License.
   298                          ;  *----------------------------------------------------------------------------
   299                          ;  * Concesso in licenza secondo i termini della Licenza Apache, versione 2.0
   300                          ;  * (la "Licenza"); è proibito usare questo file se non in conformità alla
   301                          ;  * Licenza. Una copia della Licenza è disponibile all'indirizzo:
   302                          ;  *
   303                          ;  * http://www.apache.org/licenses/LICENSE-2.0
   304                          ;  *
   305                          ;  * Se non richiesto dalla legislazione vigente o concordato per iscritto,
   306                          ;  * il software distribuito nei termini della Licenza è distribuito
   307                          ;  * "COSì COM'è", SENZA GARANZIE O CONDIZIONI DI ALCUN TIPO, esplicite o
   308                          ;  * implicite. Consultare la Licenza per il testo specifico che regola le
   309                          ;  * autorizzazioni e le limitazioni previste dalla medesima.
   310                          ;  ****************************************************************************/
   311                          ;* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
   312                          ;*                                                                             *
   313                          ;*                          STARTUP ROUTINE FOR TMS9918                        *
   314                          ;*                                                                             *
   315                          ;*                             by Marco Spedaletti                             *
   316                          ;*                                                                             *
   317                          ;* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
   318                          VDPLOCK:
   319  007c  f3                	DI
   320  007d  f5                	PUSH AF
   321  007e  3e00              	LD A, 1
   322  0080  320000            	LD (VDPINUSE), A
   323  0083  f1                	POP AF
   324  0084  c9                	RET
   325                          VDPUNLOCK:
   326  0085  f5                	PUSH AF
   327                          ; peephole(1): r228 (LD A, 0)->(XOR A)
   328                          ;        LD A, 0
   329  0086  af                	XOR A
   330  0087  320000            	LD (VDPINUSE), A
   331  008a  db00              	IN A, ($bf)
   332  008c  f1                	POP AF
   333  008d  fb                	EI
   334  008e  c9                	RET
   335                          ; if __coleco__
   336                          ; WAIT_VDP_HOOK:
   337                          ;         LD A, (VDP_HOOK)
   338                          ;         CP $cd
   339                          ;         JR Z,WAIT_VDP_HOOK
   340                          ;         RET
   341                          ; SET_VDP_HOOK0:
   342                          ;         LD (VDP_HOOK+1),HL
   343                          ;         LD A,$c9
   344                          ;         LD (VDP_HOOK+3),A
   345                          ;         LD A,$cd
   346                          ;         LD (VDP_HOOK),A
   347                          ;         RET
   348                          ; SET_VDP_HOOK:
   349                          ;         LD (VDP_HOOK+1),HL
   350                          ;         LD A,$c9
   351                          ;         LD (VDP_HOOK+3),A
   352                          ;         LD A, B
   353                          ;         LD (VDP_HOOK+4),A
   354                          ;         LD A, C
   355                          ;         LD (VDP_HOOK+5),A
   356                          ;         LD A, D
   357                          ;         LD (VDP_HOOK+6),A
   358                          ;         LD A, E
   359                          ;         LD (VDP_HOOK+7),A
   360                          ;         LD A,$cd
   361                          ;         LD (VDP_HOOK),A
   362                          ;         RET
   363                          ; SET_VDP_HOOK_HL:
   364                          ;         LD A, H
   365                          ;         LD (VDP_HOOK+8),A
   366                          ;         LD A, L
   367                          ;         LD (VDP_HOOK+9),A
   368                          ;         RET
   369                          ; GET_VDP_HOOK:
   370                          ;         LD A, (VDP_HOOK+4)
   371                          ;         LD B, A
   372                          ;         LD A, (VDP_HOOK+5)
   373                          ;         LD C, A
   374                          ;         LD A, (VDP_HOOK+6)
   375                          ;         LD D, A
   376                          ;         LD A, (VDP_HOOK+7)
   377                          ;         LD E, A
   378                          ;         LD A, (VDP_HOOK+8)
   379                          ;         LD H, A
   380                          ;         LD A, (VDP_HOOK+9)
   381                          ;         LD L, A
   382                          ;         RET
   383                          ; DONE_VDP_HOOK:
   384                          ;         LD A,0
   385                          ;         LD (VDP_HOOK),A
   386                          ;         RET
   387                          ; endif
   388                          VDPWRITEBIT: EQU     40H
   389                          VDPSETREGI:
   390  008f  cd0000            	CALL    VDPREGOUT
   391  0092  7b                	LD      A, E
   392                          VDPREGOUT:
   393  0093  c5                	PUSH    BC
   394  0094  ed4b0000          	LD      BC, (VDPCONTROLPORTWRITE)
   395                          ; if __sc3000__
   396                          ;         NOP
   397                          ;         NOP
   398                          ;         NOP
   399                          ;         NOP
   400                          ;         NOP
   401                          ;         NOP
   402                          ;         NOP
   403                          ;         NOP
   404                          ; endif
   405  0098  ed79              	OUT     (C), A
   406  009a  c1                	POP     BC
   407  009b  c9                	RET
   408                          VDPREGIN:
   409  009c  c5                	PUSH    BC
   410  009d  ed4b0000          	LD      BC, (VDPCONTROLPORTREAD)
   411                          ; if __sc3000__
   412                          ;         NOP
   413                          ;         NOP
   414                          ;         NOP
   415                          ;         NOP
   416                          ;         NOP
   417                          ;         NOP
   418                          ;         NOP
   419                          ;         NOP
   420                          ; endif
   421  00a1  ed78              	IN      A, (C)
   422  00a3  c1                	POP     BC
   423  00a4  c9                	RET
   424                          VDPRAMOUT:
   425  00a5  c5                	PUSH    BC
   426  00a6  ed4b0000          	LD      BC, (VDPDATAPORTWRITE)
   427                          ; if __sc3000__
   428                          ;         NOP
   429                          ;         NOP
   430                          ;         NOP
   431                          ;         NOP
   432                          ;         NOP
   433                          ;         NOP
   434                          ;         NOP
   435                          ;         NOP
   436                          ; endif
   437  00aa  ed79              	OUT     (C), A
   438  00ac  c1                	POP     BC
   439  00ad  c9                	RET
   440                          VDPRAMOUT8:
   441  00ae  c5                	PUSH    BC
   442  00af  ed4b0000          	LD      BC, (VDPDATAPORTWRITE)
   443                          ; if __sc3000__
   444                          ;         NOP
   445                          ;         NOP
   446                          ;         NOP
   447                          ;         NOP
   448                          ;         NOP
   449                          ;         NOP
   450                          ;         NOP
   451                          ;         NOP
   452                          ; endif
   453  00b3  ed79              	OUT     (C), A
   454  00b5  00                	NOP
   455  00b6  00                	NOP
   456  00b7  00                	NOP
   457  00b8  00                	NOP
   458  00b9  00                	NOP
   459  00ba  00                	NOP
   460  00bb  00                	NOP
   461  00bc  00                	NOP
   462  00bd  ed79              	OUT     (C), A
   463  00bf  00                	NOP
   464  00c0  00                	NOP
   465  00c1  00                	NOP
   466  00c2  00                	NOP
   467  00c3  00                	NOP
   468  00c4  00                	NOP
   469  00c5  00                	NOP
   470  00c6  00                	NOP
   471  00c7  ed79              	OUT     (C), A
   472  00c9  00                	NOP
   473  00ca  00                	NOP
   474  00cb  00                	NOP
   475  00cc  00                	NOP
   476  00cd  00                	NOP
   477  00ce  00                	NOP
   478  00cf  00                	NOP
   479  00d0  00                	NOP
   480  00d1  ed79              	OUT     (C), A
   481  00d3  00                	NOP
   482  00d4  00                	NOP
   483  00d5  00                	NOP
   484  00d6  00                	NOP
   485  00d7  00                	NOP
   486  00d8  00                	NOP
   487  00d9  00                	NOP
   488  00da  00                	NOP
   489  00db  ed79              	OUT     (C), A
   490  00dd  00                	NOP
   491  00de  00                	NOP
   492  00df  00                	NOP
   493  00e0  00                	NOP
   494  00e1  00                	NOP
   495  00e2  00                	NOP
   496  00e3  00                	NOP
   497  00e4  00                	NOP
   498  00e5  ed79              	OUT     (C), A
   499  00e7  00                	NOP
   500  00e8  00                	NOP
   501  00e9  00                	NOP
   502  00ea  00                	NOP
   503  00eb  00                	NOP
   504  00ec  00                	NOP
   505  00ed  00                	NOP
   506  00ee  00                	NOP
   507  00ef  ed79              	OUT     (C), A
   508  00f1  00                	NOP
   509  00f2  00                	NOP
   510  00f3  00                	NOP
   511  00f4  00                	NOP
   512  00f5  00                	NOP
   513  00f6  00                	NOP
   514  00f7  00                	NOP
   515  00f8  00                	NOP
   516  00f9  ed79              	OUT     (C), A
   517  00fb  00                	NOP
   518  00fc  00                	NOP
   519  00fd  00                	NOP
   520  00fe  00                	NOP
   521  00ff  00                	NOP
   522  0100  00                	NOP
   523  0101  00                	NOP
   524  0102  00                	NOP
   525  0103  c1                	POP     BC
   526  0104  c9                	RET
   527                          VDPRAMIN:
   528  0105  c5                	PUSH    BC
   529  0106  ed4b0000          	LD      BC, (VDPDATAPORTREAD)
   530                          ; if __sc3000__
   531                          ;         NOP
   532                          ;         NOP
   533                          ;         NOP
   534                          ;         NOP
   535                          ;         NOP
   536                          ;         NOP
   537                          ;         NOP
   538                          ;         NOP
   539                          ; endif
   540  010a  ed78              	IN      A, (C)
   541  010c  c1                	POP     BC
   542  010d  c9                	RET
   543                          VDPWRITEADDR:
   544  010e  7b                	LD      A, E                    ; SEND LSB
   545  010f  cd0000            	CALL    VDPREGOUT
   546  0112  7a                	LD      A, D                    ; MASK OFF MSB TO MAX OF 16KB
   547  0113  e600              	AND     3FH
   548  0115  f600              	OR      VDPWRITEBIT             ; INDICATE THAT THIS IS A WRITE
   549                          ; peephole(1): r383 (CALL+RET)->(JP)
   550                          ;        CALL    VDPREGOUT
   551  0117  c30000            	JP VDPREGOUT
   552                          ;        RET
   553                          VDPREADADDR:
   554  011a  7b                	LD      A, E                    ; SEND LSB
   555  011b  cd0000            	CALL    VDPREGOUT
   556  011e  7a                	LD      A, D                    ; MASK OFF MSB TO MAX OF 16KB
   557  011f  e600              	AND     3FH
   558                          ; peephole(1): r383 (CALL+RET)->(JP)
   559                          ;        CALL    VDPREGOUT
   560  0121  c30000            	JP VDPREGOUT
   561                          ;        RET
   562                          VDPSETREG:
   563  0124  cd0000            	CALL VDPLOCK
   564  0127  cd0000            	CALL    VDPSETREGI
   565                          ; peephole(1): r383 (CALL+RET)->(JP)
   566                          ;        CALL VDPUNLOCK
   567  012a  c30000            	JP VDPUNLOCK
   568                          ;        RET
   569                          VDPOUTCHAR:
   570  012d  cd0000            	CALL VDPLOCK
   571  0130  f5                	PUSH AF
   572  0131  cd0000            	CALL    VDPWRITEADDR
   573  0134  f1                	POP AF
   574  0135  cd0000            	CALL    VDPRAMOUT
   575                          ; peephole(1): r383 (CALL+RET)->(JP)
   576                          ;        CALL VDPUNLOCK
   577  0138  c30000            	JP VDPUNLOCK
   578                          ;        RET
   579                          VDPINCHAR:
   580  013b  cd0000            	CALL VDPLOCK
   581  013e  f5                	PUSH AF
   582  013f  cd0000            	CALL    VDPREADADDR
   583  0142  f1                	POP AF
   584  0143  cd0000            	CALL    VDPRAMIN
   585                          ; peephole(1): r383 (CALL+RET)->(JP)
   586                          ;        CALL VDPUNLOCK
   587  0146  c30000            	JP VDPUNLOCK
   588                          ;        RET
   589                          VDPWRITE:
   590  0149  cd0000            	CALL VDPLOCK
   591  014c  cd0000            	CALL    VDPWRITEADDR
   592                          VDPWRITELOOP:
   593  014f  7e                	LD      A, (HL)
   594  0150  cd0000            	CALL    VDPRAMOUT
   595  0153  23                	INC     HL
   596  0154  0b                	DEC     BC
   597  0155  78                	LD      A, B
   598  0156  b1                	OR      C
   599  0157  c20000            	JP      NZ, VDPWRITELOOP
   600                          ; peephole(1): r383 (CALL+RET)->(JP)
   601                          ;        CALL VDPUNLOCK
   602  015a  c30000            	JP VDPUNLOCK
   603                          ;        RET
   604                          VDPWRITEOPT:
   605                          	; CALL VDPREGIN
   606                                  ; AND $80
   607                                  ; JR Z, VDPWRITEOPT
   608  015d  cd0000            	CALL VDPLOCK
   609  0160  cd0000            	CALL    VDPWRITEADDR
   610                          VDPWRITEOPTLOOP:
   611                                  ; LD      A, (HL)
   612  0163  c5                	PUSH    BC
   613  0164  79                	LD      A, C
   614  0165  ed4b0000          	LD      BC, (VDPDATAPORTWRITE)
   615  0169  47                	LD      B, A
   616                          VDPWRITEOPTLOOP2:
   617  016a  eda3              	OUTI
   618  016c  c20000            	JP NZ, VDPWRITEOPTLOOP2
   619  016f  c1                	POP     BC
   620                                  ; INC     HL
   621                                  ; DEC     BC
   622                                  ; LD      A, B
   623                                  ; OR      C
   624                                  ; JP      NZ, VDPWRITELOOP
   625                          ; peephole(1): r383 (CALL+RET)->(JP)
   626                          ;        CALL VDPUNLOCK
   627  0170  c30000            	JP VDPUNLOCK
   628                          ;        RET
   629                          VDPWRITE8:
   630  0173  cd0000            	CALL VDPLOCK
   631  0176  cd0000            	CALL    VDPWRITEADDR
   632                          VDPWRITE8LOOP:
   633  0179  7e                	LD      A, (HL)
   634  017a  cd0000            	CALL    VDPRAMOUT8
   635  017d  23                	INC     HL
   636  017e  0b                	DEC     BC
   637  017f  78                	LD      A, B
   638  0180  b1                	OR      C
   639  0181  c20000            	JP      NZ, VDPWRITE8LOOP
   640                          ; peephole(1): r383 (CALL+RET)->(JP)
   641                          ;        CALL VDPUNLOCK
   642  0184  c30000            	JP VDPUNLOCK
   643                          ;        RET
   644                          VDPREAD:
   645  0187  cd0000            	CALL VDPLOCK
   646  018a  cd0000            	CALL    VDPREADADDR
   647  018d  cd0000            	CALL    VDPRAMIN
   648  0190  67                	LD      H, A
   649  0191  6f                	LD      L, A
   650                          ; peephole(1): r383 (CALL+RET)->(JP)
   651                          ;        CALL VDPUNLOCK
   652  0192  c30000            	JP VDPUNLOCK
   653                          ;        RET
   654                          VDPFILL:
   655  0195  cd0000            	CALL VDPLOCK
   656  0198  f5                	PUSH    AF
   657  0199  cd0000            	CALL    VDPWRITEADDR
   658  019c  f1                	POP     AF
   659                          VDPFILLLOOP:
   660  019d  cd0000            	CALL    VDPRAMOUT
   661  01a0  0d                	DEC     C
   662  01a1  c20000            	JP      NZ, VDPFILLLOOP
   663  01a4  1000              	DJNZ    VDPFILLLOOP
   664                          ; peephole(1): r383 (CALL+RET)->(JP)
   665                          ;        CALL VDPUNLOCK
   666  01a6  c30000            	JP VDPUNLOCK
   667                          ;        RET
   668                          VDPFILL8:
   669  01a9  cd0000            	CALL VDPLOCK
   670  01ac  f5                	PUSH    AF
   671  01ad  cd0000            	CALL    VDPWRITEADDR
   672  01b0  f1                	POP     AF
   673                          VDPFILLLOOP8:
   674  01b1  cd0000            	CALL    VDPRAMOUT8
   675  01b4  0d                	DEC     C
   676  01b5  c20000            	JP      NZ, VDPFILLLOOP8
   677                          ; peephole(1): r383 (CALL+RET)->(JP)
   678                          ;        CALL VDPUNLOCK
   679  01b8  c30000            	JP VDPUNLOCK
   680                          ;        RET
   681                          VDPFILLA:
   682  01bb  cd0000            	CALL VDPLOCK
   683  01be  f5                	PUSH    AF
   684  01bf  cd0000            	CALL    VDPWRITEADDR
   685  01c2  f1                	POP     AF
   686                          VDPFILLALOOP:
   687  01c3  cd0000            	CALL    VDPRAMOUT
   688  01c6  0d                	DEC     C
   689  01c7  3c                	INC     A
   690  01c8  c20000            	JP      NZ, VDPFILLALOOP
   691  01cb  1000              	DJNZ    VDPFILLALOOP
   692                          ; peephole(1): r383 (CALL+RET)->(JP)
   693                          ;        CALL VDPUNLOCK
   694  01cd  c30000            	JP VDPUNLOCK
   695                          ;        RET
   696                          VDP_R0              EQU 80H
   697                          VDP_R1              EQU 81H
   698                          VDP_RNAME           EQU 82H
   699                          VDP_RCOLORTABLE     EQU 83H
   700                          VDP_RPATTERN        EQU 84H
   701                          VDP_RSPRITEA        EQU 85H
   702                          VDP_RSPRITEP        EQU 86H
   703                          VDP_RCOLOR          EQU 87H
   704                          ONSCROLLVOID:
   705  01d0  c9                	RET
   706                          TMS9918STARTUP:
   707                          
   708  01d1  3e00              	LD A, 16
   709  01d3  4f                	LD C, A
   710                          ; peephole(1): r228 (LD A, 0)->(XOR A)
   711                          ;        LD A, 0
   712  01d4  af                	XOR A
   713  01d5  210000            	LD HL, PALETTE
   714                          TMS9918STARTUPL1:
   715  01d8  77                	LD (HL), A
   716  01d9  23                	INC HL
   717  01da  3c                	INC A
   718  01db  0d                	DEC C
   719  01dc  2000              	JR NZ, TMS9918STARTUPL1
   720  01de  cd0000            	CALL VDPLOCK
   721  01e1  3e00              	LD A, VDP_R0
   722  01e3  5f                	LD E, A
   723  01e4  3e00              	LD A, $00
   724  01e6  cd0000            	CALL VDPSETREG
   725  01e9  3e00              	LD A, VDP_RNAME
   726  01eb  5f                	LD E, A
   727  01ec  3e00              	LD A, $06
   728  01ee  cd0000            	CALL VDPSETREG
   729  01f1  3e00              	LD A, VDP_RCOLORTABLE
   730  01f3  5f                	LD E, A
   731  01f4  3e00              	LD A, $80
   732  01f6  cd0000            	CALL VDPSETREG
   733  01f9  3e00              	LD A, VDP_RPATTERN
   734  01fb  5f                	LD E, A
   735  01fc  3e00              	LD A, $00
   736  01fe  cd0000            	CALL VDPSETREG
   737  0201  3e00              	LD A, VDP_RSPRITEA
   738  0203  5f                	LD E, A
   739  0204  3e00              	LD A, $36
   740  0206  cd0000            	CALL VDPSETREG
   741  0209  3e00              	LD A, VDP_RSPRITEP
   742  020b  5f                	LD E, A
   743  020c  3e00              	LD A, $07
   744  020e  cd0000            	CALL VDPSETREG
   745  0211  3e00              	LD A, VDP_RCOLOR
   746  0213  5f                	LD E, A
   747  0214  3e00              	LD A, $F1
   748  0216  cd0000            	CALL VDPSETREG
   749  0219  3e00              	LD A, VDP_R1
   750  021b  5f                	LD E, A
   751  021c  3e00              	LD A, $e2
   752  021e  cd0000            	CALL VDPSETREG
   753  0221  3e00              	LD A, $C3
   754  0223  210000            	LD HL, ONSCROLLUP
   755  0226  77                	LD (HL), A
   756  0227  23                	INC HL
   757  0228  110000            	LD DE, ONSCROLLVOID
   758  022b  7b                	LD A, E
   759  022c  77                	LD (HL), A
   760  022d  23                	INC HL
   761  022e  7a                	LD A, D
   762  022f  77                	LD (HL), A
   763  0230  3e00              	LD A, $C3
   764  0232  210000            	LD HL, ONSCROLLDOWN
   765  0235  77                	LD (HL), A
   766  0236  23                	INC HL
   767  0237  7b                	LD A, E
   768  0238  77                	LD (HL), A
   769  0239  23                	INC HL
   770  023a  7a                	LD A, D
   771  023b  77                	LD (HL), A
   772  023c  3e00              	LD A, $C3
   773  023e  210000            	LD HL, ONSCROLLLEFT
   774  0241  77                	LD (HL), A
   775  0242  23                	INC HL
   776  0243  7b                	LD A, E
   777  0244  77                	LD (HL), A
   778  0245  23                	INC HL
   779  0246  7a                	LD A, D
   780  0247  77                	LD (HL), A
   781  0248  3e00              	LD A, $C3
   782  024a  210000            	LD HL, ONSCROLLRIGHT
   783  024d  77                	LD (HL), A
   784  024e  23                	INC HL
   785  024f  7b                	LD A, E
   786  0250  77                	LD (HL), A
   787  0251  23                	INC HL
   788  0252  7a                	LD A, D
   789  0253  77                	LD (HL), A
   790                          ; peephole(1): r383 (CALL+RET)->(JP)
   791                          ;        CALL VDPUNLOCK
   792  0254  c30000            	JP VDPUNLOCK
   793                          ;        RET
   794                          TMS9918SPRITEINIT:
   795  0257  e5                	PUSH HL
   796  0258  2a0000            	LD HL, (SPRITEAADDRESS)
   797  025b  0600              	LD B, 0
   798  025d  0e00              	LD C, 32
   799                          TMS9918SPRITEINITL1:
   800  025f  3e00              	LD A, $D0
   801  0261  545d              	LD DE, HL
   802  0263  cd0000            	CALL VDPOUTCHAR
   803  0266  23                	INC HL
   804  0267  23                	INC HL
   805  0268  23                	INC HL
   806  0269  23                	INC HL
   807  026a  0d                	DEC C
   808  026b  2000              	JR NZ, TMS9918SPRITEINITL1
   809  026d  c9                	RET
   810                          WAITVBL:
   811                          ; peephole(1): r228 (LD A, 0)->(XOR A)
   812                          ;        LD A, 0
   813  026e  af                	XOR A
   814  026f  320000            	LD (VBLFLAG), A
   815                          WAITVBL2:
   816  0272  3a0000            	LD A, (VBLFLAG)
   817  0275  fe00              	CP 0
   818  0277  2800              	JR Z, WAITVBL2
   819  0279  c9                	RET
   820                          tms9918startup_after:
   821  027a  cd0000            	CALL TMS9918STARTUP
   822  027d  3e00              	LD A, $0f
   823  027f  320000            	LD (_PEN), A
   824  0282  3e00              	LD A, $01
   825  0284  320000            	LD (_PAPER), A
   826  0287  3e00              	LD A, $80
   827  0289  5f                	LD E, A
   828  028a  3e00              	LD A, $02
   829  028c  cd0000            	CALL VDPSETREG
   830  028f  3e00              	LD A, $81
   831  0291  5f                	LD E, A
   832  0292  3e00              	LD A, $80
   833  0294  cd0000            	CALL VDPSETREG
   834  0297  3e00              	LD A, $82
   835  0299  5f                	LD E, A
   836  029a  3e00              	LD A, $0e
   837  029c  cd0000            	CALL VDPSETREG
   838  029f  3e00              	LD A, $00
   839  02a1  320000            	LD (TEXTADDRESS), A
   840  02a4  3e00              	LD A, $38
   841  02a6  320000            	LD (TEXTADDRESS+1), A
   842  02a9  3e00              	LD A, $83
   843  02ab  5f                	LD E, A
   844  02ac  3e00              	LD A, $ff
   845  02ae  cd0000            	CALL VDPSETREG
   846  02b1  3e00              	LD A, $00
   847  02b3  320000            	LD (COLORMAPADDRESS), A
   848  02b6  3e00              	LD A, $20
   849  02b8  320000            	LD (COLORMAPADDRESS+1), A
   850  02bb  3e00              	LD A, $84
   851  02bd  5f                	LD E, A
   852  02be  3e00              	LD A, $03
   853  02c0  cd0000            	CALL VDPSETREG
   854  02c3  3e00              	LD A, $00
   855  02c5  320000            	LD (PATTERNADDRESS), A
   856                          ; peephole(1): r250 (LD A, x; LD (x), A; LD A, x)->(LD A, x; LD (x), A)
   857                          ;	LD A, $00
   858  02c8  320000            	LD (PATTERNADDRESS+1), A
   859  02cb  3e00              	LD A, $85
   860  02cd  5f                	LD E, A
   861  02ce  3e00              	LD A, $76
   862  02d0  cd0000            	CALL VDPSETREG
   863  02d3  3e00              	LD A, $86
   864  02d5  5f                	LD E, A
   865  02d6  3e00              	LD A, $03
   866  02d8  cd0000            	CALL VDPSETREG
   867  02db  3e00              	LD A, $00
   868  02dd  320000            	LD (SPRITEAADDRESS), A
   869  02e0  3e00              	LD A, $3b
   870  02e2  320000            	LD (SPRITEAADDRESS+1), A
   871  02e5  3e00              	LD A, $00
   872  02e7  320000            	LD (SPRITEADDRESS), A
   873  02ea  3e00              	LD A, $18
   874  02ec  320000            	LD (SPRITEADDRESS+1), A
   875  02ef  cd0000            	CALL TMS9918AUDCCHAR23
   876  02f2  cd0000            	CALL TMS9918SPRITEINIT
   877  02f5  3e00              	LD A, $81
   878  02f7  5f                	LD E, A
   879  02f8  3e00              	LD A, $e2
   880  02fa  cd0000            	CALL VDPSETREG
   881  02fd  3e00              	LD A, $00
   882                          ; peephole(3): unread
   883                          ;	LD (CLIPX1), A
   884                          ; peephole(1): r250 (LD A, x; LD (x), A; LD A, x)->(LD A, x; LD (x), A)
   885                          ;	LD A, $00
   886                          ; peephole(3): unread
   887                          ;	LD (CLIPX1+1), A
   888  02ff  3e00              	LD A, $ff
   889                          ; peephole(3): unread
   890                          ;	LD (CLIPX2), A
   891                          ; peephole(4): r407 (LD A, *; LD A, *)->(LD, A)
   892                          ;	LD A, $00
   893                          ; peephole(3): unread
   894                          ;	LD (CLIPX2+1), A
   895                          ; peephole(1): r250 (LD A, x; LD (x), A; LD A, x)->(LD A, x; LD (x), A)
   896                          ;	LD A, $00
   897                          ; peephole(3): unread
   898                          ;	LD (CLIPY1), A
   899                          ; peephole(5): r407 (LD A, *; LD A, *)->(LD, A)
   900                          ;	LD A, $00
   901                          ; peephole(3): unread
   902                          ;	LD (CLIPY1+1), A
   903  0301  3e00              	LD A, $bf
   904                          ; peephole(3): unread
   905                          ;	LD (CLIPY2), A
   906                          ; peephole(4): r407 (LD A, *; LD A, *)->(LD, A)
   907                          ;	LD A, $00
   908                          ; peephole(3): unread
   909                          ;	LD (CLIPY2+1), A
   910                          ; peephole(1): r250 (LD A, x; LD (x), A; LD A, x)->(LD A, x; LD (x), A)
   911                          ;	LD A, $00
   912  0303  320000            	LD (ORIGINX), A
   913  0306  3e00              	LD A, $00
   914  0308  320000            	LD (ORIGINX+1), A
   915                          ; peephole(1): r250 (LD A, x; LD (x), A; LD A, x)->(LD A, x; LD (x), A)
   916                          ;	LD A, $00
   917  030b  320000            	LD (ORIGINY), A
   918  030e  3e00              	LD A, $00
   919  0310  320000            	LD (ORIGINY+1), A
   920                          ; peephole(1): r250 (LD A, x; LD (x), A; LD A, x)->(LD A, x; LD (x), A)
   921                          ;	LD A, $00
   922  0313  320000            	LD (CURRENTWIDTH), A
   923  0316  3e00              	LD A, $01
   924  0318  320000            	LD (CURRENTWIDTH+1), A
   925  031b  3e00              	LD A, $c0
   926  031d  320000            	LD (CURRENTHEIGHT), A
   927  0320  3e00              	LD A, $00
   928  0322  320000            	LD (CURRENTHEIGHT+1), A
   929  0325  3a0000            	LD A, (CURRENTWIDTH)
   930  0328  320000            	LD (RESOLUTIONX), A
   931  032b  3a0000            	LD A, (CURRENTWIDTH+1)
   932  032e  320000            	LD (RESOLUTIONX+1), A
   933  0331  3a0000            	LD A, (CURRENTHEIGHT)
   934  0334  320000            	LD (RESOLUTIONY), A
   935  0337  3a0000            	LD A, (CURRENTHEIGHT+1)
   936  033a  320000            	LD (RESOLUTIONY+1), A
   937  033d  3e00              	LD A, $ff
   938                          ; peephole(3): unread
   939                          ;	LD (CURRENTTILES), A
   940  033f  3e00              	LD A, $20
   941  0341  320000            	LD (CURRENTTILESWIDTH), A
   942  0344  3e00              	LD A, $00
   943                          ; peephole(3): unread
   944                          ;	LD (CURRENTTILESWIDTHX8), A
   945  0346  3e00              	LD A, $18
   946  0348  320000            	LD (CURRENTTILESHEIGHT), A
   947  034b  3e00              	LD A, $08
   948                          ; peephole(3): unread
   949                          ;	LD (FONTWIDTH), A
   950                          ; peephole(1): r250 (LD A, x; LD (x), A; LD A, x)->(LD A, x; LD (x), A)
   951                          ;	LD A, $08
   952                          ; peephole(3): unread
   953                          ;	LD (FONTHEIGHT), A
   954  034d  3e00              	LD A, $02
   955  034f  320000            	LD (CURRENTMODE), A
   956  0352  3e00              	LD A, $01
   957  0354  320000            	LD (CURRENTTILEMODE), A
   958  0357  c30000            	jp clsText_after
   959                          ; /*****************************************************************************
   960                          ;  * ugBASIC - an isomorphic BASIC language compiler for retrocomputers        *
   961                          ;  *****************************************************************************
   962                          ;  * Copyright 2021-2023 Marco Spedaletti (asimov@mclink.it)
   963                          ;  *
   964                          ;  * Licensed under the Apache License, Version 2.0 (the "License");
   965                          ;  * you may not use this file except in compliance with the License.
   966                          ;  * You may obtain a copy of the License at
   967                          ;  *
   968                          ;  * http://www.apache.org/licenses/LICENSE-2.0
   969                          ;  *
   970                          ;  * Unless required by applicable law or agreed to in writing, software
   971                          ;  * distributed under the License is distributed on an "AS IS" BASIS,
   972                          ;  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   973                          ;  * See the License for the specific language governing permissions and
   974                          ;  * limitations under the License.
   975                          ;  *----------------------------------------------------------------------------
   976                          ;  * Concesso in licenza secondo i termini della Licenza Apache, versione 2.0
   977                          ;  * (la "Licenza"); è proibito usare questo file se non in conformità alla
   978                          ;  * Licenza. Una copia della Licenza è disponibile all'indirizzo:
   979                          ;  *
   980                          ;  * http://www.apache.org/licenses/LICENSE-2.0
   981                          ;  *
   982                          ;  * Se non richiesto dalla legislazione vigente o concordato per iscritto,
   983                          ;  * il software distribuito nei termini della Licenza è distribuito
   984                          ;  * "COSì COM'è", SENZA GARANZIE O CONDIZIONI DI ALCUN TIPO, esplicite o
   985                          ;  * implicite. Consultare la Licenza per il testo specifico che regola le
   986                          ;  * autorizzazioni e le limitazioni previste dalla medesima.
   987                          ;  ****************************************************************************/
   988                          ;* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
   989                          ;*                                                                             *
   990                          ;*                      CLEAR SCREEN ROUTINE FOR TMS9918 (text mode)           *
   991                          ;*                                                                             *
   992                          ;*                             by Marco Spedaletti                             *
   993                          ;*                                                                             *
   994                          ;* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
   995                          ; 			        NAME		COLOR		PATTERN
   996                          ; VDPUPDATE0: 		$1800		            $0000 (coleco)
   997                          ; VDPUPDATE1:		$1800		$0480		$0000 (coleco)
   998                          ; VDPUPDATE2:		$3800		$2000
   999                          ; VDPUPDATE3:		$3800		$2000		$0000
  1000                          ; if __coleco__
  1001                          ; CLST:
  1002                          ;     CALL WAIT_VDP_HOOK
  1003                          ;     LD HL, CLSTNMI
  1004                          ;     CALL SET_VDP_HOOK0
  1005                          ;     CALL WAIT_VDP_HOOK
  1006                          ;     RET
  1007                          ; CLSTNMI:
  1008                          ; else
  1009                          CLST:
  1010                          ; endif
  1011                          CLSTNMI2:
  1012  035a  3a0000            	LD A, (CURRENTTILEMODE)
  1013  035d  fe00              	CP 0
  1014  035f  c8                	RET Z
  1015  0360  3a0000            	LD A, (CURRENTMODE)
  1016  0363  fe00              	CP 0
  1017  0365  2800              	JR Z,CLST0
  1018  0367  fe00              	CP 1
  1019  0369  2800              	JR Z,CLST1
  1020  036b  fe00              	CP 2
  1021  036d  2800              	JR Z,CLST2
  1022  036f  fe00              	CP 3
  1023  0371  2800              	JR Z,CLST3
  1024  0373  c30000            	JP CLSTDONE
  1025                          CLST0:
  1026  0376  3a0000            	LD A, (EMPTYTILE)
  1027  0379  010000            	LD BC, $100 + 40*24
  1028  037c  ed5b0000          	LD DE, (TEXTADDRESS)
  1029  0380  cd0000            	CALL VDPFILL
  1030  0383  c30000            	JP CLSTDONE
  1031                          CLST1:
  1032  0386  3a0000            	LD A, (EMPTYTILE)
  1033  0389  010000            	LD BC, $100 + 32*24
  1034  038c  ed5b0000          	LD DE, (TEXTADDRESS)
  1035  0390  cd0000            	CALL VDPFILL
  1036  0393  3a0000            	LD A, (_PAPER)
  1037  0396  010000            	LD BC, $100 + 32
  1038  0399  ed5b0000          	LD DE, (COLORMAPADDRESS)
  1039  039d  cd0000            	CALL VDPFILL
  1040  03a0  c30000            	JP CLSTDONE
  1041                          CLST2:
  1042                          CLST3:
  1043  03a3  3a0000            	LD A, (EMPTYTILE)
  1044  03a6  010000            	LD BC, $100 + 32*24
  1045  03a9  ed5b0000          	LD DE, (TEXTADDRESS)
  1046  03ad  cd0000            	CALL VDPFILL
  1047  03b0  3a0000            	LD A, (_PAPER)
  1048  03b3  010000            	LD BC, 32*24*8
  1049  03b6  ed5b0000          	LD DE, (COLORMAPADDRESS)
  1050  03ba  cd0000            	CALL VDPFILL
  1051  03bd  c30000            	JP CLSTDONE
  1052                          CLSTDONE:
  1053  03c0  c9                	RET
  1054                          clsText_after:
  1055  03c1  cd0000            	CALL CLST
  1056  03c4  cd0000            	call AY8910STARTUP
  1057                          	; L:0
  1058                          	; P:594
  1059                          	; L:1
  1060                          	; P:0
  1061                          	; L:2
  1062                          	; P:0
  1063                          	; L:3
  1064                          	; P:0
  1065                          	; L:4
  1066                          	; P:0
  1067                          	; L:5
  1068                          	; P:0
  1069                          	; L:6
  1070                          	; P:0
  1071                          	; L:7
  1072                          	; P:0
  1073                          	; L:8
  1074                          	; P:0
  1075                          	; L:9
  1076                          	; P:0
  1077                          	; L:10
  1078                          	; P:0
  1079                          	; L:11
  1080                          	; P:0
  1081                          	; L:12
  1082                          	; P:0
  1083                          	; L:13
  1084                          	; P:0
  1085                          	; L:14
  1086  03c7  cd0000            	CALL CLST
  1087                          	; P:1
  1088                          	; L:15
  1089                          	; P:0
  1090                          	; L:16
  1091                          	; P:0
  1092                          	; L:17
  1093                          	; P:0
  1094                          	; L:18
  1095  03ca  3e00              	LD A, $01
  1096  03cc  320000            	LD (_Ttmp1), A
  1097                          ; peephole(1): r250 (LD A, x; LD (x), A; LD A, x)->(LD A, x; LD (x), A)
  1098                          ;	LD A, $01
  1099  03cf  320000            	LD (_Ttmp2), A
  1100  03d2  3e00              	LD A, $01
  1101  03d4  320000            	LD (_Ttmp3), A
  1102  03d7  3a0000            	LD A, (_Ttmp3)
  1103  03da  fe00              	CP $00
  1104  03dc  ca0000            	JP Z, _label7
  1105  03df  3a0000            	LD A, (_Tbit5)
  1106  03e2  f600              	OR $01
  1107  03e4  320000            	LD (_Tbit5), A
  1108  03e7  c30000            	jp _label7done
  1109                          _label7:
  1110  03ea  3a0000            	LD A, (_Tbit5)
  1111  03ed  e600              	AND $fe
  1112  03ef  320000            	LD (_Tbit5), A
  1113                          _label7done:
  1114  03f2  3e00              	LD A, $00
  1115  03f4  320000            	LD (_Ttmp12), A
  1116                          ; peephole(1): r250 (LD A, x; LD (x), A; LD A, x)->(LD A, x; LD (x), A)
  1117                          ;	LD A, $00
  1118  03f7  320000            	LD (_Ttmp12+1), A
  1119  03fa  3e00              	LD A, $00
  1120  03fc  320000            	LD (_Ttmp13), A
  1121                          ; peephole(1): r250 (LD A, x; LD (x), A; LD A, x)->(LD A, x; LD (x), A)
  1122                          ;	LD A, $00
  1123  03ff  320000            	LD (_Ttmp13+1), A
  1124  0402  3a0000            	LD A, (_Ttmp1)
  1125  0405  320000            	LD (_Ttmp13), A
  1126  0408  2a0000            	LD HL, (_Ttmp12)
  1127  040b  ed5b0000          	LD DE, (_Ttmp13)
  1128  040f  19                	ADD HL, DE
  1129  0410  220000            	LD (_Ttmp12), HL
  1130  0413  3e00              	LD A, $0a
  1131  0415  320000            	LD (_Ttmp11), A
  1132  0418  3e00              	LD A, $00
  1133  041a  320000            	LD (_Ttmp11+1), A
  1134                          ; peephole(1): r250 (LD A, x; LD (x), A; LD A, x)->(LD A, x; LD (x), A)
  1135                          ;	LD A, $00
  1136  041d  320000            	LD (_Ttmp17), A
  1137  0420  3e00              	LD A, $00
  1138  0422  320000            	LD (_Ttmp17+1), A
  1139  0425  3a0000            	LD A, (_Ttmp2)
  1140  0428  320000            	LD (_Ttmp17), A
  1141  042b  ed4b0000          	LD BC, (_Ttmp17)
  1142  042f  ed5b0000          	LD DE, (_Ttmp11)
  1143  0433  79                	LD A, C
  1144  0434  48                	LD C, B
  1145  0435  210000            	LD HL, 0
  1146  0438  0600              	LD B, 16
  1147                          _label22:
  1148  043a  29                	ADD HL, HL
  1149  043b  17                	RLA
  1150  043c  cb11              	RL C
  1151  043e  3000              	JR NC,_label22b2
  1152  0440  19                	ADD HL, DE
  1153  0441  ce00              	ADC A, 0
  1154  0443  d20000            	JP NC,_label22b2
  1155  0446  0c                	INC C
  1156                          _label22b2:
  1157  0447  1000              	DJNZ _label22
  1158  0449  41                	LD B, C
  1159  044a  4f                	LD C, A
  1160  044b  220000            	LD (_Ttmp21), HL
  1161  044e  ed430000          	LD (_Ttmp21+2), BC
  1162  0452  3a0000            	LD A, (_Ttmp21)
  1163  0455  320000            	LD (_Ttmp23), A
  1164  0458  3a0000            	LD A, (_Ttmp21+1)
  1165  045b  320000            	LD (_Ttmp23+1), A
  1166  045e  2a0000            	LD HL, (_Ttmp12)
  1167  0461  ed5b0000          	LD DE, (_Ttmp23)
  1168  0465  19                	ADD HL, DE
  1169  0466  220000            	LD (_Ttmp12), HL
  1170  0469  3a0000            	LD A, (_Ttmp12)
  1171  046c  320000            	LD (_Ttmp25), A
  1172  046f  3a0000            	LD A, (_Ttmp25)
  1173  0472  e600              	AND $07
  1174  0474  320000            	LD (_Ttmp25), A
  1175  0477  3a0000            	LD A, (_Ttmp12)
  1176  047a  320000            	LD (_Ttmp27), A
  1177  047d  3a0000            	LD A, (_Ttmp12+1)
  1178  0480  320000            	LD (_Ttmp27+1), A
  1179  0483  2a0000            	LD HL, (_Ttmp27)
  1180  0486  cb2c              	SRA H
  1181  0488  cb1d              	RR L
  1182  048a  cb2c              	SRA H
  1183  048c  cb1d              	RR L
  1184  048e  cb2c              	SRA H
  1185  0490  cb1d              	RR L
  1186  0492  220000            	LD (_Ttmp27), HL
  1187  0495  e600              	AND $0
  1188  0497  2a0000            	LD HL, (_Ttmp27)
  1189  049a  110000            	LD DE, _a
  1190  049d  19                	ADD HL, DE
  1191  049e  220000            	LD (_Ttmp27), HL
  1192  04a1  210000            	LD HL, _Tbit5
  1193  04a4  7e                	LD A, (HL)
  1194  04a5  cb47              	BIT $0, A
  1195  04a7  2800              	JR Z, _label32zero
  1196  04a9  3e00              	LD A, $ff
  1197  04ab  320000            	LD (_Ttmp31), A
  1198  04ae  c30000            	JMP _label32done
  1199                          _label32zero:
  1200                          ; peephole(1): r228 (LD A, 0)->(XOR A)
  1201                          ;	LD A, 0
  1202  04b1  af                	XOR A
  1203  04b2  320000            	LD (_Ttmp31), A
  1204                          _label32done:
  1205  04b5  3a0000            	LD A, (_Ttmp31)
  1206  04b8  fe00              	CP $00
  1207  04ba  ca0000            	JP Z, _label29zero
  1208  04bd  210000            	LD HL, BITMASK
  1209  04c0  ed5b0000          	LD DE, (_Ttmp25)
  1210  04c4  19                	ADD HL, DE
  1211  04c5  ed5b0000          	LD DE, (_Ttmp27)
  1212  04c9  1a                	LD A, (DE)
  1213  04ca  b6                	OR (HL)
  1214  04cb  12                	LD (DE), A
  1215  04cc  c30000            	jp _label29
  1216                          _label29zero:
  1217  04cf  210000            	LD HL, BITMASKN
  1218  04d2  ed5b0000          	LD DE, (_Ttmp25)
  1219  04d6  19                	ADD HL, DE
  1220  04d7  ed5b0000          	LD DE, (_Ttmp27)
  1221  04db  1a                	LD A, (DE)
  1222  04dc  a6                	AND (HL)
  1223  04dd  12                	LD (DE), A
  1224                          _label29:
  1225                          	; P:124
  1226                          	; L:19
  1227  04de  3e00              	LD A, $01
  1228  04e0  320000            	LD (_Ttmp1), A
  1229  04e3  3e00              	LD A, $02
  1230  04e5  320000            	LD (_Ttmp2), A
  1231  04e8  3e00              	LD A, $01
  1232  04ea  320000            	LD (_Ttmp3), A
  1233  04ed  3a0000            	LD A, (_Ttmp3)
  1234  04f0  fe00              	CP $00
  1235  04f2  ca0000            	JP Z, _label37
  1236  04f5  3a0000            	LD A, (_Tbit5)
  1237  04f8  f600              	OR $01
  1238  04fa  320000            	LD (_Tbit5), A
  1239  04fd  c30000            	jp _label37done
  1240                          _label37:
  1241  0500  3a0000            	LD A, (_Tbit5)
  1242  0503  e600              	AND $fe
  1243  0505  320000            	LD (_Tbit5), A
  1244                          _label37done:
  1245  0508  3e00              	LD A, $00
  1246  050a  320000            	LD (_Ttmp12), A
  1247                          ; peephole(1): r250 (LD A, x; LD (x), A; LD A, x)->(LD A, x; LD (x), A)
  1248                          ;	LD A, $00
  1249  050d  320000            	LD (_Ttmp12+1), A
  1250  0510  3e00              	LD A, $00
  1251  0512  320000            	LD (_Ttmp13), A
  1252                          ; peephole(1): r250 (LD A, x; LD (x), A; LD A, x)->(LD A, x; LD (x), A)
  1253                          ;	LD A, $00
  1254  0515  320000            	LD (_Ttmp13+1), A
  1255  0518  3a0000            	LD A, (_Ttmp1)
  1256  051b  320000            	LD (_Ttmp13), A
  1257  051e  2a0000            	LD HL, (_Ttmp12)
  1258  0521  ed5b0000          	LD DE, (_Ttmp13)
  1259  0525  19                	ADD HL, DE
  1260  0526  220000            	LD (_Ttmp12), HL
  1261  0529  3e00              	LD A, $0a
  1262  052b  320000            	LD (_Ttmp11), A
  1263  052e  3e00              	LD A, $00
  1264  0530  320000            	LD (_Ttmp11+1), A
  1265                          ; peephole(1): r250 (LD A, x; LD (x), A; LD A, x)->(LD A, x; LD (x), A)
  1266                          ;	LD A, $00
  1267  0533  320000            	LD (_Ttmp17), A
  1268  0536  3e00              	LD A, $00
  1269  0538  320000            	LD (_Ttmp17+1), A
  1270  053b  3a0000            	LD A, (_Ttmp2)
  1271  053e  320000            	LD (_Ttmp17), A
  1272  0541  ed4b0000          	LD BC, (_Ttmp17)
  1273  0545  ed5b0000          	LD DE, (_Ttmp11)
  1274  0549  79                	LD A, C
  1275  054a  48                	LD C, B
  1276  054b  210000            	LD HL, 0
  1277  054e  0600              	LD B, 16
  1278                          _label43:
  1279  0550  29                	ADD HL, HL
  1280  0551  17                	RLA
  1281  0552  cb11              	RL C
  1282  0554  3000              	JR NC,_label43b2
  1283  0556  19                	ADD HL, DE
  1284  0557  ce00              	ADC A, 0
  1285  0559  d20000            	JP NC,_label43b2
  1286  055c  0c                	INC C
  1287                          _label43b2:
  1288  055d  1000              	DJNZ _label43
  1289  055f  41                	LD B, C
  1290  0560  4f                	LD C, A
  1291  0561  220000            	LD (_Ttmp21), HL
  1292  0564  ed430000          	LD (_Ttmp21+2), BC
  1293  0568  3a0000            	LD A, (_Ttmp21)
  1294  056b  320000            	LD (_Ttmp23), A
  1295  056e  3a0000            	LD A, (_Ttmp21+1)
  1296  0571  320000            	LD (_Ttmp23+1), A
  1297  0574  2a0000            	LD HL, (_Ttmp12)
  1298  0577  ed5b0000          	LD DE, (_Ttmp23)
  1299  057b  19                	ADD HL, DE
  1300  057c  220000            	LD (_Ttmp12), HL
  1301  057f  3a0000            	LD A, (_Ttmp12)
  1302  0582  320000            	LD (_Ttmp25), A
  1303  0585  3a0000            	LD A, (_Ttmp25)
  1304  0588  e600              	AND $07
  1305  058a  320000            	LD (_Ttmp25), A
  1306  058d  3a0000            	LD A, (_Ttmp12)
  1307  0590  320000            	LD (_Ttmp27), A
  1308  0593  3a0000            	LD A, (_Ttmp12+1)
  1309  0596  320000            	LD (_Ttmp27+1), A
  1310  0599  2a0000            	LD HL, (_Ttmp27)
  1311  059c  cb2c              	SRA H
  1312  059e  cb1d              	RR L
  1313  05a0  cb2c              	SRA H
  1314  05a2  cb1d              	RR L
  1315  05a4  cb2c              	SRA H
  1316  05a6  cb1d              	RR L
  1317  05a8  220000            	LD (_Ttmp27), HL
  1318  05ab  e600              	AND $0
  1319  05ad  2a0000            	LD HL, (_Ttmp27)
  1320  05b0  110000            	LD DE, _a
  1321  05b3  19                	ADD HL, DE
  1322  05b4  220000            	LD (_Ttmp27), HL
  1323  05b7  210000            	LD HL, _Tbit5
  1324  05ba  7e                	LD A, (HL)
  1325  05bb  cb47              	BIT $0, A
  1326  05bd  2800              	JR Z, _label47zero
  1327  05bf  3e00              	LD A, $ff
  1328  05c1  320000            	LD (_Ttmp31), A
  1329  05c4  c30000            	JMP _label47done
  1330                          _label47zero:
  1331                          ; peephole(1): r228 (LD A, 0)->(XOR A)
  1332                          ;	LD A, 0
  1333  05c7  af                	XOR A
  1334  05c8  320000            	LD (_Ttmp31), A
  1335                          _label47done:
  1336  05cb  3a0000            	LD A, (_Ttmp31)
  1337  05ce  fe00              	CP $00
  1338  05d0  ca0000            	JP Z, _label45zero
  1339  05d3  210000            	LD HL, BITMASK
  1340  05d6  ed5b0000          	LD DE, (_Ttmp25)
  1341  05da  19                	ADD HL, DE
  1342  05db  ed5b0000          	LD DE, (_Ttmp27)
  1343  05df  1a                	LD A, (DE)
  1344  05e0  b6                	OR (HL)
  1345  05e1  12                	LD (DE), A
  1346  05e2  c30000            	jp _label45
  1347                          _label45zero:
  1348  05e5  210000            	LD HL, BITMASKN
  1349  05e8  ed5b0000          	LD DE, (_Ttmp25)
  1350  05ec  19                	ADD HL, DE
  1351  05ed  ed5b0000          	LD DE, (_Ttmp27)
  1352  05f1  1a                	LD A, (DE)
  1353  05f2  a6                	AND (HL)
  1354  05f3  12                	LD (DE), A
  1355                          _label45:
  1356                          	; P:124
  1357                          	; L:20
  1358  05f4  3e00              	LD A, $01
  1359  05f6  320000            	LD (_Ttmp1), A
  1360  05f9  3e00              	LD A, $03
  1361  05fb  320000            	LD (_Ttmp2), A
  1362  05fe  3e00              	LD A, $01
  1363  0600  320000            	LD (_Ttmp3), A
  1364  0603  3a0000            	LD A, (_Ttmp3)
  1365  0606  fe00              	CP $00
  1366  0608  ca0000            	JP Z, _label52
  1367  060b  3a0000            	LD A, (_Tbit5)
  1368  060e  f600              	OR $01
  1369  0610  320000            	LD (_Tbit5), A
  1370  0613  c30000            	jp _label52done
  1371                          _label52:
  1372  0616  3a0000            	LD A, (_Tbit5)
  1373  0619  e600              	AND $fe
  1374  061b  320000            	LD (_Tbit5), A
  1375                          _label52done:
  1376  061e  3e00              	LD A, $00
  1377  0620  320000            	LD (_Ttmp12), A
  1378                          ; peephole(1): r250 (LD A, x; LD (x), A; LD A, x)->(LD A, x; LD (x), A)
  1379                          ;	LD A, $00
  1380  0623  320000            	LD (_Ttmp12+1), A
  1381  0626  3e00              	LD A, $00
  1382  0628  320000            	LD (_Ttmp13), A
  1383                          ; peephole(1): r250 (LD A, x; LD (x), A; LD A, x)->(LD A, x; LD (x), A)
  1384                          ;	LD A, $00
  1385  062b  320000            	LD (_Ttmp13+1), A
  1386  062e  3a0000            	LD A, (_Ttmp1)
  1387  0631  320000            	LD (_Ttmp13), A
  1388  0634  2a0000            	LD HL, (_Ttmp12)
  1389  0637  ed5b0000          	LD DE, (_Ttmp13)
  1390  063b  19                	ADD HL, DE
  1391  063c  220000            	LD (_Ttmp12), HL
  1392  063f  3e00              	LD A, $0a
  1393  0641  320000            	LD (_Ttmp11), A
  1394  0644  3e00              	LD A, $00
  1395  0646  320000            	LD (_Ttmp11+1), A
  1396                          ; peephole(1): r250 (LD A, x; LD (x), A; LD A, x)->(LD A, x; LD (x), A)
  1397                          ;	LD A, $00
  1398  0649  320000            	LD (_Ttmp17), A
  1399  064c  3e00              	LD A, $00
  1400  064e  320000            	LD (_Ttmp17+1), A
  1401  0651  3a0000            	LD A, (_Ttmp2)
  1402  0654  320000            	LD (_Ttmp17), A
  1403  0657  ed4b0000          	LD BC, (_Ttmp17)
  1404  065b  ed5b0000          	LD DE, (_Ttmp11)
  1405  065f  79                	LD A, C
  1406  0660  48                	LD C, B
  1407  0661  210000            	LD HL, 0
  1408  0664  0600              	LD B, 16
  1409                          _label58:
  1410  0666  29                	ADD HL, HL
  1411  0667  17                	RLA
  1412  0668  cb11              	RL C
  1413  066a  3000              	JR NC,_label58b2
  1414  066c  19                	ADD HL, DE
  1415  066d  ce00              	ADC A, 0
  1416  066f  d20000            	JP NC,_label58b2
  1417  0672  0c                	INC C
  1418                          _label58b2:
  1419  0673  1000              	DJNZ _label58
  1420  0675  41                	LD B, C
  1421  0676  4f                	LD C, A
  1422  0677  220000            	LD (_Ttmp21), HL
  1423  067a  ed430000          	LD (_Ttmp21+2), BC
  1424  067e  3a0000            	LD A, (_Ttmp21)
  1425  0681  320000            	LD (_Ttmp23), A
  1426  0684  3a0000            	LD A, (_Ttmp21+1)
  1427  0687  320000            	LD (_Ttmp23+1), A
  1428  068a  2a0000            	LD HL, (_Ttmp12)
  1429  068d  ed5b0000          	LD DE, (_Ttmp23)
  1430  0691  19                	ADD HL, DE
  1431  0692  220000            	LD (_Ttmp12), HL
  1432  0695  3a0000            	LD A, (_Ttmp12)
  1433  0698  320000            	LD (_Ttmp25), A
  1434  069b  3a0000            	LD A, (_Ttmp25)
  1435  069e  e600              	AND $07
  1436  06a0  320000            	LD (_Ttmp25), A
  1437  06a3  3a0000            	LD A, (_Ttmp12)
  1438  06a6  320000            	LD (_Ttmp27), A
  1439  06a9  3a0000            	LD A, (_Ttmp12+1)
  1440  06ac  320000            	LD (_Ttmp27+1), A
  1441  06af  2a0000            	LD HL, (_Ttmp27)
  1442  06b2  cb2c              	SRA H
  1443  06b4  cb1d              	RR L
  1444  06b6  cb2c              	SRA H
  1445  06b8  cb1d              	RR L
  1446  06ba  cb2c              	SRA H
  1447  06bc  cb1d              	RR L
  1448  06be  220000            	LD (_Ttmp27), HL
  1449  06c1  e600              	AND $0
  1450  06c3  2a0000            	LD HL, (_Ttmp27)
  1451  06c6  110000            	LD DE, _a
  1452  06c9  19                	ADD HL, DE
  1453  06ca  220000            	LD (_Ttmp27), HL
  1454  06cd  210000            	LD HL, _Tbit5
  1455  06d0  7e                	LD A, (HL)
  1456  06d1  cb47              	BIT $0, A
  1457  06d3  2800              	JR Z, _label62zero
  1458  06d5  3e00              	LD A, $ff
  1459  06d7  320000            	LD (_Ttmp31), A
  1460  06da  c30000            	JMP _label62done
  1461                          _label62zero:
  1462                          ; peephole(1): r228 (LD A, 0)->(XOR A)
  1463                          ;	LD A, 0
  1464  06dd  af                	XOR A
  1465  06de  320000            	LD (_Ttmp31), A
  1466                          _label62done:
  1467  06e1  3a0000            	LD A, (_Ttmp31)
  1468  06e4  fe00              	CP $00
  1469  06e6  ca0000            	JP Z, _label60zero
  1470  06e9  210000            	LD HL, BITMASK
  1471  06ec  ed5b0000          	LD DE, (_Ttmp25)
  1472  06f0  19                	ADD HL, DE
  1473  06f1  ed5b0000          	LD DE, (_Ttmp27)
  1474  06f5  1a                	LD A, (DE)
  1475  06f6  b6                	OR (HL)
  1476  06f7  12                	LD (DE), A
  1477  06f8  c30000            	jp _label60
  1478                          _label60zero:
  1479  06fb  210000            	LD HL, BITMASKN
  1480  06fe  ed5b0000          	LD DE, (_Ttmp25)
  1481  0702  19                	ADD HL, DE
  1482  0703  ed5b0000          	LD DE, (_Ttmp27)
  1483  0707  1a                	LD A, (DE)
  1484  0708  a6                	AND (HL)
  1485  0709  12                	LD (DE), A
  1486                          _label60:
  1487                          	; P:124
  1488                          	; L:21
  1489  070a  3e00              	LD A, $02
  1490  070c  320000            	LD (_Ttmp1), A
  1491  070f  3e00              	LD A, $01
  1492  0711  320000            	LD (_Ttmp2), A
  1493                          ; peephole(1): r250 (LD A, x; LD (x), A; LD A, x)->(LD A, x; LD (x), A)
  1494                          ;	LD A, $01
  1495  0714  320000            	LD (_Ttmp3), A
  1496  0717  3a0000            	LD A, (_Ttmp3)
  1497  071a  fe00              	CP $00
  1498  071c  ca0000            	JP Z, _label67
  1499  071f  3a0000            	LD A, (_Tbit5)
  1500  0722  f600              	OR $01
  1501  0724  320000            	LD (_Tbit5), A
  1502  0727  c30000            	jp _label67done
  1503                          _label67:
  1504  072a  3a0000            	LD A, (_Tbit5)
  1505  072d  e600              	AND $fe
  1506  072f  320000            	LD (_Tbit5), A
  1507                          _label67done:
  1508  0732  3e00              	LD A, $00
  1509  0734  320000            	LD (_Ttmp12), A
  1510                          ; peephole(1): r250 (LD A, x; LD (x), A; LD A, x)->(LD A, x; LD (x), A)
  1511                          ;	LD A, $00
  1512  0737  320000            	LD (_Ttmp12+1), A
  1513  073a  3e00              	LD A, $00
  1514  073c  320000            	LD (_Ttmp13), A
  1515                          ; peephole(1): r250 (LD A, x; LD (x), A; LD A, x)->(LD A, x; LD (x), A)
  1516                          ;	LD A, $00
  1517  073f  320000            	LD (_Ttmp13+1), A
  1518  0742  3a0000            	LD A, (_Ttmp1)
  1519  0745  320000            	LD (_Ttmp13), A
  1520  0748  2a0000            	LD HL, (_Ttmp12)
  1521  074b  ed5b0000          	LD DE, (_Ttmp13)
  1522  074f  19                	ADD HL, DE
  1523  0750  220000            	LD (_Ttmp12), HL
  1524  0753  3e00              	LD A, $0a
  1525  0755  320000            	LD (_Ttmp11), A
  1526  0758  3e00              	LD A, $00
  1527  075a  320000            	LD (_Ttmp11+1), A
  1528                          ; peephole(1): r250 (LD A, x; LD (x), A; LD A, x)->(LD A, x; LD (x), A)
  1529                          ;	LD A, $00
  1530  075d  320000            	LD (_Ttmp17), A
  1531  0760  3e00              	LD A, $00
  1532  0762  320000            	LD (_Ttmp17+1), A
  1533  0765  3a0000            	LD A, (_Ttmp2)
  1534  0768  320000            	LD (_Ttmp17), A
  1535  076b  ed4b0000          	LD BC, (_Ttmp17)
  1536  076f  ed5b0000          	LD DE, (_Ttmp11)
  1537  0773  79                	LD A, C
  1538  0774  48                	LD C, B
  1539  0775  210000            	LD HL, 0
  1540  0778  0600              	LD B, 16
  1541                          _label73:
  1542  077a  29                	ADD HL, HL
  1543  077b  17                	RLA
  1544  077c  cb11              	RL C
  1545  077e  3000              	JR NC,_label73b2
  1546  0780  19                	ADD HL, DE
  1547  0781  ce00              	ADC A, 0
  1548  0783  d20000            	JP NC,_label73b2
  1549  0786  0c                	INC C
  1550                          _label73b2:
  1551  0787  1000              	DJNZ _label73
  1552  0789  41                	LD B, C
  1553  078a  4f                	LD C, A
  1554  078b  220000            	LD (_Ttmp21), HL
  1555  078e  ed430000          	LD (_Ttmp21+2), BC
  1556  0792  3a0000            	LD A, (_Ttmp21)
  1557  0795  320000            	LD (_Ttmp23), A
  1558  0798  3a0000            	LD A, (_Ttmp21+1)
  1559  079b  320000            	LD (_Ttmp23+1), A
  1560  079e  2a0000            	LD HL, (_Ttmp12)
  1561  07a1  ed5b0000          	LD DE, (_Ttmp23)
  1562  07a5  19                	ADD HL, DE
  1563  07a6  220000            	LD (_Ttmp12), HL
  1564  07a9  3a0000            	LD A, (_Ttmp12)
  1565  07ac  320000            	LD (_Ttmp25), A
  1566  07af  3a0000            	LD A, (_Ttmp25)
  1567  07b2  e600              	AND $07
  1568  07b4  320000            	LD (_Ttmp25), A
  1569  07b7  3a0000            	LD A, (_Ttmp12)
  1570  07ba  320000            	LD (_Ttmp27), A
  1571  07bd  3a0000            	LD A, (_Ttmp12+1)
  1572  07c0  320000            	LD (_Ttmp27+1), A
  1573  07c3  2a0000            	LD HL, (_Ttmp27)
  1574  07c6  cb2c              	SRA H
  1575  07c8  cb1d              	RR L
  1576  07ca  cb2c              	SRA H
  1577  07cc  cb1d              	RR L
  1578  07ce  cb2c              	SRA H
  1579  07d0  cb1d              	RR L
  1580  07d2  220000            	LD (_Ttmp27), HL
  1581  07d5  e600              	AND $0
  1582  07d7  2a0000            	LD HL, (_Ttmp27)
  1583  07da  110000            	LD DE, _a
  1584  07dd  19                	ADD HL, DE
  1585  07de  220000            	LD (_Ttmp27), HL
  1586  07e1  210000            	LD HL, _Tbit5
  1587  07e4  7e                	LD A, (HL)
  1588  07e5  cb47              	BIT $0, A
  1589  07e7  2800              	JR Z, _label77zero
  1590  07e9  3e00              	LD A, $ff
  1591  07eb  320000            	LD (_Ttmp31), A
  1592  07ee  c30000            	JMP _label77done
  1593                          _label77zero:
  1594                          ; peephole(1): r228 (LD A, 0)->(XOR A)
  1595                          ;	LD A, 0
  1596  07f1  af                	XOR A
  1597  07f2  320000            	LD (_Ttmp31), A
  1598                          _label77done:
  1599  07f5  3a0000            	LD A, (_Ttmp31)
  1600  07f8  fe00              	CP $00
  1601  07fa  ca0000            	JP Z, _label75zero
  1602  07fd  210000            	LD HL, BITMASK
  1603  0800  ed5b0000          	LD DE, (_Ttmp25)
  1604  0804  19                	ADD HL, DE
  1605  0805  ed5b0000          	LD DE, (_Ttmp27)
  1606  0809  1a                	LD A, (DE)
  1607  080a  b6                	OR (HL)
  1608  080b  12                	LD (DE), A
  1609  080c  c30000            	jp _label75
  1610                          _label75zero:
  1611  080f  210000            	LD HL, BITMASKN
  1612  0812  ed5b0000          	LD DE, (_Ttmp25)
  1613  0816  19                	ADD HL, DE
  1614  0817  ed5b0000          	LD DE, (_Ttmp27)
  1615  081b  1a                	LD A, (DE)
  1616  081c  a6                	AND (HL)
  1617  081d  12                	LD (DE), A
  1618                          _label75:
  1619                          	; P:124
  1620                          	; L:22
  1621  081e  3e00              	LD A, $02
  1622  0820  320000            	LD (_Ttmp1), A
  1623                          ; peephole(1): r250 (LD A, x; LD (x), A; LD A, x)->(LD A, x; LD (x), A)
  1624                          ;	LD A, $02
  1625  0823  320000            	LD (_Ttmp2), A
  1626  0826  3e00              	LD A, $01
  1627  0828  320000            	LD (_Ttmp3), A
  1628  082b  3a0000            	LD A, (_Ttmp3)
  1629  082e  fe00              	CP $00
  1630  0830  ca0000            	JP Z, _label82
  1631  0833  3a0000            	LD A, (_Tbit5)
  1632  0836  f600              	OR $01
  1633  0838  320000            	LD (_Tbit5), A
  1634  083b  c30000            	jp _label82done
  1635                          _label82:
  1636  083e  3a0000            	LD A, (_Tbit5)
  1637  0841  e600              	AND $fe
  1638  0843  320000            	LD (_Tbit5), A
  1639                          _label82done:
  1640  0846  3e00              	LD A, $00
  1641  0848  320000            	LD (_Ttmp12), A
  1642                          ; peephole(1): r250 (LD A, x; LD (x), A; LD A, x)->(LD A, x; LD (x), A)
  1643                          ;	LD A, $00
  1644  084b  320000            	LD (_Ttmp12+1), A
  1645  084e  3e00              	LD A, $00
  1646  0850  320000            	LD (_Ttmp13), A
  1647                          ; peephole(1): r250 (LD A, x; LD (x), A; LD A, x)->(LD A, x; LD (x), A)
  1648                          ;	LD A, $00
  1649  0853  320000            	LD (_Ttmp13+1), A
  1650  0856  3a0000            	LD A, (_Ttmp1)
  1651  0859  320000            	LD (_Ttmp13), A
  1652  085c  2a0000            	LD HL, (_Ttmp12)
  1653  085f  ed5b0000          	LD DE, (_Ttmp13)
  1654  0863  19                	ADD HL, DE
  1655  0864  220000            	LD (_Ttmp12), HL
  1656  0867  3e00              	LD A, $0a
  1657  0869  320000            	LD (_Ttmp11), A
  1658  086c  3e00              	LD A, $00
  1659  086e  320000            	LD (_Ttmp11+1), A
  1660                          ; peephole(1): r250 (LD A, x; LD (x), A; LD A, x)->(LD A, x; LD (x), A)
  1661                          ;	LD A, $00
  1662  0871  320000            	LD (_Ttmp17), A
  1663  0874  3e00              	LD A, $00
  1664  0876  320000            	LD (_Ttmp17+1), A
  1665  0879  3a0000            	LD A, (_Ttmp2)
  1666  087c  320000            	LD (_Ttmp17), A
  1667  087f  ed4b0000          	LD BC, (_Ttmp17)
  1668  0883  ed5b0000          	LD DE, (_Ttmp11)
  1669  0887  79                	LD A, C
  1670  0888  48                	LD C, B
  1671  0889  210000            	LD HL, 0
  1672  088c  0600              	LD B, 16
  1673                          _label88:
  1674  088e  29                	ADD HL, HL
  1675  088f  17                	RLA
  1676  0890  cb11              	RL C
  1677  0892  3000              	JR NC,_label88b2
  1678  0894  19                	ADD HL, DE
  1679  0895  ce00              	ADC A, 0
  1680  0897  d20000            	JP NC,_label88b2
  1681  089a  0c                	INC C
  1682                          _label88b2:
  1683  089b  1000              	DJNZ _label88
  1684  089d  41                	LD B, C
  1685  089e  4f                	LD C, A
  1686  089f  220000            	LD (_Ttmp21), HL
  1687  08a2  ed430000          	LD (_Ttmp21+2), BC
  1688  08a6  3a0000            	LD A, (_Ttmp21)
  1689  08a9  320000            	LD (_Ttmp23), A
  1690  08ac  3a0000            	LD A, (_Ttmp21+1)
  1691  08af  320000            	LD (_Ttmp23+1), A
  1692  08b2  2a0000            	LD HL, (_Ttmp12)
  1693  08b5  ed5b0000          	LD DE, (_Ttmp23)
  1694  08b9  19                	ADD HL, DE
  1695  08ba  220000            	LD (_Ttmp12), HL
  1696  08bd  3a0000            	LD A, (_Ttmp12)
  1697  08c0  320000            	LD (_Ttmp25), A
  1698  08c3  3a0000            	LD A, (_Ttmp25)
  1699  08c6  e600              	AND $07
  1700  08c8  320000            	LD (_Ttmp25), A
  1701  08cb  3a0000            	LD A, (_Ttmp12)
  1702  08ce  320000            	LD (_Ttmp27), A
  1703  08d1  3a0000            	LD A, (_Ttmp12+1)
  1704  08d4  320000            	LD (_Ttmp27+1), A
  1705  08d7  2a0000            	LD HL, (_Ttmp27)
  1706  08da  cb2c              	SRA H
  1707  08dc  cb1d              	RR L
  1708  08de  cb2c              	SRA H
  1709  08e0  cb1d              	RR L
  1710  08e2  cb2c              	SRA H
  1711  08e4  cb1d              	RR L
  1712  08e6  220000            	LD (_Ttmp27), HL
  1713  08e9  e600              	AND $0
  1714  08eb  2a0000            	LD HL, (_Ttmp27)
  1715  08ee  110000            	LD DE, _a
  1716  08f1  19                	ADD HL, DE
  1717  08f2  220000            	LD (_Ttmp27), HL
  1718  08f5  210000            	LD HL, _Tbit5
  1719  08f8  7e                	LD A, (HL)
  1720  08f9  cb47              	BIT $0, A
  1721  08fb  2800              	JR Z, _label92zero
  1722  08fd  3e00              	LD A, $ff
  1723  08ff  320000            	LD (_Ttmp31), A
  1724  0902  c30000            	JMP _label92done
  1725                          _label92zero:
  1726                          ; peephole(1): r228 (LD A, 0)->(XOR A)
  1727                          ;	LD A, 0
  1728  0905  af                	XOR A
  1729  0906  320000            	LD (_Ttmp31), A
  1730                          _label92done:
  1731  0909  3a0000            	LD A, (_Ttmp31)
  1732  090c  fe00              	CP $00
  1733  090e  ca0000            	JP Z, _label90zero
  1734  0911  210000            	LD HL, BITMASK
  1735  0914  ed5b0000          	LD DE, (_Ttmp25)
  1736  0918  19                	ADD HL, DE
  1737  0919  ed5b0000          	LD DE, (_Ttmp27)
  1738  091d  1a                	LD A, (DE)
  1739  091e  b6                	OR (HL)
  1740  091f  12                	LD (DE), A
  1741  0920  c30000            	jp _label90
  1742                          _label90zero:
  1743  0923  210000            	LD HL, BITMASKN
  1744  0926  ed5b0000          	LD DE, (_Ttmp25)
  1745  092a  19                	ADD HL, DE
  1746  092b  ed5b0000          	LD DE, (_Ttmp27)
  1747  092f  1a                	LD A, (DE)
  1748  0930  a6                	AND (HL)
  1749  0931  12                	LD (DE), A
  1750                          _label90:
  1751                          	; P:124
  1752                          	; L:23
  1753  0932  3e00              	LD A, $02
  1754  0934  320000            	LD (_Ttmp1), A
  1755  0937  3e00              	LD A, $03
  1756  0939  320000            	LD (_Ttmp2), A
  1757  093c  3e00              	LD A, $01
  1758  093e  320000            	LD (_Ttmp3), A
  1759  0941  3a0000            	LD A, (_Ttmp3)
  1760  0944  fe00              	CP $00
  1761  0946  ca0000            	JP Z, _label97
  1762  0949  3a0000            	LD A, (_Tbit5)
  1763  094c  f600              	OR $01
  1764  094e  320000            	LD (_Tbit5), A
  1765  0951  c30000            	jp _label97done
  1766                          _label97:
  1767  0954  3a0000            	LD A, (_Tbit5)
  1768  0957  e600              	AND $fe
  1769  0959  320000            	LD (_Tbit5), A
  1770                          _label97done:
  1771  095c  3e00              	LD A, $00
  1772  095e  320000            	LD (_Ttmp12), A
  1773                          ; peephole(1): r250 (LD A, x; LD (x), A; LD A, x)->(LD A, x; LD (x), A)
  1774                          ;	LD A, $00
  1775  0961  320000            	LD (_Ttmp12+1), A
  1776  0964  3e00              	LD A, $00
  1777  0966  320000            	LD (_Ttmp13), A
  1778                          ; peephole(1): r250 (LD A, x; LD (x), A; LD A, x)->(LD A, x; LD (x), A)
  1779                          ;	LD A, $00
  1780  0969  320000            	LD (_Ttmp13+1), A
  1781  096c  3a0000            	LD A, (_Ttmp1)
  1782  096f  320000            	LD (_Ttmp13), A
  1783  0972  2a0000            	LD HL, (_Ttmp12)
  1784  0975  ed5b0000          	LD DE, (_Ttmp13)
  1785  0979  19                	ADD HL, DE
  1786  097a  220000            	LD (_Ttmp12), HL
  1787  097d  3e00              	LD A, $0a
  1788  097f  320000            	LD (_Ttmp11), A
  1789  0982  3e00              	LD A, $00
  1790  0984  320000            	LD (_Ttmp11+1), A
  1791                          ; peephole(1): r250 (LD A, x; LD (x), A; LD A, x)->(LD A, x; LD (x), A)
  1792                          ;	LD A, $00
  1793  0987  320000            	LD (_Ttmp17), A
  1794  098a  3e00              	LD A, $00
  1795  098c  320000            	LD (_Ttmp17+1), A
  1796  098f  3a0000            	LD A, (_Ttmp2)
  1797  0992  320000            	LD (_Ttmp17), A
  1798  0995  ed4b0000          	LD BC, (_Ttmp17)
  1799  0999  ed5b0000          	LD DE, (_Ttmp11)
  1800  099d  79                	LD A, C
  1801  099e  48                	LD C, B
  1802  099f  210000            	LD HL, 0
  1803  09a2  0600              	LD B, 16
  1804                          _label103:
  1805  09a4  29                	ADD HL, HL
  1806  09a5  17                	RLA
  1807  09a6  cb11              	RL C
  1808  09a8  3000              	JR NC,_label103b2
  1809  09aa  19                	ADD HL, DE
  1810  09ab  ce00              	ADC A, 0
  1811  09ad  d20000            	JP NC,_label103b2
  1812  09b0  0c                	INC C
  1813                          _label103b2:
  1814  09b1  1000              	DJNZ _label103
  1815  09b3  41                	LD B, C
  1816  09b4  4f                	LD C, A
  1817  09b5  220000            	LD (_Ttmp21), HL
  1818  09b8  ed430000          	LD (_Ttmp21+2), BC
  1819  09bc  3a0000            	LD A, (_Ttmp21)
  1820  09bf  320000            	LD (_Ttmp23), A
  1821  09c2  3a0000            	LD A, (_Ttmp21+1)
  1822  09c5  320000            	LD (_Ttmp23+1), A
  1823  09c8  2a0000            	LD HL, (_Ttmp12)
  1824  09cb  ed5b0000          	LD DE, (_Ttmp23)
  1825  09cf  19                	ADD HL, DE
  1826  09d0  220000            	LD (_Ttmp12), HL
  1827  09d3  3a0000            	LD A, (_Ttmp12)
  1828  09d6  320000            	LD (_Ttmp25), A
  1829  09d9  3a0000            	LD A, (_Ttmp25)
  1830  09dc  e600              	AND $07
  1831  09de  320000            	LD (_Ttmp25), A
  1832  09e1  3a0000            	LD A, (_Ttmp12)
  1833  09e4  320000            	LD (_Ttmp27), A
  1834  09e7  3a0000            	LD A, (_Ttmp12+1)
  1835  09ea  320000            	LD (_Ttmp27+1), A
  1836  09ed  2a0000            	LD HL, (_Ttmp27)
  1837  09f0  cb2c              	SRA H
  1838  09f2  cb1d              	RR L
  1839  09f4  cb2c              	SRA H
  1840  09f6  cb1d              	RR L
  1841  09f8  cb2c              	SRA H
  1842  09fa  cb1d              	RR L
  1843  09fc  220000            	LD (_Ttmp27), HL
  1844  09ff  e600              	AND $0
  1845  0a01  2a0000            	LD HL, (_Ttmp27)
  1846  0a04  110000            	LD DE, _a
  1847  0a07  19                	ADD HL, DE
  1848  0a08  220000            	LD (_Ttmp27), HL
  1849  0a0b  210000            	LD HL, _Tbit5
  1850  0a0e  7e                	LD A, (HL)
  1851  0a0f  cb47              	BIT $0, A
  1852  0a11  2800              	JR Z, _label107zero
  1853  0a13  3e00              	LD A, $ff
  1854  0a15  320000            	LD (_Ttmp31), A
  1855  0a18  c30000            	JMP _label107done
  1856                          _label107zero:
  1857                          ; peephole(1): r228 (LD A, 0)->(XOR A)
  1858                          ;	LD A, 0
  1859  0a1b  af                	XOR A
  1860  0a1c  320000            	LD (_Ttmp31), A
  1861                          _label107done:
  1862  0a1f  3a0000            	LD A, (_Ttmp31)
  1863  0a22  fe00              	CP $00
  1864  0a24  ca0000            	JP Z, _label105zero
  1865  0a27  210000            	LD HL, BITMASK
  1866  0a2a  ed5b0000          	LD DE, (_Ttmp25)
  1867  0a2e  19                	ADD HL, DE
  1868  0a2f  ed5b0000          	LD DE, (_Ttmp27)
  1869  0a33  1a                	LD A, (DE)
  1870  0a34  b6                	OR (HL)
  1871  0a35  12                	LD (DE), A
  1872  0a36  c30000            	jp _label105
  1873                          _label105zero:
  1874  0a39  210000            	LD HL, BITMASKN
  1875  0a3c  ed5b0000          	LD DE, (_Ttmp25)
  1876  0a40  19                	ADD HL, DE
  1877  0a41  ed5b0000          	LD DE, (_Ttmp27)
  1878  0a45  1a                	LD A, (DE)
  1879  0a46  a6                	AND (HL)
  1880  0a47  12                	LD (DE), A
  1881                          _label105:
  1882                          	; P:124
  1883                          	; L:24
  1884  0a48  3e00              	LD A, $03
  1885  0a4a  320000            	LD (_Ttmp1), A
  1886  0a4d  3e00              	LD A, $01
  1887  0a4f  320000            	LD (_Ttmp2), A
  1888                          ; peephole(1): r250 (LD A, x; LD (x), A; LD A, x)->(LD A, x; LD (x), A)
  1889                          ;	LD A, $01
  1890  0a52  320000            	LD (_Ttmp3), A
  1891  0a55  3a0000            	LD A, (_Ttmp3)
  1892  0a58  fe00              	CP $00
  1893  0a5a  ca0000            	JP Z, _label112
  1894  0a5d  3a0000            	LD A, (_Tbit5)
  1895  0a60  f600              	OR $01
  1896  0a62  320000            	LD (_Tbit5), A
  1897  0a65  c30000            	jp _label112done
  1898                          _label112:
  1899  0a68  3a0000            	LD A, (_Tbit5)
  1900  0a6b  e600              	AND $fe
  1901  0a6d  320000            	LD (_Tbit5), A
  1902                          _label112done:
  1903  0a70  3e00              	LD A, $00
  1904  0a72  320000            	LD (_Ttmp12), A
  1905                          ; peephole(1): r250 (LD A, x; LD (x), A; LD A, x)->(LD A, x; LD (x), A)
  1906                          ;	LD A, $00
  1907  0a75  320000            	LD (_Ttmp12+1), A
  1908  0a78  3e00              	LD A, $00
  1909  0a7a  320000            	LD (_Ttmp13), A
  1910                          ; peephole(1): r250 (LD A, x; LD (x), A; LD A, x)->(LD A, x; LD (x), A)
  1911                          ;	LD A, $00
  1912  0a7d  320000            	LD (_Ttmp13+1), A
  1913  0a80  3a0000            	LD A, (_Ttmp1)
  1914  0a83  320000            	LD (_Ttmp13), A
  1915  0a86  2a0000            	LD HL, (_Ttmp12)
  1916  0a89  ed5b0000          	LD DE, (_Ttmp13)
  1917  0a8d  19                	ADD HL, DE
  1918  0a8e  220000            	LD (_Ttmp12), HL
  1919  0a91  3e00              	LD A, $0a
  1920  0a93  320000            	LD (_Ttmp11), A
  1921  0a96  3e00              	LD A, $00
  1922  0a98  320000            	LD (_Ttmp11+1), A
  1923                          ; peephole(1): r250 (LD A, x; LD (x), A; LD A, x)->(LD A, x; LD (x), A)
  1924                          ;	LD A, $00
  1925  0a9b  320000            	LD (_Ttmp17), A
  1926  0a9e  3e00              	LD A, $00
  1927  0aa0  320000            	LD (_Ttmp17+1), A
  1928  0aa3  3a0000            	LD A, (_Ttmp2)
  1929  0aa6  320000            	LD (_Ttmp17), A
  1930  0aa9  ed4b0000          	LD BC, (_Ttmp17)
  1931  0aad  ed5b0000          	LD DE, (_Ttmp11)
  1932  0ab1  79                	LD A, C
  1933  0ab2  48                	LD C, B
  1934  0ab3  210000            	LD HL, 0
  1935  0ab6  0600              	LD B, 16
  1936                          _label118:
  1937  0ab8  29                	ADD HL, HL
  1938  0ab9  17                	RLA
  1939  0aba  cb11              	RL C
  1940  0abc  3000              	JR NC,_label118b2
  1941  0abe  19                	ADD HL, DE
  1942  0abf  ce00              	ADC A, 0
  1943  0ac1  d20000            	JP NC,_label118b2
  1944  0ac4  0c                	INC C
  1945                          _label118b2:
  1946  0ac5  1000              	DJNZ _label118
  1947  0ac7  41                	LD B, C
  1948  0ac8  4f                	LD C, A
  1949  0ac9  220000            	LD (_Ttmp21), HL
  1950  0acc  ed430000          	LD (_Ttmp21+2), BC
  1951  0ad0  3a0000            	LD A, (_Ttmp21)
  1952  0ad3  320000            	LD (_Ttmp23), A
  1953  0ad6  3a0000            	LD A, (_Ttmp21+1)
  1954  0ad9  320000            	LD (_Ttmp23+1), A
  1955  0adc  2a0000            	LD HL, (_Ttmp12)
  1956  0adf  ed5b0000          	LD DE, (_Ttmp23)
  1957  0ae3  19                	ADD HL, DE
  1958  0ae4  220000            	LD (_Ttmp12), HL
  1959  0ae7  3a0000            	LD A, (_Ttmp12)
  1960  0aea  320000            	LD (_Ttmp25), A
  1961  0aed  3a0000            	LD A, (_Ttmp25)
  1962  0af0  e600              	AND $07
  1963  0af2  320000            	LD (_Ttmp25), A
  1964  0af5  3a0000            	LD A, (_Ttmp12)
  1965  0af8  320000            	LD (_Ttmp27), A
  1966  0afb  3a0000            	LD A, (_Ttmp12+1)
  1967  0afe  320000            	LD (_Ttmp27+1), A
  1968  0b01  2a0000            	LD HL, (_Ttmp27)
  1969  0b04  cb2c              	SRA H
  1970  0b06  cb1d              	RR L
  1971  0b08  cb2c              	SRA H
  1972  0b0a  cb1d              	RR L
  1973  0b0c  cb2c              	SRA H
  1974  0b0e  cb1d              	RR L
  1975  0b10  220000            	LD (_Ttmp27), HL
  1976  0b13  e600              	AND $0
  1977  0b15  2a0000            	LD HL, (_Ttmp27)
  1978  0b18  110000            	LD DE, _a
  1979  0b1b  19                	ADD HL, DE
  1980  0b1c  220000            	LD (_Ttmp27), HL
  1981  0b1f  210000            	LD HL, _Tbit5
  1982  0b22  7e                	LD A, (HL)
  1983  0b23  cb47              	BIT $0, A
  1984  0b25  2800              	JR Z, _label122zero
  1985  0b27  3e00              	LD A, $ff
  1986  0b29  320000            	LD (_Ttmp31), A
  1987  0b2c  c30000            	JMP _label122done
  1988                          _label122zero:
  1989                          ; peephole(1): r228 (LD A, 0)->(XOR A)
  1990                          ;	LD A, 0
  1991  0b2f  af                	XOR A
  1992  0b30  320000            	LD (_Ttmp31), A
  1993                          _label122done:
  1994  0b33  3a0000            	LD A, (_Ttmp31)
  1995  0b36  fe00              	CP $00
  1996  0b38  ca0000            	JP Z, _label120zero
  1997  0b3b  210000            	LD HL, BITMASK
  1998  0b3e  ed5b0000          	LD DE, (_Ttmp25)
  1999  0b42  19                	ADD HL, DE
  2000  0b43  ed5b0000          	LD DE, (_Ttmp27)
  2001  0b47  1a                	LD A, (DE)
  2002  0b48  b6                	OR (HL)
  2003  0b49  12                	LD (DE), A
  2004  0b4a  c30000            	jp _label120
  2005                          _label120zero:
  2006  0b4d  210000            	LD HL, BITMASKN
  2007  0b50  ed5b0000          	LD DE, (_Ttmp25)
  2008  0b54  19                	ADD HL, DE
  2009  0b55  ed5b0000          	LD DE, (_Ttmp27)
  2010  0b59  1a                	LD A, (DE)
  2011  0b5a  a6                	AND (HL)
  2012  0b5b  12                	LD (DE), A
  2013                          _label120:
  2014                          	; P:124
  2015                          	; L:25
  2016  0b5c  3e00              	LD A, $03
  2017  0b5e  320000            	LD (_Ttmp1), A
  2018  0b61  3e00              	LD A, $02
  2019  0b63  320000            	LD (_Ttmp2), A
  2020  0b66  3e00              	LD A, $01
  2021  0b68  320000            	LD (_Ttmp3), A
  2022  0b6b  3a0000            	LD A, (_Ttmp3)
  2023  0b6e  fe00              	CP $00
  2024  0b70  ca0000            	JP Z, _label127
  2025  0b73  3a0000            	LD A, (_Tbit5)
  2026  0b76  f600              	OR $01
  2027  0b78  320000            	LD (_Tbit5), A
  2028  0b7b  c30000            	jp _label127done
  2029                          _label127:
  2030  0b7e  3a0000            	LD A, (_Tbit5)
  2031  0b81  e600              	AND $fe
  2032  0b83  320000            	LD (_Tbit5), A
  2033                          _label127done:
  2034  0b86  3e00              	LD A, $00
  2035  0b88  320000            	LD (_Ttmp12), A
  2036                          ; peephole(1): r250 (LD A, x; LD (x), A; LD A, x)->(LD A, x; LD (x), A)
  2037                          ;	LD A, $00
  2038  0b8b  320000            	LD (_Ttmp12+1), A
  2039  0b8e  3e00              	LD A, $00
  2040  0b90  320000            	LD (_Ttmp13), A
  2041                          ; peephole(1): r250 (LD A, x; LD (x), A; LD A, x)->(LD A, x; LD (x), A)
  2042                          ;	LD A, $00
  2043  0b93  320000            	LD (_Ttmp13+1), A
  2044  0b96  3a0000            	LD A, (_Ttmp1)
  2045  0b99  320000            	LD (_Ttmp13), A
  2046  0b9c  2a0000            	LD HL, (_Ttmp12)
  2047  0b9f  ed5b0000          	LD DE, (_Ttmp13)
  2048  0ba3  19                	ADD HL, DE
  2049  0ba4  220000            	LD (_Ttmp12), HL
  2050  0ba7  3e00              	LD A, $0a
  2051  0ba9  320000            	LD (_Ttmp11), A
  2052  0bac  3e00              	LD A, $00
  2053  0bae  320000            	LD (_Ttmp11+1), A
  2054                          ; peephole(1): r250 (LD A, x; LD (x), A; LD A, x)->(LD A, x; LD (x), A)
  2055                          ;	LD A, $00
  2056  0bb1  320000            	LD (_Ttmp17), A
  2057  0bb4  3e00              	LD A, $00
  2058  0bb6  320000            	LD (_Ttmp17+1), A
  2059  0bb9  3a0000            	LD A, (_Ttmp2)
  2060  0bbc  320000            	LD (_Ttmp17), A
  2061  0bbf  ed4b0000          	LD BC, (_Ttmp17)
  2062  0bc3  ed5b0000          	LD DE, (_Ttmp11)
  2063  0bc7  79                	LD A, C
  2064  0bc8  48                	LD C, B
  2065  0bc9  210000            	LD HL, 0
  2066  0bcc  0600              	LD B, 16
  2067                          _label133:
  2068  0bce  29                	ADD HL, HL
  2069  0bcf  17                	RLA
  2070  0bd0  cb11              	RL C
  2071  0bd2  3000              	JR NC,_label133b2
  2072  0bd4  19                	ADD HL, DE
  2073  0bd5  ce00              	ADC A, 0
  2074  0bd7  d20000            	JP NC,_label133b2
  2075  0bda  0c                	INC C
  2076                          _label133b2:
  2077  0bdb  1000              	DJNZ _label133
  2078  0bdd  41                	LD B, C
  2079  0bde  4f                	LD C, A
  2080  0bdf  220000            	LD (_Ttmp21), HL
  2081  0be2  ed430000          	LD (_Ttmp21+2), BC
  2082  0be6  3a0000            	LD A, (_Ttmp21)
  2083  0be9  320000            	LD (_Ttmp23), A
  2084  0bec  3a0000            	LD A, (_Ttmp21+1)
  2085  0bef  320000            	LD (_Ttmp23+1), A
  2086  0bf2  2a0000            	LD HL, (_Ttmp12)
  2087  0bf5  ed5b0000          	LD DE, (_Ttmp23)
  2088  0bf9  19                	ADD HL, DE
  2089  0bfa  220000            	LD (_Ttmp12), HL
  2090  0bfd  3a0000            	LD A, (_Ttmp12)
  2091  0c00  320000            	LD (_Ttmp25), A
  2092  0c03  3a0000            	LD A, (_Ttmp25)
  2093  0c06  e600              	AND $07
  2094  0c08  320000            	LD (_Ttmp25), A
  2095  0c0b  3a0000            	LD A, (_Ttmp12)
  2096  0c0e  320000            	LD (_Ttmp27), A
  2097  0c11  3a0000            	LD A, (_Ttmp12+1)
  2098  0c14  320000            	LD (_Ttmp27+1), A
  2099  0c17  2a0000            	LD HL, (_Ttmp27)
  2100  0c1a  cb2c              	SRA H
  2101  0c1c  cb1d              	RR L
  2102  0c1e  cb2c              	SRA H
  2103  0c20  cb1d              	RR L
  2104  0c22  cb2c              	SRA H
  2105  0c24  cb1d              	RR L
  2106  0c26  220000            	LD (_Ttmp27), HL
  2107  0c29  e600              	AND $0
  2108  0c2b  2a0000            	LD HL, (_Ttmp27)
  2109  0c2e  110000            	LD DE, _a
  2110  0c31  19                	ADD HL, DE
  2111  0c32  220000            	LD (_Ttmp27), HL
  2112  0c35  210000            	LD HL, _Tbit5
  2113  0c38  7e                	LD A, (HL)
  2114  0c39  cb47              	BIT $0, A
  2115  0c3b  2800              	JR Z, _label137zero
  2116  0c3d  3e00              	LD A, $ff
  2117  0c3f  320000            	LD (_Ttmp31), A
  2118  0c42  c30000            	JMP _label137done
  2119                          _label137zero:
  2120                          ; peephole(1): r228 (LD A, 0)->(XOR A)
  2121                          ;	LD A, 0
  2122  0c45  af                	XOR A
  2123  0c46  320000            	LD (_Ttmp31), A
  2124                          _label137done:
  2125  0c49  3a0000            	LD A, (_Ttmp31)
  2126  0c4c  fe00              	CP $00
  2127  0c4e  ca0000            	JP Z, _label135zero
  2128  0c51  210000            	LD HL, BITMASK
  2129  0c54  ed5b0000          	LD DE, (_Ttmp25)
  2130  0c58  19                	ADD HL, DE
  2131  0c59  ed5b0000          	LD DE, (_Ttmp27)
  2132  0c5d  1a                	LD A, (DE)
  2133  0c5e  b6                	OR (HL)
  2134  0c5f  12                	LD (DE), A
  2135  0c60  c30000            	jp _label135
  2136                          _label135zero:
  2137  0c63  210000            	LD HL, BITMASKN
  2138  0c66  ed5b0000          	LD DE, (_Ttmp25)
  2139  0c6a  19                	ADD HL, DE
  2140  0c6b  ed5b0000          	LD DE, (_Ttmp27)
  2141  0c6f  1a                	LD A, (DE)
  2142  0c70  a6                	AND (HL)
  2143  0c71  12                	LD (DE), A
  2144                          _label135:
  2145                          	; P:124
  2146                          	; L:26
  2147  0c72  3e00              	LD A, $03
  2148  0c74  320000            	LD (_Ttmp1), A
  2149                          ; peephole(1): r250 (LD A, x; LD (x), A; LD A, x)->(LD A, x; LD (x), A)
  2150                          ;	LD A, $03
  2151  0c77  320000            	LD (_Ttmp2), A
  2152  0c7a  3e00              	LD A, $01
  2153  0c7c  320000            	LD (_Ttmp3), A
  2154  0c7f  3a0000            	LD A, (_Ttmp3)
  2155  0c82  fe00              	CP $00
  2156  0c84  ca0000            	JP Z, _label142
  2157  0c87  3a0000            	LD A, (_Tbit5)
  2158  0c8a  f600              	OR $01
  2159  0c8c  320000            	LD (_Tbit5), A
  2160  0c8f  c30000            	jp _label142done
  2161                          _label142:
  2162  0c92  3a0000            	LD A, (_Tbit5)
  2163  0c95  e600              	AND $fe
  2164  0c97  320000            	LD (_Tbit5), A
  2165                          _label142done:
  2166  0c9a  3e00              	LD A, $00
  2167  0c9c  320000            	LD (_Ttmp12), A
  2168                          ; peephole(1): r250 (LD A, x; LD (x), A; LD A, x)->(LD A, x; LD (x), A)
  2169                          ;	LD A, $00
  2170  0c9f  320000            	LD (_Ttmp12+1), A
  2171  0ca2  3e00              	LD A, $00
  2172  0ca4  320000            	LD (_Ttmp13), A
  2173                          ; peephole(1): r250 (LD A, x; LD (x), A; LD A, x)->(LD A, x; LD (x), A)
  2174                          ;	LD A, $00
  2175  0ca7  320000            	LD (_Ttmp13+1), A
  2176  0caa  3a0000            	LD A, (_Ttmp1)
  2177  0cad  320000            	LD (_Ttmp13), A
  2178  0cb0  2a0000            	LD HL, (_Ttmp12)
  2179  0cb3  ed5b0000          	LD DE, (_Ttmp13)
  2180  0cb7  19                	ADD HL, DE
  2181  0cb8  220000            	LD (_Ttmp12), HL
  2182  0cbb  3e00              	LD A, $0a
  2183  0cbd  320000            	LD (_Ttmp11), A
  2184  0cc0  3e00              	LD A, $00
  2185  0cc2  320000            	LD (_Ttmp11+1), A
  2186                          ; peephole(1): r250 (LD A, x; LD (x), A; LD A, x)->(LD A, x; LD (x), A)
  2187                          ;	LD A, $00
  2188  0cc5  320000            	LD (_Ttmp17), A
  2189  0cc8  3e00              	LD A, $00
  2190  0cca  320000            	LD (_Ttmp17+1), A
  2191  0ccd  3a0000            	LD A, (_Ttmp2)
  2192  0cd0  320000            	LD (_Ttmp17), A
  2193  0cd3  ed4b0000          	LD BC, (_Ttmp17)
  2194  0cd7  ed5b0000          	LD DE, (_Ttmp11)
  2195  0cdb  79                	LD A, C
  2196  0cdc  48                	LD C, B
  2197  0cdd  210000            	LD HL, 0
  2198  0ce0  0600              	LD B, 16
  2199                          _label148:
  2200  0ce2  29                	ADD HL, HL
  2201  0ce3  17                	RLA
  2202  0ce4  cb11              	RL C
  2203  0ce6  3000              	JR NC,_label148b2
  2204  0ce8  19                	ADD HL, DE
  2205  0ce9  ce00              	ADC A, 0
  2206  0ceb  d20000            	JP NC,_label148b2
  2207  0cee  0c                	INC C
  2208                          _label148b2:
  2209  0cef  1000              	DJNZ _label148
  2210  0cf1  41                	LD B, C
  2211  0cf2  4f                	LD C, A
  2212  0cf3  220000            	LD (_Ttmp21), HL
  2213  0cf6  ed430000          	LD (_Ttmp21+2), BC
  2214  0cfa  3a0000            	LD A, (_Ttmp21)
  2215  0cfd  320000            	LD (_Ttmp23), A
  2216  0d00  3a0000            	LD A, (_Ttmp21+1)
  2217  0d03  320000            	LD (_Ttmp23+1), A
  2218  0d06  2a0000            	LD HL, (_Ttmp12)
  2219  0d09  ed5b0000          	LD DE, (_Ttmp23)
  2220  0d0d  19                	ADD HL, DE
  2221  0d0e  220000            	LD (_Ttmp12), HL
  2222  0d11  3a0000            	LD A, (_Ttmp12)
  2223  0d14  320000            	LD (_Ttmp25), A
  2224  0d17  3a0000            	LD A, (_Ttmp25)
  2225  0d1a  e600              	AND $07
  2226  0d1c  320000            	LD (_Ttmp25), A
  2227  0d1f  3a0000            	LD A, (_Ttmp12)
  2228  0d22  320000            	LD (_Ttmp27), A
  2229  0d25  3a0000            	LD A, (_Ttmp12+1)
  2230  0d28  320000            	LD (_Ttmp27+1), A
  2231  0d2b  2a0000            	LD HL, (_Ttmp27)
  2232  0d2e  cb2c              	SRA H
  2233  0d30  cb1d              	RR L
  2234  0d32  cb2c              	SRA H
  2235  0d34  cb1d              	RR L
  2236  0d36  cb2c              	SRA H
  2237  0d38  cb1d              	RR L
  2238  0d3a  222b01            	LD (_Ttmp27), HL
  2239  0d3d  e600              	AND $0
  2240  0d3f  2a2b01            	LD HL, (_Ttmp27)
  2241  0d42  110701            	LD DE, _a
  2242  0d45  19                	ADD HL, DE
  2243  0d46  222b01            	LD (_Ttmp27), HL
  2244  0d49  213501            	LD HL, _Tbit5
  2245  0d4c  7e                	LD A, (HL)
  2246  0d4d  cb47              	BIT $0, A
  2247  0d4f  2808              	JR Z, _label152zero
  2248  0d51  3eff              	LD A, $ff
  2249  0d53  322d01            	LD (_Ttmp31), A
  2250  0d56  c35d0d            	JMP _label152done
  2251                          _label152zero:
  2252                          ; peephole(1): r228 (LD A, 0)->(XOR A)
  2253                          ;	LD A, 0
  2254  0d59  af                	XOR A
  2255  0d5a  322d01            	LD (_Ttmp31), A
  2256                          _label152done:
  2257  0d5d  3a2d01            	LD A, (_Ttmp31)
  2258  0d60  fe00              	CP $00
  2259  0d62  ca770d            	JP Z, _label150zero
  2260  0d65  219416            	LD HL, BITMASK
  2261  0d68  ed5b2901          	LD DE, (_Ttmp25)
  2262  0d6c  19                	ADD HL, DE
  2263  0d6d  ed5b2b01          	LD DE, (_Ttmp27)
  2264  0d71  1a                	LD A, (DE)
  2265  0d72  b6                	OR (HL)
  2266  0d73  12                	LD (DE), A
  2267  0d74  c3860d            	jp _label150
  2268                          _label150zero:
  2269  0d77  219c16            	LD HL, BITMASKN
  2270  0d7a  ed5b2901          	LD DE, (_Ttmp25)
  2271  0d7e  19                	ADD HL, DE
  2272  0d7f  ed5b2b01          	LD DE, (_Ttmp27)
  2273  0d83  1a                	LD A, (DE)
  2274  0d84  a6                	AND (HL)
  2275  0d85  12                	LD (DE), A
  2276                          _label150:
  2277                          	; P:124
  2278                          	; L:27
  2279                          	; P:0
  2280                          	; L:28
  2281  0d86  3e00              	LD A, $00
  2282  0d88  321701            	LD (_Ttmp1), A
  2283  0d8b  3e09              	LD A, $09
  2284  0d8d  321801            	LD (_Ttmp2), A
  2285                          	; _TRtmp156 <-> (step 1) (resident)
  2286                          	; _TRtmp157 <-> (resident to) (resident)
  2287                          	 ; variable_move_8bit_8bit
  2288                          	 ; 8 BIT (unsigned) -> 8 BIT (unsigned)
  2289  0d90  3a1801            	LD A, (_Ttmp2)
  2290  0d93  323701            	LD (_TRtmp157), A
  2291  0d96  3e01              	LD A, $01
  2292  0d98  323601            	LD (_TRtmp156), A
  2293                          	 ; variable_move_8bit_8bit
  2294                          	 ; 8 BIT (unsigned) -> 8 BIT (unsigned)
  2295  0d9b  3a1701            	LD A, (_Ttmp1)
  2296  0d9e  321401            	LD (_y), A
  2297                          _label158bf:
  2298  0da1  3a3701            	LD A, (_TRtmp157)
  2299  0da4  47                	LD B, A
  2300  0da5  3a1401            	LD A, (_y)
  2301  0da8  b8                	CP B
  2302  0da9  3809              	JR C, _label161
  2303  0dab  2807              	JR Z, _label161
  2304                          ; peephole(1): r228 (LD A, 0)->(XOR A)
  2305                          ;	LD A, 0
  2306  0dad  af                	XOR A
  2307  0dae  322e01            	LD (_Ttmp160), A
  2308  0db1  c3b90d            	JMP _label161b2
  2309                          _label161:
  2310  0db4  3eff              	LD A, $ff
  2311  0db6  322e01            	LD (_Ttmp160), A
  2312                          _label161b2:
  2313  0db9  3a2e01            	LD A, (_Ttmp160)
  2314                          ; peephole(1): r319 (XOR $FF)->(CPL)
  2315                          ;	XOR $FF
  2316  0dbc  2f                	CPL
  2317  0dbd  322e01            	LD (_Ttmp160), A
  2318  0dc0  3a2e01            	LD A, (_Ttmp160)
  2319  0dc3  fe00              	CP 0
  2320  0dc5  c2cb0d            	JP NZ, _label162
  2321  0dc8  c3ce0d            	JMP _label162b2
  2322                          _label162:
  2323  0dcb  c39116            	JMP _label158bis
  2324                          _label162b2:
  2325                          	; P:34
  2326                          	; L:29
  2327  0dce  3e00              	LD A, $00
  2328  0dd0  321701            	LD (_Ttmp1), A
  2329  0dd3  3e09              	LD A, $09
  2330  0dd5  321801            	LD (_Ttmp2), A
  2331                          	; _TRtmp163 <-> (step 1) (resident)
  2332                          	; _TRtmp164 <-> (resident to) (resident)
  2333                          	 ; variable_move_8bit_8bit
  2334                          	 ; 8 BIT (unsigned) -> 8 BIT (unsigned)
  2335  0dd8  3a1801            	LD A, (_Ttmp2)
  2336  0ddb  323901            	LD (_TRtmp164), A
  2337  0dde  3e01              	LD A, $01
  2338  0de0  323801            	LD (_TRtmp163), A
  2339                          	 ; variable_move_8bit_8bit
  2340                          	 ; 8 BIT (unsigned) -> 8 BIT (unsigned)
  2341  0de3  3a1701            	LD A, (_Ttmp1)
  2342  0de6  321501            	LD (_x), A
  2343                          _label165bf:
  2344  0de9  3a3901            	LD A, (_TRtmp164)
  2345  0dec  47                	LD B, A
  2346  0ded  3a1501            	LD A, (_x)
  2347  0df0  b8                	CP B
  2348  0df1  3809              	JR C, _label167
  2349  0df3  2807              	JR Z, _label167
  2350                          ; peephole(1): r228 (LD A, 0)->(XOR A)
  2351                          ;	LD A, 0
  2352  0df5  af                	XOR A
  2353  0df6  322e01            	LD (_Ttmp160), A
  2354  0df9  c3010e            	JMP _label167b2
  2355                          _label167:
  2356  0dfc  3eff              	LD A, $ff
  2357  0dfe  322e01            	LD (_Ttmp160), A
  2358                          _label167b2:
  2359  0e01  3a2e01            	LD A, (_Ttmp160)
  2360                          ; peephole(1): r319 (XOR $FF)->(CPL)
  2361                          ;	XOR $FF
  2362  0e04  2f                	CPL
  2363  0e05  322e01            	LD (_Ttmp160), A
  2364  0e08  3a2e01            	LD A, (_Ttmp160)
  2365  0e0b  fe00              	CP 0
  2366  0e0d  c2130e            	JP NZ, _label168
  2367  0e10  c3160e            	JMP _label168b2
  2368                          _label168:
  2369  0e13  c32f16            	JMP _label165bis
  2370                          _label168b2:
  2371                          	; P:34
  2372                          	; L:30
  2373  0e16  3e00              	LD A, $00
  2374  0e18  321c01            	LD (_Ttmp12), A
  2375                          ; peephole(1): r250 (LD A, x; LD (x), A; LD A, x)->(LD A, x; LD (x), A)
  2376                          ;	LD A, $00
  2377  0e1b  321d01            	LD (_Ttmp12+1), A
  2378  0e1e  3e00              	LD A, $00
  2379  0e20  321e01            	LD (_Ttmp13), A
  2380                          ; peephole(1): r250 (LD A, x; LD (x), A; LD A, x)->(LD A, x; LD (x), A)
  2381                          ;	LD A, $00
  2382  0e23  321f01            	LD (_Ttmp13+1), A
  2383  0e26  3a1501            	LD A, (_x)
  2384  0e29  321e01            	LD (_Ttmp13), A
  2385  0e2c  2a1c01            	LD HL, (_Ttmp12)
  2386  0e2f  ed5b1e01          	LD DE, (_Ttmp13)
  2387  0e33  19                	ADD HL, DE
  2388  0e34  221c01            	LD (_Ttmp12), HL
  2389  0e37  3e0a              	LD A, $0a
  2390  0e39  321a01            	LD (_Ttmp11), A
  2391  0e3c  3e00              	LD A, $00
  2392  0e3e  321b01            	LD (_Ttmp11+1), A
  2393                          ; peephole(1): r250 (LD A, x; LD (x), A; LD A, x)->(LD A, x; LD (x), A)
  2394                          ;	LD A, $00
  2395  0e41  322001            	LD (_Ttmp17), A
  2396  0e44  3e00              	LD A, $00
  2397  0e46  322101            	LD (_Ttmp17+1), A
  2398  0e49  3a1401            	LD A, (_y)
  2399  0e4c  322001            	LD (_Ttmp17), A
  2400  0e4f  ed4b2001          	LD BC, (_Ttmp17)
  2401  0e53  ed5b1a01          	LD DE, (_Ttmp11)
  2402  0e57  79                	LD A, C
  2403  0e58  48                	LD C, B
  2404  0e59  210000            	LD HL, 0
  2405  0e5c  0610              	LD B, 16
  2406                          _label172:
  2407  0e5e  29                	ADD HL, HL
  2408  0e5f  17                	RLA
  2409  0e60  cb11              	RL C
  2410  0e62  3007              	JR NC,_label172b2
  2411  0e64  19                	ADD HL, DE
  2412  0e65  ce00              	ADC A, 0
  2413  0e67  d26b0e            	JP NC,_label172b2
  2414  0e6a  0c                	INC C
  2415                          _label172b2:
  2416  0e6b  10f1              	DJNZ _label172
  2417  0e6d  41                	LD B, C
  2418  0e6e  4f                	LD C, A
  2419  0e6f  222301            	LD (_Ttmp21), HL
  2420  0e72  ed432501          	LD (_Ttmp21+2), BC
  2421  0e76  3a2301            	LD A, (_Ttmp21)
  2422  0e79  322701            	LD (_Ttmp23), A
  2423  0e7c  3a2401            	LD A, (_Ttmp21+1)
  2424  0e7f  322801            	LD (_Ttmp23+1), A
  2425  0e82  2a1c01            	LD HL, (_Ttmp12)
  2426  0e85  ed5b2701          	LD DE, (_Ttmp23)
  2427  0e89  19                	ADD HL, DE
  2428  0e8a  221c01            	LD (_Ttmp12), HL
  2429  0e8d  3a1c01            	LD A, (_Ttmp12)
  2430  0e90  322201            	LD (_Ttmp18), A
  2431  0e93  3a2201            	LD A, (_Ttmp18)
  2432  0e96  e607              	AND $07
  2433  0e98  322201            	LD (_Ttmp18), A
  2434  0e9b  3a1c01            	LD A, (_Ttmp12)
  2435  0e9e  322b01            	LD (_Ttmp27), A
  2436  0ea1  3a1d01            	LD A, (_Ttmp12+1)
  2437  0ea4  322c01            	LD (_Ttmp27+1), A
  2438  0ea7  2a2b01            	LD HL, (_Ttmp27)
  2439  0eaa  cb2c              	SRA H
  2440  0eac  cb1d              	RR L
  2441  0eae  cb2c              	SRA H
  2442  0eb0  cb1d              	RR L
  2443  0eb2  cb2c              	SRA H
  2444  0eb4  cb1d              	RR L
  2445  0eb6  222b01            	LD (_Ttmp27), HL
  2446  0eb9  e600              	AND $0
  2447  0ebb  2a2b01            	LD HL, (_Ttmp27)
  2448  0ebe  110701            	LD DE, _a
  2449  0ec1  19                	ADD HL, DE
  2450  0ec2  222b01            	LD (_Ttmp27), HL
  2451  0ec5  ed5b2b01          	LD DE, (_Ttmp27)
  2452  0ec9  1a                	LD A, (DE)
  2453  0eca  321701            	LD (_Ttmp1), A
  2454  0ecd  211701            	LD HL, _Ttmp1
  2455  0ed0  3a2201            	LD A, (_Ttmp18)
  2456  0ed3  cb2f              	SRA A
  2457  0ed5  cb2f              	SRA A
  2458  0ed7  cb2f              	SRA A
  2459  0ed9  fe03              	CP 3
  2460  0edb  280b              	JR Z,_label175_3
  2461  0edd  fe02              	CP 2
  2462  0edf  2808              	JR Z,_label175_2
  2463  0ee1  fe01              	CP 1
  2464  0ee3  2805              	JR Z,_label175_1
  2465  0ee5  c3eb0e            	JMP _label175end
  2466                          _label175_3:
  2467  0ee8  23                	INC HL
  2468                          _label175_2:
  2469  0ee9  23                	INC HL
  2470                          _label175_1:
  2471  0eea  23                	INC HL
  2472                          _label175end:
  2473  0eeb  7e                	LD A, (HL)
  2474  0eec  f5                	PUSH AF
  2475  0eed  3a2201            	LD A, (_Ttmp18)
  2476  0ef0  e607              	AND $07
  2477  0ef2  0601              	LD B, 1
  2478  0ef4  fe00              	CP 0
  2479  0ef6  2805              	JR Z, _label175done2
  2480                          _label175loop2:
  2481  0ef8  cb20              	SLA B
  2482  0efa  3d                	DEC A
  2483  0efb  20fb              	JR NZ, _label175loop2
  2484                          _label175done2:
  2485  0efd  f1                	POP AF
  2486  0efe  a0                	AND A, B
  2487  0eff  280b              	JR Z, _label176zero
  2488  0f01  3a3501            	LD A, (_Tbit5)
  2489  0f04  f601              	OR $01
  2490  0f06  323501            	LD (_Tbit5), A
  2491  0f09  c3140f            	JP _label176done
  2492                          _label176zero:
  2493  0f0c  3a3501            	LD A, (_Tbit5)
  2494  0f0f  e6fe              	AND $fe
  2495  0f11  323501            	LD (_Tbit5), A
  2496                          _label176done:
  2497  0f14  3e30              	LD A, $30
  2498  0f16  322a01            	LD (_Ttmp26), A
  2499  0f19  3e31              	LD A, $31
  2500  0f1b  322d01            	LD (_Ttmp31), A
  2501  0f1e  c3ad10            	jp dstring_after
  2502                          ; /*****************************************************************************
  2503                          ;  * ugBASIC - an isomorphic BASIC language compiler for retrocomputers        *
  2504                          ;  *****************************************************************************
  2505                          ;  * Copyright 2021-2023 Marco Spedaletti (asimov@mclink.it)
  2506                          ;  *
  2507                          ;  * Licensed under the Apache License, Version 2.0 (the "License");
  2508                          ;  * you may not use this file except in compliance with the License.
  2509                          ;  * You may obtain a copy of the License at
  2510                          ;  *
  2511                          ;  * http://www.apache.org/licenses/LICENSE-2.0
  2512                          ;  *
  2513                          ;  * Unless required by applicable law or agreed to in writing, software
  2514                          ;  * distributed under the License is distributed on an "AS IS" BASIS,
  2515                          ;  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  2516                          ;  * See the License for the specific language governing permissions and
  2517                          ;  * limitations under the License.
  2518                          ;  *----------------------------------------------------------------------------
  2519                          ;  * Concesso in licenza secondo i termini della Licenza Apache, versione 2.0
  2520                          ;  * (la "Licenza"); è proibito usare questo file se non in conformità alla
  2521                          ;  * Licenza. Una copia della Licenza è disponibile all'indirizzo:
  2522                          ;  *
  2523                          ;  * http://www.apache.org/licenses/LICENSE-2.0
  2524                          ;  *
  2525                          ;  * Se non richiesto dalla legislazione vigente o concordato per iscritto,
  2526                          ;  * il software distribuito nei termini della Licenza è distribuito
  2527                          ;  * "COSì COM'è", SENZA GARANZIE O CONDIZIONI DI ALCUN TIPO, esplicite o
  2528                          ;  * implicite. Consultare la Licenza per il testo specifico che regola le
  2529                          ;  * autorizzazioni e le limitazioni previste dalla medesima.
  2530                          ;  ****************************************************************************/
  2531                          ;* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
  2532                          ;*                                                                             *
  2533                          ;*                DINAMYC STRING MANAGEMENT WITH GARBAGE COLLECTION            *
  2534                          ;*                                                                             *
  2535                          ;*                             by Marco Spedaletti                             *
  2536                          ;*                                                                             *
  2537                          ;* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
  2538                          ; DSDEFINE(HL) -> B
  2539                          DSDEFINE:
  2540  0f21  cd2510            	CALL DSFINDFREE
  2541  0f24  cd9410            	CALL DSDESCRIPTOR
  2542  0f27  7e                	LD A, (HL)
  2543  0f28  23                	INC HL
  2544  0f29  dd7700            	LD (IX),A
  2545  0f2c  dd7501            	LD (IX+1),L
  2546  0f2f  dd7402            	LD (IX+2),H
  2547  0f32  3ec0              	LD A, $C0
  2548  0f34  dd7703            	LD (IX+3),A
  2549  0f37  c9                	RET
  2550                          ; DSALLOC(C) -> B
  2551                          DSALLOC:
  2552  0f38  cd2510            	CALL DSFINDFREE
  2553  0f3b  cd9410            	CALL DSDESCRIPTOR
  2554  0f3e  dd7e03            	LD A, (IX+3)
  2555  0f41  f640              	OR A, $40
  2556  0f43  dd7703            	LD (IX+3),A
  2557  0f46  cd6210            	CALL DSCHECKFREE
  2558                          DSALLOCOK:
  2559  0f49  cd8310            	CALL DSUSING
  2560                          ; peephole(1): r383 (CALL+RET)->(JP)
  2561                          ;    CALL DSMALLOC
  2562  0f4c  c34210            	JP DSMALLOC
  2563                          ;    RET
  2564                          ; DSFREE(B)
  2565                          DSFREE:
  2566  0f4f  cd9410            	CALL DSDESCRIPTOR
  2567                          ; peephole(1): r228 (LD A, 0)->(XOR A)
  2568                          ;    LD A, 0
  2569  0f52  af                	XOR A
  2570  0f53  dd7703            	LD (IX+3), A
  2571  0f56  c9                	RET
  2572                          ; DSWRITE(B)
  2573                          DSWRITE:
  2574  0f57  cd9410            	CALL DSDESCRIPTOR
  2575  0f5a  dd7e03            	LD A, (IX+3)
  2576  0f5d  e680              	AND $80
  2577  0f5f  2836              	JR Z, DSWRITED
  2578  0f61  dd7e03            	LD A, (IX+3)
  2579  0f64  e67f              	AND $7F
  2580  0f66  dd7703            	LD (IX+3),A
  2581  0f69  50                	LD D, B
  2582  0f6a  dd4e00            	LD C, (IX)
  2583  0f6d  cd6210            	CALL DSCHECKFREE
  2584                          DSWRITEOK:
  2585  0f70  dd4e01            	LD C, (IX+1)
  2586  0f73  dd4602            	LD B, (IX+2)
  2587  0f76  c5                	PUSH BC
  2588  0f77  cd8310            	CALL DSUSING
  2589  0f7a  dd4e00            	LD C, (IX)
  2590  0f7d  42                	LD B, D
  2591  0f7e  cd4210            	CALL DSMALLOC
  2592  0f81  c1                	POP BC
  2593  0f82  6069              	LD HL, BC
  2594  0f84  dd5e01            	LD E, (IX+1)
  2595  0f87  dd5602            	LD D, (IX+2)
  2596                          DSCOPY:
  2597  0f8a  dd4e00            	LD C, (IX)
  2598  0f8d  79                	LD A, C
  2599  0f8e  2807              	JR Z,DSWRITED
  2600                          DSWRITECOPY:
  2601  0f90  7e                	LD A, (HL)
  2602  0f91  12                	LD (DE), A
  2603  0f92  23                	INC HL
  2604  0f93  13                	INC DE
  2605  0f94  0d                	DEC C
  2606  0f95  20f9              	JR NZ, DSWRITECOPY
  2607                          DSWRITED:
  2608  0f97  c9                	RET
  2609                          ; DSRESIZE(B,C)
  2610                          DSRESIZE:
  2611  0f98  cd9410            	CALL DSDESCRIPTOR
  2612  0f9b  79                	LD A, C
  2613  0f9c  dd7700            	LD (IX), A
  2614  0f9f  fe00              	CP 0
  2615  0fa1  2008              	JR NZ, DSRESIZEDONE
  2616  0fa3  dd7e03            	LD A, (IX+3)
  2617  0fa6  f680              	OR $80
  2618  0fa8  dd7703            	LD (IX+3), A
  2619                          DSRESIZEDONE:
  2620  0fab  c9                	RET
  2621                          ; DSGC()
  2622                          DSGC:
  2623  0fac  dde5              	PUSH IX
  2624  0fae  21380d            	LD HL, FREE_STRING
  2625  0fb1  110004            	LD DE, max_free_string
  2626  0fb4  73                	LD (HL), E
  2627  0fb5  23                	INC HL
  2628  0fb6  72                	LD (HL), D
  2629  0fb7  3a0a00            	LD A, (USING)
  2630  0fba  fe00              	CP 0
  2631  0fbc  2803              	JR Z, DSGT
  2632  0fbe  c3c70f            	JMP DSGW
  2633                          DSGT:
  2634  0fc1  213809            	LD HL, TEMPORARY
  2635  0fc4  c3cd0f            	JMP BSGCLOOP0
  2636                          DSGW:
  2637  0fc7  213805            	LD HL, WORKING
  2638  0fca  c3cd0f            	JMP BSGCLOOP0
  2639                          BSGCLOOP0:
  2640  0fcd  0601              	LD B, 1
  2641                          DSGCLOOP:
  2642  0fcf  c5                	PUSH BC
  2643  0fd0  cd9410            	CALL DSDESCRIPTOR
  2644  0fd3  dd7e03            	LD A, (IX+3)
  2645  0fd6  e680              	AND $80
  2646  0fd8  2031              	JR NZ, DSGCLOOP2
  2647  0fda  dd7e03            	LD A, (IX+3)
  2648  0fdd  e640              	AND $40
  2649  0fdf  282a              	JR Z, DSGCLOOP2
  2650  0fe1  dd7e00            	LD A, (IX)
  2651  0fe4  fe00              	CP 0
  2652  0fe6  2826              	JR Z, DSGCLOOP3
  2653  0fe8  78                	LD A, B
  2654  0fe9  dd4e01            	LD C, (IX+1)
  2655  0fec  dd4602            	LD B, (IX+2)
  2656  0fef  c5                	PUSH BC
  2657  0ff0  47                	LD B, A
  2658  0ff1  dd4e00            	LD C, (IX)
  2659  0ff4  cd4210            	CALL DSMALLOC
  2660  0ff7  c1                	POP BC
  2661  0ff8  dd5e01            	LD E, (IX+1)
  2662  0ffb  dd5602            	LD D, (IX+2)
  2663  0ffe  e5                	PUSH HL
  2664  0fff  6069              	LD HL, BC
  2665  1001  dd4e00            	LD C, (IX)
  2666  1004  cd900f            	CALL DSWRITECOPY
  2667  1007  e1                	POP HL
  2668  1008  c30e10            	JMP DSGCLOOP3
  2669                          DSGCLOOP2:
  2670                              ; LD A, 0
  2671                              ; LD (IX), A
  2672  100b  c30e10            	JMP DSGCLOOP3
  2673                          DSGCLOOP3:
  2674  100e  c1                	POP BC
  2675  100f  04                	INC B
  2676  1010  78                	LD A, B
  2677  1011  545d              	LD DE, HL
  2678  1013  213b01            	LD HL, MAXSTRINGS
  2679  1016  be                	CP (HL)
  2680  1017  626b              	LD HL, DE
  2681  1019  20b4              	JR NZ, DSGCLOOP
  2682                          DSGCEND:
  2683  101b  3a0a00            	LD A, (USING)
  2684                          ; peephole(1): r319 (XOR $FF)->(CPL)
  2685                          ;    XOR $FF
  2686  101e  2f                	CPL
  2687  101f  320a00            	LD (USING),A
  2688  1022  dde1              	POP IX
  2689  1024  c9                	RET
  2690                          ; DSFINDFREE() -> B
  2691                          DSFINDFREE:
  2692  1025  e5                	PUSH HL
  2693  1026  0601              	LD B, 1; // fix denote 0 as "unused slot"
  2694                          DSFINDFREEL:
  2695  1028  cd9410            	CALL DSDESCRIPTOR
  2696  102b  dd7e03            	LD A, (IX+3)
  2697  102e  e640              	AND $40
  2698  1030  280b              	JR Z, DSFINDFREEN
  2699  1032  04                	INC B
  2700  1033  78                	LD A, B
  2701  1034  213b01            	LD HL, MAXSTRINGS
  2702  1037  be                	CP (HL)
  2703  1038  20ee              	JR NZ, DSFINDFREEL
  2704  103a  c3aa10            	JMP OUT_OF_MEMORY
  2705                          DSFINDFREEN:
  2706  103d  e1                	POP HL
  2707  103e  c9                	RET
  2708                          OUT_OF_MEMORY2:
  2709  103f  c3aa10            	JMP OUT_OF_MEMORY
  2710                          ; DSMALLOC(HL,C,B)
  2711                          DSMALLOC:
  2712  1042  cd9410            	CALL DSDESCRIPTOR
  2713  1045  e5                	PUSH HL
  2714                          ; peephole(1): r228 (LD A, 0)->(XOR A)
  2715                          ;    LD A, 0
  2716  1046  af                	XOR A
  2717  1047  57                	LD D, A
  2718  1048  79                	LD A, C
  2719  1049  5f                	LD E, A
  2720  104a  2a380d            	LD HL, (FREE_STRING)
  2721  104d  ed52              	SBC HL, DE
  2722  104f  22380d            	LD (FREE_STRING), HL
  2723  1052  e5                	PUSH HL
  2724  1053  d1                	POP DE
  2725  1054  e1                	POP HL
  2726  1055  e5                	PUSH HL
  2727  1056  19                	ADD HL, DE
  2728  1057  dd7100            	LD (IX), C
  2729  105a  dd7501            	LD (IX+1), L
  2730  105d  dd7402            	LD (IX+2), H
  2731  1060  e1                	POP HL
  2732  1061  c9                	RET
  2733                          ; DSCHECKFREE()
  2734                          DSCHECKFREE:
  2735  1062  f5                	PUSH AF
  2736  1063  c5                	PUSH BC
  2737                          DSCHECKFREE2:
  2738  1064  3a390d            	LD A, (FREE_STRING+1)
  2739  1067  fe80              	CP $80
  2740  1069  300f              	JR NC, DSCHECKFREEKO
  2741  106b  47                	LD B, A
  2742                          ; peephole(1): r228 (LD A, 0)->(XOR A)
  2743                          ;    LD A, 0
  2744  106c  af                	XOR A
  2745  106d  b8                	CP B
  2746  106e  2802              	JR Z, DSCHECKFREEL2
  2747  1070  380e              	JR C, DSCHECKFREEOK
  2748                          DSCHECKFREEL2:
  2749  1072  3a380d            	LD A, (FREE_STRING)
  2750  1075  47                	LD B, A
  2751  1076  79                	LD A, C
  2752  1077  b8                	CP B
  2753  1078  3806              	JR C, DSCHECKFREEOK
  2754                          DSCHECKFREEKO:
  2755  107a  cdac0f            	CALL DSGC
  2756  107d  c36410            	JMP DSCHECKFREE2
  2757                          DSCHECKFREEOK:
  2758  1080  c1                	POP BC
  2759  1081  f1                	POP AF
  2760  1082  c9                	RET
  2761                          ; DSUSING() -> HL
  2762                          DSUSING:
  2763  1083  3a0a00            	LD A, (USING)
  2764  1086  fe00              	CP 0
  2765  1088  2806              	JR Z, DSUSINGW
  2766  108a  1800              	JR DSUSINGT
  2767                          DSUSINGT:
  2768  108c  213809            	LD HL, TEMPORARY
  2769  108f  c9                	RET
  2770                          DSUSINGW:
  2771  1090  213805            	LD HL, WORKING
  2772  1093  c9                	RET
  2773                          ; DSDESCRIPTOR(B) -> IX
  2774                          DSDESCRIPTOR:
  2775  1094  e5                	PUSH HL
  2776  1095  c5                	PUSH BC
  2777  1096  78                	LD A, B
  2778  1097  4f                	LD C, A
  2779                          ; peephole(1): r228 (LD A, 0)->(XOR A)
  2780                          ;    LD A, 0
  2781  1098  af                	XOR A
  2782  1099  47                	LD B, A
  2783  109a  c5                	PUSH BC
  2784  109b  e1                	POP HL
  2785  109c  29                	ADD HL, HL
  2786  109d  29                	ADD HL, HL
  2787  109e  e5                	PUSH HL
  2788  109f  d1                	POP DE
  2789  10a0  213c01            	LD HL, DESCRIPTORS
  2790  10a3  19                	ADD HL, DE
  2791  10a4  e5                	PUSH HL
  2792  10a5  dde1              	POP IX
  2793  10a7  c1                	POP BC
  2794  10a8  e1                	POP HL
  2795  10a9  c9                	RET
  2796                          OUT_OF_MEMORY:
  2797  10aa  c3aa10            	JMP OUT_OF_MEMORY
  2798                          dstring_after:
  2799  10ad  3a3101            	LD A, (_Ttmp179)
  2800  10b0  47                	LD B, A
  2801  10b1  cd4f0f            	CALL DSFREE
  2802  10b4  21a018            	LD HL, _Tstr180
  2803  10b7  cd210f            	CALL DSDEFINE
  2804  10ba  78                	LD A, B
  2805  10bb  323101            	LD (_Ttmp179), A
  2806  10be  3a3101            	LD A, (_Ttmp179)
  2807  10c1  47                	LD B, A
  2808  10c2  cd570f            	CALL DSWRITE
  2809  10c5  3a3101            	LD A, (_Ttmp179)
  2810  10c8  47                	LD B, A
  2811  10c9  cd9410            	CALL DSDESCRIPTOR
  2812  10cc  dd7e00            	LD A, (IX)
  2813                          ; peephole(3): unread
  2814                          ;	LD (_Ttmp24), A
  2815  10cf  dd7e01            	LD A, (IX+1)
  2816  10d2  322f01            	LD (_Ttmp178), A
  2817  10d5  dd7e02            	LD A, (IX+2)
  2818  10d8  323001            	LD (_Ttmp178+1), A
  2819                          	 ; printing bit...
  2820  10db  213501            	LD HL, _Tbit5
  2821  10de  7e                	LD A, (HL)
  2822  10df  cb47              	BIT $0, A
  2823  10e1  2808              	JR Z, _label183zero
  2824  10e3  3eff              	LD A, $ff
  2825  10e5  322901            	LD (_Ttmp25), A
  2826  10e8  c3ef10            	JMP _label183done
  2827                          _label183zero:
  2828                          ; peephole(1): r228 (LD A, 0)->(XOR A)
  2829                          ;	LD A, 0
  2830  10eb  af                	XOR A
  2831  10ec  322901            	LD (_Ttmp25), A
  2832                          _label183done:
  2833  10ef  3a2901            	LD A, (_Ttmp25)
  2834  10f2  fe00              	CP $00
  2835  10f4  ca0211            	JP Z, _label182
  2836  10f7  ed5b2f01          	LD DE, (_Ttmp178)
  2837  10fb  3a2d01            	LD A, (_Ttmp31)
  2838  10fe  12                	LD (DE), A
  2839  10ff  c30a11            	jp _label182done
  2840                          _label182:
  2841  1102  ed5b2f01          	LD DE, (_Ttmp178)
  2842  1106  3a2a01            	LD A, (_Ttmp26)
  2843  1109  12                	LD (DE), A
  2844                          _label182done:
  2845  110a  3a3101            	LD A, (_Ttmp179)
  2846  110d  47                	LD B, A
  2847  110e  cd9410            	CALL DSDESCRIPTOR
  2848  1111  dd7e00            	LD A, (IX)
  2849  1114  323401            	LD (_Ttmp186), A
  2850  1117  dd7e01            	LD A, (IX+1)
  2851  111a  323201            	LD (_Ttmp185), A
  2852  111d  dd7e02            	LD A, (IX+2)
  2853  1120  323301            	LD (_Ttmp185+1), A
  2854  1123  c3b311            	jp vScrollTextUp_after
  2855                          ; /*****************************************************************************
  2856                          ;  * ugBASIC - an isomorphic BASIC language compiler for retrocomputers        *
  2857                          ;  *****************************************************************************
  2858                          ;  * Copyright 2021-2023 Marco Spedaletti (asimov@mclink.it)
  2859                          ;  *
  2860                          ;  * Licensed under the Apache License, Version 2.0 (the "License");
  2861                          ;  * you may not use this file except in compliance with the License.
  2862                          ;  * You may obtain a copy of the License at
  2863                          ;  *
  2864                          ;  * http://www.apache.org/licenses/LICENSE-2.0
  2865                          ;  *
  2866                          ;  * Unless required by applicable law or agreed to in writing, software
  2867                          ;  * distributed under the License is distributed on an "AS IS" BASIS,
  2868                          ;  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  2869                          ;  * See the License for the specific language governing permissions and
  2870                          ;  * limitations under the License.
  2871                          ;  *----------------------------------------------------------------------------
  2872                          ;  * Concesso in licenza secondo i termini della Licenza Apache, versione 2.0
  2873                          ;  * (la "Licenza"); è proibito usare questo file se non in conformità alla
  2874                          ;  * Licenza. Una copia della Licenza è disponibile all'indirizzo:
  2875                          ;  *
  2876                          ;  * http://www.apache.org/licenses/LICENSE-2.0
  2877                          ;  *
  2878                          ;  * Se non richiesto dalla legislazione vigente o concordato per iscritto,
  2879                          ;  * il software distribuito nei termini della Licenza è distribuito
  2880                          ;  * "COSì COM'è", SENZA GARANZIE O CONDIZIONI DI ALCUN TIPO, esplicite o
  2881                          ;  * implicite. Consultare la Licenza per il testo specifico che regola le
  2882                          ;  * autorizzazioni e le limitazioni previste dalla medesima.
  2883                          ;  ****************************************************************************/
  2884                          ;* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
  2885                          ;*                                                                             *
  2886                          ;*                          VERTICAL SCROLL ON MSX1                            *
  2887                          ;*                                                                             *
  2888                          ;*                             by Marco Spedaletti                             *
  2889                          ;*                                                                             *
  2890                          ;* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
  2891                          ; 			        NAME		COLOR		PATTERN
  2892                          ; VDPUPDATE0: 		$1800		            $0000 (coleco)
  2893                          ; VDPUPDATE1:		$0000		$0480		$0800
  2894                          ; VDPUPDATE2:		$3800		$2000
  2895                          ; VDPUPDATE3:		$3800		$2000		$0000
  2896                          ; if __coleco__
  2897                          ; VSCROLLTUP:
  2898                          ;     CALL WAIT_VDP_HOOK
  2899                          ;     LD HL, VSCROLLTUPNMI
  2900                          ;     CALL SET_VDP_HOOK0
  2901                          ;     CALL WAIT_VDP_HOOK
  2902                          ;     RET
  2903                          ; VSCROLLTUPNMI:
  2904                          ; else
  2905                          VSCROLLTUP:
  2906                          ; endif
  2907                          VSCROLLTUPNMI2:
  2908  1126  3a8e00            	LD A, (CURRENTTILEMODE)
  2909  1129  fe00              	CP 0
  2910  112b  c8                	RET Z
  2911  112c  3a8d00            	LD A, (CURRENTMODE)
  2912  112f  fe00              	CP 0
  2913  1131  280f              	JR Z,VSCROLLTUP0
  2914  1133  fe01              	CP 1
  2915  1135  281b              	JR Z,VSCROLLTUP1
  2916  1137  fe02              	CP 2
  2917  1139  2817              	JR Z,VSCROLLTUP2
  2918  113b  fe03              	CP 3
  2919  113d  2813              	JR Z,VSCROLLTUP3
  2920  113f  c3b211            	JP VSCROLLTUPDONE
  2921                          VSCROLLTUP0:
  2922  1142  019803            	LD BC, 40 * 23
  2923  1145  3e28              	LD A, 40
  2924  1147  5f                	LD E, A
  2925  1148  1600              	LD D, 0
  2926  114a  2a0500            	LD HL, (TEXTADDRESS)
  2927  114d  09                	ADD HL, BC
  2928  114e  e5                	PUSH HL
  2929  114f  c36211            	JP VSCROLLTUPCOMMON
  2930                          VSCROLLTUP1:
  2931                          VSCROLLTUP2:
  2932                          VSCROLLTUP3:
  2933  1152  01e002            	LD BC, 32 * 23
  2934  1155  3e20              	LD A, 32
  2935  1157  5f                	LD E, A
  2936  1158  1600              	LD D, 0
  2937  115a  2a0500            	LD HL, (TEXTADDRESS)
  2938  115d  09                	ADD HL, BC
  2939  115e  e5                	PUSH HL
  2940  115f  c36211            	JP VSCROLLTUPCOMMON
  2941                          VSCROLLTUPCOMMON:
  2942  1162  2a0500            	LD HL, (TEXTADDRESS)
  2943  1165  e5                	PUSH HL
  2944  1166  19                	ADD HL, DE
  2945  1167  d1                	POP DE
  2946  1168  04                	INC B
  2947                          
  2948                          VSCROLLTUPLOOP:
  2949  1169  d5                	PUSH DE
  2950  116a  c5                	PUSH BC
  2951  116b  545d              	LD DE, HL
  2952  116d  010100            	LD BC, 1
  2953  1170  cd3b01            	CALL VDPINCHAR
  2954  1173  c1                	POP BC
  2955  1174  d1                	POP DE
  2956  1175  c5                	PUSH BC
  2957  1176  010100            	LD BC, 1
  2958  1179  cd2d01            	CALL VDPOUTCHAR
  2959  117c  c1                	POP BC
  2960  117d  13                	INC     DE
  2961  117e  23                	INC     HL
  2962  117f  0d                	DEC     C
  2963  1180  c26911            	JP      NZ, VSCROLLTUPLOOP
  2964  1183  10e4              	DJNZ    VSCROLLTUPLOOP
  2965  1185  3a8d00            	LD A, (CURRENTMODE)
  2966  1188  fe00              	CP 0
  2967  118a  280c              	JR Z,VSCROLLTUPX0
  2968  118c  fe01              	CP 1
  2969  118e  2815              	JR Z,VSCROLLTUPX1
  2970  1190  fe02              	CP 2
  2971  1192  2811              	JR Z,VSCROLLTUPX2
  2972  1194  d1                	POP DE
  2973  1195  c3b211            	JP VSCROLLTUPDONE
  2974                          VSCROLLTUPX0:
  2975  1198  3a0900            	LD A, (EMPTYTILE)
  2976  119b  012801            	LD BC, $128
  2977  119e  d1                	POP DE
  2978  119f  cd9501            	CALL VDPFILL
  2979  11a2  c3b211            	JP VSCROLLTUPDONE
  2980                          VSCROLLTUPX1:
  2981                          VSCROLLTUPX2:
  2982  11a5  3a0900            	LD A, (EMPTYTILE)
  2983  11a8  012001            	LD BC, $120
  2984  11ab  d1                	POP DE
  2985  11ac  cd9501            	CALL VDPFILL
  2986  11af  c3b211            	JP VSCROLLTUPDONE
  2987                          VSCROLLTUPDONE:
  2988  11b2  c9                	RET
  2989                          vScrollTextUp_after:
  2990  11b3  ed5b3201          	LD DE, (_Ttmp185)
  2991  11b7  3a3401            	LD A, (_Ttmp186)
  2992  11ba  4f                	LD C, A
  2993  11bb  c3fc12            	jp tms9918varsGraphic_after
  2994                          ; /*****************************************************************************
  2995                          ;  * ugBASIC - an isomorphic BASIC language compiler for retrocomputers        *
  2996                          ;  *****************************************************************************
  2997                          ;  * Copyright 2021-2023 Marco Spedaletti (asimov@mclink.it)
  2998                          ;  *
  2999                          ;  * Licensed under the Apache License, Version 2.0 (the "License");
  3000                          ;  * you may not use this file except in compliance with the License.
  3001                          ;  * You may obtain a copy of the License at
  3002                          ;  *
  3003                          ;  * http://www.apache.org/licenses/LICENSE-2.0
  3004                          ;  *
  3005                          ;  * Unless required by applicable law or agreed to in writing, software
  3006                          ;  * distributed under the License is distributed on an "AS IS" BASIS,
  3007                          ;  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  3008                          ;  * See the License for the specific language governing permissions and
  3009                          ;  * limitations under the License.
  3010                          ;  *----------------------------------------------------------------------------
  3011                          ;  * Concesso in licenza secondo i termini della Licenza Apache, versione 2.0
  3012                          ;  * (la "Licenza"); è proibito usare questo file se non in conformità alla
  3013                          ;  * Licenza. Una copia della Licenza è disponibile all'indirizzo:
  3014                          ;  *
  3015                          ;  * http://www.apache.org/licenses/LICENSE-2.0
  3016                          ;  *
  3017                          ;  * Se non richiesto dalla legislazione vigente o concordato per iscritto,
  3018                          ;  * il software distribuito nei termini della Licenza è distribuito
  3019                          ;  * "COSì COM'è", SENZA GARANZIE O CONDIZIONI DI ALCUN TIPO, esplicite o
  3020                          ;  * implicite. Consultare la Licenza per il testo specifico che regola le
  3021                          ;  * autorizzazioni e le limitazioni previste dalla medesima.
  3022                          ;  ****************************************************************************/
  3023                          ;* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
  3024                          ;*                                                                             *
  3025                          ;*                          INTERNAL VARIABLES FOR TMS9918                     *
  3026                          ;*                                                                             *
  3027                          ;*                             by Marco Spedaletti                             *
  3028                          ;*                                                                             *
  3029                          ;* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
  3030                          ; ------------------------------------------------------------------------------
  3031                          ; BITMAP_MODE_GRAPHIC2
  3032                          ; ------------------------------------------------------------------------------
  3033                          PLOTVBASE:
  3034  11be  0000000100020003  	DW ($0000+(0*256)),($0000+(1*256)),($0000+(2*256)),($0000+(3*256))
  3035  11c6  0004000500060007  	DW ($0000+(4*256)),($0000+(5*256)),($0000+(6*256)),($0000+(7*256))
  3036  11ce  00080009000a000b  	DW ($0000+(8*256)),($0000+(9*256)),($0000+(10*256)),($0000+(11*256))
  3037  11d6  000c000d000e000f  	DW ($0000+(12*256)),($0000+(13*256)),($0000+(14*256)),($0000+(15*256))
  3038  11de  0010001100120013  	DW ($0000+(16*256)),($0000+(17*256)),($0000+(18*256)),($0000+(19*256))
  3039  11e6  0014001500160017  	DW ($0000+(20*256)),($0000+(21*256)),($0000+(22*256)),($0000+(23*256))
  3040                          PLOT8:
  3041  11ee  0000080010001800  	DW (0*8),(1*8),(2*8),(3*8),(4*8),(5*8),(6*8),(7*8),(8*8),(9*8)
              2000280030003800  
              40004800          
  3042  1202  5000580060006800  	DW (10*8),(11*8),(12*8),(13*8),(14*8),(15*8),(16*8),(17*8),(18*8),(19*8)
              7000780080008800  
              90009800          
  3043  1216  a000a800b000b800  	DW (20*8),(21*8),(22*8),(23*8),(24*8),(25*8),(26*8),(27*8),(28*8),(29*8)
              c000c800d000d800  
              e000e800          
  3044  122a  f000f800          	DW (30*8),(31*8)
  3045                          PLOTCVBASE:
  3046  122e  0020002100220023  	DW ($2000+(0*256)),($2000+(1*256)),($2000+(2*256)),($2000+(3*256))
  3047  1236  0024002500260027  	DW ($2000+(4*256)),($2000+(5*256)),($2000+(6*256)),($2000+(7*256))
  3048  123e  00280029002a002b  	DW ($2000+(8*256)),($2000+(9*256)),($2000+(10*256)),($2000+(11*256))
  3049  1246  002c002d002e002f  	DW ($2000+(12*256)),($2000+(13*256)),($2000+(14*256)),($2000+(15*256))
  3050  124e  0030003100320033  	DW ($2000+(16*256)),($2000+(17*256)),($2000+(18*256)),($2000+(19*256))
  3051  1256  0034003500360037  	DW ($2000+(20*256)),($2000+(21*256)),($2000+(22*256)),($2000+(23*256))
  3052                          VDPPOS:
  3053                          ; 4) Use the re~nainder of (X/8) to look up in a table (below) the actual data to plot. The values
  3054                          ; corresponding to different remainders are as follows: The actual bit we need to plot is determined
  3055                          ; by whatever remainder is left after calculating (X/8).
  3056  125e  e5                	PUSH HL
  3057  125f  d5                	PUSH DE
  3058  1260  1600              	LD D,0
  3059  1262  7b                	LD A, E
  3060  1263  e607              	AND $07
  3061  1265  5f                	LD E, A
  3062  1266  21ec12            	LD HL, PLOTORBIT
  3063  1269  19                	ADD HL, DE
  3064  126a  7e                	LD A, (HL)
  3065  126b  47                	LD B, A
  3066  126c  21f412            	LD HL, PLOTANDBIT
  3067  126f  19                	ADD HL, DE
  3068  1270  7e                	LD A, (HL)
  3069  1271  4f                	LD C, A
  3070  1272  d1                	POP DE
  3071  1273  e1                	POP HL
  3072  1274  d5                	PUSH DE
  3073                              ;-------------------------
  3074                              ;calc Y-cell, divide by 8
  3075                              ;y/8 is y-cell table index
  3076                              ;-------------------------
  3077  1275  cb3a              	SRL D                         ;/ 2
  3078  1277  cb3a              	SRL D                         ;/ 4
  3079  1279  cb3a              	SRL D                         ;/ 8
  3080                              ;------------------------
  3081                              ;calc X-cell, divide by 8
  3082                              ;divide 2-byte PLOTX / 8
  3083                              ;------------------------
  3084  127b  cb3b              	SRL E
  3085  127d  cb3b              	SRL E
  3086  127f  cb3b              	SRL E
  3087                              ;----------------------------------
  3088                              ;add x & y to calc cell point is in
  3089                              ;----------------------------------
  3090                          ; 1) Take the integer value of (X/8) and multiply it times 8. This will give the horizontal byte
  3091                          ; offset.
  3092  1281  c5                	PUSH BC
  3093  1282  d5                	PUSH DE
  3094  1283  1600              	LD D, 0
  3095  1285  21ee11            	LD HL, PLOT8
  3096  1288  19                	ADD HL, DE
  3097  1289  19                	ADD HL, DE
  3098  128a  7e                	LD A, (HL)
  3099  128b  4f                	LD C, A
  3100  128c  23                	INC HL
  3101  128d  7e                	LD A, (HL)
  3102  128e  47                	LD B, A
  3103                          ; 2) Take the integer value of (Y/8) and multiply it times Hex 100. This will give the vertical
  3104                          ; byte offset to the nearest eight bits.
  3105  128f  21be11            	LD HL, PLOTVBASE
  3106  1292  d1                	POP DE
  3107  1293  d5                	PUSH DE
  3108  1294  5a                	LD E, D
  3109  1295  1600              	LD D, 0
  3110  1297  19                	ADD HL, DE
  3111  1298  19                	ADD HL, DE
  3112  1299  7e                	LD A, (HL)
  3113  129a  5f                	LD E, A
  3114  129b  23                	INC HL
  3115  129c  7e                	LD A, (HL)
  3116  129d  57                	LD D, A
  3117  129e  626b              	LD HL, DE
  3118                          ; 3) Add the horizontal byte offset to the vertical starting address. This will give the actual
  3119                          ; address of the byte we need to write data to in order to plot our pixel.
  3120  12a0  09                	ADD HL, BC
  3121  12a1  d1                	POP DE
  3122                          ; If there is any remainder after calculating (Y/8), add
  3123                          ; it to the vertical byte offset. This gives the vertical
  3124                          ; starting address.
  3125  12a2  c1                	POP BC
  3126  12a3  d1                	POP DE
  3127                          
  3128  12a4  d5                	PUSH DE
  3129  12a5  7a                	LD A, D
  3130  12a6  e607              	AND $07
  3131  12a8  5f                	LD E, A
  3132  12a9  1600              	LD D, 0
  3133  12ab  19                	ADD HL, DE
  3134  12ac  d1                	POP DE
  3135  12ad  f3                	DI
  3136  12ae  d5                	PUSH DE
  3137  12af  d9                	EXX
  3138  12b0  d1                	POP DE
  3139  12b1  210020            	LD HL, $2000
  3140  12b4  d5                	PUSH DE
  3141  12b5  1600              	LD D, 0
  3142  12b7  cb3b              	SRL E
  3143  12b9  cb3b              	SRL E
  3144  12bb  cb3b              	SRL E
  3145  12bd  21ee11            	LD HL, PLOT8
  3146  12c0  19                	ADD HL, DE
  3147  12c1  19                	ADD HL, DE
  3148  12c2  7e                	LD A, (HL)
  3149  12c3  4f                	LD C, A
  3150  12c4  23                	INC HL
  3151  12c5  7e                	LD A, (HL)
  3152  12c6  47                	LD B, A
  3153  12c7  212e12            	LD HL, PLOTCVBASE
  3154  12ca  d1                	POP DE
  3155  12cb  d5                	PUSH DE
  3156  12cc  5a                	LD E, D
  3157  12cd  cb3b              	SRL E
  3158  12cf  cb3b              	SRL E
  3159  12d1  cb3b              	SRL E
  3160  12d3  1600              	LD D, 0
  3161  12d5  19                	ADD HL, DE
  3162  12d6  19                	ADD HL, DE
  3163  12d7  7e                	LD A, (HL)
  3164  12d8  5f                	LD E, A
  3165  12d9  23                	INC HL
  3166  12da  7e                	LD A, (HL)
  3167  12db  57                	LD D, A
  3168  12dc  626b              	LD HL, DE
  3169  12de  09                	ADD HL, BC
  3170  12df  d1                	POP DE
  3171  12e0  d5                	PUSH DE
  3172  12e1  7a                	LD A, D
  3173  12e2  e607              	AND $07
  3174  12e4  5f                	LD E, A
  3175  12e5  1600              	LD D, 0
  3176  12e7  19                	ADD HL, DE
  3177  12e8  d1                	POP DE
  3178  12e9  d9                	EXX
  3179  12ea  fb                	EI
  3180  12eb  c9                	RET
  3181                          PLOTORBIT:
  3182  12ec  80                	DB %10000000
  3183  12ed  40                	DB %01000000
  3184  12ee  20                	DB %00100000
  3185  12ef  10                	DB %00010000
  3186  12f0  08                	DB %00001000
  3187  12f1  04                	DB %00000100
  3188  12f2  02                	DB %00000010
  3189  12f3  01                	DB %00000001
  3190                          PLOTANDBIT:
  3191  12f4  7f                	DB %01111111
  3192  12f5  bf                	DB %10111111
  3193  12f6  df                	DB %11011111
  3194  12f7  ef                	DB %11101111
  3195  12f8  f7                	DB %11110111
  3196  12f9  fb                	DB %11111011
  3197  12fa  fd                	DB %11111101
  3198  12fb  fe                	DB %11111110
  3199                          tms9918varsGraphic_after:
  3200  12fc  c30913            	jp textEncodedAt_after
  3201                          ; /*****************************************************************************
  3202                          ;  * ugBASIC - an isomorphic BASIC language compiler for retrocomputers        *
  3203                          ;  *****************************************************************************
  3204                          ;  * Copyright 2021-2023 Marco Spedaletti (asimov@mclink.it)
  3205                          ;  *
  3206                          ;  * Licensed under the Apache License, Version 2.0 (the "License");
  3207                          ;  * you may not use this file except in compliance with the License.
  3208                          ;  * You may obtain a copy of the License at
  3209                          ;  *
  3210                          ;  * http://www.apache.org/licenses/LICENSE-2.0
  3211                          ;  *
  3212                          ;  * Unless required by applicable law or agreed to in writing, software
  3213                          ;  * distributed under the License is distributed on an "AS IS" BASIS,
  3214                          ;  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  3215                          ;  * See the License for the specific language governing permissions and
  3216                          ;  * limitations under the License.
  3217                          ;  *----------------------------------------------------------------------------
  3218                          ;  * Concesso in licenza secondo i termini della Licenza Apache, versione 2.0
  3219                          ;  * (la "Licenza"); è proibito usare questo file se non in conformità alla
  3220                          ;  * Licenza. Una copia della Licenza è disponibile all'indirizzo:
  3221                          ;  *
  3222                          ;  * http://www.apache.org/licenses/LICENSE-2.0
  3223                          ;  *
  3224                          ;  * Se non richiesto dalla legislazione vigente o concordato per iscritto,
  3225                          ;  * il software distribuito nei termini della Licenza è distribuito
  3226                          ;  * "COSì COM'è", SENZA GARANZIE O CONDIZIONI DI ALCUN TIPO, esplicite o
  3227                          ;  * implicite. Consultare la Licenza per il testo specifico che regola le
  3228                          ;  * autorizzazioni e le limitazioni previste dalla medesima.
  3229                          ;  ****************************************************************************/
  3230                          ;* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
  3231                          ;*                                                                             *
  3232                          ;*                      TEXT AT GIVEN POSITION ON MSX1                         *
  3233                          ;*                                                                             *
  3234                          ;*                             by Marco Spedaletti                             *
  3235                          ;*                                                                             *
  3236                          ;* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
  3237                          TEXTATDECODE:
  3238  12ff  fe61              	CP 97
  3239  1301  3805              	JR C, TEXTATDECODEX1F
  3240  1303  d660              	SUB 96
  3241  1305  c30813            	JP TEXTATDECODE0
  3242                          TEXTATDECODEX1F:
  3243                              ; CP 64
  3244                              ; JR C, TEXTATDECODEX39
  3245                              ; SUB 64
  3246                              ; JP TEXTATDECODE0
  3247                          TEXTATDECODEX39:
  3248                          ;     CP $5F
  3249                          ;     JR C, TEXTATDECODEX5A
  3250                          ;     SUB $40
  3251                          ;     JP TEXTATDECODE0
  3252                          ; TEXTATDECODEX5A:
  3253                          ;     CP $7F
  3254                          ;     JR C, TEXTATDECODEX7F
  3255                          ;     SUB $20
  3256                          ;     JP TEXTATDECODE0
  3257                          ; TEXTATDECODEX7F:
  3258                          ;     LD A, $60
  3259                          ;     JP TEXTATDECODE0
  3260                          TEXTATDECODE0:
  3261                              ; AND $3F
  3262  1308  c9                	RET
  3263                          textEncodedAt_after:
  3264  1309  c30d16            	jp textEncodedAtText_after
  3265                          ; /*****************************************************************************
  3266                          ;  * ugBASIC - an isomorphic BASIC language compiler for retrocomputers        *
  3267                          ;  *****************************************************************************
  3268                          ;  * Copyright 2021-2023 Marco Spedaletti (asimov@mclink.it)
  3269                          ;  *
  3270                          ;  * Licensed under the Apache License, Version 2.0 (the "License");
  3271                          ;  * you may not use this file except in compliance with the License.
  3272                          ;  * You may obtain a copy of the License at
  3273                          ;  *
  3274                          ;  * http://www.apache.org/licenses/LICENSE-2.0
  3275                          ;  *
  3276                          ;  * Unless required by applicable law or agreed to in writing, software
  3277                          ;  * distributed under the License is distributed on an "AS IS" BASIS,
  3278                          ;  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  3279                          ;  * See the License for the specific language governing permissions and
  3280                          ;  * limitations under the License.
  3281                          ;  *----------------------------------------------------------------------------
  3282                          ;  * Concesso in licenza secondo i termini della Licenza Apache, versione 2.0
  3283                          ;  * (la "Licenza"); è proibito usare questo file se non in conformità alla
  3284                          ;  * Licenza. Una copia della Licenza è disponibile all'indirizzo:
  3285                          ;  *
  3286                          ;  * http://www.apache.org/licenses/LICENSE-2.0
  3287                          ;  *
  3288                          ;  * Se non richiesto dalla legislazione vigente o concordato per iscritto,
  3289                          ;  * il software distribuito nei termini della Licenza è distribuito
  3290                          ;  * "COSì COM'è", SENZA GARANZIE O CONDIZIONI DI ALCUN TIPO, esplicite o
  3291                          ;  * implicite. Consultare la Licenza per il testo specifico che regola le
  3292                          ;  * autorizzazioni e le limitazioni previste dalla medesima.
  3293                          ;  ****************************************************************************/
  3294                          ;* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
  3295                          ;*                                                                             *
  3296                          ;*                      TEXT AT GIVEN POSITION ON MSX1                         *
  3297                          ;*                                                                             *
  3298                          ;*                             by Marco Spedaletti                             *
  3299                          ;*                                                                             *
  3300                          ;* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
  3301                          ; 			        NAME		COLOR		PATTERN
  3302                          ; VDPUPDATE0: 		$1800		            $0000 (coleco)
  3303                          ; VDPUPDATE1:		$1800		$0480		$0000 (coleco)
  3304                          ; VDPUPDATE2:		$3800		$2000
  3305                          ; VDPUPDATE3:		$3800		$2000		$0000
  3306                          ; if __coleco__
  3307                          ; TEXTATTILEMODE:
  3308                          ;     CALL WAIT_VDP_HOOK
  3309                          ;     CALL SET_VDP_HOOK_HL
  3310                          ;     LD HL, TEXTATTILEMODENMI
  3311                          ;     CALL SET_VDP_HOOK
  3312                          ;     CALL WAIT_VDP_HOOK
  3313                          ;     RET
  3314                          ; TEXTATTILEMODENMI:
  3315                          ;     CALL GET_VDP_HOOK
  3316                          ; else
  3317                          TEXTATTILEMODE:
  3318                          ; endif
  3319                          TEXTATTILEMODENMI2:
  3320  130c  3a8e00            	LD A, (CURRENTTILEMODE)
  3321  130f  fe00              	CP 0
  3322  1311  c8                	RET Z
  3323  1312  79                	LD A, C
  3324  1313  fe00              	CP 0
  3325  1315  2003              	JR NZ,TEXTATTILEMODEGO
  3326  1317  c30c16            	JP TEXTATTILEMODEDONE
  3327                          TEXTATTILEMODEGO:
  3328  131a  c5                	PUSH BC
  3329  131b  d5                	PUSH DE
  3330  131c  3a6700            	LD A, (CURRENTTILESWIDTH)
  3331  131f  5f                	LD E, A
  3332  1320  1600              	LD D, 0
  3333  1322  3a8d00            	LD A, (CURRENTMODE)
  3334  1325  fe00              	CP 0
  3335  1327  280d              	JR Z,TEXTATTILEMODEGO0
  3336  1329  fe01              	CP 1
  3337  132b  2809              	JR Z,TEXTATTILEMODEGO1
  3338  132d  fe02              	CP 2
  3339  132f  280e              	JR Z,TEXTATTILEMODEGO2
  3340  1331  fe03              	CP 3
  3341  1333  280a              	JR Z,TEXTATTILEMODEGO3
  3342  1335  c9                	RET
  3343                          TEXTATTILEMODEGO0:
  3344                          TEXTATTILEMODEGO1:
  3345  1336  2a0500            	LD HL, (TEXTADDRESS)
  3346  1339  220f00            	LD (COPYOFTEXTADDRESS), HL
  3347  133c  c34813            	JMP TEXTATTILEMODEGOX
  3348                          TEXTATTILEMODEGO2:
  3349                          TEXTATTILEMODEGO3:
  3350  133f  2a0500            	LD HL, (TEXTADDRESS)
  3351  1342  220f00            	LD (COPYOFTEXTADDRESS), HL
  3352  1345  c34813            	JMP TEXTATTILEMODEGOX
  3353                          TEXTATTILEMODEGOX:
  3354                          ; peephole(1): r228 (LD A, 0)->(XOR A)
  3355                          ;    LD A, 0
  3356  1348  af                	XOR A
  3357  1349  47                	LD B, A
  3358  134a  328c00            	LD (TABSTODRAW), A
  3359  134d  3a5a00            	LD A, (YCURSYS)
  3360  1350  fe00              	CP 0
  3361  1352  280b              	JR Z, TEXTATSKIP
  3362  1354  4f                	LD C, A
  3363  1355  2a0f00            	LD HL, (COPYOFTEXTADDRESS)
  3364                          TEXTATLOOP1:
  3365  1358  19                	ADD HL, DE
  3366  1359  0d                	DEC C
  3367  135a  20fc              	JR NZ, TEXTATLOOP1
  3368  135c  220f00            	LD (COPYOFTEXTADDRESS), HL
  3369                          TEXTATSKIP:
  3370  135f  3a5900            	LD A, (XCURSYS)
  3371  1362  5f                	LD E, A
  3372                          ; peephole(1): r228 (LD A, 0)->(XOR A)
  3373                          ;    LD A, 0
  3374  1363  af                	XOR A
  3375  1364  1600              	LD D, 0
  3376  1366  2a0f00            	LD HL, (COPYOFTEXTADDRESS)
  3377  1369  19                	ADD HL, DE
  3378  136a  220f00            	LD (COPYOFTEXTADDRESS), HL
  3379  136d  d1                	POP DE
  3380  136e  c1                	POP BC
  3381                          
  3382                          TEXTATLOOP2:
  3383  136f  3a8c00            	LD A, (TABSTODRAW)
  3384  1372  fe00              	CP 0
  3385  1374  2803              	JR Z,TEXTATNSKIPTAB
  3386  1376  c39b15            	JMP TEXTATSKIPTAB
  3387                          TEXTATNSKIPTAB:
  3388  1379  1a                	LD A, (DE)
  3389  137a  fe1f              	CP 31
  3390  137c  381f              	JR C,TEXTATCC
  3391                          TEXTATXCC:
  3392  137e  cdff12            	CALL TEXTATDECODE
  3393  1381  c3d214            	JMP TEXTATSP0
  3394                          TEXTATTAB:
  3395  1384  3a8900            	LD A, (TABCOUNT)
  3396  1387  47                	LD B, A
  3397  1388  3a5900            	LD A, (XCURSYS)
  3398                          TEXTATTAB2:
  3399  138b  b8                	CP B
  3400  138c  3804              	JR C, TEXTATTAB3
  3401  138e  90                	SUB A, B
  3402  138f  c38b13            	JMP TEXTATTAB2
  3403                          TEXTATTAB3:
  3404  1392  47                	LD B, A
  3405  1393  3a8900            	LD A, (TABCOUNT)
  3406  1396  90                	SUB A, B
  3407  1397  328c00            	LD (TABSTODRAW), A
  3408  139a  c3f915            	JMP TEXTATNEXT
  3409                          TEXTATCC:
  3410  139d  fe0d              	CP 13
  3411  139f  282e              	JR Z, TEXTATLF
  3412  13a1  fe0a              	CP 10
  3413  13a3  282a              	JR Z, TEXTATLF
  3414  13a5  fe09              	CP 9
  3415  13a7  28db              	JR Z, TEXTATTAB
  3416  13a9  fe01              	CP 1
  3417  13ab  283d              	JR Z, TEXTATPEN
  3418  13ad  fe02              	CP 2
  3419  13af  284f              	JR Z, TEXTATPAPER
  3420  13b1  fe03              	CP 3
  3421  13b3  2859              	JR Z, TEXTATCMOVEPREPARE
  3422  13b5  fe04              	CP 4
  3423  13b7  282e              	JR Z, TEXTATXAT
  3424  13b9  fe05              	CP 5
  3425  13bb  2803              	JR Z, TEXTATCLS
  3426  13bd  c3f915            	JMP TEXTATNEXT
  3427                          TEXTATCLS:
  3428  13c0  13                	INC DE
  3429  13c1  f5                	PUSH AF
  3430  13c2  d5                	PUSH DE
  3431  13c3  e5                	PUSH HL
  3432  13c4  c5                	PUSH BC
  3433  13c5  cd5a03            	CALL CLST
  3434  13c8  c1                	POP BC
  3435  13c9  e1                	POP HL
  3436  13ca  d1                	POP DE
  3437  13cb  f1                	POP AF
  3438  13cc  c3f915            	JMP TEXTATNEXT
  3439                          TEXTATLF:
  3440  13cf  13                	INC DE
  3441  13d0  3a5900            	LD A, (XCURSYS)
  3442  13d3  47                	LD B, A
  3443  13d4  3a6700            	LD A, (CURRENTTILESWIDTH)
  3444  13d7  90                	SUB A, B
  3445  13d8  d5                	PUSH DE
  3446  13d9  2a0f00            	LD HL, (COPYOFTEXTADDRESS)
  3447  13dc  1600              	LD D, 0
  3448  13de  5f                	LD E, A
  3449  13df  19                	ADD HL, DE
  3450  13e0  220f00            	LD (COPYOFTEXTADDRESS), HL
  3451  13e3  d1                	POP DE
  3452  13e4  c3c015            	JMP TEXTATNEXT2
  3453                          TEXTATXAT:
  3454  13e7  c3b914            	JMP TEXTATAT
  3455                          TEXTATPEN:
  3456  13ea  13                	INC DE
  3457  13eb  0d                	DEC C
  3458  13ec  3a5d00            	LD A, (TEXTWW)
  3459  13ef  e602              	AND $2
  3460  13f1  2809              	JR Z,TEXTATPENDISABLED
  3461  13f3  1a                	LD A, (DE)
  3462  13f4  feff              	CP $FF
  3463  13f6  2001              	JR NZ, TEXTATPEN2
  3464                          ; peephole(1): r228 (LD A, 0)->(XOR A)
  3465                          ;    LD A, 0
  3466  13f8  af                	XOR A
  3467                          TEXTATPEN2:
  3468  13f9  325b00            	LD (_PEN), A
  3469                          TEXTATPENDISABLED:
  3470  13fc  13                	INC DE
  3471  13fd  c3f915            	JMP TEXTATNEXT
  3472                          TEXTATPAPER:
  3473  1400  13                	INC DE
  3474  1401  0d                	DEC C
  3475  1402  3a5d00            	LD A, (TEXTWW)
  3476  1405  e601              	AND $1
  3477  1407  2801              	JR Z, TEXTATPAPERDISABLED
  3478  1409  1a                	LD A, (DE)
  3479                              ; STA $d021
  3480                              ; STA $d020
  3481                          TEXTATPAPERDISABLED:
  3482  140a  13                	INC DE
  3483  140b  c3f915            	JMP TEXTATNEXT
  3484                          TEXTATCMOVEPREPARE:
  3485  140e  13                	INC DE
  3486  140f  0d                	DEC C
  3487  1410  1a                	LD A, (DE)
  3488  1411  328a00            	LD (CLINEX), A
  3489  1414  13                	INC DE
  3490  1415  0d                	DEC C
  3491  1416  1a                	LD A, (DE)
  3492  1417  328b00            	LD (CLINEY), A
  3493                          TEXTATCMOVE:
  3494  141a  3a5900            	LD A, (XCURSYS)
  3495  141d  47                	LD B, A
  3496  141e  3a8a00            	LD A, (CLINEX)
  3497  1421  80                	ADD A, B
  3498  1422  fe80              	CP $80
  3499  1424  303b              	JR NC, TEXTATCMOVESKIPX
  3500  1426  f5                	PUSH AF
  3501  1427  3a6700            	LD A, (CURRENTTILESWIDTH)
  3502  142a  47                	LD B, A
  3503  142b  f1                	POP AF
  3504  142c  b8                	CP B
  3505  142d  3032              	JR NC, TEXTATCMOVESKIPX
  3506  142f  325900            	LD (XCURSYS), A
  3507  1432  3a8a00            	LD A, (CLINEX)
  3508  1435  fe80              	CP $80
  3509  1437  3816              	JR C, TEXTATCMOVEADDPX
  3510                          TEXTATCMOVESUBPX:
  3511                          ; peephole(1): r319 (XOR $FF)->(CPL)
  3512                          ;    XOR $FF
  3513  1439  2f                	CPL
  3514  143a  c601              	ADD 1
  3515  143c  328a00            	LD (CLINEX), A
  3516  143f  2a0f00            	LD HL, (COPYOFTEXTADDRESS)
  3517  1442  d5                	PUSH DE
  3518  1443  5f                	LD E, A
  3519  1444  1600              	LD D, 0
  3520  1446  ed52              	SBC HL, DE
  3521  1448  d1                	POP DE
  3522  1449  220f00            	LD (COPYOFTEXTADDRESS), HL
  3523  144c  c36114            	JMP TEXTATCMOVESKIPX
  3524                          TEXTATCMOVEADDPX:
  3525  144f  328a00            	LD (CLINEX), A
  3526  1452  2a0f00            	LD HL, (COPYOFTEXTADDRESS)
  3527  1455  d5                	PUSH DE
  3528  1456  5f                	LD E, A
  3529  1457  1600              	LD D, 0
  3530  1459  19                	ADD HL, DE
  3531  145a  d1                	POP DE
  3532  145b  220f00            	LD (COPYOFTEXTADDRESS), HL
  3533  145e  c36114            	JMP TEXTATCMOVESKIPX
  3534                          TEXTATCMOVESKIPX:
  3535  1461  3a5a00            	LD A, (YCURSYS)
  3536  1464  47                	LD B, A
  3537  1465  3a8b00            	LD A, (CLINEY)
  3538  1468  80                	ADD A,B
  3539  1469  fe80              	CP $80
  3540  146b  3048              	JR NC, TEXTATCMOVESKIPY
  3541  146d  fe1a              	CP 26
  3542  146f  3044              	JR NC, TEXTATCMOVESKIPY
  3543  1471  325a00            	LD (YCURSYS), A
  3544                          TEXTATCMOVEADDPY:
  3545  1474  3a8b00            	LD A, (CLINEY)
  3546  1477  fe80              	CP $80
  3547  1479  3803              	JR C, TEXTATCMOVELOOPYP
  3548  147b  c39614            	JMP TEXTATCMOVELOOPYM
  3549                          TEXTATCMOVELOOPYP:
  3550  147e  c5                	PUSH BC
  3551  147f  4f                	LD C, A
  3552  1480  2a0f00            	LD HL, (COPYOFTEXTADDRESS)
  3553  1483  d5                	PUSH DE
  3554  1484  3a6700            	LD A, (CURRENTTILESWIDTH)
  3555  1487  5f                	LD E, A
  3556  1488  1600              	LD D, 0
  3557                          TEXTATCMOVELOOPY:
  3558  148a  19                	ADD HL, DE
  3559  148b  0d                	DEC C
  3560  148c  20fc              	JR NZ, TEXTATCMOVELOOPY
  3561  148e  d1                	POP DE
  3562  148f  220f00            	LD (COPYOFTEXTADDRESS), HL
  3563  1492  c1                	POP BC
  3564  1493  c3b514            	JMP TEXTATCMOVESKIPY
  3565                          TEXTATCMOVELOOPYM:
  3566                          ; peephole(1): r319 (XOR $FF)->(CPL)
  3567                          ;    XOR $FF
  3568  1496  2f                	CPL
  3569  1497  c601              	ADD A, 1
  3570  1499  328b00            	LD (CLINEY), A
  3571  149c  c5                	PUSH BC
  3572  149d  4f                	LD C, A
  3573  149e  2a0f00            	LD HL, (COPYOFTEXTADDRESS)
  3574                          TEXTATCMOVELOOPY2:
  3575  14a1  d5                	PUSH DE
  3576  14a2  3a6700            	LD A, (CURRENTTILESWIDTH)
  3577  14a5  5f                	LD E, A
  3578  14a6  1600              	LD D, 0
  3579  14a8  ed52              	SBC HL, DE
  3580  14aa  d1                	POP DE
  3581  14ab  0d                	DEC C
  3582  14ac  20f3              	JR NZ, TEXTATCMOVELOOPY2
  3583  14ae  220f00            	LD (COPYOFTEXTADDRESS), HL
  3584  14b1  c1                	POP BC
  3585  14b2  c3b514            	JMP TEXTATCMOVESKIPY
  3586                          TEXTATCMOVESKIPY:
  3587  14b5  13                	INC DE
  3588  14b6  c3f915            	JMP TEXTATNEXT
  3589                          TEXTATAT:
  3590  14b9  13                	INC DE
  3591  14ba  0d                	DEC C
  3592  14bb  3a5900            	LD A, (XCURSYS)
  3593  14be  47                	LD B, A
  3594  14bf  1a                	LD A, (DE)
  3595  14c0  90                	SUB A, B
  3596  14c1  328a00            	LD (CLINEX), A
  3597  14c4  13                	INC DE
  3598  14c5  0d                	DEC C
  3599  14c6  3a5a00            	LD A, (YCURSYS)
  3600  14c9  47                	LD B, A
  3601  14ca  1a                	LD A, (DE)
  3602  14cb  90                	SUB A, B
  3603  14cc  328b00            	LD (CLINEY), A
  3604  14cf  c31a14            	JMP TEXTATCMOVE
  3605                          TEXTATSP0:
  3606  14d2  2a0f00            	LD HL, (COPYOFTEXTADDRESS)
  3607  14d5  f5                	PUSH AF
  3608  14d6  d5                	PUSH DE
  3609  14d7  c5                	PUSH BC
  3610  14d8  545d              	LD DE, HL
  3611  14da  010100            	LD BC, 1
  3612  14dd  cd2d01            	CALL VDPOUTCHAR
  3613  14e0  c1                	POP BC
  3614  14e1  d1                	POP DE
  3615  14e2  f1                	POP AF
  3616  14e3  f5                	PUSH AF
  3617  14e4  3a8d00            	LD A, (CURRENTMODE)
  3618  14e7  fe00              	CP 0
  3619  14e9  280e              	JR Z,TEXTAT20
  3620  14eb  fe01              	CP 1
  3621  14ed  280a              	JR Z,TEXTAT21
  3622  14ef  fe02              	CP 2
  3623  14f1  2833              	JR Z,TEXTAT22
  3624  14f3  fe03              	CP 3
  3625  14f5  282f              	JR Z,TEXTAT23
  3626  14f7  f1                	POP AF
  3627  14f8  c9                	RET
  3628                          TEXTAT20:
  3629                          TEXTAT21:
  3630  14f9  f1                	POP AF
  3631  14fa  e5                	PUSH HL
  3632  14fb  f5                	PUSH AF
  3633  14fc  d5                	PUSH DE
  3634  14fd  c5                	PUSH BC
  3635  14fe  cb3f              	SRL A
  3636  1500  cb3f              	SRL A
  3637  1502  cb3f              	SRL A
  3638  1504  5f                	LD E, A
  3639                          ; peephole(1): r228 (LD A, 0)->(XOR A)
  3640                          ;    LD A, 0
  3641  1505  af                	XOR A
  3642  1506  57                	LD D, A
  3643  1507  218004            	LD HL, $480
  3644  150a  19                	ADD HL, DE
  3645  150b  545d              	LD DE, HL
  3646  150d  3a5b00            	LD A, (_PEN)
  3647  1510  cb27              	SLA A
  3648  1512  cb27              	SLA A
  3649  1514  cb27              	SLA A
  3650  1516  cb27              	SLA A
  3651  1518  010100            	LD BC, 1
  3652  151b  cd2d01            	CALL VDPOUTCHAR
  3653  151e  c1                	POP BC
  3654  151f  d1                	POP DE
  3655  1520  f1                	POP AF
  3656  1521  e1                	POP HL
  3657  1522  f1                	POP AF
  3658  1523  c39115            	JMP TEXTAT2X
  3659                          TEXTAT22:
  3660                          TEXTAT23:
  3661  1526  f1                	POP AF
  3662  1527  e5                	PUSH HL
  3663  1528  f5                	PUSH AF
  3664  1529  d5                	PUSH DE
  3665  152a  c5                	PUSH BC
  3666  152b  6f                	LD L, A
  3667                          ; peephole(1): r228 (LD A, 0)->(XOR A)
  3668                          ;    LD A, 0
  3669  152c  af                	XOR A
  3670  152d  67                	LD H, A
  3671  152e  29                	ADD HL, HL
  3672  152f  29                	ADD HL, HL
  3673  1530  29                	ADD HL, HL
  3674  1531  545d              	LD DE, HL
  3675  1533  d5                	PUSH DE
  3676  1534  2a0300            	LD HL, (COLORMAPADDRESS)
  3677  1537  19                	ADD HL, DE
  3678  1538  545d              	LD DE, HL
  3679  153a  3a5b00            	LD A, (_PEN)
  3680  153d  cb27              	SLA A
  3681  153f  cb27              	SLA A
  3682  1541  cb27              	SLA A
  3683  1543  cb27              	SLA A
  3684  1545  010100            	LD BC, 1
  3685  1548  cda901            	CALL VDPFILL8
  3686  154b  d1                	POP DE
  3687  154c  d5                	PUSH DE
  3688  154d  2a0300            	LD HL, (COLORMAPADDRESS)
  3689  1550  110008            	LD DE, $800
  3690  1553  19                	ADD HL, DE
  3691  1554  d1                	POP DE
  3692  1555  d5                	PUSH DE
  3693  1556  19                	ADD HL, DE
  3694  1557  545d              	LD DE, HL
  3695  1559  3a5b00            	LD A, (_PEN)
  3696  155c  cb27              	SLA A
  3697  155e  cb27              	SLA A
  3698  1560  cb27              	SLA A
  3699  1562  cb27              	SLA A
  3700  1564  010100            	LD BC, 1
  3701  1567  cda901            	CALL VDPFILL8
  3702  156a  d1                	POP DE
  3703  156b  d5                	PUSH DE
  3704  156c  2a0300            	LD HL, (COLORMAPADDRESS)
  3705  156f  110010            	LD DE, $1000
  3706  1572  19                	ADD HL, DE
  3707  1573  d1                	POP DE
  3708  1574  d5                	PUSH DE
  3709  1575  19                	ADD HL, DE
  3710  1576  545d              	LD DE, HL
  3711  1578  3a5b00            	LD A, (_PEN)
  3712  157b  cb27              	SLA A
  3713  157d  cb27              	SLA A
  3714  157f  cb27              	SLA A
  3715  1581  cb27              	SLA A
  3716  1583  010100            	LD BC, 1
  3717  1586  cda901            	CALL VDPFILL8
  3718  1589  d1                	POP DE
  3719  158a  c1                	POP BC
  3720  158b  d1                	POP DE
  3721  158c  f1                	POP AF
  3722  158d  e1                	POP HL
  3723  158e  c39115            	JMP TEXTAT2X
  3724                          TEXTAT2X:
  3725  1591  3a5d00            	LD A, (TEXTWW)
  3726  1594  e602              	AND $2
  3727  1596  2800              	JR Z, TEXTATCNOPEN
  3728                          TEXTATCNOPEN:
  3729  1598  c3a515            	JMP TEXTATINCX
  3730                          TEXTATSKIPTAB:
  3731  159b  3a8c00            	LD A, (TABSTODRAW)
  3732  159e  3d                	DEC A
  3733  159f  328c00            	LD (TABSTODRAW),A
  3734  15a2  c3a515            	JMP TEXTATINCX
  3735                          TEXTATINCX:
  3736  15a5  2a0f00            	LD HL, (COPYOFTEXTADDRESS)
  3737  15a8  23                	INC HL
  3738  15a9  220f00            	LD (COPYOFTEXTADDRESS), HL
  3739  15ac  13                	INC DE
  3740  15ad  3a5900            	LD A, (XCURSYS)
  3741  15b0  3c                	INC A
  3742  15b1  325900            	LD (XCURSYS), A
  3743  15b4  f5                	PUSH AF
  3744  15b5  3a6700            	LD A, (CURRENTTILESWIDTH)
  3745  15b8  47                	LD B, A
  3746  15b9  f1                	POP AF
  3747  15ba  b8                	CP B
  3748  15bb  2803              	JR Z, TEXTATNEXT2
  3749  15bd  c3f915            	JMP TEXTATNEXT
  3750                          TEXTATNEXT2:
  3751                          ; peephole(1): r228 (LD A, 0)->(XOR A)
  3752                          ;    LD A, 0
  3753  15c0  af                	XOR A
  3754  15c1  325900            	LD (XCURSYS), A
  3755  15c4  3a5a00            	LD A, (YCURSYS)
  3756  15c7  3c                	INC A
  3757  15c8  325a00            	LD (YCURSYS), A
  3758  15cb  f5                	PUSH AF
  3759  15cc  3a6800            	LD A, (CURRENTTILESHEIGHT)
  3760  15cf  47                	LD B, A
  3761  15d0  f1                	POP AF
  3762  15d1  b8                	CP B
  3763  15d2  2803              	JR Z, TEXTATNEXT3
  3764  15d4  c3f915            	JMP TEXTATNEXT
  3765                          TEXTATNEXT3:
  3766  15d7  f5                	PUSH AF
  3767  15d8  c5                	PUSH BC
  3768  15d9  d5                	PUSH DE
  3769  15da  e5                	PUSH HL
  3770                              ; if __coleco__
  3771                              ;     CALL VSCROLLTUPNMI
  3772                              ; else
  3773  15db  cd2611            	CALL VSCROLLTUP
  3774                              ; endif
  3775  15de  e1                	POP HL
  3776  15df  d1                	POP DE
  3777  15e0  c1                	POP BC
  3778  15e1  f1                	POP AF
  3779  15e2  3a5a00            	LD A, (YCURSYS)
  3780  15e5  3d                	DEC A
  3781  15e6  325a00            	LD (YCURSYS), A
  3782  15e9  2a0f00            	LD HL, (COPYOFTEXTADDRESS)
  3783  15ec  d5                	PUSH DE
  3784  15ed  3a6700            	LD A, (CURRENTTILESWIDTH)
  3785  15f0  5f                	LD E, A
  3786  15f1  1600              	LD D, 0
  3787  15f3  ed52              	SBC HL, DE
  3788  15f5  d1                	POP DE
  3789  15f6  220f00            	LD (COPYOFTEXTADDRESS), HL
  3790                          TEXTATNEXT:
  3791  15f9  3a8c00            	LD A, (TABSTODRAW)
  3792  15fc  fe00              	CP 0
  3793  15fe  2803              	JR Z, TEXTATXLOOP2
  3794  1600  c36f13            	JMP TEXTATLOOP2
  3795                          TEXTATXLOOP2:
  3796  1603  0d                	DEC C
  3797  1604  2803              	JR Z, TEXTATEND
  3798  1606  c36f13            	JMP TEXTATLOOP2
  3799                          TEXTATEND:
  3800  1609  c30c16            	JP TEXTATTILEMODEDONE
  3801                          TEXTATTILEMODEDONE:
  3802  160c  c9                	RET
  3803                          textEncodedAtText_after:
  3804  160d  cd0c13            	CALL TEXTATTILEMODE
  3805  1610  3a3101            	LD A, (_Ttmp179)
  3806  1613  47                	LD B, A
  3807  1614  cd4f0f            	CALL DSFREE
  3808                          	; P:1126
  3809                          	; L:31
  3810  1617  0600              	LD B, 0
  3811  1619  3a1501            	LD A, (_x)
  3812  161c  47                	LD B, A
  3813  161d  3a3801            	LD A, (_TRtmp163)
  3814  1620  80                	ADD A, B
  3815  1621  321501            	LD (_x), A
  3816  1624  3a1501            	LD A, (_x)
  3817  1627  fe00              	CP $00
  3818  1629  ca2f16            	JP Z, _label165bis
  3819  162c  c3e90d            	jp _label165bf
  3820                          _label165bis:
  3821                          	; P:11
  3822                          	; L:32
  3823  162f  3e00              	LD A, $00
  3824  1631  325900            	LD (XCURSYS), A
  3825  1634  3a5a00            	LD A, (YCURSYS)
  3826  1637  3c                	INC A
  3827  1638  325a00            	LD (YCURSYS), A
  3828  163b  3a6800            	LD A, (CURRENTTILESHEIGHT)
  3829  163e  47                	LD B, A
  3830  163f  3a5a00            	LD A, (YCURSYS)
  3831  1642  b8                	CP B
  3832  1643  3807              	JR C, _label191
  3833                          ; peephole(1): r228 (LD A, 0)->(XOR A)
  3834                          ;	LD A, 0
  3835  1645  af                	XOR A
  3836  1646  322e01            	LD (_Ttmp160), A
  3837  1649  c35116            	JMP _label191b2
  3838                          _label191:
  3839  164c  3eff              	LD A, $ff
  3840  164e  322e01            	LD (_Ttmp160), A
  3841                          _label191b2:
  3842  1651  3a2e01            	LD A, (_Ttmp160)
  3843                          ; peephole(1): r319 (XOR $FF)->(CPL)
  3844                          ;	XOR $FF
  3845  1654  2f                	CPL
  3846  1655  322e01            	LD (_Ttmp160), A
  3847  1658  3a2e01            	LD A, (_Ttmp160)
  3848  165b  fe00              	CP 0
  3849  165d  c26316            	JP NZ, _label192
  3850  1660  c36616            	JMP _label192b2
  3851                          _label192:
  3852  1663  c36916            	JMP _label189scroll
  3853                          _label192b2:
  3854  1666  c37916            	jp _label189end
  3855                          _label189scroll:
  3856  1669  cd2611            	CALL VSCROLLTUP
  3857  166c  3a6800            	LD A, (CURRENTTILESHEIGHT)
  3858  166f  325a00            	LD (YCURSYS), A
  3859  1672  3a5a00            	LD A, (YCURSYS)
  3860  1675  3d                	DEC A
  3861  1676  325a00            	LD (YCURSYS), A
  3862                          _label189end:
  3863                          	; P:36
  3864                          	; L:33
  3865  1679  0600              	LD B, 0
  3866  167b  3a1401            	LD A, (_y)
  3867  167e  47                	LD B, A
  3868  167f  3a3601            	LD A, (_TRtmp156)
  3869  1682  80                	ADD A, B
  3870  1683  321401            	LD (_y), A
  3871  1686  3a1401            	LD A, (_y)
  3872  1689  fe00              	CP $00
  3873  168b  ca9116            	JP Z, _label158bis
  3874  168e  c3a10d            	jp _label158bf
  3875                          _label158bis:
  3876                          	; P:11
  3877                          	; L:34
  3878                          	; P:0
  3879                          	; L:35
  3880                          	; P:0
  3881                          _label195:
  3882  1691  c39116            	jp _label195
  3883                          section data_user
  3884  0000  41                	EVERYSTATUS: defs 1
  3885                          section code_user
  3886                          section data_user
  3887  0001  4210              	BITMAPADDRESS: defs 2
  3888                          section code_user
  3889                          section data_user
  3890  0003  0000              	COLORMAPADDRESS: defs 2
  3891                          section code_user
  3892                          section data_user
  3893  0005  0000              	TEXTADDRESS: defs 2
  3894                          section code_user
  3895                          section data_user
  3896  0007  0000              	TILESADDRESS: defs 2
  3897                          section code_user
  3898                          section data_user
  3899  0009  00                	EMPTYTILE: db 0
  3900                          section code_user
  3901                          section data_user
  3902  000a  00                	USING: defs 1
  3903                          section code_user
  3904                          section data_user
  3905  000b  0000              	COPYOFBITMAPADDRESS: defs 2
  3906                          section code_user
  3907                          section data_user
  3908  000d  0000              	COPYOFCOLORMAPADDRESS: defs 2
  3909                          section code_user
  3910                          section data_user
  3911  000f  0000              	COPYOFTEXTADDRESS: defs 2
  3912                          section code_user
  3913                          section data_user
  3914  0011  3801              	COPYOFTILESADDRESS: defs 2
  3915                          section code_user
  3916                          section data_user
  3917  0013  00                	VDPDATAPORTREAD: defs 1
  3918                          section code_user
  3919                          section data_user
  3920  0014  00                	VDPDATAPORTWRITE: defs 1
  3921                          section code_user
  3922                          section data_user
  3923  0015  00                	VDPCONTROLPORTREAD: defs 1
  3924                          section code_user
  3925                          section data_user
  3926  0016  03                	VDPCONTROLPORTWRITE: defs 1
  3927                          section code_user
  3928                          section data_user
  3929  0017  000000            	ISRSVC2: defs 3
  3930                          section code_user
  3931                          section data_user
  3932  001a  00                	BANKSHADOW: defs 1
  3933                          section code_user
  3934                          section data_user
  3935  001b  c1fc000000800000  	FPSCRAP: defs 16
              0000000000000c00  
  3936                          section code_user
  3937                          section data_user
  3938  002b  00                	TICKSPERSECOND: defs 1
  3939                          section code_user
  3940                          section data_user
  3941  002c  80                	KBDCHAR: defs 1
  3942                          section code_user
  3943                          section data_user
  3944  002d  00                	KBDRATE: defs 1
  3945                          section code_user
  3946                          section data_user
  3947  002e  24                	KBDDELAY: defs 1
  3948                          section code_user
  3949                          section data_user
  3950  002f  00                	KBDRATEC: defs 1
  3951                          section code_user
  3952                          section data_user
  3953  0030  00                	KBDDELAYC: defs 1
  3954                          section code_user
  3955                          section data_user
  3956  0031  1800eda0eda0eda0  DUFFDEVICEL0: db 24,0,237,160,237,160,237,160,237,160,237,160,237,160,237,	160
              eda0eda0eda0eda0  
  3957  0041  eda0eda0eda0eda0  	db  237,160,237,160,237,160,237,160,237,160,237,160,237,160,237,	160
              eda0eda0eda0eda0  
  3958  0051  eda0ea0000c9      	db  237,160,234,0,0,	201
  3959                          section code_user
  3960                          section data_user
  3961  0057  9efc              	DUFFDEVICEL1: defs 2
  3962                          section code_user
  3963                          section data_user
  3964  0059  00                	XCURSYS: defs 1
  3965                          section code_user
  3966                          section data_user
  3967  005a  00                	YCURSYS: defs 1
  3968                          section code_user
  3969                          section data_user
  3970  005b  01                	_PEN: defs 1
  3971                          section code_user
  3972                          section data_user
  3973  005c  00                	_PAPER: defs 1
  3974                          section code_user
  3975                          section data_user
  3976                          ; peephole(3): unread
  3977                          ;	_windowE: defs 1
  3978                          section code_user
  3979                          section data_user
  3980                          ; peephole(3): unread
  3981                          ;	_windowS: defs 1
  3982                          section code_user
  3983                          section data_user
  3984                          ; peephole(3): unread
  3985                          ;	_windowW: defs 1
  3986                          section code_user
  3987                          section data_user
  3988  005d  00                	TEXTWW: defs 1
  3989                          section code_user
  3990                          	_TAB: EQU cstring0
  3991                          section data_user
  3992                          ; peephole(3): unread
  3993                          ;	_windowMX: defs 1
  3994                          section code_user
  3995                          section data_user
  3996                          ; peephole(3): unread
  3997                          ;	_windowMY: defs 1
  3998                          section code_user
  3999                          section data_user
  4000  005e  00                	PROTOTHREADCT: defs 1
  4001                          section code_user
  4002                          section data_user
  4003  005f  009efc00          	CPURANDOM_SEED: defs 4
  4004                          section code_user
  4005                          section data_user
  4006  0063  0000              	CURRENTWIDTH: defs 2
  4007                          section code_user
  4008                          section data_user
  4009  0065  0000              	CURRENTHEIGHT: defs 2
  4010                          section code_user
  4011                          section data_user
  4012                          ; peephole(3): unread
  4013                          ;	CURRENTTILES: defs 1
  4014                          section code_user
  4015                          section data_user
  4016  0067  4c                	CURRENTTILESWIDTH: defs 1
  4017                          section code_user
  4018                          section data_user
  4019                          ; peephole(3): unread
  4020                          ;	CURRENTTILESWIDTHX8: defs 2
  4021                          section code_user
  4022                          section data_user
  4023  0068  00                	CURRENTTILESHEIGHT: defs 1
  4024                          section code_user
  4025                          section data_user
  4026                          ; peephole(3): unread
  4027                          ;	FONTWIDTH: defs 1
  4028                          section code_user
  4029                          section data_user
  4030                          ; peephole(3): unread
  4031                          ;	FONTHEIGHT: defs 1
  4032                          section code_user
  4033                          section data_user
  4034  0069  00a0              	SPRITEADDRESS: defs 2
  4035                          section code_user
  4036                          section data_user
  4037  006b  fd00              	SPRITEAADDRESS: defs 2
  4038                          section code_user
  4039                          section data_user
  4040  006d  c300              	PATTERNADDRESS: defs 2
  4041                          section code_user
  4042                          section data_user
  4043  006f  9ffd000000650000  	PALETTE: defs 16
              7900007a02000000  
  4044                          section code_user
  4045                          section data_user
  4046                          ; peephole(3): unread
  4047                          ;	XGR: defs 2
  4048                          section code_user
  4049                          section data_user
  4050                          ; peephole(3): unread
  4051                          ;	YGR: defs 2
  4052                          section code_user
  4053                          section data_user
  4054  007f  0100              	LINE: defs 2
  4055                          section code_user
  4056                          section data_user
  4057                          ; peephole(3): unread
  4058                          ;	CLIPX1: defs 2
  4059                          section code_user
  4060                          section data_user
  4061                          ; peephole(3): unread
  4062                          ;	CLIPX2: defs 2
  4063                          section code_user
  4064                          section data_user
  4065                          ; peephole(3): unread
  4066                          ;	CLIPY1: defs 2
  4067                          section code_user
  4068                          section data_user
  4069                          ; peephole(3): unread
  4070                          ;	CLIPY2: defs 2
  4071                          section code_user
  4072                          section data_user
  4073  0081  f600              	ORIGINX: defs 2
  4074                          section code_user
  4075                          section data_user
  4076  0083  0000              	ORIGINY: defs 2
  4077                          section code_user
  4078                          section data_user
  4079  0085  0000              	RESOLUTIONX: defs 2
  4080                          section code_user
  4081                          section data_user
  4082  0087  00f6              	RESOLUTIONY: defs 2
  4083                          section code_user
  4084                          section data_user
  4085  0089  00                	TABCOUNT: defs 1
  4086                          section code_user
  4087                          section data_user
  4088  008a  00                	CLINEX: defs 1
  4089                          section code_user
  4090                          section data_user
  4091  008b  bf                	CLINEY: defs 1
  4092                          section code_user
  4093                          section data_user
  4094  008c  00                	TABSTODRAW: defs 1
  4095                          section code_user
  4096                          section data_user
  4097  008d  00                	CURRENTMODE: defs 1
  4098                          section code_user
  4099                          section data_user
  4100  008e  00                	CURRENTTILEMODE: defs 1
  4101                          section code_user
  4102                          section data_user
  4103  008f  00                	SPRITECOUNT: db 0
  4104                          section code_user
  4105                          section data_user
  4106  0090  9300000000001600  	SPRITEXY: defs 64
              0000000000000015  
              0000000000000000  
              1400000000000000  
              0014000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
  4107                          section code_user
  4108                          section data_user
  4109  00d0  00                	TILEX: defs 1
  4110                          section code_user
  4111                          section data_user
  4112  00d1  00                	TILEY: defs 1
  4113                          section code_user
  4114                          section data_user
  4115  00d2  00                	TILEX2: defs 1
  4116                          section code_user
  4117                          section data_user
  4118  00d3  00                	TILET: defs 1
  4119                          section code_user
  4120                          section data_user
  4121  00d4  00                	TILEW: defs 1
  4122                          section code_user
  4123                          section data_user
  4124  00d5  00                	TILEH: defs 1
  4125                          section code_user
  4126                          section data_user
  4127  00d6  00                	TILEW2: defs 1
  4128                          section code_user
  4129                          section data_user
  4130  00d7  00                	TILEH2: defs 1
  4131                          section code_user
  4132                          section data_user
  4133  00d8  00                	TILEA: defs 1
  4134                          section code_user
  4135                          section data_user
  4136  00d9  0000              	TILEO: defs 2
  4137                          section code_user
  4138                          section data_user
  4139  00db  00                	XSCROLLPOS: defs 1
  4140                          section code_user
  4141                          section data_user
  4142  00dc  00                	YSCROLLPOS: defs 1
  4143                          section code_user
  4144                          section data_user
  4145  00dd  00                	XSCROLL: defs 1
  4146                          section code_user
  4147                          section data_user
  4148  00de  00                	YSCROLL: defs 1
  4149                          section code_user
  4150                          section data_user
  4151  00df  00                	DIRECTION: defs 1
  4152                          section code_user
  4153                          section data_user
  4154  00e0  000000            	ONSCROLLUP: defs 3
  4155                          section code_user
  4156                          section data_user
  4157  00e3  000000            	ONSCROLLDOWN: defs 3
  4158                          section code_user
  4159                          section data_user
  4160  00e6  000000            	ONSCROLLLEFT: defs 3
  4161                          section code_user
  4162                          section data_user
  4163  00e9  000000            	ONSCROLLRIGHT: defs 3
  4164                          section code_user
  4165                          section data_user
  4166  00ec  00                	IMAGEF: defs 1
  4167                          section code_user
  4168                          section data_user
  4169  00ed  00                	IMAGET: defs 1
  4170                          section code_user
  4171                          section data_user
  4172  00ee  00                	IMAGEY: defs 1
  4173                          section code_user
  4174                          section data_user
  4175  00ef  0000              	BLITIMAGEBLITTINGADDR: defs 2
  4176                          section code_user
  4177                          section data_user
  4178  00f1  0000              	BLITTMPPTR: defs 2
  4179                          section code_user
  4180                          section data_user
  4181  00f3  0000              	BLITTMPPTR2: defs 2
  4182                          section code_user
  4183                          section data_user
  4184  00f5  00                	VBLFLAG: defs 1
  4185                          section code_user
  4186                          section data_user
  4187  00f6  00                	VDPINUSE: defs 1
  4188                          section code_user
  4189                          section data_user
  4190  00f7  0000              	SLICEX: defs 2
  4191                          section code_user
  4192                          section data_user
  4193  00f9  0000              	SLICEY: defs 2
  4194                          section code_user
  4195                          section data_user
  4196  00fb  0000              	SLICEDTARGET: defs 2
  4197                          section code_user
  4198                          section data_user
  4199  00fd  00                	AY8910MUSICREADY: defs 1
  4200                          section code_user
  4201                          section data_user
  4202  00fe  00                	AY8910BLOCKS: defs 1
  4203                          section code_user
  4204                          section data_user
  4205  00ff  00                	AY8910LASTBLOCK: defs 1
  4206                          section code_user
  4207                          section data_user
  4208  0100  0000              	AY8910TMPPTR2: defs 2
  4209                          section code_user
  4210                          section data_user
  4211  0102  0000              	AY8910TMPPTR: defs 2
  4212                          section code_user
  4213                          section data_user
  4214  0104  00                	AY8910TMPOFS: defs 1
  4215                          section code_user
  4216                          section data_user
  4217  0105  00                	AY8910TMPLEN: defs 1
  4218                          section code_user
  4219                          section data_user
  4220  0106  00                	AY8910JIFFIES: defs 1
  4221                          section code_user
  4222                          section data_user
  4223  0107  0013000000000000  	_a: defs 13
              0093000000        
  4224                          section code_user
  4225                          section data_user
  4226  0114  3f                	_y: defs 1
  4227                          section code_user
  4228                          section data_user
  4229  0115  00                	_x: defs 1
  4230                          section code_user
  4231                          section data_user
  4232  0116  40                	defs 1
  4233                          section code_user
  4234  1694  0102040810204080  BITMASK: defm $01,$02,$04,$08,$10,$20,$40,$80
  4235  169c  fefdfbf7efdfbf7f  BITMASKN: defm $fe,$fd,$fb,$f7,$ef,$df,$bf,$7f
  4236                          max_free_string = $0400
  4237                          section data_user
  4238  0117  00                	_Ttmp1: defs 1
  4239                          section code_user
  4240                          section data_user
  4241  0118  93                	_Ttmp2: defs 1
  4242                          section code_user
  4243                          section data_user
  4244  0119  00                	_Ttmp3: defs 1
  4245                          section code_user
  4246                          section data_user
  4247                          ; peephole(3): unread
  4248                          ;	_Ttmp6: defs 1
  4249                          section code_user
  4250                          section data_user
  4251  011a  0000              	_Ttmp11: defs 2
  4252                          section code_user
  4253                          section data_user
  4254  011c  9300              	_Ttmp12: defs 2
  4255                          section code_user
  4256                          section data_user
  4257  011e  0000              	_Ttmp13: defs 2
  4258                          section code_user
  4259                          section data_user
  4260                          ; peephole(3): unread
  4261                          ;	_Ttmp14: defs 1
  4262                          section code_user
  4263                          section data_user
  4264                          ; peephole(3): unread
  4265                          ;	_Ttmp15: defs 1
  4266                          section code_user
  4267                          section data_user
  4268  0120  3f00              	_Ttmp17: defs 2
  4269                          section code_user
  4270                          section data_user
  4271  0122  93                	_Ttmp18: defs 1
  4272                          section code_user
  4273                          section data_user
  4274                          ; peephole(3): unread
  4275                          ;	_Ttmp19: defs 1
  4276                          section code_user
  4277                          section data_user
  4278  0123  00007c00          	_Ttmp21: defs 4
  4279                          section code_user
  4280                          section data_user
  4281  0127  008f              	_Ttmp23: defs 2
  4282                          section code_user
  4283                          section data_user
  4284                          ; peephole(3): unread
  4285                          ;	_Ttmp24: defs 1
  4286                          section code_user
  4287                          section data_user
  4288  0129  00                	_Ttmp25: defs 1
  4289                          section code_user
  4290                          section data_user
  4291  012a  00                	_Ttmp26: defs 1
  4292                          section code_user
  4293                          section data_user
  4294  012b  8500              	_Ttmp27: defs 2
  4295                          section code_user
  4296                          section data_user
  4297  012d  00                	_Ttmp31: defs 1
  4298                          section code_user
  4299                          section data_user
  4300  012e  7c                	_Ttmp160: defs 1
  4301                          section code_user
  4302                          section data_user
  4303  012f  0000              	_Ttmp178: defs 2
  4304                          section code_user
  4305                          section data_user
  4306  0131  00                	_Ttmp179: db 0
  4307                          section code_user
  4308                          	_Tstr180: EQU cstring181
  4309                          section data_user
  4310  0132  0e01              	_Ttmp185: defs 2
  4311                          section code_user
  4312                          section data_user
  4313  0134  00                	_Ttmp186: defs 1
  4314                          section code_user
  4315                          section data_user
  4316                          	_Tbit5:
  4317  0135  00                	defs 1
  4318                          section code_user
  4319                          section data_user
  4320  0136  a5                	_TRtmp156: defs 1
  4321                          section code_user
  4322                          section data_user
  4323  0137  00                	_TRtmp157: defs 1
  4324                          section code_user
  4325                          section data_user
  4326  0138  00                	_TRtmp163: defs 1
  4327                          section code_user
  4328                          section data_user
  4329  0139  85                	_TRtmp164: defs 1
  4330                          section code_user
  4331                          section data_user
  4332  013a  00                	defs 1
  4333                          section code_user
  4334                          VARINIT:
  4335  16a4  3e00              	LD A, $00
  4336  16a6  320000            	LD (EVERYSTATUS), A
  4337                          ; peephole(1): r250 (LD A, x; LD (x), A; LD A, x)->(LD A, x; LD (x), A)
  4338                          ;	LD A, $00
  4339  16a9  320100            	LD (BITMAPADDRESS), A
  4340  16ac  3e00              	LD A, $00
  4341  16ae  320200            	LD (BITMAPADDRESS+1), A
  4342                          ; peephole(1): r250 (LD A, x; LD (x), A; LD A, x)->(LD A, x; LD (x), A)
  4343                          ;	LD A, $00
  4344  16b1  320300            	LD (COLORMAPADDRESS), A
  4345  16b4  3e00              	LD A, $00
  4346  16b6  320400            	LD (COLORMAPADDRESS+1), A
  4347                          ; peephole(1): r250 (LD A, x; LD (x), A; LD A, x)->(LD A, x; LD (x), A)
  4348                          ;	LD A, $00
  4349  16b9  320500            	LD (TEXTADDRESS), A
  4350  16bc  3e00              	LD A, $00
  4351  16be  320600            	LD (TEXTADDRESS+1), A
  4352                          ; peephole(1): r250 (LD A, x; LD (x), A; LD A, x)->(LD A, x; LD (x), A)
  4353                          ;	LD A, $00
  4354  16c1  320700            	LD (TILESADDRESS), A
  4355  16c4  3e00              	LD A, $00
  4356  16c6  320800            	LD (TILESADDRESS+1), A
  4357  16c9  3e20              	LD A, $20
  4358  16cb  320900            	LD (EMPTYTILE), A
  4359  16ce  3e00              	LD A, $00
  4360  16d0  320a00            	LD (USING), A
  4361                          ; peephole(1): r250 (LD A, x; LD (x), A; LD A, x)->(LD A, x; LD (x), A)
  4362                          ;	LD A, $00
  4363  16d3  320b00            	LD (COPYOFBITMAPADDRESS), A
  4364  16d6  3e00              	LD A, $00
  4365  16d8  320c00            	LD (COPYOFBITMAPADDRESS+1), A
  4366                          ; peephole(1): r250 (LD A, x; LD (x), A; LD A, x)->(LD A, x; LD (x), A)
  4367                          ;	LD A, $00
  4368  16db  320d00            	LD (COPYOFCOLORMAPADDRESS), A
  4369  16de  3e00              	LD A, $00
  4370  16e0  320e00            	LD (COPYOFCOLORMAPADDRESS+1), A
  4371                          ; peephole(1): r250 (LD A, x; LD (x), A; LD A, x)->(LD A, x; LD (x), A)
  4372                          ;	LD A, $00
  4373  16e3  320f00            	LD (COPYOFTEXTADDRESS), A
  4374  16e6  3e00              	LD A, $00
  4375  16e8  321000            	LD (COPYOFTEXTADDRESS+1), A
  4376                          ; peephole(1): r250 (LD A, x; LD (x), A; LD A, x)->(LD A, x; LD (x), A)
  4377                          ;	LD A, $00
  4378  16eb  321100            	LD (COPYOFTILESADDRESS), A
  4379  16ee  3e00              	LD A, $00
  4380  16f0  321200            	LD (COPYOFTILESADDRESS+1), A
  4381  16f3  3e98              	LD A, $98
  4382  16f5  321300            	LD (VDPDATAPORTREAD), A
  4383                          ; peephole(1): r250 (LD A, x; LD (x), A; LD A, x)->(LD A, x; LD (x), A)
  4384                          ;	LD A, $98
  4385  16f8  321400            	LD (VDPDATAPORTWRITE), A
  4386  16fb  3e99              	LD A, $99
  4387  16fd  321500            	LD (VDPCONTROLPORTREAD), A
  4388                          ; peephole(1): r250 (LD A, x; LD (x), A; LD A, x)->(LD A, x; LD (x), A)
  4389                          ;	LD A, $99
  4390  1700  321600            	LD (VDPCONTROLPORTWRITE), A
  4391  1703  3e00              	LD A, $00
  4392  1705  321a00            	LD (BANKSHADOW), A
  4393                          ; peephole(1): r250 (LD A, x; LD (x), A; LD A, x)->(LD A, x; LD (x), A)
  4394                          ;	LD A, $00
  4395  1708  322b00            	LD (TICKSPERSECOND), A
  4396  170b  3e00              	LD A, $00
  4397  170d  322c00            	LD (KBDCHAR), A
  4398  1710  3e10              	LD A, $10
  4399  1712  322d00            	LD (KBDRATE), A
  4400  1715  3e40              	LD A, $40
  4401  1717  322e00            	LD (KBDDELAY), A
  4402  171a  3e10              	LD A, $10
  4403  171c  322f00            	LD (KBDRATEC), A
  4404  171f  3e40              	LD A, $40
  4405  1721  323000            	LD (KBDDELAYC), A
  4406  1724  3e00              	LD A, $00
  4407  1726  325700            	LD (DUFFDEVICEL1), A
  4408                          ; peephole(1): r250 (LD A, x; LD (x), A; LD A, x)->(LD A, x; LD (x), A)
  4409                          ;	LD A, $00
  4410  1729  325800            	LD (DUFFDEVICEL1+1), A
  4411  172c  3e00              	LD A, $00
  4412  172e  325900            	LD (XCURSYS), A
  4413                          ; peephole(1): r250 (LD A, x; LD (x), A; LD A, x)->(LD A, x; LD (x), A)
  4414                          ;	LD A, $00
  4415  1731  325a00            	LD (YCURSYS), A
  4416  1734  3e0f              	LD A, $0f
  4417  1736  325b00            	LD (_PEN), A
  4418  1739  3e01              	LD A, $01
  4419  173b  325c00            	LD (_PAPER), A
  4420  173e  3e00              	LD A, $00
  4421                          ; peephole(3): unread
  4422                          ;	LD (_windowE), A
  4423                          ; peephole(1): r250 (LD A, x; LD (x), A; LD A, x)->(LD A, x; LD (x), A)
  4424                          ;	LD A, $00
  4425                          ; peephole(3): unread
  4426                          ;	LD (_windowS), A
  4427  1740  3e00              	LD A, $00
  4428                          ; peephole(3): unread
  4429                          ;	LD (_windowW), A
  4430  1742  3e03              	LD A, $03
  4431  1744  325d00            	LD (TEXTWW), A
  4432  1747  3e00              	LD A, $00
  4433                          ; peephole(3): unread
  4434                          ;	LD (_windowMX), A
  4435                          ; peephole(1): r250 (LD A, x; LD (x), A; LD A, x)->(LD A, x; LD (x), A)
  4436                          ;	LD A, $00
  4437                          ; peephole(3): unread
  4438                          ;	LD (_windowMY), A
  4439  1749  3e00              	LD A, $00
  4440  174b  325e00            	LD (PROTOTHREADCT), A
  4441  174e  3eff              	LD A, $ff
  4442  1750  325f00            	LD (CPURANDOM_SEED), A
  4443                          ; peephole(1): r250 (LD A, x; LD (x), A; LD A, x)->(LD A, x; LD (x), A)
  4444                          ;	LD A, $ff
  4445  1753  326000            	LD (CPURANDOM_SEED+1), A
  4446  1756  3eff              	LD A, $ff
  4447  1758  326100            	LD (CPURANDOM_SEED+2), A
  4448                          ; peephole(1): r250 (LD A, x; LD (x), A; LD A, x)->(LD A, x; LD (x), A)
  4449                          ;	LD A, $ff
  4450  175b  326200            	LD (CPURANDOM_SEED+3), A
  4451  175e  3e00              	LD A, $00
  4452  1760  326300            	LD (CURRENTWIDTH), A
  4453  1763  3e01              	LD A, $01
  4454  1765  326400            	LD (CURRENTWIDTH+1), A
  4455  1768  3ec0              	LD A, $c0
  4456  176a  326500            	LD (CURRENTHEIGHT), A
  4457  176d  3e00              	LD A, $00
  4458  176f  326600            	LD (CURRENTHEIGHT+1), A
  4459  1772  3eff              	LD A, $ff
  4460                          ; peephole(3): unread
  4461                          ;	LD (CURRENTTILES), A
  4462  1774  3e28              	LD A, $28
  4463  1776  326700            	LD (CURRENTTILESWIDTH), A
  4464  1779  3e40              	LD A, $40
  4465                          ; peephole(3): unread
  4466                          ;	LD (CURRENTTILESWIDTHX8), A
  4467  177b  3e01              	LD A, $01
  4468                          ; peephole(3): unread
  4469                          ;	LD (CURRENTTILESWIDTHX8+1), A
  4470  177d  3e18              	LD A, $18
  4471  177f  326800            	LD (CURRENTTILESHEIGHT), A
  4472  1782  3e08              	LD A, $08
  4473                          ; peephole(3): unread
  4474                          ;	LD (FONTWIDTH), A
  4475                          ; peephole(1): r250 (LD A, x; LD (x), A; LD A, x)->(LD A, x; LD (x), A)
  4476                          ;	LD A, $08
  4477                          ; peephole(3): unread
  4478                          ;	LD (FONTHEIGHT), A
  4479  1784  3e00              	LD A, $00
  4480  1786  326900            	LD (SPRITEADDRESS), A
  4481                          ; peephole(1): r250 (LD A, x; LD (x), A; LD A, x)->(LD A, x; LD (x), A)
  4482                          ;	LD A, $00
  4483  1789  326a00            	LD (SPRITEADDRESS+1), A
  4484  178c  3e00              	LD A, $00
  4485  178e  326b00            	LD (SPRITEAADDRESS), A
  4486  1791  3e10              	LD A, $10
  4487  1793  326c00            	LD (SPRITEAADDRESS+1), A
  4488  1796  3e00              	LD A, $00
  4489  1798  326d00            	LD (PATTERNADDRESS), A
  4490                          ; peephole(1): r250 (LD A, x; LD (x), A; LD A, x)->(LD A, x; LD (x), A)
  4491                          ;	LD A, $00
  4492  179b  326e00            	LD (PATTERNADDRESS+1), A
  4493  179e  3e00              	LD A, $00
  4494                          ; peephole(3): unread
  4495                          ;	LD (XGR), A
  4496                          ; peephole(1): r250 (LD A, x; LD (x), A; LD A, x)->(LD A, x; LD (x), A)
  4497                          ;	LD A, $00
  4498                          ; peephole(3): unread
  4499                          ;	LD (XGR+1), A
  4500  17a0  3e00              	LD A, $00
  4501                          ; peephole(3): unread
  4502                          ;	LD (YGR), A
  4503                          ; peephole(1): r250 (LD A, x; LD (x), A; LD A, x)->(LD A, x; LD (x), A)
  4504                          ;	LD A, $00
  4505                          ; peephole(3): unread
  4506                          ;	LD (YGR+1), A
  4507  17a2  3eff              	LD A, $ff
  4508  17a4  327f00            	LD (LINE), A
  4509                          ; peephole(1): r250 (LD A, x; LD (x), A; LD A, x)->(LD A, x; LD (x), A)
  4510                          ;	LD A, $ff
  4511  17a7  328000            	LD (LINE+1), A
  4512  17aa  3e00              	LD A, $00
  4513                          ; peephole(3): unread
  4514                          ;	LD (CLIPX1), A
  4515                          ; peephole(1): r250 (LD A, x; LD (x), A; LD A, x)->(LD A, x; LD (x), A)
  4516                          ;	LD A, $00
  4517                          ; peephole(3): unread
  4518                          ;	LD (CLIPX1+1), A
  4519  17ac  3eff              	LD A, $ff
  4520                          ; peephole(3): unread
  4521                          ;	LD (CLIPX2), A
  4522                          ; peephole(4): r407 (LD A, *; LD A, *)->(LD, A)
  4523                          ;	LD A, $00
  4524                          ; peephole(3): unread
  4525                          ;	LD (CLIPX2+1), A
  4526                          ; peephole(1): r250 (LD A, x; LD (x), A; LD A, x)->(LD A, x; LD (x), A)
  4527                          ;	LD A, $00
  4528                          ; peephole(3): unread
  4529                          ;	LD (CLIPY1), A
  4530                          ; peephole(5): r407 (LD A, *; LD A, *)->(LD, A)
  4531                          ;	LD A, $00
  4532                          ; peephole(3): unread
  4533                          ;	LD (CLIPY1+1), A
  4534  17ae  3ebf              	LD A, $bf
  4535                          ; peephole(3): unread
  4536                          ;	LD (CLIPY2), A
  4537                          ; peephole(4): r407 (LD A, *; LD A, *)->(LD, A)
  4538                          ;	LD A, $00
  4539                          ; peephole(3): unread
  4540                          ;	LD (CLIPY2+1), A
  4541                          ; peephole(1): r250 (LD A, x; LD (x), A; LD A, x)->(LD A, x; LD (x), A)
  4542                          ;	LD A, $00
  4543  17b0  328100            	LD (ORIGINX), A
  4544  17b3  3e00              	LD A, $00
  4545  17b5  328200            	LD (ORIGINX+1), A
  4546                          ; peephole(1): r250 (LD A, x; LD (x), A; LD A, x)->(LD A, x; LD (x), A)
  4547                          ;	LD A, $00
  4548  17b8  328300            	LD (ORIGINY), A
  4549  17bb  3e00              	LD A, $00
  4550  17bd  328400            	LD (ORIGINY+1), A
  4551                          ; peephole(1): r250 (LD A, x; LD (x), A; LD A, x)->(LD A, x; LD (x), A)
  4552                          ;	LD A, $00
  4553  17c0  328500            	LD (RESOLUTIONX), A
  4554  17c3  3e00              	LD A, $00
  4555  17c5  328600            	LD (RESOLUTIONX+1), A
  4556                          ; peephole(1): r250 (LD A, x; LD (x), A; LD A, x)->(LD A, x; LD (x), A)
  4557                          ;	LD A, $00
  4558  17c8  328700            	LD (RESOLUTIONY), A
  4559  17cb  3e00              	LD A, $00
  4560  17cd  328800            	LD (RESOLUTIONY+1), A
  4561  17d0  3e04              	LD A, $04
  4562  17d2  328900            	LD (TABCOUNT), A
  4563  17d5  3e00              	LD A, $00
  4564  17d7  328a00            	LD (CLINEX), A
  4565                          ; peephole(1): r250 (LD A, x; LD (x), A; LD A, x)->(LD A, x; LD (x), A)
  4566                          ;	LD A, $00
  4567  17da  328b00            	LD (CLINEY), A
  4568  17dd  3e00              	LD A, $00
  4569  17df  328c00            	LD (TABSTODRAW), A
  4570                          ; peephole(1): r250 (LD A, x; LD (x), A; LD A, x)->(LD A, x; LD (x), A)
  4571                          ;	LD A, $00
  4572  17e2  328d00            	LD (CURRENTMODE), A
  4573  17e5  3e01              	LD A, $01
  4574  17e7  328e00            	LD (CURRENTTILEMODE), A
  4575  17ea  3e00              	LD A, $00
  4576  17ec  32d000            	LD (TILEX), A
  4577                          ; peephole(1): r250 (LD A, x; LD (x), A; LD A, x)->(LD A, x; LD (x), A)
  4578                          ;	LD A, $00
  4579  17ef  32d100            	LD (TILEY), A
  4580  17f2  3e00              	LD A, $00
  4581  17f4  32d200            	LD (TILEX2), A
  4582                          ; peephole(1): r250 (LD A, x; LD (x), A; LD A, x)->(LD A, x; LD (x), A)
  4583                          ;	LD A, $00
  4584  17f7  32d300            	LD (TILET), A
  4585  17fa  3e00              	LD A, $00
  4586  17fc  32d400            	LD (TILEW), A
  4587                          ; peephole(1): r250 (LD A, x; LD (x), A; LD A, x)->(LD A, x; LD (x), A)
  4588                          ;	LD A, $00
  4589  17ff  32d500            	LD (TILEH), A
  4590  1802  3e00              	LD A, $00
  4591  1804  32d600            	LD (TILEW2), A
  4592                          ; peephole(1): r250 (LD A, x; LD (x), A; LD A, x)->(LD A, x; LD (x), A)
  4593                          ;	LD A, $00
  4594  1807  32d700            	LD (TILEH2), A
  4595  180a  3e00              	LD A, $00
  4596  180c  32d800            	LD (TILEA), A
  4597                          ; peephole(1): r250 (LD A, x; LD (x), A; LD A, x)->(LD A, x; LD (x), A)
  4598                          ;	LD A, $00
  4599  180f  32d900            	LD (TILEO), A
  4600  1812  3e00              	LD A, $00
  4601  1814  32da00            	LD (TILEO+1), A
  4602                          ; peephole(1): r250 (LD A, x; LD (x), A; LD A, x)->(LD A, x; LD (x), A)
  4603                          ;	LD A, $00
  4604  1817  32db00            	LD (XSCROLLPOS), A
  4605  181a  3e00              	LD A, $00
  4606  181c  32dc00            	LD (YSCROLLPOS), A
  4607                          ; peephole(1): r250 (LD A, x; LD (x), A; LD A, x)->(LD A, x; LD (x), A)
  4608                          ;	LD A, $00
  4609  181f  32dd00            	LD (XSCROLL), A
  4610  1822  3e00              	LD A, $00
  4611  1824  32de00            	LD (YSCROLL), A
  4612                          ; peephole(1): r250 (LD A, x; LD (x), A; LD A, x)->(LD A, x; LD (x), A)
  4613                          ;	LD A, $00
  4614  1827  32df00            	LD (DIRECTION), A
  4615  182a  3e00              	LD A, $00
  4616  182c  32ec00            	LD (IMAGEF), A
  4617                          ; peephole(1): r250 (LD A, x; LD (x), A; LD A, x)->(LD A, x; LD (x), A)
  4618                          ;	LD A, $00
  4619  182f  32ed00            	LD (IMAGET), A
  4620  1832  3e00              	LD A, $00
  4621  1834  32ee00            	LD (IMAGEY), A
  4622                          ; peephole(1): r250 (LD A, x; LD (x), A; LD A, x)->(LD A, x; LD (x), A)
  4623                          ;	LD A, $00
  4624  1837  32ef00            	LD (BLITIMAGEBLITTINGADDR), A
  4625  183a  3e00              	LD A, $00
  4626  183c  32f000            	LD (BLITIMAGEBLITTINGADDR+1), A
  4627                          ; peephole(1): r250 (LD A, x; LD (x), A; LD A, x)->(LD A, x; LD (x), A)
  4628                          ;	LD A, $00
  4629  183f  32f100            	LD (BLITTMPPTR), A
  4630  1842  3e00              	LD A, $00
  4631  1844  32f200            	LD (BLITTMPPTR+1), A
  4632                          ; peephole(1): r250 (LD A, x; LD (x), A; LD A, x)->(LD A, x; LD (x), A)
  4633                          ;	LD A, $00
  4634  1847  32f300            	LD (BLITTMPPTR2), A
  4635  184a  3e00              	LD A, $00
  4636  184c  32f400            	LD (BLITTMPPTR2+1), A
  4637                          ; peephole(1): r250 (LD A, x; LD (x), A; LD A, x)->(LD A, x; LD (x), A)
  4638                          ;	LD A, $00
  4639  184f  32f500            	LD (VBLFLAG), A
  4640  1852  3e00              	LD A, $00
  4641  1854  32f600            	LD (VDPINUSE), A
  4642                          ; peephole(1): r250 (LD A, x; LD (x), A; LD A, x)->(LD A, x; LD (x), A)
  4643                          ;	LD A, $00
  4644  1857  32f700            	LD (SLICEX), A
  4645  185a  3e00              	LD A, $00
  4646  185c  32f800            	LD (SLICEX+1), A
  4647                          ; peephole(1): r250 (LD A, x; LD (x), A; LD A, x)->(LD A, x; LD (x), A)
  4648                          ;	LD A, $00
  4649  185f  32f900            	LD (SLICEY), A
  4650  1862  3e00              	LD A, $00
  4651  1864  32fa00            	LD (SLICEY+1), A
  4652                          ; peephole(1): r250 (LD A, x; LD (x), A; LD A, x)->(LD A, x; LD (x), A)
  4653                          ;	LD A, $00
  4654  1867  32fb00            	LD (SLICEDTARGET), A
  4655  186a  3e00              	LD A, $00
  4656  186c  32fc00            	LD (SLICEDTARGET+1), A
  4657                          ; peephole(1): r250 (LD A, x; LD (x), A; LD A, x)->(LD A, x; LD (x), A)
  4658                          ;	LD A, $00
  4659  186f  32fd00            	LD (AY8910MUSICREADY), A
  4660  1872  3e00              	LD A, $00
  4661  1874  32fe00            	LD (AY8910BLOCKS), A
  4662                          ; peephole(1): r250 (LD A, x; LD (x), A; LD A, x)->(LD A, x; LD (x), A)
  4663                          ;	LD A, $00
  4664  1877  32ff00            	LD (AY8910LASTBLOCK), A
  4665  187a  3e00              	LD A, $00
  4666  187c  320001            	LD (AY8910TMPPTR2), A
  4667                          ; peephole(1): r250 (LD A, x; LD (x), A; LD A, x)->(LD A, x; LD (x), A)
  4668                          ;	LD A, $00
  4669  187f  320101            	LD (AY8910TMPPTR2+1), A
  4670  1882  3e00              	LD A, $00
  4671  1884  320201            	LD (AY8910TMPPTR), A
  4672                          ; peephole(1): r250 (LD A, x; LD (x), A; LD A, x)->(LD A, x; LD (x), A)
  4673                          ;	LD A, $00
  4674  1887  320301            	LD (AY8910TMPPTR+1), A
  4675  188a  3e00              	LD A, $00
  4676  188c  320401            	LD (AY8910TMPOFS), A
  4677                          ; peephole(1): r250 (LD A, x; LD (x), A; LD A, x)->(LD A, x; LD (x), A)
  4678                          ;	LD A, $00
  4679  188f  320501            	LD (AY8910TMPLEN), A
  4680  1892  3e00              	LD A, $00
  4681  1894  320601            	LD (AY8910JIFFIES), A
  4682                          ; peephole(1): r250 (LD A, x; LD (x), A; LD A, x)->(LD A, x; LD (x), A)
  4683                          ;	LD A, $00
  4684  1897  321401            	LD (_y), A
  4685  189a  3e00              	LD A, $00
  4686  189c  321501            	LD (_x), A
  4687  189f  c9                	RET
  4688  18a0  0120              	cstring181: db 1, " "
  4689  18a2  0109              	cstring0: db 1, $09
  4690                          UDCCHAR:
  4691                          	; $00
  4692  18a4  3c666e6e60623c00  DEFB $3c,$66,$6e,$6e,$60,$62,$3c,	$00
  4693                          	; $01
  4694  18ac  00003c063e663e00  DEFB $00,$00,$3c,$06,$3e,$66,$3e,	$00
  4695                          	; $02
  4696  18b4  0060607c66667c00  DEFB $00,$60,$60,$7c,$66,$66,$7c,	$00
  4697                          	; $03
  4698  18bc  00003c6060603c00  DEFB $00,$00,$3c,$60,$60,$60,$3c,	$00
  4699                          	; $04
  4700  18c4  0006063e66663e00  DEFB $00,$06,$06,$3e,$66,$66,$3e,	$00
  4701                          	; $05
  4702  18cc  00003c667e603c00  DEFB $00,$00,$3c,$66,$7e,$60,$3c,	$00
  4703                          	; $06
  4704  18d4  000e183e18181800  DEFB $00,$0e,$18,$3e,$18,$18,$18,	$00
  4705                          	; $07
  4706  18dc  00003e66663e067c  DEFB $00,$00,$3e,$66,$66,$3e,$06,	$7c
  4707                          	; $08
  4708  18e4  0060607c66666600  DEFB $00,$60,$60,$7c,$66,$66,$66,	$00
  4709                          	; $09
  4710  18ec  0018003818183c00  DEFB $00,$18,$00,$38,$18,$18,$3c,	$00
  4711                          	; $0a
  4712  18f4  000600060606063c  DEFB $00,$06,$00,$06,$06,$06,$06,	$3c
  4713                          	; $0b
  4714  18fc  0060606c786c6600  DEFB $00,$60,$60,$6c,$78,$6c,$66,	$00
  4715                          	; $0c
  4716  1904  0038181818183c00  DEFB $00,$38,$18,$18,$18,$18,$3c,	$00
  4717                          	; $0d
  4718  190c  0000667f7f6b6300  DEFB $00,$00,$66,$7f,$7f,$6b,$63,	$00
  4719                          	; $0e
  4720  1914  00007c6666666600  DEFB $00,$00,$7c,$66,$66,$66,$66,	$00
  4721                          	; $0f
  4722  191c  00003c6666663c00  DEFB $00,$00,$3c,$66,$66,$66,$3c,	$00
  4723                          	; $10
  4724  1924  00007c66667c6060  DEFB $00,$00,$7c,$66,$66,$7c,$60,	$60
  4725                          	; $11
  4726  192c  00003e66663e0606  DEFB $00,$00,$3e,$66,$66,$3e,$06,	$06
  4727                          	; $12
  4728  1934  00007c6660606000  DEFB $00,$00,$7c,$66,$60,$60,$60,	$00
  4729                          	; $13
  4730  193c  00003e603c067c00  DEFB $00,$00,$3e,$60,$3c,$06,$7c,	$00
  4731                          	; $14
  4732  1944  00187e1818180e00  DEFB $00,$18,$7e,$18,$18,$18,$0e,	$00
  4733                          	; $15
  4734  194c  0000666666663e00  DEFB $00,$00,$66,$66,$66,$66,$3e,	$00
  4735                          	; $16
  4736  1954  00006666663c1800  DEFB $00,$00,$66,$66,$66,$3c,$18,	$00
  4737                          	; $17
  4738  195c  0000636b7f3e3600  DEFB $00,$00,$63,$6b,$7f,$3e,$36,	$00
  4739                          	; $18
  4740  1964  0000663c183c6600  DEFB $00,$00,$66,$3c,$18,$3c,$66,	$00
  4741                          	; $19
  4742  196c  00006666663e0c78  DEFB $00,$00,$66,$66,$66,$3e,$0c,	$78
  4743                          	; $1a
  4744  1974  00007e0c18307e00  DEFB $00,$00,$7e,$0c,$18,$30,$7e,	$00
  4745                          	; $1b
  4746  197c  3c30303030303c00  DEFB $3c,$30,$30,$30,$30,$30,$3c,	$00
  4747                          	; $1c
  4748  1984  0c12307c3062fc00  DEFB $0c,$12,$30,$7c,$30,$62,$fc,	$00
  4749                          	; $1d
  4750  198c  3c0c0c0c0c0c3c00  DEFB $3c,$0c,$0c,$0c,$0c,$0c,$3c,	$00
  4751                          	; $1e
  4752  1994  00183c7e18181818  DEFB $00,$18,$3c,$7e,$18,$18,$18,	$18
  4753                          	; $1f
  4754  199c  0010307f7f301000  DEFB $00,$10,$30,$7f,$7f,$30,$10,	$00
  4755                          	; $20
  4756  19a4  0000000000000000  DEFB $00,$00,$00,$00,$00,$00,$00,	$00
  4757                          	; $21
  4758  19ac  1818181800001800  DEFB $18,$18,$18,$18,$00,$00,$18,	$00
  4759                          	; $22
  4760  19b4  6666660000000000  DEFB $66,$66,$66,$00,$00,$00,$00,	$00
  4761                          	; $23
  4762  19bc  6666ff66ff666600  DEFB $66,$66,$ff,$66,$ff,$66,$66,	$00
  4763                          	; $24
  4764  19c4  183e603c067c1800  DEFB $18,$3e,$60,$3c,$06,$7c,$18,	$00
  4765                          	; $25
  4766  19cc  62660c1830664600  DEFB $62,$66,$0c,$18,$30,$66,$46,	$00
  4767                          	; $26
  4768  19d4  3c663c3867663f00  DEFB $3c,$66,$3c,$38,$67,$66,$3f,	$00
  4769                          	; $27
  4770  19dc  060c180000000000  DEFB $06,$0c,$18,$00,$00,$00,$00,	$00
  4771                          	; $28
  4772  19e4  0c18303030180c00  DEFB $0c,$18,$30,$30,$30,$18,$0c,	$00
  4773                          	; $29
  4774  19ec  30180c0c0c183000  DEFB $30,$18,$0c,$0c,$0c,$18,$30,	$00
  4775                          	; $2a
  4776  19f4  00663cff3c660000  DEFB $00,$66,$3c,$ff,$3c,$66,$00,	$00
  4777                          	; $2b
  4778  19fc  0018187e18180000  DEFB $00,$18,$18,$7e,$18,$18,$00,	$00
  4779                          	; $2c
  4780  1a04  0000000000181830  DEFB $00,$00,$00,$00,$00,$18,$18,	$30
  4781                          	; $2d
  4782  1a0c  0000007e00000000  DEFB $00,$00,$00,$7e,$00,$00,$00,	$00
  4783                          	; $2e
  4784  1a14  0000000000181800  DEFB $00,$00,$00,$00,$00,$18,$18,	$00
  4785                          	; $2f
  4786  1a1c  0003060c18306000  DEFB $00,$03,$06,$0c,$18,$30,$60,	$00
  4787                          	; $30
  4788  1a24  3c666e7666663c00  DEFB $3c,$66,$6e,$76,$66,$66,$3c,	$00
  4789                          	; $31
  4790  1a2c  1818381818187e00  DEFB $18,$18,$38,$18,$18,$18,$7e,	$00
  4791                          	; $32
  4792  1a34  3c66060c30607e00  DEFB $3c,$66,$06,$0c,$30,$60,$7e,	$00
  4793                          	; $33
  4794  1a3c  3c66061c06663c00  DEFB $3c,$66,$06,$1c,$06,$66,$3c,	$00
  4795                          	; $34
  4796  1a44  060e1e667f060600  DEFB $06,$0e,$1e,$66,$7f,$06,$06,	$00
  4797                          	; $35
  4798  1a4c  7e607c0606663c00  DEFB $7e,$60,$7c,$06,$06,$66,$3c,	$00
  4799                          	; $36
  4800  1a54  3c66607c66663c00  DEFB $3c,$66,$60,$7c,$66,$66,$3c,	$00
  4801                          	; $37
  4802  1a5c  7e660c1818181800  DEFB $7e,$66,$0c,$18,$18,$18,$18,	$00
  4803                          	; $38
  4804  1a64  3c66663c66663c00  DEFB $3c,$66,$66,$3c,$66,$66,$3c,	$00
  4805                          	; $39
  4806  1a6c  3c66663e06663c00  DEFB $3c,$66,$66,$3e,$06,$66,$3c,	$00
  4807                          	; $3a
  4808  1a74  0000180000180000  DEFB $00,$00,$18,$00,$00,$18,$00,	$00
  4809                          	; $3b
  4810  1a7c  0000180000181830  DEFB $00,$00,$18,$00,$00,$18,$18,	$30
  4811                          	; $3c
  4812  1a84  0e18306030180e00  DEFB $0e,$18,$30,$60,$30,$18,$0e,	$00
  4813                          	; $3d
  4814  1a8c  00007e007e000000  DEFB $00,$00,$7e,$00,$7e,$00,$00,	$00
  4815                          	; $3e
  4816  1a94  70180c060c187000  DEFB $70,$18,$0c,$06,$0c,$18,$70,	$00
  4817                          	; $3f
  4818  1a9c  3c66060c18001800  DEFB $3c,$66,$06,$0c,$18,$00,$18,	$00
  4819                          	; $40
  4820  1aa4  000000ffff000000  DEFB $00,$00,$00,$ff,$ff,$00,$00,	$00
  4821                          	; $41
  4822  1aac  183c667e66666600  DEFB $18,$3c,$66,$7e,$66,$66,$66,	$00
  4823                          	; $42
  4824  1ab4  7c66667c66667c00  DEFB $7c,$66,$66,$7c,$66,$66,$7c,	$00
  4825                          	; $43
  4826  1abc  3c66606060663c00  DEFB $3c,$66,$60,$60,$60,$66,$3c,	$00
  4827                          	; $44
  4828  1ac4  786c6666666c7800  DEFB $78,$6c,$66,$66,$66,$6c,$78,	$00
  4829                          	; $45
  4830  1acc  7e60607860607e00  DEFB $7e,$60,$60,$78,$60,$60,$7e,	$00
  4831                          	; $46
  4832  1ad4  7e60607860606000  DEFB $7e,$60,$60,$78,$60,$60,$60,	$00
  4833                          	; $47
  4834  1adc  3c66606e66663c00  DEFB $3c,$66,$60,$6e,$66,$66,$3c,	$00
  4835                          	; $48
  4836  1ae4  6666667e66666600  DEFB $66,$66,$66,$7e,$66,$66,$66,	$00
  4837                          	; $49
  4838  1aec  3c18181818183c00  DEFB $3c,$18,$18,$18,$18,$18,$3c,	$00
  4839                          	; $4a
  4840  1af4  1e0c0c0c0c6c3800  DEFB $1e,$0c,$0c,$0c,$0c,$6c,$38,	$00
  4841                          	; $4b
  4842  1afc  666c7870786c6600  DEFB $66,$6c,$78,$70,$78,$6c,$66,	$00
  4843                          	; $4c
  4844  1b04  6060606060607e00  DEFB $60,$60,$60,$60,$60,$60,$7e,	$00
  4845                          	; $4d
  4846  1b0c  63777f6b63636300  DEFB $63,$77,$7f,$6b,$63,$63,$63,	$00
  4847                          	; $4e
  4848  1b14  66767e7e6e666600  DEFB $66,$76,$7e,$7e,$6e,$66,$66,	$00
  4849                          	; $4f
  4850  1b1c  3c66666666663c00  DEFB $3c,$66,$66,$66,$66,$66,$3c,	$00
  4851                          	; $50
  4852  1b24  7c66667c60606000  DEFB $7c,$66,$66,$7c,$60,$60,$60,	$00
  4853                          	; $51
  4854  1b2c  3c666666663c0e00  DEFB $3c,$66,$66,$66,$66,$3c,$0e,	$00
  4855                          	; $52
  4856  1b34  7c66667c786c6600  DEFB $7c,$66,$66,$7c,$78,$6c,$66,	$00
  4857                          	; $53
  4858  1b3c  3c66603c06663c00  DEFB $3c,$66,$60,$3c,$06,$66,$3c,	$00
  4859                          	; $54
  4860  1b44  7e18181818181800  DEFB $7e,$18,$18,$18,$18,$18,$18,	$00
  4861                          	; $55
  4862  1b4c  6666666666663c00  DEFB $66,$66,$66,$66,$66,$66,$3c,	$00
  4863                          	; $56
  4864  1b54  66666666663c1800  DEFB $66,$66,$66,$66,$66,$3c,$18,	$00
  4865                          	; $57
  4866  1b5c  6363636b7f776300  DEFB $63,$63,$63,$6b,$7f,$77,$63,	$00
  4867                          	; $58
  4868  1b64  66663c183c666600  DEFB $66,$66,$3c,$18,$3c,$66,$66,	$00
  4869                          	; $59
  4870  1b6c  6666663c18181800  DEFB $66,$66,$66,$3c,$18,$18,$18,	$00
  4871                          	; $5a
  4872  1b74  7e060c1830607e00  DEFB $7e,$06,$0c,$18,$30,$60,$7e,	$00
  4873                          	; $5b
  4874  1b7c  181818ffff181818  DEFB $18,$18,$18,$ff,$ff,$18,$18,	$18
  4875                          	; $5c
  4876  1b84  c0c03030c0c03030  DEFB $c0,$c0,$30,$30,$c0,$c0,$30,	$30
  4877                          	; $5d
  4878  1b8c  1818181818181818  DEFB $18,$18,$18,$18,$18,$18,$18,	$18
  4879                          	; $5e
  4880  1b94  3333cccc3333cccc  DEFB $33,$33,$cc,$cc,$33,$33,$cc,	$cc
  4881                          	; $5f
  4882  1b9c  3399cc663399cc66  DEFB $33,$99,$cc,$66,$33,$99,$cc,	$66
  4883                          	; $60
  4884  1ba4  0000000000000000  DEFB $00,$00,$00,$00,$00,$00,$00,	$00
  4885                          	; $61
  4886  1bac  f0f0f0f0f0f0f0f0  DEFB $f0,$f0,$f0,$f0,$f0,$f0,$f0,	$f0
  4887                          	; $62
  4888  1bb4  00000000ffffffff  DEFB $00,$00,$00,$00,$ff,$ff,$ff,	$ff
  4889                          	; $63
  4890  1bbc  ff00000000000000  DEFB $ff,$00,$00,$00,$00,$00,$00,	$00
  4891                          	; $64
  4892  1bc4  00000000000000ff  DEFB $00,$00,$00,$00,$00,$00,$00,	$ff
  4893                          	; $65
  4894  1bcc  c0c0c0c0c0c0c0c0  DEFB $c0,$c0,$c0,$c0,$c0,$c0,$c0,	$c0
  4895                          	; $66
  4896  1bd4  cccc3333cccc3333  DEFB $cc,$cc,$33,$33,$cc,$cc,$33,	$33
  4897                          	; $67
  4898  1bdc  0303030303030303  DEFB $03,$03,$03,$03,$03,$03,$03,	$03
  4899                          	; $68
  4900  1be4  00000000cccc3333  DEFB $00,$00,$00,$00,$cc,$cc,$33,	$33
  4901                          	; $69
  4902  1bec  cc993366cc993366  DEFB $cc,$99,$33,$66,$cc,$99,$33,	$66
  4903                          	; $6a
  4904  1bf4  0303030303030303  DEFB $03,$03,$03,$03,$03,$03,$03,	$03
  4905                          	; $6b
  4906  1bfc  1818181f1f181818  DEFB $18,$18,$18,$1f,$1f,$18,$18,	$18
  4907                          	; $6c
  4908  1c04  000000000f0f0f0f  DEFB $00,$00,$00,$00,$0f,$0f,$0f,	$0f
  4909                          	; $6d
  4910  1c0c  1818181f1f000000  DEFB $18,$18,$18,$1f,$1f,$00,$00,	$00
  4911                          	; $6e
  4912  1c14  000000f8f8181818  DEFB $00,$00,$00,$f8,$f8,$18,$18,	$18
  4913                          	; $6f
  4914  1c1c  000000000000ffff  DEFB $00,$00,$00,$00,$00,$00,$ff,	$ff
  4915                          	; $70
  4916  1c24  0000001f1f181818  DEFB $00,$00,$00,$1f,$1f,$18,$18,	$18
  4917                          	; $71
  4918  1c2c  181818ffff000000  DEFB $18,$18,$18,$ff,$ff,$00,$00,	$00
  4919                          	; $72
  4920  1c34  000000ffff181818  DEFB $00,$00,$00,$ff,$ff,$18,$18,	$18
  4921                          	; $73
  4922  1c3c  181818f8f8181818  DEFB $18,$18,$18,$f8,$f8,$18,$18,	$18
  4923                          	; $74
  4924  1c44  c0c0c0c0c0c0c0c0  DEFB $c0,$c0,$c0,$c0,$c0,$c0,$c0,	$c0
  4925                          	; $75
  4926  1c4c  e0e0e0e0e0e0e0e0  DEFB $e0,$e0,$e0,$e0,$e0,$e0,$e0,	$e0
  4927                          	; $76
  4928  1c54  0707070707070707  DEFB $07,$07,$07,$07,$07,$07,$07,	$07
  4929                          	; $77
  4930  1c5c  ffff000000000000  DEFB $ff,$ff,$00,$00,$00,$00,$00,	$00
  4931                          	; $78
  4932  1c64  ffffff0000000000  DEFB $ff,$ff,$ff,$00,$00,$00,$00,	$00
  4933                          	; $79
  4934  1c6c  0000000000ffffff  DEFB $00,$00,$00,$00,$00,$ff,$ff,	$ff
  4935                          	; $7a
  4936  1c74  0103066c78706000  DEFB $01,$03,$06,$6c,$78,$70,$60,	$00
  4937                          	; $7b
  4938  1c7c  00000000f0f0f0f0  DEFB $00,$00,$00,$00,$f0,$f0,$f0,	$f0
  4939                          	; $7c
  4940  1c84  0f0f0f0f00000000  DEFB $0f,$0f,$0f,$0f,$00,$00,$00,	$00
  4941                          	; $7d
  4942  1c8c  181818f8f8000000  DEFB $18,$18,$18,$f8,$f8,$00,$00,	$00
  4943                          	; $7e
  4944  1c94  f0f0f0f000000000  DEFB $f0,$f0,$f0,$f0,$00,$00,$00,	$00
  4945                          	; $7f
  4946  1c9c  f0f0f0f00f0f0f0f  DEFB $f0,$f0,$f0,$f0,$0f,$0f,$0f,	$0f
  4947                          	; $80
  4948  1ca4  c39991919f99c3ff  DEFB $c3,$99,$91,$91,$9f,$99,$c3,	$ff
  4949                          	; $81
  4950  1cac  ffffc3f9c199c1ff  DEFB $ff,$ff,$c3,$f9,$c1,$99,$c1,	$ff
  4951                          	; $82
  4952  1cb4  ff9f9f83999983ff  DEFB $ff,$9f,$9f,$83,$99,$99,$83,	$ff
  4953                          	; $83
  4954  1cbc  ffffc39f9f9fc3ff  DEFB $ff,$ff,$c3,$9f,$9f,$9f,$c3,	$ff
  4955                          	; $84
  4956  1cc4  fff9f9c19999c1ff  DEFB $ff,$f9,$f9,$c1,$99,$99,$c1,	$ff
  4957                          	; $85
  4958  1ccc  ffffc399819fc3ff  DEFB $ff,$ff,$c3,$99,$81,$9f,$c3,	$ff
  4959                          	; $86
  4960  1cd4  fff1e7c1e7e7e7ff  DEFB $ff,$f1,$e7,$c1,$e7,$e7,$e7,	$ff
  4961                          	; $87
  4962  1cdc  ffffc19999c1f983  DEFB $ff,$ff,$c1,$99,$99,$c1,$f9,	$83
  4963                          	; $88
  4964  1ce4  ff9f9f83999999ff  DEFB $ff,$9f,$9f,$83,$99,$99,$99,	$ff
  4965                          	; $89
  4966  1cec  ffe7ffc7e7e7c3ff  DEFB $ff,$e7,$ff,$c7,$e7,$e7,$c3,	$ff
  4967                          	; $8a
  4968  1cf4  fff9fff9f9f9f9c3  DEFB $ff,$f9,$ff,$f9,$f9,$f9,$f9,	$c3
  4969                          	; $8b
  4970  1cfc  ff9f9f93879399ff  DEFB $ff,$9f,$9f,$93,$87,$93,$99,	$ff
  4971                          	; $8c
  4972  1d04  ffc7e7e7e7e7c3ff  DEFB $ff,$c7,$e7,$e7,$e7,$e7,$c3,	$ff
  4973                          	; $8d
  4974  1d0c  ffff998080949cff  DEFB $ff,$ff,$99,$80,$80,$94,$9c,	$ff
  4975                          	; $8e
  4976  1d14  ffff8399999999ff  DEFB $ff,$ff,$83,$99,$99,$99,$99,	$ff
  4977                          	; $8f
  4978  1d1c  ffffc3999999c3ff  DEFB $ff,$ff,$c3,$99,$99,$99,$c3,	$ff
  4979                          	; $90
  4980  1d24  ffff839999839f9f  DEFB $ff,$ff,$83,$99,$99,$83,$9f,	$9f
  4981                          	; $91
  4982  1d2c  ffffc19999c1f9f9  DEFB $ff,$ff,$c1,$99,$99,$c1,$f9,	$f9
  4983                          	; $92
  4984  1d34  ffff83999f9f9fff  DEFB $ff,$ff,$83,$99,$9f,$9f,$9f,	$ff
  4985                          	; $93
  4986  1d3c  ffffc19fc3f983ff  DEFB $ff,$ff,$c1,$9f,$c3,$f9,$83,	$ff
  4987                          	; $94
  4988  1d44  ffe781e7e7e7f1ff  DEFB $ff,$e7,$81,$e7,$e7,$e7,$f1,	$ff
  4989                          	; $95
  4990  1d4c  ffff99999999c1ff  DEFB $ff,$ff,$99,$99,$99,$99,$c1,	$ff
  4991                          	; $96
  4992  1d54  ffff999999c3e7ff  DEFB $ff,$ff,$99,$99,$99,$c3,$e7,	$ff
  4993                          	; $97
  4994  1d5c  ffff9c9480c1c9ff  DEFB $ff,$ff,$9c,$94,$80,$c1,$c9,	$ff
  4995                          	; $98
  4996  1d64  ffff99c3e7c399ff  DEFB $ff,$ff,$99,$c3,$e7,$c3,$99,	$ff
  4997                          	; $99
  4998  1d6c  ffff999999c1f387  DEFB $ff,$ff,$99,$99,$99,$c1,$f3,	$87
  4999                          	; $9a
  5000  1d74  ffff81f3e7cf81ff  DEFB $ff,$ff,$81,$f3,$e7,$cf,$81,	$ff
  5001                          	; $9b
  5002  1d7c  c3cfcfcfcfcfc3ff  DEFB $c3,$cf,$cf,$cf,$cf,$cf,$c3,	$ff
  5003                          	; $9c
  5004  1d84  f3edcf83cf9d03ff  DEFB $f3,$ed,$cf,$83,$cf,$9d,$03,	$ff
  5005                          	; $9d
  5006  1d8c  c3f3f3f3f3f3c3ff  DEFB $c3,$f3,$f3,$f3,$f3,$f3,$c3,	$ff
  5007                          	; $9e
  5008  1d94  ffe7c381e7e7e7e7  DEFB $ff,$e7,$c3,$81,$e7,$e7,$e7,	$e7
  5009                          	; $9f
  5010  1d9c  ffefcf8080cfefff  DEFB $ff,$ef,$cf,$80,$80,$cf,$ef,	$ff
  5011                          	; $a0
  5012  1da4  ffffffffffffffff  DEFB $ff,$ff,$ff,$ff,$ff,$ff,$ff,	$ff
  5013                          	; $a1
  5014  1dac  e7e7e7e7ffffe7ff  DEFB $e7,$e7,$e7,$e7,$ff,$ff,$e7,	$ff
  5015                          	; $a2
  5016  1db4  999999ffffffffff  DEFB $99,$99,$99,$ff,$ff,$ff,$ff,	$ff
  5017                          	; $a3
  5018  1dbc  99990099009999ff  DEFB $99,$99,$00,$99,$00,$99,$99,	$ff
  5019                          	; $a4
  5020  1dc4  e7c19fc3f983e7ff  DEFB $e7,$c1,$9f,$c3,$f9,$83,$e7,	$ff
  5021                          	; $a5
  5022  1dcc  9d99f3e7cf99b9ff  DEFB $9d,$99,$f3,$e7,$cf,$99,$b9,	$ff
  5023                          	; $a6
  5024  1dd4  c399c3c79899c0ff  DEFB $c3,$99,$c3,$c7,$98,$99,$c0,	$ff
  5025                          	; $a7
  5026  1ddc  f9f3e7ffffffffff  DEFB $f9,$f3,$e7,$ff,$ff,$ff,$ff,	$ff
  5027                          	; $a8
  5028  1de4  f3e7cfcfcfe7f3ff  DEFB $f3,$e7,$cf,$cf,$cf,$e7,$f3,	$ff
  5029                          	; $a9
  5030  1dec  cfe7f3f3f3e7cfff  DEFB $cf,$e7,$f3,$f3,$f3,$e7,$cf,	$ff
  5031                          	; $aa
  5032  1df4  ff99c300c399ffff  DEFB $ff,$99,$c3,$00,$c3,$99,$ff,	$ff
  5033                          	; $ab
  5034  1dfc  ffe7e781e7e7ffff  DEFB $ff,$e7,$e7,$81,$e7,$e7,$ff,	$ff
  5035                          	; $ac
  5036  1e04  ffffffffffe7e7cf  DEFB $ff,$ff,$ff,$ff,$ff,$e7,$e7,	$cf
  5037                          	; $ad
  5038  1e0c  ffffff81ffffffff  DEFB $ff,$ff,$ff,$81,$ff,$ff,$ff,	$ff
  5039                          	; $ae
  5040  1e14  ffffffffffe7e7ff  DEFB $ff,$ff,$ff,$ff,$ff,$e7,$e7,	$ff
  5041                          	; $af
  5042  1e1c  fffcf9f3e7cf9fff  DEFB $ff,$fc,$f9,$f3,$e7,$cf,$9f,	$ff
  5043                          	; $b0
  5044  1e24  c39991899999c3ff  DEFB $c3,$99,$91,$89,$99,$99,$c3,	$ff
  5045                          	; $b1
  5046  1e2c  e7e7c7e7e7e781ff  DEFB $e7,$e7,$c7,$e7,$e7,$e7,$81,	$ff
  5047                          	; $b2
  5048  1e34  c399f9f3cf9f81ff  DEFB $c3,$99,$f9,$f3,$cf,$9f,$81,	$ff
  5049                          	; $b3
  5050  1e3c  c399f9e3f999c3ff  DEFB $c3,$99,$f9,$e3,$f9,$99,$c3,	$ff
  5051                          	; $b4
  5052  1e44  f9f1e19980f9f9ff  DEFB $f9,$f1,$e1,$99,$80,$f9,$f9,	$ff
  5053                          	; $b5
  5054  1e4c  819f83f9f999c3ff  DEFB $81,$9f,$83,$f9,$f9,$99,$c3,	$ff
  5055                          	; $b6
  5056  1e54  c3999f839999c3ff  DEFB $c3,$99,$9f,$83,$99,$99,$c3,	$ff
  5057                          	; $b7
  5058  1e5c  8199f3e7e7e7e7ff  DEFB $81,$99,$f3,$e7,$e7,$e7,$e7,	$ff
  5059                          	; $b8
  5060  1e64  c39999c39999c3ff  DEFB $c3,$99,$99,$c3,$99,$99,$c3,	$ff
  5061                          	; $b9
  5062  1e6c  c39999c1f999c3ff  DEFB $c3,$99,$99,$c1,$f9,$99,$c3,	$ff
  5063                          	; $ba
  5064  1e74  ffffe7ffffe7ffff  DEFB $ff,$ff,$e7,$ff,$ff,$e7,$ff,	$ff
  5065                          	; $bb
  5066  1e7c  ffffe7ffffe7e7cf  DEFB $ff,$ff,$e7,$ff,$ff,$e7,$e7,	$cf
  5067                          	; $bc
  5068  1e84  f1e7cf9fcfe7f1ff  DEFB $f1,$e7,$cf,$9f,$cf,$e7,$f1,	$ff
  5069                          	; $bd
  5070  1e8c  ffff81ff81ffffff  DEFB $ff,$ff,$81,$ff,$81,$ff,$ff,	$ff
  5071                          	; $be
  5072  1e94  8fe7f3f9f3e78fff  DEFB $8f,$e7,$f3,$f9,$f3,$e7,$8f,	$ff
  5073                          	; $bf
  5074  1e9c  c399f9f3e7ffe7ff  DEFB $c3,$99,$f9,$f3,$e7,$ff,$e7,	$ff
  5075                          	; $c0
  5076  1ea4  ffffff0000ffffff  DEFB $ff,$ff,$ff,$00,$00,$ff,$ff,	$ff
  5077                          	; $c1
  5078  1eac  e7c39981999999ff  DEFB $e7,$c3,$99,$81,$99,$99,$99,	$ff
  5079                          	; $c2
  5080  1eb4  83999983999983ff  DEFB $83,$99,$99,$83,$99,$99,$83,	$ff
  5081                          	; $c3
  5082  1ebc  c3999f9f9f99c3ff  DEFB $c3,$99,$9f,$9f,$9f,$99,$c3,	$ff
  5083                          	; $c4
  5084  1ec4  87939999999387ff  DEFB $87,$93,$99,$99,$99,$93,$87,	$ff
  5085                          	; $c5
  5086  1ecc  819f9f879f9f81ff  DEFB $81,$9f,$9f,$87,$9f,$9f,$81,	$ff
  5087                          	; $c6
  5088  1ed4  819f9f879f9f9fff  DEFB $81,$9f,$9f,$87,$9f,$9f,$9f,	$ff
  5089                          	; $c7
  5090  1edc  c3999f919999c3ff  DEFB $c3,$99,$9f,$91,$99,$99,$c3,	$ff
  5091                          	; $c8
  5092  1ee4  99999981999999ff  DEFB $99,$99,$99,$81,$99,$99,$99,	$ff
  5093                          	; $c9
  5094  1eec  c3e7e7e7e7e7c3ff  DEFB $c3,$e7,$e7,$e7,$e7,$e7,$c3,	$ff
  5095                          	; $ca
  5096  1ef4  e1f3f3f3f393c7ff  DEFB $e1,$f3,$f3,$f3,$f3,$93,$c7,	$ff
  5097                          	; $cb
  5098  1efc  9993878f879399ff  DEFB $99,$93,$87,$8f,$87,$93,$99,	$ff
  5099                          	; $cc
  5100  1f04  9f9f9f9f9f9f81ff  DEFB $9f,$9f,$9f,$9f,$9f,$9f,$81,	$ff
  5101                          	; $cd
  5102  1f0c  9c8880949c9c9cff  DEFB $9c,$88,$80,$94,$9c,$9c,$9c,	$ff
  5103                          	; $ce
  5104  1f14  99898181919999ff  DEFB $99,$89,$81,$81,$91,$99,$99,	$ff
  5105                          	; $cf
  5106  1f1c  c39999999999c3ff  DEFB $c3,$99,$99,$99,$99,$99,$c3,	$ff
  5107                          	; $d0
  5108  1f24  839999839f9f9fff  DEFB $83,$99,$99,$83,$9f,$9f,$9f,	$ff
  5109                          	; $d1
  5110  1f2c  c399999999c3f1ff  DEFB $c3,$99,$99,$99,$99,$c3,$f1,	$ff
  5111                          	; $d2
  5112  1f34  83999983879399ff  DEFB $83,$99,$99,$83,$87,$93,$99,	$ff
  5113                          	; $d3
  5114  1f3c  c3999fc3f999c3ff  DEFB $c3,$99,$9f,$c3,$f9,$99,$c3,	$ff
  5115                          	; $d4
  5116  1f44  81e7e7e7e7e7e7ff  DEFB $81,$e7,$e7,$e7,$e7,$e7,$e7,	$ff
  5117                          	; $d5
  5118  1f4c  999999999999c3ff  DEFB $99,$99,$99,$99,$99,$99,$c3,	$ff
  5119                          	; $d6
  5120  1f54  9999999999c3e7ff  DEFB $99,$99,$99,$99,$99,$c3,$e7,	$ff
  5121                          	; $d7
  5122  1f5c  9c9c9c9480889cff  DEFB $9c,$9c,$9c,$94,$80,$88,$9c,	$ff
  5123                          	; $d8
  5124  1f64  9999c3e7c39999ff  DEFB $99,$99,$c3,$e7,$c3,$99,$99,	$ff
  5125                          	; $d9
  5126  1f6c  999999c3e7e7e7ff  DEFB $99,$99,$99,$c3,$e7,$e7,$e7,	$ff
  5127                          	; $da
  5128  1f74  81f9f3e7cf9f81ff  DEFB $81,$f9,$f3,$e7,$cf,$9f,$81,	$ff
  5129                          	; $db
  5130  1f7c  e7e7e70000e7e7e7  DEFB $e7,$e7,$e7,$00,$00,$e7,$e7,	$e7
  5131                          	; $dc
  5132  1f84  3f3fcfcf3f3fcfcf  DEFB $3f,$3f,$cf,$cf,$3f,$3f,$cf,	$cf
  5133                          	; $dd
  5134  1f8c  e7e7e7e7e7e7e7e7  DEFB $e7,$e7,$e7,$e7,$e7,$e7,$e7,	$e7
  5135                          	; $de
  5136  1f94  cccc3333cccc3333  DEFB $cc,$cc,$33,$33,$cc,$cc,$33,	$33
  5137                          	; $df
  5138  1f9c  cc663399cc663399  DEFB $cc,$66,$33,$99,$cc,$66,$33,	$99
  5139                          	; $e0
  5140  1fa4  ffffffffffffffff  DEFB $ff,$ff,$ff,$ff,$ff,$ff,$ff,	$ff
  5141                          	; $e1
  5142  1fac  0f0f0f0f0f0f0f0f  DEFB $0f,$0f,$0f,$0f,$0f,$0f,$0f,	$0f
  5143                          	; $e2
  5144  1fb4  ffffffff00000000  DEFB $ff,$ff,$ff,$ff,$00,$00,$00,	$00
  5145                          	; $e3
  5146  1fbc  00ffffffffffffff  DEFB $00,$ff,$ff,$ff,$ff,$ff,$ff,	$ff
  5147                          	; $e4
  5148  1fc4  ffffffffffffff00  DEFB $ff,$ff,$ff,$ff,$ff,$ff,$ff,	$00
  5149                          	; $e5
  5150  1fcc  3f3f3f3f3f3f3f3f  DEFB $3f,$3f,$3f,$3f,$3f,$3f,$3f,	$3f
  5151                          	; $e6
  5152  1fd4  3333cccc3333cccc  DEFB $33,$33,$cc,$cc,$33,$33,$cc,	$cc
  5153                          	; $e7
  5154  1fdc  fcfcfcfcfcfcfcfc  DEFB $fc,$fc,$fc,$fc,$fc,$fc,$fc,	$fc
  5155                          	; $e8
  5156  1fe4  ffffffff3333cccc  DEFB $ff,$ff,$ff,$ff,$33,$33,$cc,	$cc
  5157                          	; $e9
  5158  1fec  3366cc993366cc99  DEFB $33,$66,$cc,$99,$33,$66,$cc,	$99
  5159                          	; $ea
  5160  1ff4  fcfcfcfcfcfcfcfc  DEFB $fc,$fc,$fc,$fc,$fc,$fc,$fc,	$fc
  5161                          	; $eb
  5162  1ffc  e7e7e7e0e0e7e7e7  DEFB $e7,$e7,$e7,$e0,$e0,$e7,$e7,	$e7
  5163                          	; $ec
  5164  2004  fffffffff0f0f0f0  DEFB $ff,$ff,$ff,$ff,$f0,$f0,$f0,	$f0
  5165                          	; $ed
  5166  200c  e7e7e7e0e0ffffff  DEFB $e7,$e7,$e7,$e0,$e0,$ff,$ff,	$ff
  5167                          	; $ee
  5168  2014  ffffff0707e7e7e7  DEFB $ff,$ff,$ff,$07,$07,$e7,$e7,	$e7
  5169                          	; $ef
  5170  201c  ffffffffffff0000  DEFB $ff,$ff,$ff,$ff,$ff,$ff,$00,	$00
  5171                          	; $f0
  5172  2024  ffffffe0e0e7e7e7  DEFB $ff,$ff,$ff,$e0,$e0,$e7,$e7,	$e7
  5173                          	; $f1
  5174  202c  e7e7e70000ffffff  DEFB $e7,$e7,$e7,$00,$00,$ff,$ff,	$ff
  5175                          	; $f2
  5176  2034  ffffff0000e7e7e7  DEFB $ff,$ff,$ff,$00,$00,$e7,$e7,	$e7
  5177                          	; $f3
  5178  203c  e7e7e70707e7e7e7  DEFB $e7,$e7,$e7,$07,$07,$e7,$e7,	$e7
  5179                          	; $f4
  5180  2044  3f3f3f3f3f3f3f3f  DEFB $3f,$3f,$3f,$3f,$3f,$3f,$3f,	$3f
  5181                          	; $f5
  5182  204c  1f1f1f1f1f1f1f1f  DEFB $1f,$1f,$1f,$1f,$1f,$1f,$1f,	$1f
  5183                          	; $f6
  5184  2054  f8f8f8f8f8f8f8f8  DEFB $f8,$f8,$f8,$f8,$f8,$f8,$f8,	$f8
  5185                          	; $f7
  5186  205c  0000ffffffffffff  DEFB $00,$00,$ff,$ff,$ff,$ff,$ff,	$ff
  5187                          	; $f8
  5188  2064  000000ffffffffff  DEFB $00,$00,$00,$ff,$ff,$ff,$ff,	$ff
  5189                          	; $f9
  5190  206c  ffffffffff000000  DEFB $ff,$ff,$ff,$ff,$ff,$00,$00,	$00
  5191                          	; $fa
  5192  2074  fefcf993878f9fff  DEFB $fe,$fc,$f9,$93,$87,$8f,$9f,	$ff
  5193                          	; $fb
  5194  207c  ffffffff0f0f0f0f  DEFB $ff,$ff,$ff,$ff,$0f,$0f,$0f,	$0f
  5195                          	; $fc
  5196  2084  f0f0f0f0ffffffff  DEFB $f0,$f0,$f0,$f0,$ff,$ff,$ff,	$ff
  5197                          	; $fd
  5198  208c  e7e7e70707ffffff  DEFB $e7,$e7,$e7,$07,$07,$ff,$ff,	$ff
  5199                          	; $fe
  5200  2094  0f0f0f0fffffffff  DEFB $0f,$0f,$0f,$0f,$ff,$ff,$ff,	$ff
  5201                          TMS9918AUDCCHAR01:
  5202  209c  01f807            	LD BC, 2040
  5203  209f  21a418            	LD HL, UDCCHAR
  5204  20a2  110000            	LD DE, $0000
  5205                          ; peephole(1): r383 (CALL+RET)->(JP)
  5206                          ;	CALL VDPWRITE
  5207  20a5  c34901            	JP VDPWRITE
  5208                          ;	RET
  5209                          TMS9918AUDCCHAR23:
  5210  20a8  01f807            	LD BC, 2040
  5211  20ab  21a418            	LD HL, UDCCHAR
  5212  20ae  110000            	LD DE, $0000
  5213  20b1  cd4901            	CALL VDPWRITE
  5214  20b4  01f807            	LD BC, 2040
  5215  20b7  21a418            	LD HL, UDCCHAR
  5216  20ba  110008            	LD DE, $800+$0000
  5217  20bd  cd4901            	CALL VDPWRITE
  5218  20c0  01f807            	LD BC, 2040
  5219  20c3  21a418            	LD HL, UDCCHAR
  5220  20c6  110010            	LD DE, $1000+$0000
  5221                          ; peephole(1): r383 (CALL+RET)->(JP)
  5222                          ;	CALL VDPWRITE
  5223  20c9  c34901            	JP VDPWRITE
  5224                          ;	RET
  5225                          section data_user
  5226  013b  ff                MAXSTRINGS:                   DB 255
  5227  013c  7c0000001a010000  DESCRIPTORS:                  DEFS 1020
              0501008500007c00  
              000e010000a50000  
              000000004f010085  
              00007c00000e0100  
              0000001400000000  
              006a010000850000  
              7c00000e010000ae  
              0000000000007901  
              008500007c00001a  
              0100050100000085  
              00007c0000000e01  
              0000a50000009d01  
              00f7008500007c00  
              00000e010000ae00  
              0000b10100850000  
              7c0000000e010000  
              a500000000c30100  
              f600850000001000  
              00006f0000000000  
              00fa007c00008000  
              0000002401008200  
              0006002401008300  
              0080002401008400  
              0000002401008500  
              0036002401008600  
              0007002401008700  
              00f1002401008100  
              00e200240100c300  
              e000000000d00100  
              0000000000c300e3  
              0000000000000000  
              00c300e600000000  
              0000000000c300e9  
              0000000000000000  
              00850000006b0000  
              00002000d0000000  
              2d01000000000000  
              f2000000f50000f5  
              00000000f90000d1  
              01000f005b000001  
              005c000080000002  
              0024010081000080  
              002401008200000e  
              0024010000000500  
              0038000600008300  
              00ff002401000000  
              0300002000040000  
              8400000300240100  
              00006d00006e0000  
              8500007600240100  
              8600000300240100  
              00006b00003b006c  
              0000000069000018  
              006a0000a8200057  
              0200810000e20024  
              01000000ff00bf00  
              8100000000820000  
              8300000000840000  
              6300000100640000  
              c000650000000066  
              0000630000850000  
              6400008600006500  
              0087000066000088  
              0000ff0020006700  
              0000001800680000  
              080002008d000001  
              008e0000c103008e  
              00000000008d0000  
              00000f0001001b00  
              0200340003003000  
              c00300090000c004  
              0000050000950100  
              c003000900000004  
              0000050000950100  
              5c00002001000003  
              0000950100c00300  
              0900000004000005  
              00009501005c0000  
              0018000003000095  
              0100c00300005a03  
              00cc20005a030001  
              0017010018010001  
              0019010019010000  
              00ea030035010001  
              00350100f2030035  
              0100fe0035010000  
              001c01001d010000  
              001e01001f010017  
              01001e01001c0100  
              001e0100001c0100  
              0a001a010000001b  
              0100200100000021  
              0100180100200100  
              00200100001a0100  
              0000000000100000  
              0000000700000000  
              47040000f1000000  
              2301000025010023  
              0100270100240100  
              2801001c01000027  
              0100001c01001c01  
              0029010029010007  
              002901001c01002b  
              01001d01002c0100  
              2b01000000000000  
              000000000000002b  
              010000002b010007  
              0100002b01003501  
              000000000800ff00  
              2d0100b50400002d  
              01002d01000000cf  
              0400941600002901  
              0000002b01000000  
              00de04009c160000  
              29010000002b0100  
              0000000100170100  
              0200180100010019  
              0100190100000000  
              0500350100010035  
              0100080500350100  
              fe0035010000001c  
              01001d010000001e  
              01001f0100170100  
              1e01001c0100001e  
              0100001c01000a00  
              1a010000001b0100  
              20010000          
  5228  0538  0021010018010020  WORKING:                      DEFS 1024
              010000200100001a  
              0100000000000010  
              0000000000070000  
              00005d050000f100  
              0000230100002501  
              0023010027010024  
              01002801001c0100  
              00270100001c0100  
              1c01002901002901  
              0007002901001c01  
              002b01001d01002c  
              01002b0100000000  
              0000000000000000  
              002b010000002b01  
              00070100002b0100  
              3501000000000800  
              ff002d0100cb0500  
              002d01002d010000  
              00e5050094160000  
              29010000002b0100  
              000000f405009c16  
              000029010000002b  
              0100000000010017  
              0100030018010001  
              0019010019010000  
              0016060035010001  
              003501001e060035  
              0100fe0035010000  
              001c01001d010000  
              001e01001f010017  
              01001e01001c0100  
              001e0100001c0100  
              0a001a010000001b  
              0100200100000021  
              0100180100200100  
              00200100001a0100  
              0000000000100000  
              0000000700000000  
              73060000f1000000  
              2301000025010023  
              0100270100240100  
              2801001c01000027  
              0100001c01001c01  
              0029010029010007  
              002901001c01002b  
              01001d01002c0100  
              2b01000000000000  
              000000000000002b  
              010000002b010007  
              0100002b01003501  
              000000000800ff00  
              2d0100e10600002d  
              01002d01000000fb  
              0600941600002901  
              0000002b01000000  
              000a07009c160000  
              29010000002b0100  
              0000000200170100  
              0100180100190100  
              19010000002a0700  
              3501000100350100  
              320700350100fe00  
              35010000001c0100  
              1d010000001e0100  
              1f01001701001e01  
              001c0100001e0100  
              001c01000a001a01  
              0000001b01002001  
              0000002101001801  
              0020010000200100  
              001a010000000000  
              0010000000000007  
              0000000087070000  
              f100000023010000  
              2501002301002701  
              002401002801001c  
              010000270100001c  
              01001c0100290100  
              2901000700290100  
              1c01002b01001d01  
              002c01002b010000  
              0000000000000000  
              0000002b01000000  
              2b0100070100002b  
              0100350100000000  
              0800ff002d0100f5  
              0700002d01002d01  
              0000000f08009416  
              000029010000002b  
              01000000001e0800  
              9c16000029010000  
              002b010000000002  
              0017010018010001  
              0019010019010000  
              003e080035010001  
              0035010046080035  
              0100fe0035010000  
              001c01001d010000  
              001e01001f010017  
              01001e01001c0100  
              001e0100001c0100  
              0a001a010000001b  
              0100200100000021  
              0100180100200100  
              00200100001a0100  
              0000000000100000  
              0000000700000000  
              9b080000f1000000  
              2301000025010023  
              0100270100240100  
              2801001c01000027  
              0100001c01001c01  
              0029010029010007  
              002901001c01002b  
              01001d01002c0100  
              2b01000000000000  
              000000000000002b  
              010000002b010007  
              0100002b01003501  
              000000000800ff00  
              2d0100090900002d  
              01002d0100000023  
              0900941600002901  
              0000002b01000000  
              003209009c160000  
              29010000002b0100  
              0000000200170100  
  5229  0938  0300180100010019  TEMPORARY:                    DEFS 1024
              0100190100000054  
              0900350100010035  
              01005c0900350100  
              fe0035010000001c  
              01001d010000001e  
              01001f0100170100  
              1e01001c0100001e  
              0100001c01000a00  
              1a010000001b0100  
              2001000000210100  
              1801002001000020  
              0100001a01000000  
              0000001000000000  
              000700000000b109  
              0000f10000002301  
              0000250100230100  
              2701002401002801  
              001c010000270100  
              001c01001c010029  
              0100290100070029  
              01001c01002b0100  
              1d01002c01002b01  
              0000000000000000  
              00000000002b0100  
              00002b0100070100  
              002b010035010000  
              00000800ff002d01  
              001f0a00002d0100  
              2d01000000390a00  
              9416000029010000  
              002b010000000048  
              0a009c1600002901  
              0000002b01000000  
              0003001701000100  
              1801001901001901  
              000000680a003501  
              000100350100700a  
              00350100fe003501  
              0000001c01001d01  
              0000001e01001f01  
              001701001e01001c  
              0100001e0100001c  
              01000a001a010000  
              001b010020010000  
              0021010018010020  
              010000200100001a  
              0100000000000010  
              0000000000070000  
              0000c50a0000f100  
              0000230100002501  
              0023010027010024  
              01002801001c0100  
              00270100001c0100  
              1c01002901002901  
              0007002901001c01  
              002b01001d01002c  
              01002b0100000000  
              0000000000000000  
              002b010000002b01  
              00070100002b0100  
              3501000000000800  
              ff002d0100330b00  
              002d01002d010000  
              004d0b0094160000  
              29010000002b0100  
              0000005c0b009c16  
              000029010000002b  
              0100000000030017  
              0100020018010001  
              0019010019010000  
              007e0b0035010001  
              00350100860b0035  
              0100fe0035010000  
              001c01001d010000  
              001e01001f010017  
              01001e01001c0100  
              001e0100001c0100  
              0a001a010000001b  
              0100200100000021  
              0100180100200100  
              00200100001a0100  
              0000000000100000  
              0000000700000000  
              db0b0000f1000000  
              2301000025010023  
              0100270100240100  
              2801001c01000027  
              0100001c01001c01  
              0029010029010007  
              002901001c01002b  
              01001d01002c0100  
              2b01000000000000  
              000000000000002b  
              010000002b010007  
              0100002b01003501  
              000000000800ff00  
              2d0100490c00002d  
              01002d0100000063  
              0c00941600002901  
              0000002b01000000  
              00720c009c160000  
              29010000002b0100  
              0000000300170100  
              1801000100190100  
              1901000000920c00  
              3501000100350100  
              9a0c00350100fe00  
              35010000001c0100  
              1d010000001e0100  
              1f01001701001e01  
              001c0100001e0100  
              001c01000a001a01  
              0000001b01002001  
              0000002101001801  
              0020010000200100  
              001a010000000000  
              0010000000000007  
              00000000ef0c0000  
              f100000023010000  
              2501002301002701  
              002401002801001c  
              010000270100001c  
              01001c0100290100  
              2901000700290100  
              1c01002b01001d01  
              002c01002b010000  
              0000000000000000  
  5230  0d38  ff04              FREE_STRING:                  DB $ff, $04
  5231                          section code_user
  5232                          AY8910STARTUP:
  5233  20cc  c9                	RET
  5234                          MUSICPLAYER:
  5235  20cd  c9                	RET
  5236                          section data_user
  5237  0d3a  00                LASTVAR: db $00
  5238                          section code_user
  5239                          PROTOTHREADINIT:
  5240  20ce  c9                	RET
  5241                          VARINIT2:
  5242  20cf  21db20            	LD HL, CODEEND
  5243  20d2  1100c0            	LD DE, $C000
  5244  20d5  013a4d            	LD BC, LASTVAR - $C000
  5245  20d8  edb0              	LDIR
  5246  20da  c9                	RET
  5247                          CODEEND:
  5248                          ; peephole: pass 1, 159 changes.
  5249                          ; peephole: pass 2, 0 change.
  5250                          ; peephole: pass 3, 20 vars removed.
  5251                          ; peephole: pass 4, 4 changes.
  5252                          ; peephole: pass 5, 2 changes.
  5253                          ; peephole: pass 6, 0 change.
  5254                          ; peephole: pass 7, 0 var removed.
  5255                          ; peephole: pass 8, 0 var moved to dp, 0 var inlined.
  5256                          
