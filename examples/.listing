dgrpnpgmjbchktd.asm:
     1                          ORG $100
     2  0000  c3a100            	jp startup_after
     3                          ; /*****************************************************************************
     4                          ;  * ugBASIC - an isomorphic BASIC language compiler for retrocomputers        *
     5                          ;  *****************************************************************************
     6                          ;  * Copyright 2021-2023 Marco Spedaletti (asimov@mclink.it)
     7                          ;  *
     8                          ;  * Licensed under the Apache License, Version 2.0 (the "License
     9                          ;  * you may not use this file except in compliance with the License.
    10                          ;  * You may obtain a copy of the License at
    11                          ;  *
    12                          ;  * http://www.apache.org/licenses/LICENSE-2.0
    13                          ;  *
    14                          ;  * Unless required by applicable law or agreed to in writing, software
    15                          ;  * distributed under the License is distributed on an "AS IS" BASIS,
    16                          ;  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    17                          ;  * See the License for the specific language governing permissions and
    18                          ;  * limitations under the License.
    19                          ;  *----------------------------------------------------------------------------
    20                          ;  * Concesso in licenza secondo i termini della Licenza Apache, versione 2.0
    21                          ;  * (la "Licenza è proibito usare questo file se non in conformità alla
    22                          ;  * Licenza. Una copia della Licenza è disponibile all'indirizzo:
    23                          ;  *
    24                          ;  * http://www.apache.org/licenses/LICENSE-2.0
    25                          ;  *
    26                          ;  * Se non richiesto dalla legislazione vigente o concordato per iscritto,
    27                          ;  * il software distribuito nei termini della Licenza è distribuito
    28                          ;  * "COSì COM'è", SENZA GARANZIE O CONDIZIONI DI ALCUN TIPO, esplicite o
    29                          ;  * implicite. Consultare la Licenza per il testo specifico che regola le
    30                          ;  * autorizzazioni e le limitazioni previste dalla medesima.
    31                          ;  ****************************************************************************/
    32                          ;* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
    33                          ;*                                                                             *
    34                          ;*                      STARTUP ROUTINE FOR CPC                             *
    35                          ;*                                                                             *
    36                          ;*                             by Marco Spedaletti                             *
    37                          ;*                                                                             *
    38                          ;* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
    39                          PALETTE:
    40  0003  040a130c          	DB      4,  10,  19,  12
    41  0007  0b14150d          	DB     11,  20,  21,  13
    42  000b  061e1f07          	DB      6,  30,  31,   7
    43  000f  12190a07          	DB      18, 25,  10,   7
    44                          PALETTEUNUSED:
    45  0013  00                	DB $00
    46                          SETHWPALETTE:
    47  0014  c5                	PUSH BC
    48  0015  f5                	PUSH AF
    49  0016  01007f            	LD BC, $7F00
    50  0019  dd7c              	LD A, IXH
    51  001b  4f                	LD C, A
    52  001c  ed49              	OUT (C), C
    53  001e  dd7d              	LD A, IXL
    54  0020  f640              	OR A, $40
    55  0022  ed79              	OUT (C), A
    56  0024  f1                	POP AF
    57  0025  c1                	POP BC
    58  0026  c9                	RET
    59                          IRQTIMERVOID:
    60  0027  c9                	RET
    61                          CPCISVC:
    62  0028  f5                	PUSH	AF
    63  0029  c5                	PUSH	BC
    64  002a  d5                	PUSH	DE
    65  002b  e5                	PUSH	HL
    66  002c  dde5              	PUSH	IX
    67  002e  fde5              	PUSH	IY
    68  0030  08                	EX	AF,AF'
    69  0031  f5                	PUSH	AF
    70  0032  d9                	EXX
    71  0033  c5                	PUSH	BC
    72  0034  d5                	PUSH	DE
    73  0035  e5                	PUSH	HL
    74  0036  3a8109            	LD A, (CPCTIMER2)
    75  0039  3d                	DEC A
    76  003a  328109            	LD (CPCTIMER2), A
    77  003d  fe00              	CP 0
    78  003f  202d              	JR NZ,IRQVECTORSKIP
    79  0041  3e06              	LD A,6
    80  0043  328109            	LD (CPCTIMER2), A
    81  0046  2a4409            	LD HL,(CPCTIMER)
    82  0049  23                	INC HL
    83  004a  224409            	LD (CPCTIMER),HL
    84  004d  cd4e13            	CALL MUSICPLAYER
    85  0050  3a8209            	LD A, (EVERYCOUNTER)
    86  0053  fe00              	CP 0
    87  0055  2807              	JR Z, IRQTIMERADDR2
    88  0057  3d                	DEC A
    89  0058  328209            	LD (EVERYCOUNTER), A
    90  005b  c36e00            	JP IRQVECTORSKIP
    91                          IRQTIMERADDR2:
    92  005e  3a3309            	LD A, (EVERYSTATUS)
    93  0061  fe00              	CP 0
    94  0063  2809              	JR Z, IRQVECTORSKIP
    95  0065  3a8309            	LD A, (EVERYTIMING)
    96  0068  328209            	LD (EVERYCOUNTER), A
    97                          IRQTIMERADDR:
    98  006b  cd2700            	CALL IRQTIMERVOID
    99                          IRQVECTORSKIP:
   100  006e  e1                	POP	HL
   101  006f  d1                	POP	DE
   102  0070  c1                	POP	BC
   103  0071  d9                	EXX
   104  0072  f1                	POP	AF
   105  0073  08                	EX	AF,AF'
   106  0074  fde1              	POP	IY
   107  0076  dde1              	POP	IX
   108  0078  e1                	POP	HL
   109  0079  d1                	POP	DE
   110  007a  c1                	POP	BC
   111  007b  f1                	POP	AF
   112  007c  fb                	EI
   113  007d  c9                	RET
   114                          CPCSTARTUP:
   115  007e  c9                	RET
   116                          CPCVIDEOSTARTUP:
   117  007f  f3                	DI
   118  0080  3ec3              	LD A, $C3
   119  0082  323800            	LD ($0038), A
   120  0085  212800            	LD HL, CPCISVC
   121  0088  223900            	LD ($0039), HL
   122  008b  fb                	EI
   123  008c  210300            	LD HL, PALETTE
   124                          ; peephole(1): r215 (LD A, 0)->(XOR A)
   125                          ;	LD A, 0
   126  008f  af                	XOR A
   127  0090  01000f            	LD BC, $0F00
   128                          CPCVIDEOSTARTUPL1:
   129  0093  79                	LD A, C
   130  0094  dd67              	LD IXH, A
   131  0096  7e                	LD A, (HL)
   132  0097  dd6f              	LD IXL, A
   133  0099  cd1400            	CALL SETHWPALETTE
   134  009c  23                	INC HL
   135  009d  0c                	INC C
   136                          ; peephole(1): r383 (DEC B+JR NZ)->(DJNZ)
   137                          ;	DEC B
   138  009e  10f3              	DJNZ CPCVIDEOSTARTUPL1
   139                          ;	JR NZ, CPCVIDEOSTARTUPL1
   140  00a0  c9                	RET
   141                          startup_after:
   142                          CODESTART:
   143  00a1  3100c0            	LD SP, $C000
   144  00a4  cdd809            	CALL VARINIT
   145  00a7  cd4f13            	CALL PROTOTHREADINIT
   146  00aa  cd7f00            	CALL CPCVIDEOSTARTUP
   147  00ad  3e00              	LD A, $00
   148  00af  329e09            	LD (_PEN), A
   149  00b2  3e14              	LD A, $14
   150                          ; peephole(3): unread
   151                          ;	LD (_PAPER), A
   152  00b4  067f              	LD B, $7F
   153  00b6  ed48              	IN C, (C)
   154  00b8  79                	LD A, C
   155  00b9  e63c              	AND A, $3c
   156  00bb  f682              	OR A, $82
   157  00bd  4f                	LD C, A
   158  00be  ed49              	OUT (C), C
   159  00c0  3e00              	LD A, $00
   160                          ; peephole(3): unread
   161                          ;	LD (CLIPX1), A
   162                          ; peephole(1): r237 (LD A, x; LD (x), A; LD A, x)->(LD A, x; LD (x), A)
   163                          ;	LD A, $00
   164                          ; peephole(3): unread
   165                          ;	LD (CLIPX1+1), A
   166  00c2  3e7f              	LD A, $7f
   167                          ; peephole(3): unread
   168                          ;	LD (CLIPX2), A
   169  00c4  3e02              	LD A, $02
   170                          ; peephole(3): unread
   171                          ;	LD (CLIPX2+1), A
   172  00c6  3e00              	LD A, $00
   173                          ; peephole(3): unread
   174                          ;	LD (CLIPY1), A
   175                          ; peephole(1): r237 (LD A, x; LD (x), A; LD A, x)->(LD A, x; LD (x), A)
   176                          ;	LD A, $00
   177                          ; peephole(3): unread
   178                          ;	LD (CLIPY1+1), A
   179  00c8  3ec7              	LD A, $c7
   180                          ; peephole(3): unread
   181                          ;	LD (CLIPY2), A
   182                          ; peephole(4): r392 (LD A, *; LD A, *)->(LD, A)
   183                          ;	LD A, $00
   184                          ; peephole(3): unread
   185                          ;	LD (CLIPY2+1), A
   186                          ; peephole(1): r237 (LD A, x; LD (x), A; LD A, x)->(LD A, x; LD (x), A)
   187                          ;	LD A, $00
   188  00ca  325309            	LD (ORIGINX), A
   189  00cd  3e00              	LD A, $00
   190  00cf  325409            	LD (ORIGINX+1), A
   191                          ; peephole(1): r237 (LD A, x; LD (x), A; LD A, x)->(LD A, x; LD (x), A)
   192                          ;	LD A, $00
   193  00d2  325509            	LD (ORIGINY), A
   194  00d5  3e00              	LD A, $00
   195  00d7  325609            	LD (ORIGINY+1), A
   196  00da  3e80              	LD A, $80
   197  00dc  324a09            	LD (CURRENTWIDTH), A
   198  00df  3e02              	LD A, $02
   199  00e1  324b09            	LD (CURRENTWIDTH+1), A
   200  00e4  3ec8              	LD A, $c8
   201  00e6  324c09            	LD (CURRENTHEIGHT), A
   202  00e9  3e00              	LD A, $00
   203  00eb  324d09            	LD (CURRENTHEIGHT+1), A
   204  00ee  3a4a09            	LD A, (CURRENTWIDTH)
   205  00f1  325709            	LD (RESOLUTIONX), A
   206  00f4  3a4b09            	LD A, (CURRENTWIDTH+1)
   207  00f7  325809            	LD (RESOLUTIONX+1), A
   208  00fa  3a4c09            	LD A, (CURRENTHEIGHT)
   209  00fd  325909            	LD (RESOLUTIONY), A
   210  0100  3a4d09            	LD A, (CURRENTHEIGHT+1)
   211  0103  325a09            	LD (RESOLUTIONY+1), A
   212  0106  3eff              	LD A, $ff
   213                          ; peephole(3): unread
   214                          ;	LD (CURRENTTILES), A
   215  0108  3e50              	LD A, $50
   216  010a  324e09            	LD (CURRENTTILESWIDTH), A
   217  010d  3e19              	LD A, $19
   218  010f  324f09            	LD (CURRENTTILESHEIGHT), A
   219  0112  3e08              	LD A, $08
   220                          ; peephole(3): unread
   221                          ;	LD (FONTWIDTH), A
   222                          ; peephole(1): r237 (LD A, x; LD (x), A; LD A, x)->(LD A, x; LD (x), A)
   223                          ;	LD A, $08
   224                          ; peephole(3): unread
   225                          ;	LD (FONTHEIGHT), A
   226  0114  3e02              	LD A, $02
   227  0116  325009            	LD (PALETTELIMIT), A
   228  0119  cd4d13            	call AY8910STARTUP
   229  011c  cd7e00            	CALL CPCSTARTUP
   230                          	; L:0
   231                          	; P:171
   232                          	; L:1
   233                          	; P:0
   234                          	; L:2
   235                          	; P:0
   236                          	; L:3
   237                          	; P:0
   238                          	; L:4
   239                          	; P:0
   240                          	; L:5
   241                          	; P:0
   242                          	; L:6
   243                          	; P:0
   244                          	; L:7
   245                          	; P:0
   246                          	; L:8
   247                          	; P:0
   248                          	; L:9
   249                          	; P:0
   250                          	; L:10
   251                          	; P:0
   252                          	; L:11
   253                          	; P:0
   254                          	; L:12
   255  011f  c33001            	jp clsGraphic_after
   256                          ; /*****************************************************************************
   257                          ;  * ugBASIC - an isomorphic BASIC language compiler for retrocomputers        *
   258                          ;  *****************************************************************************
   259                          ;  * Copyright 2021-2023 Marco Spedaletti (asimov@mclink.it)
   260                          ;  *
   261                          ;  * Licensed under the Apache License, Version 2.0 (the "License");
   262                          ;  * you may not use this file except in compliance with the License.
   263                          ;  * You may obtain a copy of the License at
   264                          ;  *
   265                          ;  * http://www.apache.org/licenses/LICENSE-2.0
   266                          ;  *
   267                          ;  * Unless required by applicable law or agreed to in writing, software
   268                          ;  * distributed under the License is distributed on an "AS IS" BASIS,
   269                          ;  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   270                          ;  * See the License for the specific language governing permissions and
   271                          ;  * limitations under the License.
   272                          ;  *----------------------------------------------------------------------------
   273                          ;  * Concesso in licenza secondo i termini della Licenza Apache, versione 2.0
   274                          ;  * (la "Licenza"); è proibito usare questo file se non in conformità alla
   275                          ;  * Licenza. Una copia della Licenza è disponibile all'indirizzo:
   276                          ;  *
   277                          ;  * http://www.apache.org/licenses/LICENSE-2.0
   278                          ;  *
   279                          ;  * Se non richiesto dalla legislazione vigente o concordato per iscritto,
   280                          ;  * il software distribuito nei termini della Licenza è distribuito
   281                          ;  * "COSì COM'è", SENZA GARANZIE O CONDIZIONI DI ALCUN TIPO, esplicite o
   282                          ;  * implicite. Consultare la Licenza per il testo specifico che regola le
   283                          ;  * autorizzazioni e le limitazioni previste dalla medesima.
   284                          ;  ****************************************************************************/
   285                          ;* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
   286                          ;*                                                                             *
   287                          ;*                      CLEAR SCREEN ROUTINE FOR CPC                           *
   288                          ;*                                                                             *
   289                          ;*                             by Marco Spedaletti                             *
   290                          ;*                                                                             *
   291                          ;* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
   292                          CLSG:
   293                          CLSX:
   294                          ; peephole(1): r215 (LD A, 0)->(XOR A)
   295                          ;    LD A, 0
   296  0122  af                	XOR A
   297  0123  2100c0            	LD HL, $C000
   298  0126  77                	LD (HL), A
   299  0127  5d                	LD E, L
   300  0128  54                	LD D, H
   301  0129  13                	INC DE
   302  012a  01ff3f            	LD BC, $3FFF
   303  012d  edb0              	LDIR
   304  012f  c9                	RET
   305                          clsGraphic_after:
   306  0130  cd2201            	CALL CLSG
   307                          	; P:14
   308                          	; L:13
   309  0133  3e0a              	LD A, $0a
   310  0135  32a709            	LD (_Ttmp0), A
   311                          ; peephole(1): r237 (LD A, x; LD (x), A; LD A, x)->(LD A, x; LD (x), A)
   312                          ;	LD A, $0a
   313  0138  32a809            	LD (_Ttmp1), A
   314  013b  3aa709            	LD A, (_Ttmp0)
   315  013e  325b09            	LD (XCURSYS), A
   316  0141  3aa809            	LD A, (_Ttmp1)
   317  0144  325c09            	LD (YCURSYS), A
   318                          	; P:8
   319                          	; L:14
   320  0147  3aa909            	LD A, (_Tstr4)
   321  014a  32a709            	LD (_Ttmp0), A
   322  014d  21a909            	LD HL, _Tstr4
   323  0150  22af09            	LD (_Ttmp6), HL
   324  0153  2aaf09            	LD HL, (_Ttmp6)
   325  0156  23                	INC HL
   326  0157  22af09            	LD (_Ttmp6), HL
   327  015a  c35d01            	jp cpcvars_after
   328                          ; /*****************************************************************************
   329                          ;  * ugBASIC - an isomorphic BASIC language compiler for retrocomputers        *
   330                          ;  *****************************************************************************
   331                          ;  * Copyright 2021-2023 Marco Spedaletti (asimov@mclink.it)
   332                          ;  *
   333                          ;  * Licensed under the Apache License, Version 2.0 (the "License");
   334                          ;  * you may not use this file except in compliance with the License.
   335                          ;  * You may obtain a copy of the License at
   336                          ;  *
   337                          ;  * http://www.apache.org/licenses/LICENSE-2.0
   338                          ;  *
   339                          ;  * Unless required by applicable law or agreed to in writing, software
   340                          ;  * distributed under the License is distributed on an "AS IS" BASIS,
   341                          ;  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   342                          ;  * See the License for the specific language governing permissions and
   343                          ;  * limitations under the License.
   344                          ;  *----------------------------------------------------------------------------
   345                          ;  * Concesso in licenza secondo i termini della Licenza Apache, versione 2.0
   346                          ;  * (la "Licenza"); è proibito usare questo file se non in conformità alla
   347                          ;  * Licenza. Una copia della Licenza è disponibile all'indirizzo:
   348                          ;  *
   349                          ;  * http://www.apache.org/licenses/LICENSE-2.0
   350                          ;  *
   351                          ;  * Se non richiesto dalla legislazione vigente o concordato per iscritto,
   352                          ;  * il software distribuito nei termini della Licenza è distribuito
   353                          ;  * "COSì COM'è", SENZA GARANZIE O CONDIZIONI DI ALCUN TIPO, esplicite o
   354                          ;  * implicite. Consultare la Licenza per il testo specifico che regola le
   355                          ;  * autorizzazioni e le limitazioni previste dalla medesima.
   356                          ;  ****************************************************************************/
   357                          ;* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
   358                          ;*                                                                             *
   359                          ;*                          INTERNAL VARIABLES FOR CPC                         *
   360                          ;*                                                                             *
   361                          ;*                             by Marco Spedaletti                             *
   362                          ;*                                                                             *
   363                          ;* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
   364                          cpcvars_after:
   365  015d  c3a701            	jp vScrollTextUp_after
   366                          ; /*****************************************************************************
   367                          ;  * ugBASIC - an isomorphic BASIC language compiler for retrocomputers        *
   368                          ;  *****************************************************************************
   369                          ;  * Copyright 2021-2023 Marco Spedaletti (asimov@mclink.it)
   370                          ;  *
   371                          ;  * Licensed under the Apache License, Version 2.0 (the "License");
   372                          ;  * you may not use this file except in compliance with the License.
   373                          ;  * You may obtain a copy of the License at
   374                          ;  *
   375                          ;  * http://www.apache.org/licenses/LICENSE-2.0
   376                          ;  *
   377                          ;  * Unless required by applicable law or agreed to in writing, software
   378                          ;  * distributed under the License is distributed on an "AS IS" BASIS,
   379                          ;  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   380                          ;  * See the License for the specific language governing permissions and
   381                          ;  * limitations under the License.
   382                          ;  *----------------------------------------------------------------------------
   383                          ;  * Concesso in licenza secondo i termini della Licenza Apache, versione 2.0
   384                          ;  * (la "Licenza"); è proibito usare questo file se non in conformità alla
   385                          ;  * Licenza. Una copia della Licenza è disponibile all'indirizzo:
   386                          ;  *
   387                          ;  * http://www.apache.org/licenses/LICENSE-2.0
   388                          ;  *
   389                          ;  * Se non richiesto dalla legislazione vigente o concordato per iscritto,
   390                          ;  * il software distribuito nei termini della Licenza è distribuito
   391                          ;  * "COSì COM'è", SENZA GARANZIE O CONDIZIONI DI ALCUN TIPO, esplicite o
   392                          ;  * implicite. Consultare la Licenza per il testo specifico che regola le
   393                          ;  * autorizzazioni e le limitazioni previste dalla medesima.
   394                          ;  ****************************************************************************/
   395                          ;* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
   396                          ;*                                                                             *
   397                          ;*                          VERTICAL SCROLL ON CPC                             *
   398                          ;*                                                                             *
   399                          ;*                             by Marco Spedaletti                             *
   400                          ;*                                                                             *
   401                          ;* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
   402                          VSCROLLTUP:
   403  0160  01c000            	LD BC, 192
   404  0163  21b201            	LD HL, PLOTVBASE
   405                          VSCROLLTUPL1:
   406  0166  c5                	PUSH BC
   407  0167  e5                	PUSH HL
   408  0168  7e                	LD A, (HL)
   409  0169  5f                	LD E, A
   410  016a  23                	INC HL
   411  016b  7e                	LD A, (HL)
   412  016c  57                	LD D, A
   413  016d  23                	INC HL
   414  016e  d5110e0019d1      	ADD HL, 14
   415  0174  7e                	LD A, (HL)
   416  0175  4f                	LD C, A
   417  0176  23                	INC HL
   418  0177  7e                	LD A, (HL)
   419  0178  47                	LD B, A
   420  0179  6069              	LD HL, BC
   421  017b  015000            	LD BC, $50
   422  017e  edb0              	LDIR
   423  0180  e1                	POP HL
   424  0181  c1                	POP BC
   425  0182  23                	INC HL
   426  0183  23                	INC HL
   427  0184  0d                	DEC C
   428  0185  c26601            	JP NZ, VSCROLLTUPL1
   429  0188  010800            	LD BC, 8
   430                          VSCROLLTUPL2:
   431  018b  c5                	PUSH BC
   432  018c  e5                	PUSH HL
   433  018d  7e                	LD A, (HL)
   434  018e  4f                	LD C, A
   435  018f  23                	INC HL
   436  0190  7e                	LD A, (HL)
   437  0191  47                	LD B, A
   438  0192  6069              	LD HL, BC
   439                          ; peephole(1): r215 (LD A, 0)->(XOR A)
   440                          ;    LD A, 0
   441  0194  af                	XOR A
   442  0195  77                	LD (HL), A
   443  0196  5d                	LD E, L
   444  0197  54                	LD D, H
   445  0198  13                	INC DE
   446  0199  015000            	LD BC, $0050
   447  019c  edb0              	LDIR
   448  019e  e1                	POP HL
   449  019f  c1                	POP BC
   450  01a0  23                	INC HL
   451  01a1  23                	INC HL
   452  01a2  0d                	DEC C
   453  01a3  c28b01            	JP NZ, VSCROLLTUPL2
   454  01a6  c9                	RET
   455                          vScrollTextUp_after:
   456  01a7  ed5baf09          	LD DE, (_Ttmp6)
   457  01ab  3aa709            	LD A, (_Ttmp0)
   458  01ae  4f                	LD C, A
   459  01af  c3eb04            	jp cpcvarsGraphic_after
   460                          ; /*****************************************************************************
   461                          ;  * ugBASIC - an isomorphic BASIC language compiler for retrocomputers        *
   462                          ;  *****************************************************************************
   463                          ;  * Copyright 2021-2023 Marco Spedaletti (asimov@mclink.it)
   464                          ;  *
   465                          ;  * Licensed under the Apache License, Version 2.0 (the "License");
   466                          ;  * you may not use this file except in compliance with the License.
   467                          ;  * You may obtain a copy of the License at
   468                          ;  *
   469                          ;  * http://www.apache.org/licenses/LICENSE-2.0
   470                          ;  *
   471                          ;  * Unless required by applicable law or agreed to in writing, software
   472                          ;  * distributed under the License is distributed on an "AS IS" BASIS,
   473                          ;  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   474                          ;  * See the License for the specific language governing permissions and
   475                          ;  * limitations under the License.
   476                          ;  *----------------------------------------------------------------------------
   477                          ;  * Concesso in licenza secondo i termini della Licenza Apache, versione 2.0
   478                          ;  * (la "Licenza"); è proibito usare questo file se non in conformità alla
   479                          ;  * Licenza. Una copia della Licenza è disponibile all'indirizzo:
   480                          ;  *
   481                          ;  * http://www.apache.org/licenses/LICENSE-2.0
   482                          ;  *
   483                          ;  * Se non richiesto dalla legislazione vigente o concordato per iscritto,
   484                          ;  * il software distribuito nei termini della Licenza è distribuito
   485                          ;  * "COSì COM'è", SENZA GARANZIE O CONDIZIONI DI ALCUN TIPO, esplicite o
   486                          ;  * implicite. Consultare la Licenza per il testo specifico che regola le
   487                          ;  * autorizzazioni e le limitazioni previste dalla medesima.
   488                          ;  ****************************************************************************/
   489                          ;* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
   490                          ;*                                                                             *
   491                          ;*                          INTERNAL VARIABLES FOR CPC                         *
   492                          ;*                                                                             *
   493                          ;*                             by Marco Spedaletti                             *
   494                          ;*                                                                             *
   495                          ;* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
   496                          PLOTVBASE:
   497  01b2  00c000c800d000d8  	DW $C000, $C800, $D000, $D800, $E000, $E800, $F000, $F800
              00e000e800f000f8  
   498  01c2  50c050c850d050d8  	DW $C050, $C850, $D050, $D850, $E050, $E850, $F050, $F850
              50e050e850f050f8  
   499  01d2  a0c0a0c8a0d0a0d8  	DW $C0A0, $C8A0, $D0A0, $D8A0, $E0A0, $E8A0, $F0A0, $F8A0
              a0e0a0e8a0f0a0f8  
   500  01e2  f0c0f0c8f0d0f0d8  	DW $C0F0, $C8F0, $D0F0, $D8F0, $E0F0, $E8F0, $F0F0, $F8F0
              f0e0f0e8f0f0f0f8  
   501  01f2  40c140c940d140d9  	DW $C140, $C940, $D140, $D940, $E140, $E940, $F140, $F940
              40e140e940f140f9  
   502  0202  90c190c990d190d9  	DW $C190, $C990, $D190, $D990, $E190, $E990, $F190, $F990
              90e190e990f190f9  
   503  0212  e0c1e0c9e0d1e0d9  	DW $C1E0, $C9E0, $D1E0, $D9E0, $E1E0, $E9E0, $F1E0, $F9E0
              e0e1e0e9e0f1e0f9  
   504  0222  30c230ca30d230da  	DW $C230, $CA30, $D230, $DA30, $E230, $EA30, $F230, $FA30
              30e230ea30f230fa  
   505  0232  80c280ca80d280da  	DW $C280, $CA80, $D280, $DA80, $E280, $EA80, $F280, $FA80
              80e280ea80f280fa  
   506  0242  d0c2d0cad0d2d0da  	DW $C2D0, $CAD0, $D2D0, $DAD0, $E2D0, $EAD0, $F2D0, $FAD0
              d0e2d0ead0f2d0fa  
   507  0252  20c320cb20d320db  	DW $C320, $CB20, $D320, $DB20, $E320, $EB20, $F320, $FB20
              20e320eb20f320fb  
   508  0262  70c370cb70d370db  	DW $C370, $CB70, $D370, $DB70, $E370, $EB70, $F370, $FB70
              70e370eb70f370fb  
   509  0272  c0c3c0cbc0d3c0db  	DW $C3C0, $CBC0, $D3C0, $DBC0, $E3C0, $EBC0, $F3C0, $FBC0
              c0e3c0ebc0f3c0fb  
   510  0282  10c410cc10d410dc  	DW $C410, $CC10, $D410, $DC10, $E410, $EC10, $F410, $FC10
              10e410ec10f410fc  
   511  0292  60c460cc60d460dc  	DW $C460, $CC60, $D460, $DC60, $E460, $EC60, $F460, $FC60
              60e460ec60f460fc  
   512  02a2  b0c4b0ccb0d4b0dc  	DW $C4B0, $CCB0, $D4B0, $DCB0, $E4B0, $ECB0, $F4B0, $FCB0
              b0e4b0ecb0f4b0fc  
   513  02b2  00c500cd00d500dd  	DW $C500, $CD00, $D500, $DD00, $E500, $ED00, $F500, $FD00
              00e500ed00f500fd  
   514  02c2  50c550cd50d550dd  	DW $C550, $CD50, $D550, $DD50, $E550, $ED50, $F550, $FD50
              50e550ed50f550fd  
   515  02d2  a0c5a0cda0d5a0dd  	DW $C5A0, $CDA0, $D5A0, $DDA0, $E5A0, $EDA0, $F5A0, $FDA0
              a0e5a0eda0f5a0fd  
   516  02e2  f0c5f0cdf0d5f0dd  	DW $C5F0, $CDF0, $D5F0, $DDF0, $E5F0, $EDF0, $F5F0, $FDF0
              f0e5f0edf0f5f0fd  
   517  02f2  40c640ce40d640de  	DW $C640, $CE40, $D640, $DE40, $E640, $EE40, $F640, $FE40
              40e640ee40f640fe  
   518  0302  90c690ce90d690de  	DW $C690, $CE90, $D690, $DE90, $E690, $EE90, $F690, $FE90
              90e690ee90f690fe  
   519  0312  e0c6e0cee0d6e0de  	DW $C6E0, $CEE0, $D6E0, $DEE0, $E6E0, $EEE0, $F6E0, $FEE0
              e0e6e0eee0f6e0fe  
   520  0322  30c730cf30d730df  	DW $C730, $CF30, $D730, $DF30, $E730, $EF30, $F730, $FF30
              30e730ef30f730ff  
   521  0332  80c780cf80d780df  	DW $C780, $CF80, $D780, $DF80, $E780, $EF80, $F780, $FF80
              80e780ef80f780ff  
   522                          ; Look for a specific color into the palette.
   523                          ;   input: IXL = color to look for
   524                          ;   output: IXH = index of ink, $FF if not found
   525                          CPCLOOKFORPALETTE:
   526  0342  c5                	PUSH BC
   527  0343  e5                	PUSH HL
   528  0344  f5                	PUSH AF
   529  0345  d5                	PUSH DE
   530  0346  210300            	LD HL, PALETTE
   531                          ; peephole(1): r215 (LD A, 0)->(XOR A)
   532                          ;    LD A, 0
   533  0349  af                	XOR A
   534  034a  4f                	LD C, A
   535  034b  dd7d              	LD A, IXL
   536  034d  47                	LD B, A
   537  034e  0c                	INC C
   538  034f  23                	INC HL
   539                          CPCLOOKFORPALETTEL1:
   540  0350  7e                	LD A, (HL)
   541  0351  b8                	CP B
   542  0352  280f              	JR Z, CPCLOOKFORPALETTEFOUND
   543  0354  23                	INC HL
   544  0355  0c                	INC C
   545  0356  3a5009            	LD A, (PALETTELIMIT)
   546  0359  5f                	LD E, A
   547  035a  79                	LD A, C
   548  035b  bb                	CP E
   549  035c  38f2              	JR C, CPCLOOKFORPALETTEL1
   550  035e  20f0              	JR NZ, CPCLOOKFORPALETTEL1
   551  0360  3eff              	LD A, $FF
   552  0362  4f                	LD C, A
   553                          CPCLOOKFORPALETTEFOUND:
   554  0363  d1                	POP DE
   555  0364  f1                	POP AF
   556  0365  e1                	POP HL
   557  0366  79                	LD A, C
   558  0367  dd67              	LD IXH, A
   559  0369  c1                	POP BC
   560  036a  c9                	RET
   561                          ; Insert a specific color into the palette.
   562                          ;   input: IXL = color to insert
   563                          ;   output: IXH = index of ink allocated
   564                          CPCINSERTPALETTE:
   565  036b  c5                	PUSH BC
   566  036c  e5                	PUSH HL
   567  036d  d5                	PUSH DE
   568  036e  f5                	PUSH AF
   569  036f  dd7d              	LD A, IXL
   570  0371  feff              	CP $FF
   571  0373  2828              	JR Z, CPCINSERTPALETTEDONE
   572  0375  3a5009            	LD A, (PALETTELIMIT)
   573  0378  47                	LD B, A
   574  0379  3a1300            	LD A, (PALETTEUNUSED)
   575  037c  3c                	INC A
   576  037d  b8                	CP B
   577  037e  3802              	JR C, CPCINSERTPALETTEUNDER
   578  0380  3e01              	LD A, 1
   579                          CPCINSERTPALETTEUNDER:
   580  0382  321300            	LD (PALETTEUNUSED), A
   581  0385  dd67              	LD IXH, A
   582  0387  3a1300            	LD A, (PALETTEUNUSED)
   583  038a  210300            	LD HL, PALETTE
   584  038d  5f                	LD E, A
   585                          ; peephole(1): r215 (LD A, 0)->(XOR A)
   586                          ;    LD A, 0
   587  038e  af                	XOR A
   588  038f  57                	LD D, A
   589  0390  19                	ADD HL, DE
   590  0391  dd7d              	LD A, IXL
   591  0393  77                	LD (HL), A
   592  0394  fd7d              	LD A, IYL
   593  0396  fe00              	CP $0
   594  0398  2803              	JR Z, CPCINSERTPALETTEDONE
   595  039a  cd1400            	CALL SETHWPALETTE
   596                          CPCINSERTPALETTEDONE:
   597  039d  f1                	POP AF
   598  039e  d1                	POP DE
   599  039f  e1                	POP HL
   600  03a0  c1                	POP BC
   601  03a1  c9                	RET
   602                          ; Update a specific color into the palette.
   603                          ;   input:
   604                          ;           IXH = index of ink to update
   605                          ;           IXL = color to update
   606                          ;           IYL > 0 update ink on GATE ARRAY, also
   607                          CPCUPDATEPALETTE:
   608  03a2  f5                	PUSH AF
   609  03a3  e5                	PUSH HL
   610  03a4  d5                	PUSH DE
   611  03a5  dd7d              	LD A, IXL
   612  03a7  feff              	CP $FF
   613  03a9  2814              	JR Z, CPCUPDATEPALETTEDONE
   614  03ab  dd5c              	LD E, IXH
   615                          ; peephole(1): r215 (LD A, 0)->(XOR A)
   616                          ;    LD A, 0
   617  03ad  af                	XOR A
   618  03ae  57                	LD D, A
   619  03af  210300            	LD HL, PALETTE
   620  03b2  19                	ADD HL, DE
   621  03b3  dd7d              	LD A, IXL
   622  03b5  77                	LD (HL), A
   623  03b6  fd7d              	LD A, IYL
   624  03b8  fe00              	CP $0
   625  03ba  2803              	JR Z, CPCUPDATEPALETTEDONE
   626  03bc  cd1400            	CALL SETHWPALETTE
   627                          CPCUPDATEPALETTEDONE:
   628  03bf  d1                	POP DE
   629  03c0  e1                	POP HL
   630  03c1  f1                	POP AF
   631  03c2  c9                	RET
   632                          ; Get a specific color from the palette.
   633                          ;   input:
   634                          ;           IXH = index of ink
   635                          ;   output:
   636                          ;           IXL = color
   637                          CPCGETPALETTE:
   638  03c3  f5                	PUSH AF
   639  03c4  e5                	PUSH HL
   640  03c5  d5                	PUSH DE
   641  03c6  dd5c              	LD E, IXH
   642                          ; peephole(1): r215 (LD A, 0)->(XOR A)
   643                          ;    LD A, 0
   644  03c8  af                	XOR A
   645  03c9  57                	LD D, A
   646  03ca  210300            	LD HL, PALETTE
   647  03cd  19                	ADD HL, DE
   648  03ce  7e                	LD A, (HL)
   649  03cf  dd6f              	LD IXL, A
   650  03d1  d1                	POP DE
   651  03d2  e1                	POP HL
   652  03d3  f1                	POP AF
   653  03d4  c9                	RET
   654                          ; Look for a specific color into the palette and, if missing,
   655                          ; insert it into palette.
   656                          ;   input:
   657                          ;           IXL = color to look for / insert
   658                          ;           IYL > 0 update ink on GATE ARRAY, also
   659                          ;   output:
   660                          ;           IXH = index of ink
   661                          CPCSELECTPALETTE:
   662  03d5  cd4203            	CALL CPCLOOKFORPALETTE
   663  03d8  dd7c              	LD A, IXH
   664  03da  feff              	CP $FF
   665  03dc  c0                	RET NZ
   666                          ; peephole(1): r369 (CALL+RET)->(JP)
   667                          ;    CALL CPCINSERTPALETTE
   668  03dd  c36b03            	JP CPCINSERTPALETTE
   669                          ;    RET
   670                          ; CPCVIDEOMUL8:
   671                          ;     PUSH HL
   672                          ;     PUSH DE
   673                          ;     PUSH BC
   674                          ;     LD E, A
   675                          ;     LD A, B
   676                          ;     LD H, A
   677                          ;     LD D,0
   678                          ;     LD L,D
   679                          ;     LD B,8
   680                          ; CPCVIDEOMUL8L1:
   681                          ;     ADD HL, HL
   682                          ;     JR NC, CPCVIDEOMUL8L1A
   683                          ;     ADD HL, DE
   684                          ; CPCVIDEOMUL8L1A:
   685                          ;     DJNZ CPCVIDEOMUL8L1
   686                          ;     LD A, L
   687                          ;     POP BC
   688                          ;     POP DE
   689                          ;     POP HL
   690                          ;     RET
   691                          CPCVIDEOMUL82:
   692  03e0  e5                	PUSH HL
   693  03e1  c5                	PUSH BC
   694  03e2  f5                	PUSH AF
   695  03e3  78                	LD A, B
   696  03e4  e602              	AND $2
   697  03e6  fe00              	CP $0
   698  03e8  2809              	JR Z, CPCVIDEOMUL82L0
   699                          CPCVIDEOMUL82L1:
   700  03ea  f1                	POP AF
   701  03eb  f5                	PUSH AF
   702  03ec  e60f              	AND $F
   703  03ee  6f                	LD L, A
   704  03ef  f1                	POP AF
   705  03f0  c3f603            	JP CPCVIDEOMUL82H
   706                          CPCVIDEOMUL82L0:
   707                          ; peephole(1): r215 (LD A, 0)->(XOR A)
   708                          ;    LD A, 0
   709  03f3  af                	XOR A
   710  03f4  6f                	LD L, A
   711  03f5  f1                	POP AF
   712                          CPCVIDEOMUL82H:
   713  03f6  f5                	PUSH AF
   714  03f7  78                	LD A, B
   715  03f8  e601              	AND $1
   716  03fa  fe00              	CP $0
   717  03fc  280f              	JR Z, CPCVIDEOMUL82H0
   718                          CPCVIDEOMUL82H1:
   719  03fe  f1                	POP AF
   720  03ff  f5                	PUSH AF
   721  0400  cb27              	SLA A
   722  0402  cb27              	SLA A
   723  0404  cb27              	SLA A
   724  0406  cb27              	SLA A
   725  0408  67                	LD H, A
   726  0409  f1                	POP AF
   727  040a  c31004            	JP CPCVIDEOMUL82E
   728                          CPCVIDEOMUL82H0:
   729                          ; peephole(1): r215 (LD A, 0)->(XOR A)
   730                          ;    LD A, 0
   731  040d  af                	XOR A
   732  040e  67                	LD H, A
   733  040f  f1                	POP AF
   734                          CPCVIDEOMUL82E:
   735  0410  c1                	POP BC
   736  0411  7c                	LD A, H
   737  0412  b5                	OR L
   738  0413  e1                	POP HL
   739  0414  c9                	RET
   740                          CPCVIDEOMUL84:
   741  0415  e5                	PUSH HL
   742  0416  c5                	PUSH BC
   743  0417  f5                	PUSH AF
   744  0418  78                	LD A, B
   745  0419  e601              	AND $1
   746  041b  fe00              	CP $0
   747  041d  2815              	JR Z, CPCVIDEOMUL84L0
   748                          CPCVIDEOMUL84L1:
   749  041f  f1                	POP AF
   750  0420  f5                	PUSH AF
   751  0421  e603              	AND $3
   752  0423  cb27              	SLA A
   753  0425  cb27              	SLA A
   754  0427  cb27              	SLA A
   755  0429  cb27              	SLA A
   756  042b  cb27              	SLA A
   757  042d  cb27              	SLA A
   758  042f  6f                	LD L, A
   759  0430  f1                	POP AF
   760  0431  c33704            	JP CPCVIDEOMUL84H
   761                          CPCVIDEOMUL84L0:
   762                          ; peephole(1): r215 (LD A, 0)->(XOR A)
   763                          ;    LD A, 0
   764  0434  af                	XOR A
   765  0435  6f                	LD L, A
   766  0436  f1                	POP AF
   767                          CPCVIDEOMUL84H:
   768  0437  f5                	PUSH AF
   769  0438  78                	LD A, B
   770  0439  e602              	AND $2
   771  043b  fe00              	CP $0
   772  043d  280e              	JR Z, CPCVIDEOMUL84H0
   773                          CPCVIDEOMUL84H1:
   774  043f  f1                	POP AF
   775  0440  f5                	PUSH AF
   776  0441  e603              	AND $3
   777  0443  cb27              	SLA A
   778  0445  cb27              	SLA A
   779  0447  b5                	OR L
   780  0448  6f                	LD L, A
   781  0449  f1                	POP AF
   782  044a  c34e04            	JP CPCVIDEOMUL84I
   783                          CPCVIDEOMUL84H0:
   784  044d  f1                	POP AF
   785                          CPCVIDEOMUL84I:
   786  044e  f5                	PUSH AF
   787  044f  78                	LD A, B
   788  0450  e604              	AND $4
   789  0452  fe00              	CP $0
   790  0454  2812              	JR Z, CPCVIDEOMUL84I0
   791                          CPCVIDEOMUL84I1:
   792  0456  f1                	POP AF
   793  0457  f5                	PUSH AF
   794  0458  e603              	AND $3
   795  045a  cb27              	SLA A
   796  045c  cb27              	SLA A
   797  045e  cb27              	SLA A
   798  0460  cb27              	SLA A
   799  0462  b5                	OR L
   800  0463  6f                	LD L, A
   801  0464  f1                	POP AF
   802  0465  c36904            	JP CPCVIDEOMUL84J
   803                          CPCVIDEOMUL84I0:
   804  0468  f1                	POP AF
   805                          CPCVIDEOMUL84J:
   806  0469  f5                	PUSH AF
   807  046a  78                	LD A, B
   808  046b  e608              	AND $8
   809  046d  fe00              	CP $0
   810  046f  280a              	JR Z, CPCVIDEOMUL84J0
   811                          CPCVIDEOMUL84J1:
   812  0471  f1                	POP AF
   813  0472  f5                	PUSH AF
   814  0473  e603              	AND $3
   815  0475  b5                	OR L
   816  0476  6f                	LD L, A
   817  0477  f1                	POP AF
   818  0478  c37c04            	JP CPCVIDEOMUL84K
   819                          CPCVIDEOMUL84J0:
   820  047b  f1                	POP AF
   821                          CPCVIDEOMUL84K:
   822  047c  c1                	POP BC
   823  047d  7d                	LD A, L
   824  047e  e1                	POP HL
   825  047f  c9                	RET
   826                          CPCVIDEOPOS:
   827  0480  d5                	PUSH DE
   828  0481  21b201            	LD HL, PLOTVBASE
   829  0484  5a                	LD E, D
   830  0485  1600              	LD D, 0
   831  0487  19                	ADD HL, DE
   832  0488  19                	ADD HL, DE
   833  0489  7e                	LD A, (HL)
   834  048a  5f                	LD E, A
   835  048b  23                	INC HL
   836  048c  7e                	LD A, (HL)
   837  048d  57                	LD D, A
   838  048e  626b              	LD HL, DE
   839  0490  d1                	POP DE
   840  0491  3a6109            	LD A, (CURRENTMODE)
   841  0494  fe00              	CP 0
   842  0496  280d              	JR Z, CPCVIDEOPOS0
   843  0498  fe01              	CP 1
   844  049a  2811              	JR Z, CPCVIDEOPOS1
   845  049c  fe02              	CP 2
   846  049e  281c              	JR Z, CPCVIDEOPOS2
   847  04a0  fe03              	CP 3
   848  04a2  2809              	JR Z, CPCVIDEOPOS3
   849  04a4  c9                	RET
   850                          CPCVIDEOPOS0:
   851  04a5  d5                	PUSH DE
   852  04a6  cb3b              	SRL E
   853                          ; peephole(1): r215 (LD A, 0)->(XOR A)
   854                          ;    LD A, 0
   855  04a8  af                	XOR A
   856  04a9  57                	LD D, A
   857  04aa  19                	ADD HL, DE
   858  04ab  d1                	POP DE
   859  04ac  c9                	RET
   860                          CPCVIDEOPOS1:
   861                          CPCVIDEOPOS3:
   862  04ad  d5                	PUSH DE
   863  04ae  dd7d              	LD A, IXL
   864  04b0  57                	LD D, A
   865  04b1  cb3a              	SRL D
   866  04b3  cb1b              	RR E
   867  04b5  cb3a              	SRL D
   868  04b7  cb1b              	RR E
   869  04b9  19                	ADD HL, DE
   870  04ba  d1                	POP DE
   871  04bb  c9                	RET
   872                          CPCVIDEOPOS2:
   873  04bc  d5                	PUSH DE
   874  04bd  dd7d              	LD A, IXL
   875  04bf  57                	LD D, A
   876  04c0  cb3a              	SRL D
   877  04c2  cb1b              	RR E
   878  04c4  cb3a              	SRL D
   879  04c6  cb1b              	RR E
   880  04c8  cb3a              	SRL D
   881  04ca  cb1b              	RR E
   882  04cc  19                	ADD HL, DE
   883  04cd  d1                	POP DE
   884  04ce  c9                	RET
   885                          CPCVIDEOBITMASK1:
   886  04cf  00112233          	DB $00,$11,$22,$33
   887  04d3  44556677          	DB $44,$55,$66,$77
   888  04d7  8899aabb          	DB $88,$99,$aa,$bb
   889  04db  ccddeeff          	DB $cc,$dd,$ee,$ff
   890                          CPCVIDEOBITMASK2:
   891  04df  88442211          	DB $88,$44,$22,$11
   892                          CPCVIDEOBITMASK4:
   893  04e3  80402010          	DB $80,$40,$20,$10
   894  04e7  08040201          	DB $08,$04,$02,$01
   895                          cpcvarsGraphic_after:
   896  04eb  c3d807            	jp textEncodedAtGraphic_after
   897                          ; /*****************************************************************************
   898                          ;  * ugBASIC - an isomorphic BASIC language compiler for retrocomputers        *
   899                          ;  *****************************************************************************
   900                          ;  * Copyright 2021-2023 Marco Spedaletti (asimov@mclink.it)
   901                          ;  *
   902                          ;  * Licensed under the Apache License, Version 2.0 (the "License");
   903                          ;  * you may not use this file except in compliance with the License.
   904                          ;  * You may obtain a copy of the License at
   905                          ;  *
   906                          ;  * http://www.apache.org/licenses/LICENSE-2.0
   907                          ;  *
   908                          ;  * Unless required by applicable law or agreed to in writing, software
   909                          ;  * distributed under the License is distributed on an "AS IS" BASIS,
   910                          ;  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   911                          ;  * See the License for the specific language governing permissions and
   912                          ;  * limitations under the License.
   913                          ;  *----------------------------------------------------------------------------
   914                          ;  * Concesso in licenza secondo i termini della Licenza Apache, versione 2.0
   915                          ;  * (la "Licenza"); è proibito usare questo file se non in conformità alla
   916                          ;  * Licenza. Una copia della Licenza è disponibile all'indirizzo:
   917                          ;  *
   918                          ;  * http://www.apache.org/licenses/LICENSE-2.0
   919                          ;  *
   920                          ;  * Se non richiesto dalla legislazione vigente o concordato per iscritto,
   921                          ;  * il software distribuito nei termini della Licenza è distribuito
   922                          ;  * "COSì COM'è", SENZA GARANZIE O CONDIZIONI DI ALCUN TIPO, esplicite o
   923                          ;  * implicite. Consultare la Licenza per il testo specifico che regola le
   924                          ;  * autorizzazioni e le limitazioni previste dalla medesima.
   925                          ;  ****************************************************************************/
   926                          ;* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
   927                          ;*                                                                             *
   928                          ;*                      TEXT AT GIVEN POSITION ON CPC                         *
   929                          ;*                                                                             *
   930                          ;*                             by Marco Spedaletti                             *
   931                          ;*                                                                             *
   932                          ;* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
   933                          TEXTATDECODE:
   934  04ee  fe7a              	CP 122
   935  04f0  3009              	JR NC, TEXTATDECODEX1F
   936  04f2  fe61              	CP 97
   937  04f4  3805              	JR C, TEXTATDECODEX1F
   938  04f6  d660              	SUB 96
   939  04f8  c3fb04            	JP TEXTATDECODE0
   940                          TEXTATDECODEX1F:
   941                          TEXTATDECODE0:
   942  04fb  c9                	RET
   943                          TEXTATPIXPOS:
   944  04fc  f5                	PUSH AF
   945  04fd  d5                	PUSH DE
   946  04fe  e5                	PUSH HL
   947  04ff  21b201            	LD HL, PLOTVBASE
   948  0502  3a5c09            	LD A, (YCURSYS)
   949  0505  fe00              	CP 0
   950  0507  2815              	JR Z, TEXTATPIXPOSSKIPY
   951  0509  5f                	LD E, A
   952  050a  3e00              	LD A, $0
   953  050c  57                	LD D, A
   954  050d  cb23              	SLA E
   955  050f  cb12              	RL D
   956  0511  cb23              	SLA E
   957  0513  cb12              	RL D
   958  0515  cb23              	SLA E
   959  0517  cb12              	RL D
   960  0519  cb23              	SLA E
   961  051b  cb12              	RL D
   962  051d  19                	ADD HL, DE
   963                          TEXTATPIXPOSSKIPY:
   964  051e  7e                	LD A, (HL)
   965  051f  324009            	LD (COPYOFTEXTADDRESS), A
   966  0522  23                	INC HL
   967  0523  7e                	LD A, (HL)
   968  0524  324109            	LD (COPYOFTEXTADDRESS+1), A
   969  0527  2a4009            	LD HL, (COPYOFTEXTADDRESS)
   970  052a  3a5b09            	LD A, (XCURSYS)
   971  052d  5f                	LD E, A
   972                          ; peephole(1): r215 (LD A, 0)->(XOR A)
   973                          ;    LD A, 0
   974  052e  af                	XOR A
   975  052f  1600              	LD D, 0
   976                              ; PUSH HL
   977                              ; LD HL, DE
   978                              ; ADD HL, HL
   979                              ; ADD HL, HL
   980                              ; ADD HL, HL
   981                              ; LD DE, HL
   982                              ; POP HL
   983  0531  3a6109            	LD A, (CURRENTMODE)
   984  0534  fe00              	CP 0
   985  0536  ca4b05            	JP Z, TEXTATPIXPOSSKIPY0
   986  0539  fe01              	CP 1
   987  053b  ca4d05            	JP Z, TEXTATPIXPOSSKIPY1
   988  053e  fe02              	CP 2
   989  0540  ca4e05            	JP Z, TEXTATPIXPOSSKIPY2
   990  0543  fe03              	CP 3
   991  0545  ca4b05            	JP Z, TEXTATPIXPOSSKIPY3
   992  0548  c34e05            	JP TEXTATPIXPOSSKIPY2
   993                          TEXTATPIXPOSSKIPY0:
   994                          TEXTATPIXPOSSKIPY3:
   995  054b  19                	ADD HL, DE
   996  054c  19                	ADD HL, DE
   997                          TEXTATPIXPOSSKIPY1:
   998  054d  19                	ADD HL, DE
   999                          TEXTATPIXPOSSKIPY2:
  1000  054e  19                	ADD HL, DE
  1001  054f  224009            	LD (COPYOFTEXTADDRESS), HL
  1002  0552  e1                	POP HL
  1003  0553  d1                	POP DE
  1004  0554  f1                	POP AF
  1005  0555  c9                	RET
  1006                          TEXTATBITMAPMODE:
  1007  0556  79                	LD A, C
  1008  0557  fe00              	CP 0
  1009  0559  2003              	JR NZ,TEXTATBITMAPMODEGO
  1010  055b  c3d707            	JP TEXTATBITMAPMODEDONE
  1011                          TEXTATBITMAPMODEGO:
  1012                          TEXTATBMSKIP:
  1013                          
  1014                          TEXTATBMLOOP2:
  1015  055e  3a6009            	LD A, (TABSTODRAW)
  1016  0561  fe00              	CP 0
  1017  0563  2803              	JR Z,TEXTATBMNSKIPTAB
  1018  0565  c35807            	JP TEXTATBMSKIPTAB
  1019                          TEXTATBMNSKIPTAB:
  1020  0568  1a                	LD A, (DE)
  1021  0569  fe1f              	CP 31
  1022  056b  381c              	JR C,TEXTATBMCC
  1023                          TEXTATBMXCC:
  1024  056d  c35606            	JP TEXTATBMSP0
  1025                          TEXTATBMTAB:
  1026  0570  3a5d09            	LD A, (TABCOUNT)
  1027  0573  47                	LD B, A
  1028  0574  3a5b09            	LD A, (XCURSYS)
  1029                          TEXTATBMTAB2:
  1030  0577  b8                	CP B
  1031  0578  3804              	JR C, TEXTATBMTAB3
  1032  057a  90                	SUB A, B
  1033  057b  c37705            	JP TEXTATBMTAB2
  1034                          TEXTATBMTAB3:
  1035  057e  47                	LD B, A
  1036  057f  3a5d09            	LD A, (TABCOUNT)
  1037  0582  90                	SUB A, B
  1038  0583  326009            	LD (TABSTODRAW), A
  1039  0586  c3c407            	JP TEXTATBMNEXT
  1040                          TEXTATBMCC:
  1041  0589  fe0d              	CP 13
  1042  058b  282e              	JR Z, TEXTATBMLF
  1043  058d  fe0a              	CP 10
  1044  058f  282a              	JR Z, TEXTATBMLF
  1045  0591  fe09              	CP 9
  1046  0593  28db              	JR Z, TEXTATBMTAB
  1047  0595  fe01              	CP 1
  1048  0597  282d              	JR Z, TEXTATBMPEN
  1049  0599  fe02              	CP 2
  1050  059b  283f              	JR Z, TEXTATBMPAPER
  1051  059d  fe03              	CP 3
  1052  059f  2849              	JR Z, TEXTATBMCMOVEPREPARE
  1053  05a1  fe04              	CP 4
  1054  05a3  281e              	JR Z, TEXTATBMXAT
  1055  05a5  fe05              	CP 5
  1056  05a7  2803              	JR Z, TEXTATBMCLS
  1057  05a9  c3c407            	JP TEXTATBMNEXT
  1058                          TEXTATBMCLS:
  1059  05ac  13                	INC DE
  1060  05ad  f5                	PUSH AF
  1061  05ae  d5                	PUSH DE
  1062  05af  e5                	PUSH HL
  1063  05b0  c5                	PUSH BC
  1064  05b1  cd2201            	CALL CLSG
  1065  05b4  c1                	POP BC
  1066  05b5  e1                	POP HL
  1067  05b6  d1                	POP DE
  1068  05b7  f1                	POP AF
  1069  05b8  c3c407            	JP TEXTATBMNEXT
  1070                          TEXTATBMLF:
  1071  05bb  13                	INC DE
  1072                          ; peephole(1): r215 (LD A, 0)->(XOR A)
  1073                          ;    LD A, 0
  1074  05bc  af                	XOR A
  1075  05bd  325b09            	LD (XCURSYS), A
  1076  05c0  c38207            	JP TEXTATBMNEXT2
  1077                          TEXTATBMXAT:
  1078  05c3  c33d06            	JP TEXTATBMAT
  1079                          TEXTATBMPEN:
  1080  05c6  13                	INC DE
  1081  05c7  0d                	DEC C
  1082  05c8  3a9f09            	LD A, (TEXTWW)
  1083  05cb  e602              	AND $2
  1084  05cd  2809              	JR Z,TEXTATBMPENDISABLED
  1085  05cf  1a                	LD A, (DE)
  1086  05d0  feff              	CP $FF
  1087  05d2  2001              	JR NZ, TEXTATBMPEN2
  1088                          ; peephole(1): r215 (LD A, 0)->(XOR A)
  1089                          ;    LD A, 0
  1090  05d4  af                	XOR A
  1091                          TEXTATBMPEN2:
  1092  05d5  329e09            	LD (_PEN), A
  1093                          TEXTATBMPENDISABLED:
  1094  05d8  13                	INC DE
  1095  05d9  c3c407            	JP TEXTATBMNEXT
  1096                          TEXTATBMPAPER:
  1097  05dc  13                	INC DE
  1098  05dd  0d                	DEC C
  1099  05de  3a9f09            	LD A, (TEXTWW)
  1100  05e1  e601              	AND $1
  1101  05e3  2801              	JR Z, TEXTATBMPAPERDISABLED
  1102  05e5  1a                	LD A, (DE)
  1103                              ; STA $d021
  1104                              ; STA $d020
  1105                          TEXTATBMPAPERDISABLED:
  1106  05e6  13                	INC DE
  1107  05e7  c3c407            	JP TEXTATBMNEXT
  1108                          TEXTATBMCMOVEPREPARE:
  1109  05ea  13                	INC DE
  1110  05eb  0d                	DEC C
  1111  05ec  1a                	LD A, (DE)
  1112  05ed  325e09            	LD (CLINEX), A
  1113  05f0  13                	INC DE
  1114  05f1  0d                	DEC C
  1115  05f2  1a                	LD A, (DE)
  1116  05f3  325f09            	LD (CLINEY), A
  1117                          TEXTATBMCMOVE:
  1118  05f6  3a5b09            	LD A, (XCURSYS)
  1119  05f9  47                	LD B, A
  1120  05fa  3a5e09            	LD A, (CLINEX)
  1121  05fd  80                	ADD A, B
  1122  05fe  fe80              	CP $80
  1123  0600  3022              	JR NC, TEXTATBMCMOVESKIPX
  1124  0602  f5                	PUSH AF
  1125  0603  3a4e09            	LD A, (CURRENTTILESWIDTH)
  1126  0606  47                	LD B, A
  1127  0607  f1                	POP AF
  1128  0608  b8                	CP B
  1129  0609  3019              	JR NC, TEXTATBMCMOVESKIPX
  1130  060b  325b09            	LD (XCURSYS), A
  1131  060e  3a5e09            	LD A, (CLINEX)
  1132  0611  fe80              	CP $80
  1133  0613  3809              	JR C, TEXTATBMCMOVEADDPX
  1134                          TEXTATBMCMOVESUBPX:
  1135                          ; peephole(1): r306 (XOR $FF)->(CPL)
  1136                          ;    XOR $FF
  1137  0615  2f                	CPL
  1138  0616  c601              	ADD 1
  1139  0618  325e09            	LD (CLINEX), A
  1140  061b  c32406            	JP TEXTATBMCMOVESKIPX
  1141                          TEXTATBMCMOVEADDPX:
  1142  061e  325e09            	LD (CLINEX), A
  1143  0621  c32406            	JP TEXTATBMCMOVESKIPX
  1144                          TEXTATBMCMOVESKIPX:
  1145  0624  3a5c09            	LD A, (YCURSYS)
  1146  0627  47                	LD B, A
  1147  0628  3a5f09            	LD A, (CLINEY)
  1148  062b  80                	ADD A,B
  1149  062c  fe80              	CP $80
  1150  062e  d23906            	JP NC, TEXTATBMCMOVESKIPY
  1151  0631  fe1a              	CP 26
  1152  0633  d23906            	JP NC, TEXTATBMCMOVESKIPY
  1153  0636  325c09            	LD (YCURSYS), A
  1154                          TEXTATBMCMOVESKIPY:
  1155  0639  13                	INC DE
  1156  063a  c3c407            	JP TEXTATBMNEXT
  1157                          TEXTATBMAT:
  1158  063d  13                	INC DE
  1159  063e  0d                	DEC C
  1160  063f  3a5b09            	LD A, (XCURSYS)
  1161  0642  47                	LD B, A
  1162  0643  1a                	LD A, (DE)
  1163  0644  90                	SUB A, B
  1164  0645  325e09            	LD (CLINEX), A
  1165  0648  13                	INC DE
  1166  0649  0d                	DEC C
  1167  064a  3a5c09            	LD A, (YCURSYS)
  1168  064d  47                	LD B, A
  1169  064e  1a                	LD A, (DE)
  1170  064f  90                	SUB A, B
  1171  0650  325f09            	LD (CLINEY), A
  1172  0653  c3f605            	JP TEXTATBMCMOVE
  1173                          TEXTATBMSP0:
  1174  0656  1a                	LD A, (DE)
  1175  0657  cdee04            	CALL TEXTATDECODE
  1176  065a  d5                	PUSH DE
  1177  065b  c5                	PUSH BC
  1178  065c  010800            	LD BC, 8
  1179  065f  2600              	LD H, 0
  1180  0661  6f                	LD L, A
  1181  0662  29                	ADD HL, HL
  1182  0663  29                	ADD HL, HL
  1183  0664  29                	ADD HL, HL
  1184  0665  545d              	LD DE, HL
  1185  0667  21550b            	LD HL, UDCCHAR
  1186  066a  19                	ADD HL, DE
  1187  066b  cdfc04            	CALL TEXTATPIXPOS
  1188  066e  ed5b4009          	LD DE, (COPYOFTEXTADDRESS)
  1189                              ; We draw the text using a different approach,
  1190                              ; based on the current graphic mode.
  1191  0672  3a6109            	LD A, (CURRENTMODE)
  1192  0675  fe00              	CP 0
  1193  0677  ca8c06            	JP Z, TEXTATFONT0L1X
  1194  067a  fe01              	CP 1
  1195  067c  caea06            	JP Z, TEXTATFONT1L1X
  1196  067f  fe02              	CP 2
  1197  0681  ca2b07            	JP Z, TEXTATFONT2L1X
  1198  0684  fe03              	CP 3
  1199  0686  ca8c06            	JP Z, TEXTATFONT0L1X
  1200  0689  c33a07            	JP TEXTATFONT2L1
  1201                          ; Mode 0, 160×200, 16 colors (each byte of video memory represents 2 pixels):
  1202                          ; bit 7	bit 6	bit 5	bit 4	bit 3	bit 2	bit 1	bit 0
  1203                          ; pixel 0 (bit 0)	pixel 1 (bit 0)	pixel 0 (bit 2)	pixel 1 (bit 2)	pixel 0 (bit 1)	pixel 1 (bit 1)	pixel 0 (bit 3)	pixel 1 (bit 3)
  1204                          TEXTATFONT0L1X:
  1205  068c  3a9e09            	LD A, (_PEN)
  1206  068f  dd6f              	LD IXL, A
  1207  0691  3e01              	LD A, 1
  1208  0693  fd6f              	LD IYL, A
  1209  0695  cdd503            	CALL CPCSELECTPALETTE
  1210  0698  dd7c              	LD A, IXH
  1211  069a  47                	LD B, A
  1212                          TEXTATFONT0L1:
  1213  069b  d5                	PUSH DE
  1214  069c  7e                	LD A, (HL)
  1215  069d  cb3f              	SRL A
  1216  069f  cb3f              	SRL A
  1217  06a1  cb3f              	SRL A
  1218  06a3  cb3f              	SRL A
  1219  06a5  cb3f              	SRL A
  1220  06a7  cb3f              	SRL A
  1221  06a9  cd1504            	CALL CPCVIDEOMUL84
  1222  06ac  12                	LD (DE), A
  1223                          
  1224  06ad  13                	INC DE
  1225  06ae  7e                	LD A, (HL)
  1226  06af  cb3f              	SRL A
  1227  06b1  cb3f              	SRL A
  1228  06b3  cb3f              	SRL A
  1229  06b5  cb3f              	SRL A
  1230  06b7  cd1504            	CALL CPCVIDEOMUL84
  1231  06ba  12                	LD (DE), A
  1232  06bb  13                	INC DE
  1233  06bc  7e                	LD A, (HL)
  1234  06bd  cb3f              	SRL A
  1235  06bf  cb3f              	SRL A
  1236  06c1  cd1504            	CALL CPCVIDEOMUL84
  1237  06c4  12                	LD (DE), A
  1238  06c5  13                	INC DE
  1239  06c6  7e                	LD A, (HL)
  1240  06c7  cd1504            	CALL CPCVIDEOMUL84
  1241  06ca  12                	LD (DE), A
  1242  06cb  d1                	POP DE
  1243  06cc  e5                	PUSH HL
  1244  06cd  626b              	LD HL, DE
  1245  06cf  110008            	LD DE, $800
  1246  06d2  19                	ADD HL, DE
  1247  06d3  545d              	LD DE, HL
  1248  06d5  e1                	POP HL
  1249  06d6  23                	INC HL
  1250  06d7  0d                	DEC C
  1251  06d8  c29b06            	JP NZ, TEXTATFONT0L1
  1252  06db  78                	LD A, B
  1253  06dc  67                	LD H, A
  1254  06dd  c1                	POP BC
  1255  06de  d1                	POP DE
  1256  06df  3a9f09            	LD A, (TEXTWW)
  1257  06e2  e602              	AND $2
  1258  06e4  ca5507            	JP Z, TEXTATBMCNOPEN
  1259  06e7  c35507            	JP TEXTATFONTLE
  1260                          ; Mode 1, 320×200, 4 colors (each byte of video memory represents 4 pixels):
  1261                          ; bit 7	bit 6	bit 5	bit 4	bit 3	bit 2	bit 1	bit 0
  1262                          ; pixel 0 (bit 1)	pixel 1 (bit 1)	pixel 2 (bit 1)	pixel 3 (bit 1)	pixel 0 (bit 0)	pixel 1(bit 0)	pixel 2 (bit 0)	pixel 3 (bit 0)
  1263                          TEXTATFONT1L1X:
  1264  06ea  3a9e09            	LD A, (_PEN)
  1265  06ed  dd6f              	LD IXL, A
  1266  06ef  3e01              	LD A, 1
  1267  06f1  fd6f              	LD IYL, A
  1268  06f3  cdd503            	CALL CPCSELECTPALETTE
  1269  06f6  dd7c              	LD A, IXH
  1270  06f8  47                	LD B, A
  1271                          TEXTATFONT1L1:
  1272  06f9  7e                	LD A, (HL)
  1273  06fa  cb3f              	SRL A
  1274  06fc  cb3f              	SRL A
  1275  06fe  cb3f              	SRL A
  1276  0700  cb3f              	SRL A
  1277  0702  cde003            	CALL CPCVIDEOMUL82
  1278  0705  12                	LD (DE), A
  1279  0706  13                	INC DE
  1280  0707  7e                	LD A, (HL)
  1281  0708  e60f              	AND $0F
  1282  070a  cde003            	CALL CPCVIDEOMUL82
  1283  070d  12                	LD (DE), A
  1284  070e  1b                	DEC DE
  1285                          
  1286  070f  e5                	PUSH HL
  1287  0710  626b              	LD HL, DE
  1288  0712  110008            	LD DE, $800
  1289  0715  19                	ADD HL, DE
  1290  0716  545d              	LD DE, HL
  1291  0718  e1                	POP HL
  1292  0719  23                	INC HL
  1293  071a  0d                	DEC C
  1294  071b  20dc              	JR NZ, TEXTATFONT1L1
  1295  071d  78                	LD A, B
  1296  071e  67                	LD H, A
  1297  071f  c1                	POP BC
  1298  0720  d1                	POP DE
  1299  0721  3a9f09            	LD A, (TEXTWW)
  1300  0724  e602              	AND $2
  1301  0726  282d              	JR Z, TEXTATBMCNOPEN
  1302  0728  c35507            	JP TEXTATFONTLE
  1303                          TEXTATFONT2L1X:
  1304  072b  3a9e09            	LD A, (_PEN)
  1305  072e  dd6f              	LD IXL, A
  1306  0730  3e01              	LD A, 1
  1307  0732  fd6f              	LD IYL, A
  1308  0734  cdd503            	CALL CPCSELECTPALETTE
  1309  0737  dd7c              	LD A, IXH
  1310  0739  47                	LD B, A
  1311                          TEXTATFONT2L1:
  1312  073a  7e                	LD A, (HL)
  1313  073b  12                	LD (DE), A
  1314  073c  e5                	PUSH HL
  1315  073d  626b              	LD HL, DE
  1316  073f  110008            	LD DE, $800
  1317  0742  19                	ADD HL, DE
  1318  0743  545d              	LD DE, HL
  1319  0745  e1                	POP HL
  1320  0746  23                	INC HL
  1321  0747  0d                	DEC C
  1322  0748  20f0              	JR NZ, TEXTATFONT2L1
  1323  074a  78                	LD A, B
  1324  074b  67                	LD H, A
  1325                          
  1326  074c  c1                	POP BC
  1327  074d  d1                	POP DE
  1328  074e  3a9f09            	LD A, (TEXTWW)
  1329  0751  e602              	AND $2
  1330  0753  2800              	JR Z, TEXTATBMCNOPEN
  1331                          TEXTATFONTLE:
  1332                          TEXTATBMCNOPEN:
  1333  0755  c36207            	JP TEXTATBMINCX
  1334                          TEXTATBMSKIPTAB:
  1335  0758  3a6009            	LD A, (TABSTODRAW)
  1336  075b  3d                	DEC A
  1337  075c  326009            	LD (TABSTODRAW),A
  1338  075f  c36207            	JP TEXTATBMINCX
  1339                          TEXTATBMINCX:
  1340  0762  2a4009            	LD HL, (COPYOFTEXTADDRESS)
  1341  0765  d511010019d1      	ADD HL, 1
  1342  076b  224009            	LD (COPYOFTEXTADDRESS), HL
  1343  076e  13                	INC DE
  1344  076f  3a5b09            	LD A, (XCURSYS)
  1345  0772  3c                	INC A
  1346  0773  325b09            	LD (XCURSYS), A
  1347  0776  f5                	PUSH AF
  1348  0777  3a4e09            	LD A, (CURRENTTILESWIDTH)
  1349  077a  47                	LD B, A
  1350  077b  f1                	POP AF
  1351  077c  b8                	CP B
  1352  077d  2803              	JR Z, TEXTATBMNEXT2
  1353  077f  c3c407            	JP TEXTATBMNEXT
  1354                          TEXTATBMNEXT2:
  1355                          ; peephole(1): r215 (LD A, 0)->(XOR A)
  1356                          ;    LD A, 0
  1357  0782  af                	XOR A
  1358  0783  325b09            	LD (XCURSYS), A
  1359  0786  3a5c09            	LD A, (YCURSYS)
  1360  0789  3c                	INC A
  1361  078a  325c09            	LD (YCURSYS), A
  1362  078d  f5                	PUSH AF
  1363  078e  3a4f09            	LD A, (CURRENTTILESHEIGHT)
  1364  0791  47                	LD B, A
  1365  0792  f1                	POP AF
  1366  0793  b8                	CP B
  1367  0794  2803              	JR Z, TEXTATBMNEXT3
  1368  0796  c3c407            	JP TEXTATBMNEXT
  1369                          TEXTATBMNEXT3:
  1370  0799  f5                	PUSH AF
  1371  079a  c5                	PUSH BC
  1372  079b  d5                	PUSH DE
  1373  079c  e5                	PUSH HL
  1374  079d  cd6001            	CALL VSCROLLTUP
  1375  07a0  e1                	POP HL
  1376  07a1  d1                	POP DE
  1377  07a2  c1                	POP BC
  1378  07a3  f1                	POP AF
  1379  07a4  3a5c09            	LD A, (YCURSYS)
  1380  07a7  3d                	DEC A
  1381  07a8  325c09            	LD (YCURSYS), A
  1382  07ab  d5                	PUSH DE
  1383  07ac  3a4e09            	LD A, (CURRENTTILESWIDTH)
  1384  07af  5f                	LD E, A
  1385  07b0  1600              	LD D, 0
  1386  07b2  e5                	PUSH HL
  1387  07b3  626b              	LD HL, DE
  1388  07b5  29                	ADD HL, HL
  1389  07b6  29                	ADD HL, HL
  1390  07b7  29                	ADD HL, HL
  1391  07b8  545d              	LD DE, HL
  1392  07ba  e1                	POP HL
  1393  07bb  2a4009            	LD HL, (COPYOFTEXTADDRESS)
  1394  07be  ed52              	SBC HL, DE
  1395  07c0  224009            	LD (COPYOFTEXTADDRESS), HL
  1396  07c3  d1                	POP DE
  1397                          TEXTATBMNEXT:
  1398  07c4  3a6009            	LD A, (TABSTODRAW)
  1399  07c7  fe00              	CP 0
  1400  07c9  2803              	JR Z, TEXTATBMXLOOP2
  1401  07cb  c35e05            	JP TEXTATBMLOOP2
  1402                          TEXTATBMXLOOP2:
  1403  07ce  0d                	DEC C
  1404  07cf  2803              	JR Z, TEXTATBMEND
  1405  07d1  c35e05            	JP TEXTATBMLOOP2
  1406                          TEXTATBMEND:
  1407  07d4  c3d707            	JP TEXTATBITMAPMODEDONE
  1408                          TEXTATBITMAPMODEDONE:
  1409  07d7  c9                	RET
  1410                          
  1411                          textEncodedAtGraphic_after:
  1412  07d8  cd5605            	CALL TEXTATBITMAPMODE
  1413                          	; P:858
  1414                          	; L:15
  1415  07db  3a5b09            	LD A, (XCURSYS)
  1416                          ; peephole(3): unread
  1417                          ;	LD (_windowMX), A
  1418  07de  3a5c09            	LD A, (YCURSYS)
  1419                          ; peephole(3): unread
  1420                          ;	LD (_windowMY), A
  1421                          	; P:4
  1422                          	; L:16
  1423  07e1  3e0c              	LD A, $0c
  1424  07e3  32a709            	LD (_Ttmp0), A
  1425                          ; peephole(1): r237 (LD A, x; LD (x), A; LD A, x)->(LD A, x; LD (x), A)
  1426                          ;	LD A, $0c
  1427  07e6  32a809            	LD (_Ttmp1), A
  1428  07e9  3aa709            	LD A, (_Ttmp0)
  1429  07ec  325b09            	LD (XCURSYS), A
  1430  07ef  3aa809            	LD A, (_Ttmp1)
  1431  07f2  325c09            	LD (YCURSYS), A
  1432                          	; P:8
  1433                          	; L:17
  1434  07f5  3ab109            	LD A, (_Tstr7)
  1435  07f8  32a709            	LD (_Ttmp0), A
  1436  07fb  21b109            	LD HL, _Tstr7
  1437  07fe  22af09            	LD (_Ttmp6), HL
  1438  0801  2aaf09            	LD HL, (_Ttmp6)
  1439  0804  23                	INC HL
  1440  0805  22af09            	LD (_Ttmp6), HL
  1441  0808  ed5baf09          	LD DE, (_Ttmp6)
  1442  080c  3aa709            	LD A, (_Ttmp0)
  1443  080f  4f                	LD C, A
  1444  0810  cd5605            	CALL TEXTATBITMAPMODE
  1445  0813  3e00              	LD A, $00
  1446  0815  325b09            	LD (XCURSYS), A
  1447  0818  3a5c09            	LD A, (YCURSYS)
  1448  081b  3c                	INC A
  1449  081c  325c09            	LD (YCURSYS), A
  1450  081f  3a4f09            	LD A, (CURRENTTILESHEIGHT)
  1451  0822  47                	LD B, A
  1452  0823  3a5c09            	LD A, (YCURSYS)
  1453  0826  b8                	CP B
  1454  0827  3807              	JR C, _label12
  1455                          ; peephole(1): r215 (LD A, 0)->(XOR A)
  1456                          ;	LD A, 0
  1457  0829  af                	XOR A
  1458  082a  32b709            	LD (_Ttmp11), A
  1459  082d  c33508            	JMP _label12b2
  1460                          _label12:
  1461  0830  3eff              	LD A, $ff
  1462  0832  32b709            	LD (_Ttmp11), A
  1463                          _label12b2:
  1464  0835  3ab709            	LD A, (_Ttmp11)
  1465                          ; peephole(1): r306 (XOR $FF)->(CPL)
  1466                          ;	XOR $FF
  1467  0838  2f                	CPL
  1468  0839  32b709            	LD (_Ttmp11), A
  1469  083c  3ab709            	LD A, (_Ttmp11)
  1470  083f  fe00              	CP 0
  1471  0841  c24708            	JP NZ, _label13
  1472  0844  c34a08            	JMP _label13b2
  1473                          _label13:
  1474  0847  c34d08            	JMP _label9scroll
  1475                          _label13b2:
  1476  084a  c35d08            	jp _label9end
  1477                          _label9scroll:
  1478  084d  cd6001            	CALL VSCROLLTUP
  1479  0850  3a4f09            	LD A, (CURRENTTILESHEIGHT)
  1480  0853  325c09            	LD (YCURSYS), A
  1481  0856  3a5c09            	LD A, (YCURSYS)
  1482  0859  3d                	DEC A
  1483  085a  325c09            	LD (YCURSYS), A
  1484                          _label9end:
  1485                          	; P:47
  1486                          	; L:18
  1487                          	; P:0
  1488                          	; L:19
  1489                          	; P:0
  1490                          	; L:20
  1491                          	; P:0
  1492                          	; L:21
  1493  085d  3ab809            	LD A, (_Tstr14)
  1494  0860  32a709            	LD (_Ttmp0), A
  1495  0863  21b809            	LD HL, _Tstr14
  1496  0866  22af09            	LD (_Ttmp6), HL
  1497  0869  2aaf09            	LD HL, (_Ttmp6)
  1498  086c  23                	INC HL
  1499  086d  22af09            	LD (_Ttmp6), HL
  1500  0870  ed5baf09          	LD DE, (_Ttmp6)
  1501  0874  3aa709            	LD A, (_Ttmp0)
  1502  0877  4f                	LD C, A
  1503  0878  cd5605            	CALL TEXTATBITMAPMODE
  1504  087b  3e00              	LD A, $00
  1505  087d  325b09            	LD (XCURSYS), A
  1506  0880  3a5c09            	LD A, (YCURSYS)
  1507  0883  3c                	INC A
  1508  0884  325c09            	LD (YCURSYS), A
  1509  0887  3a4f09            	LD A, (CURRENTTILESHEIGHT)
  1510  088a  47                	LD B, A
  1511  088b  3a5c09            	LD A, (YCURSYS)
  1512  088e  b8                	CP B
  1513  088f  3807              	JR C, _label18
  1514                          ; peephole(1): r215 (LD A, 0)->(XOR A)
  1515                          ;	LD A, 0
  1516  0891  af                	XOR A
  1517  0892  32b709            	LD (_Ttmp11), A
  1518  0895  c39d08            	JMP _label18b2
  1519                          _label18:
  1520  0898  3eff              	LD A, $ff
  1521  089a  32b709            	LD (_Ttmp11), A
  1522                          _label18b2:
  1523  089d  3ab709            	LD A, (_Ttmp11)
  1524                          ; peephole(1): r306 (XOR $FF)->(CPL)
  1525                          ;	XOR $FF
  1526  08a0  2f                	CPL
  1527  08a1  32b709            	LD (_Ttmp11), A
  1528  08a4  3ab709            	LD A, (_Ttmp11)
  1529  08a7  fe00              	CP 0
  1530  08a9  c2af08            	JP NZ, _label19
  1531  08ac  c3b208            	JMP _label19b2
  1532                          _label19:
  1533  08af  c3b508            	JMP _label16scroll
  1534                          _label19b2:
  1535  08b2  c3c508            	jp _label16end
  1536                          _label16scroll:
  1537  08b5  cd6001            	CALL VSCROLLTUP
  1538  08b8  3a4f09            	LD A, (CURRENTTILESHEIGHT)
  1539  08bb  325c09            	LD (YCURSYS), A
  1540  08be  3a5c09            	LD A, (YCURSYS)
  1541  08c1  3d                	DEC A
  1542  08c2  325c09            	LD (YCURSYS), A
  1543                          _label16end:
  1544                          	; P:47
  1545                          	; L:22
  1546                          	; P:0
  1547                          	; L:23
  1548                          	; P:0
  1549                          	; L:24
  1550                          	; P:0
  1551                          	; L:25
  1552  08c5  3ac809            	LD A, (_Tstr20)
  1553  08c8  32a709            	LD (_Ttmp0), A
  1554  08cb  21c809            	LD HL, _Tstr20
  1555  08ce  22af09            	LD (_Ttmp6), HL
  1556  08d1  2aaf09            	LD HL, (_Ttmp6)
  1557  08d4  23                	INC HL
  1558  08d5  22af09            	LD (_Ttmp6), HL
  1559  08d8  ed5baf09          	LD DE, (_Ttmp6)
  1560  08dc  3aa709            	LD A, (_Ttmp0)
  1561  08df  4f                	LD C, A
  1562  08e0  cd5605            	CALL TEXTATBITMAPMODE
  1563  08e3  3e00              	LD A, $00
  1564  08e5  325b09            	LD (XCURSYS), A
  1565  08e8  3a5c09            	LD A, (YCURSYS)
  1566  08eb  3c                	INC A
  1567  08ec  325c09            	LD (YCURSYS), A
  1568  08ef  3a4f09            	LD A, (CURRENTTILESHEIGHT)
  1569  08f2  47                	LD B, A
  1570  08f3  3a5c09            	LD A, (YCURSYS)
  1571  08f6  b8                	CP B
  1572  08f7  3807              	JR C, _label24
  1573                          ; peephole(1): r215 (LD A, 0)->(XOR A)
  1574                          ;	LD A, 0
  1575  08f9  af                	XOR A
  1576  08fa  32b709            	LD (_Ttmp11), A
  1577  08fd  c30509            	JMP _label24b2
  1578                          _label24:
  1579  0900  3eff              	LD A, $ff
  1580  0902  32b709            	LD (_Ttmp11), A
  1581                          _label24b2:
  1582  0905  3ab709            	LD A, (_Ttmp11)
  1583                          ; peephole(1): r306 (XOR $FF)->(CPL)
  1584                          ;	XOR $FF
  1585  0908  2f                	CPL
  1586  0909  32b709            	LD (_Ttmp11), A
  1587  090c  3ab709            	LD A, (_Ttmp11)
  1588  090f  fe00              	CP 0
  1589  0911  c21709            	JP NZ, _label25
  1590  0914  c31a09            	JMP _label25b2
  1591                          _label25:
  1592  0917  c31d09            	JMP _label22scroll
  1593                          _label25b2:
  1594  091a  c32d09            	jp _label22end
  1595                          _label22scroll:
  1596  091d  cd6001            	CALL VSCROLLTUP
  1597  0920  3a4f09            	LD A, (CURRENTTILESHEIGHT)
  1598  0923  325c09            	LD (YCURSYS), A
  1599  0926  3a5c09            	LD A, (YCURSYS)
  1600  0929  3d                	DEC A
  1601  092a  325c09            	LD (YCURSYS), A
  1602                          _label22end:
  1603                          	; P:47
  1604                          	; L:26
  1605                          _label26:
  1606  092d  c32d09            	jp _label26
  1607                          	; P:2
  1608                          	; L:27
  1609                          	; P:0
  1610                          _label27:
  1611  0930  c33009            	jp _label27
  1612  0933  00                	EVERYSTATUS: defs 1
  1613  0934  0000              	BITMAPADDRESS: defs 2
  1614  0936  0000              	COLORMAPADDRESS: defs 2
  1615                          ; peephole(3): unread
  1616                          ;	TEXTADDRESS: defs 2
  1617  0938  0000              	TILESADDRESS: defs 2
  1618  093a  00                	EMPTYTILE: db 0
  1619  093b  00                	USING: defs 1
  1620  093c  0000              	COPYOFBITMAPADDRESS: defs 2
  1621  093e  0000              	COPYOFCOLORMAPADDRESS: defs 2
  1622  0940  0000              	COPYOFTEXTADDRESS: defs 2
  1623  0942  0000              	COPYOFTILESADDRESS: defs 2
  1624  0944  0000              	CPCTIMER: defs 2
  1625  0946  000000            	IRQVECTOR: defs 3
  1626  0949  00                	IRQVECTORREADY: defs 1
  1627  094a  0000              	CURRENTWIDTH: defs 2
  1628  094c  0000              	CURRENTHEIGHT: defs 2
  1629                          ; peephole(3): unread
  1630                          ;	CURRENTTILES: defs 1
  1631  094e  00                	CURRENTTILESWIDTH: defs 1
  1632  094f  00                	CURRENTTILESHEIGHT: defs 1
  1633                          ; peephole(3): unread
  1634                          ;	FONTWIDTH: defs 1
  1635                          ; peephole(3): unread
  1636                          ;	FONTHEIGHT: defs 1
  1637  0950  00                	PALETTELIMIT: defs 1
  1638                          ; peephole(3): unread
  1639                          ;	XGR: defs 2
  1640                          ; peephole(3): unread
  1641                          ;	YGR: defs 2
  1642  0951  0000              	LINE: defs 2
  1643                          ; peephole(3): unread
  1644                          ;	CLIPX1: defs 2
  1645                          ; peephole(3): unread
  1646                          ;	CLIPX2: defs 2
  1647                          ; peephole(3): unread
  1648                          ;	CLIPY1: defs 2
  1649                          ; peephole(3): unread
  1650                          ;	CLIPY2: defs 2
  1651  0953  0000              	ORIGINX: defs 2
  1652  0955  0000              	ORIGINY: defs 2
  1653  0957  0000              	RESOLUTIONX: defs 2
  1654  0959  0000              	RESOLUTIONY: defs 2
  1655  095b  00                	XCURSYS: defs 1
  1656  095c  00                	YCURSYS: defs 1
  1657  095d  00                	TABCOUNT: defs 1
  1658  095e  00                	CLINEX: defs 1
  1659  095f  00                	CLINEY: defs 1
  1660  0960  00                	TABSTODRAW: defs 1
  1661  0961  00                	CURRENTMODE: defs 1
  1662                          ; peephole(3): unread
  1663                          ;	CURRENTTILEMODE: defs 1
  1664  0962  00                	SPRITECOUNT: db 0
  1665                          	SPRITEXY: defs 0
  1666  0963  00                	TILEX: defs 1
  1667  0964  00                	TILEY: defs 1
  1668  0965  00                	TILEX2: defs 1
  1669  0966  00                	TILET: defs 1
  1670  0967  00                	TILEW: defs 1
  1671  0968  00                	TILEH: defs 1
  1672  0969  00                	TILEW2: defs 1
  1673  096a  00                	TILEH2: defs 1
  1674  096b  00                	TILEA: defs 1
  1675  096c  0000              	TILEO: defs 2
  1676  096e  00                	XSCROLLPOS: defs 1
  1677  096f  00                	YSCROLLPOS: defs 1
  1678  0970  00                	XSCROLL: defs 1
  1679  0971  00                	YSCROLL: defs 1
  1680  0972  00                	DIRECTION: defs 1
  1681  0973  000000            	ONSCROLLUP: defs 3
  1682  0976  000000            	ONSCROLLDOWN: defs 3
  1683  0979  000000            	ONSCROLLLEFT: defs 3
  1684  097c  000000            	ONSCROLLRIGHT: defs 3
  1685  097f  00                	IMAGEF: defs 1
  1686  0980  00                	IMAGET: defs 1
  1687  0981  00                	CPCTIMER2: defs 1
  1688  0982  00                	EVERYCOUNTER: defs 1
  1689  0983  00                	EVERYTIMING: defs 1
  1690  0984  0000000000000000  	FPSCRAP: defs 16
              0000000000000000  
  1691  0994  00                	AY8910MUSICREADY: defs 1
  1692  0995  00                	AY8910BLOCKS: defs 1
  1693  0996  00                	AY8910LASTBLOCK: defs 1
  1694  0997  0000              	AY8910TMPPTR2: defs 2
  1695  0999  0000              	AY8910TMPPTR: defs 2
  1696  099b  00                	AY8910TMPOFS: defs 1
  1697  099c  00                	AY8910TMPLEN: defs 1
  1698  099d  00                	AY8910JIFFIES: defs 1
  1699  099e  00                	_PEN: defs 1
  1700                          ; peephole(3): unread
  1701                          ;	_PAPER: defs 1
  1702                          ; peephole(3): unread
  1703                          ;	_windowE: defs 1
  1704                          ; peephole(3): unread
  1705                          ;	_windowS: defs 1
  1706                          ; peephole(3): unread
  1707                          ;	_windowW: defs 1
  1708  099f  00                	TEXTWW: defs 1
  1709  09a0  0109              	_TAB: db 1,$09
  1710                          ; peephole(3): unread
  1711                          ;	_windowMX: defs 1
  1712                          ; peephole(3): unread
  1713                          ;	_windowMY: defs 1
  1714  09a2  00                	PROTOTHREADCT: defs 1
  1715  09a3  00000000          	CPURANDOM_SEED: defs 4
  1716  09a7  00                	_Ttmp0: defs 1
  1717  09a8  00                	_Ttmp1: defs 1
  1718                          ; peephole(3): unread
  1719                          ;	_Ttmp2: defs 1
  1720                          ; peephole(3): unread
  1721                          ;	_Ttmp3: defs 1
  1722  09a9  0531302c3130      	_Tstr4: db 5,"10,10"
  1723  09af  0000              	_Ttmp6: defs 2
  1724  09b1  0531322c3132      	_Tstr7: db 5,"12,12"
  1725  09b7  00                	_Ttmp11: defs 1
  1726  09b8  0f203e2052454d45  	_Tstr14: db 15," > REMEMBERED 1"
              4d42455245442031  
  1727  09c8  0f203e2052454d45  	_Tstr20: db 15," > REMEMBERED 2"
              4d42455245442032  
  1728                          VARINIT:
  1729  09d8  3e00              	LD A, $00
  1730  09da  323309            	LD (EVERYSTATUS), A
  1731                          ; peephole(1): r237 (LD A, x; LD (x), A; LD A, x)->(LD A, x; LD (x), A)
  1732                          ;	LD A, $00
  1733  09dd  323409            	LD (BITMAPADDRESS), A
  1734  09e0  3ec0              	LD A, $c0
  1735  09e2  323509            	LD (BITMAPADDRESS+1), A
  1736  09e5  3e00              	LD A, $00
  1737  09e7  323609            	LD (COLORMAPADDRESS), A
  1738  09ea  3ec0              	LD A, $c0
  1739  09ec  323709            	LD (COLORMAPADDRESS+1), A
  1740  09ef  3e00              	LD A, $00
  1741                          ; peephole(3): unread
  1742                          ;	LD (TEXTADDRESS), A
  1743  09f1  3ec0              	LD A, $c0
  1744                          ; peephole(3): unread
  1745                          ;	LD (TEXTADDRESS+1), A
  1746                          ; peephole(4): r392 (LD A, *; LD A, *)->(LD, A)
  1747                          ;	LD A, $00
  1748  09f3  323809            	LD (TILESADDRESS), A
  1749                          ; peephole(5): r237 (LD A, x; LD (x), A; LD A, x)->(LD A, x; LD (x), A)
  1750                          ;	LD A, $c0
  1751  09f6  323909            	LD (TILESADDRESS+1), A
  1752  09f9  3e20              	LD A, $20
  1753  09fb  323a09            	LD (EMPTYTILE), A
  1754  09fe  3e00              	LD A, $00
  1755  0a00  323b09            	LD (USING), A
  1756                          ; peephole(1): r237 (LD A, x; LD (x), A; LD A, x)->(LD A, x; LD (x), A)
  1757                          ;	LD A, $00
  1758  0a03  323c09            	LD (COPYOFBITMAPADDRESS), A
  1759  0a06  3ec0              	LD A, $c0
  1760  0a08  323d09            	LD (COPYOFBITMAPADDRESS+1), A
  1761  0a0b  3e00              	LD A, $00
  1762  0a0d  323e09            	LD (COPYOFCOLORMAPADDRESS), A
  1763  0a10  3ec0              	LD A, $c0
  1764  0a12  323f09            	LD (COPYOFCOLORMAPADDRESS+1), A
  1765  0a15  3e00              	LD A, $00
  1766  0a17  324009            	LD (COPYOFTEXTADDRESS), A
  1767  0a1a  3ec0              	LD A, $c0
  1768  0a1c  324109            	LD (COPYOFTEXTADDRESS+1), A
  1769  0a1f  3e00              	LD A, $00
  1770  0a21  324209            	LD (COPYOFTILESADDRESS), A
  1771  0a24  3ec0              	LD A, $c0
  1772  0a26  324309            	LD (COPYOFTILESADDRESS+1), A
  1773  0a29  3e00              	LD A, $00
  1774  0a2b  324409            	LD (CPCTIMER), A
  1775                          ; peephole(1): r237 (LD A, x; LD (x), A; LD A, x)->(LD A, x; LD (x), A)
  1776                          ;	LD A, $00
  1777  0a2e  324509            	LD (CPCTIMER+1), A
  1778  0a31  3e00              	LD A, $00
  1779  0a33  324909            	LD (IRQVECTORREADY), A
  1780  0a36  3ea0              	LD A, $a0
  1781  0a38  324a09            	LD (CURRENTWIDTH), A
  1782  0a3b  3e00              	LD A, $00
  1783  0a3d  324b09            	LD (CURRENTWIDTH+1), A
  1784  0a40  3ec8              	LD A, $c8
  1785  0a42  324c09            	LD (CURRENTHEIGHT), A
  1786  0a45  3e00              	LD A, $00
  1787  0a47  324d09            	LD (CURRENTHEIGHT+1), A
  1788  0a4a  3eff              	LD A, $ff
  1789                          ; peephole(3): unread
  1790                          ;	LD (CURRENTTILES), A
  1791  0a4c  3e14              	LD A, $14
  1792  0a4e  324e09            	LD (CURRENTTILESWIDTH), A
  1793  0a51  3e19              	LD A, $19
  1794  0a53  324f09            	LD (CURRENTTILESHEIGHT), A
  1795  0a56  3e08              	LD A, $08
  1796                          ; peephole(3): unread
  1797                          ;	LD (FONTWIDTH), A
  1798                          ; peephole(1): r237 (LD A, x; LD (x), A; LD A, x)->(LD A, x; LD (x), A)
  1799                          ;	LD A, $08
  1800                          ; peephole(3): unread
  1801                          ;	LD (FONTHEIGHT), A
  1802  0a58  3e10              	LD A, $10
  1803  0a5a  325009            	LD (PALETTELIMIT), A
  1804  0a5d  3e00              	LD A, $00
  1805                          ; peephole(3): unread
  1806                          ;	LD (XGR), A
  1807                          ; peephole(1): r237 (LD A, x; LD (x), A; LD A, x)->(LD A, x; LD (x), A)
  1808                          ;	LD A, $00
  1809                          ; peephole(3): unread
  1810                          ;	LD (XGR+1), A
  1811  0a5f  3e00              	LD A, $00
  1812                          ; peephole(3): unread
  1813                          ;	LD (YGR), A
  1814                          ; peephole(1): r237 (LD A, x; LD (x), A; LD A, x)->(LD A, x; LD (x), A)
  1815                          ;	LD A, $00
  1816                          ; peephole(3): unread
  1817                          ;	LD (YGR+1), A
  1818  0a61  3eff              	LD A, $ff
  1819  0a63  325109            	LD (LINE), A
  1820                          ; peephole(1): r237 (LD A, x; LD (x), A; LD A, x)->(LD A, x; LD (x), A)
  1821                          ;	LD A, $ff
  1822  0a66  325209            	LD (LINE+1), A
  1823  0a69  3e00              	LD A, $00
  1824                          ; peephole(3): unread
  1825                          ;	LD (CLIPX1), A
  1826                          ; peephole(1): r237 (LD A, x; LD (x), A; LD A, x)->(LD A, x; LD (x), A)
  1827                          ;	LD A, $00
  1828                          ; peephole(3): unread
  1829                          ;	LD (CLIPX1+1), A
  1830  0a6b  3eff              	LD A, $ff
  1831                          ; peephole(3): unread
  1832                          ;	LD (CLIPX2), A
  1833                          ; peephole(4): r392 (LD A, *; LD A, *)->(LD, A)
  1834                          ;	LD A, $00
  1835                          ; peephole(3): unread
  1836                          ;	LD (CLIPX2+1), A
  1837                          ; peephole(1): r237 (LD A, x; LD (x), A; LD A, x)->(LD A, x; LD (x), A)
  1838                          ;	LD A, $00
  1839                          ; peephole(3): unread
  1840                          ;	LD (CLIPY1), A
  1841                          ; peephole(5): r392 (LD A, *; LD A, *)->(LD, A)
  1842                          ;	LD A, $00
  1843                          ; peephole(3): unread
  1844                          ;	LD (CLIPY1+1), A
  1845  0a6d  3ebf              	LD A, $bf
  1846                          ; peephole(3): unread
  1847                          ;	LD (CLIPY2), A
  1848                          ; peephole(4): r392 (LD A, *; LD A, *)->(LD, A)
  1849                          ;	LD A, $00
  1850                          ; peephole(3): unread
  1851                          ;	LD (CLIPY2+1), A
  1852                          ; peephole(1): r237 (LD A, x; LD (x), A; LD A, x)->(LD A, x; LD (x), A)
  1853                          ;	LD A, $00
  1854  0a6f  325309            	LD (ORIGINX), A
  1855  0a72  3e00              	LD A, $00
  1856  0a74  325409            	LD (ORIGINX+1), A
  1857                          ; peephole(1): r237 (LD A, x; LD (x), A; LD A, x)->(LD A, x; LD (x), A)
  1858                          ;	LD A, $00
  1859  0a77  325509            	LD (ORIGINY), A
  1860  0a7a  3e00              	LD A, $00
  1861  0a7c  325609            	LD (ORIGINY+1), A
  1862                          ; peephole(1): r237 (LD A, x; LD (x), A; LD A, x)->(LD A, x; LD (x), A)
  1863                          ;	LD A, $00
  1864  0a7f  325709            	LD (RESOLUTIONX), A
  1865  0a82  3e00              	LD A, $00
  1866  0a84  325809            	LD (RESOLUTIONX+1), A
  1867                          ; peephole(1): r237 (LD A, x; LD (x), A; LD A, x)->(LD A, x; LD (x), A)
  1868                          ;	LD A, $00
  1869  0a87  325909            	LD (RESOLUTIONY), A
  1870  0a8a  3e00              	LD A, $00
  1871  0a8c  325a09            	LD (RESOLUTIONY+1), A
  1872                          ; peephole(1): r237 (LD A, x; LD (x), A; LD A, x)->(LD A, x; LD (x), A)
  1873                          ;	LD A, $00
  1874  0a8f  325b09            	LD (XCURSYS), A
  1875  0a92  3e00              	LD A, $00
  1876  0a94  325c09            	LD (YCURSYS), A
  1877  0a97  3e04              	LD A, $04
  1878  0a99  325d09            	LD (TABCOUNT), A
  1879  0a9c  3e00              	LD A, $00
  1880  0a9e  325e09            	LD (CLINEX), A
  1881                          ; peephole(1): r237 (LD A, x; LD (x), A; LD A, x)->(LD A, x; LD (x), A)
  1882                          ;	LD A, $00
  1883  0aa1  325f09            	LD (CLINEY), A
  1884  0aa4  3e00              	LD A, $00
  1885  0aa6  326009            	LD (TABSTODRAW), A
  1886  0aa9  3e02              	LD A, $02
  1887  0aab  326109            	LD (CURRENTMODE), A
  1888  0aae  3e01              	LD A, $01
  1889                          ; peephole(3): unread
  1890                          ;	LD (CURRENTTILEMODE), A
  1891  0ab0  3e00              	LD A, $00
  1892  0ab2  326309            	LD (TILEX), A
  1893                          ; peephole(1): r237 (LD A, x; LD (x), A; LD A, x)->(LD A, x; LD (x), A)
  1894                          ;	LD A, $00
  1895  0ab5  326409            	LD (TILEY), A
  1896  0ab8  3e00              	LD A, $00
  1897  0aba  326509            	LD (TILEX2), A
  1898                          ; peephole(1): r237 (LD A, x; LD (x), A; LD A, x)->(LD A, x; LD (x), A)
  1899                          ;	LD A, $00
  1900  0abd  326609            	LD (TILET), A
  1901  0ac0  3e00              	LD A, $00
  1902  0ac2  326709            	LD (TILEW), A
  1903                          ; peephole(1): r237 (LD A, x; LD (x), A; LD A, x)->(LD A, x; LD (x), A)
  1904                          ;	LD A, $00
  1905  0ac5  326809            	LD (TILEH), A
  1906  0ac8  3e00              	LD A, $00
  1907  0aca  326909            	LD (TILEW2), A
  1908                          ; peephole(1): r237 (LD A, x; LD (x), A; LD A, x)->(LD A, x; LD (x), A)
  1909                          ;	LD A, $00
  1910  0acd  326a09            	LD (TILEH2), A
  1911  0ad0  3e00              	LD A, $00
  1912  0ad2  326b09            	LD (TILEA), A
  1913                          ; peephole(1): r237 (LD A, x; LD (x), A; LD A, x)->(LD A, x; LD (x), A)
  1914                          ;	LD A, $00
  1915  0ad5  326c09            	LD (TILEO), A
  1916  0ad8  3e00              	LD A, $00
  1917  0ada  326d09            	LD (TILEO+1), A
  1918                          ; peephole(1): r237 (LD A, x; LD (x), A; LD A, x)->(LD A, x; LD (x), A)
  1919                          ;	LD A, $00
  1920  0add  326e09            	LD (XSCROLLPOS), A
  1921  0ae0  3e00              	LD A, $00
  1922  0ae2  326f09            	LD (YSCROLLPOS), A
  1923                          ; peephole(1): r237 (LD A, x; LD (x), A; LD A, x)->(LD A, x; LD (x), A)
  1924                          ;	LD A, $00
  1925  0ae5  327009            	LD (XSCROLL), A
  1926  0ae8  3e00              	LD A, $00
  1927  0aea  327109            	LD (YSCROLL), A
  1928                          ; peephole(1): r237 (LD A, x; LD (x), A; LD A, x)->(LD A, x; LD (x), A)
  1929                          ;	LD A, $00
  1930  0aed  327209            	LD (DIRECTION), A
  1931  0af0  3e00              	LD A, $00
  1932  0af2  327f09            	LD (IMAGEF), A
  1933                          ; peephole(1): r237 (LD A, x; LD (x), A; LD A, x)->(LD A, x; LD (x), A)
  1934                          ;	LD A, $00
  1935  0af5  328009            	LD (IMAGET), A
  1936  0af8  3e06              	LD A, $06
  1937  0afa  328109            	LD (CPCTIMER2), A
  1938  0afd  3e00              	LD A, $00
  1939  0aff  328209            	LD (EVERYCOUNTER), A
  1940                          ; peephole(1): r237 (LD A, x; LD (x), A; LD A, x)->(LD A, x; LD (x), A)
  1941                          ;	LD A, $00
  1942  0b02  328309            	LD (EVERYTIMING), A
  1943  0b05  3e00              	LD A, $00
  1944  0b07  329409            	LD (AY8910MUSICREADY), A
  1945                          ; peephole(1): r237 (LD A, x; LD (x), A; LD A, x)->(LD A, x; LD (x), A)
  1946                          ;	LD A, $00
  1947  0b0a  329509            	LD (AY8910BLOCKS), A
  1948  0b0d  3e00              	LD A, $00
  1949  0b0f  329609            	LD (AY8910LASTBLOCK), A
  1950                          ; peephole(1): r237 (LD A, x; LD (x), A; LD A, x)->(LD A, x; LD (x), A)
  1951                          ;	LD A, $00
  1952  0b12  329709            	LD (AY8910TMPPTR2), A
  1953  0b15  3e00              	LD A, $00
  1954  0b17  329809            	LD (AY8910TMPPTR2+1), A
  1955                          ; peephole(1): r237 (LD A, x; LD (x), A; LD A, x)->(LD A, x; LD (x), A)
  1956                          ;	LD A, $00
  1957  0b1a  329909            	LD (AY8910TMPPTR), A
  1958  0b1d  3e00              	LD A, $00
  1959  0b1f  329a09            	LD (AY8910TMPPTR+1), A
  1960                          ; peephole(1): r237 (LD A, x; LD (x), A; LD A, x)->(LD A, x; LD (x), A)
  1961                          ;	LD A, $00
  1962  0b22  329b09            	LD (AY8910TMPOFS), A
  1963  0b25  3e00              	LD A, $00
  1964  0b27  329c09            	LD (AY8910TMPLEN), A
  1965                          ; peephole(1): r237 (LD A, x; LD (x), A; LD A, x)->(LD A, x; LD (x), A)
  1966                          ;	LD A, $00
  1967  0b2a  329d09            	LD (AY8910JIFFIES), A
  1968  0b2d  3e00              	LD A, $00
  1969  0b2f  329e09            	LD (_PEN), A
  1970  0b32  3e14              	LD A, $14
  1971                          ; peephole(3): unread
  1972                          ;	LD (_PAPER), A
  1973  0b34  3e00              	LD A, $00
  1974                          ; peephole(3): unread
  1975                          ;	LD (_windowE), A
  1976                          ; peephole(1): r237 (LD A, x; LD (x), A; LD A, x)->(LD A, x; LD (x), A)
  1977                          ;	LD A, $00
  1978                          ; peephole(3): unread
  1979                          ;	LD (_windowS), A
  1980  0b36  3e00              	LD A, $00
  1981                          ; peephole(3): unread
  1982                          ;	LD (_windowW), A
  1983  0b38  3e03              	LD A, $03
  1984  0b3a  329f09            	LD (TEXTWW), A
  1985  0b3d  3e00              	LD A, $00
  1986                          ; peephole(3): unread
  1987                          ;	LD (_windowMX), A
  1988                          ; peephole(1): r237 (LD A, x; LD (x), A; LD A, x)->(LD A, x; LD (x), A)
  1989                          ;	LD A, $00
  1990                          ; peephole(3): unread
  1991                          ;	LD (_windowMY), A
  1992  0b3f  3e00              	LD A, $00
  1993  0b41  32a209            	LD (PROTOTHREADCT), A
  1994  0b44  3eff              	LD A, $ff
  1995  0b46  32a309            	LD (CPURANDOM_SEED), A
  1996                          ; peephole(1): r237 (LD A, x; LD (x), A; LD A, x)->(LD A, x; LD (x), A)
  1997                          ;	LD A, $ff
  1998  0b49  32a409            	LD (CPURANDOM_SEED+1), A
  1999  0b4c  3eff              	LD A, $ff
  2000  0b4e  32a509            	LD (CPURANDOM_SEED+2), A
  2001                          ; peephole(1): r237 (LD A, x; LD (x), A; LD A, x)->(LD A, x; LD (x), A)
  2002                          ;	LD A, $ff
  2003  0b51  32a609            	LD (CPURANDOM_SEED+3), A
  2004  0b54  c9                	RET
  2005                          UDCCHAR:
  2006                          	; $00
  2007  0b55  3c666e6e60623c00  DEFB $3c,$66,$6e,$6e,$60,$62,$3c,	$00
  2008                          	; $01
  2009  0b5d  00003c063e663e00  DEFB $00,$00,$3c,$06,$3e,$66,$3e,	$00
  2010                          	; $02
  2011  0b65  0060607c66667c00  DEFB $00,$60,$60,$7c,$66,$66,$7c,	$00
  2012                          	; $03
  2013  0b6d  00003c6060603c00  DEFB $00,$00,$3c,$60,$60,$60,$3c,	$00
  2014                          	; $04
  2015  0b75  0006063e66663e00  DEFB $00,$06,$06,$3e,$66,$66,$3e,	$00
  2016                          	; $05
  2017  0b7d  00003c667e603c00  DEFB $00,$00,$3c,$66,$7e,$60,$3c,	$00
  2018                          	; $06
  2019  0b85  000e183e18181800  DEFB $00,$0e,$18,$3e,$18,$18,$18,	$00
  2020                          	; $07
  2021  0b8d  00003e66663e067c  DEFB $00,$00,$3e,$66,$66,$3e,$06,	$7c
  2022                          	; $08
  2023  0b95  0060607c66666600  DEFB $00,$60,$60,$7c,$66,$66,$66,	$00
  2024                          	; $09
  2025  0b9d  0018003818183c00  DEFB $00,$18,$00,$38,$18,$18,$3c,	$00
  2026                          	; $0a
  2027  0ba5  000600060606063c  DEFB $00,$06,$00,$06,$06,$06,$06,	$3c
  2028                          	; $0b
  2029  0bad  0060606c786c6600  DEFB $00,$60,$60,$6c,$78,$6c,$66,	$00
  2030                          	; $0c
  2031  0bb5  0038181818183c00  DEFB $00,$38,$18,$18,$18,$18,$3c,	$00
  2032                          	; $0d
  2033  0bbd  0000667f7f6b6300  DEFB $00,$00,$66,$7f,$7f,$6b,$63,	$00
  2034                          	; $0e
  2035  0bc5  00007c6666666600  DEFB $00,$00,$7c,$66,$66,$66,$66,	$00
  2036                          	; $0f
  2037  0bcd  00003c6666663c00  DEFB $00,$00,$3c,$66,$66,$66,$3c,	$00
  2038                          	; $10
  2039  0bd5  00007c66667c6060  DEFB $00,$00,$7c,$66,$66,$7c,$60,	$60
  2040                          	; $11
  2041  0bdd  00003e66663e0606  DEFB $00,$00,$3e,$66,$66,$3e,$06,	$06
  2042                          	; $12
  2043  0be5  00007c6660606000  DEFB $00,$00,$7c,$66,$60,$60,$60,	$00
  2044                          	; $13
  2045  0bed  00003e603c067c00  DEFB $00,$00,$3e,$60,$3c,$06,$7c,	$00
  2046                          	; $14
  2047  0bf5  00187e1818180e00  DEFB $00,$18,$7e,$18,$18,$18,$0e,	$00
  2048                          	; $15
  2049  0bfd  0000666666663e00  DEFB $00,$00,$66,$66,$66,$66,$3e,	$00
  2050                          	; $16
  2051  0c05  00006666663c1800  DEFB $00,$00,$66,$66,$66,$3c,$18,	$00
  2052                          	; $17
  2053  0c0d  0000636b7f3e3600  DEFB $00,$00,$63,$6b,$7f,$3e,$36,	$00
  2054                          	; $18
  2055  0c15  0000663c183c6600  DEFB $00,$00,$66,$3c,$18,$3c,$66,	$00
  2056                          	; $19
  2057  0c1d  00006666663e0c78  DEFB $00,$00,$66,$66,$66,$3e,$0c,	$78
  2058                          	; $1a
  2059  0c25  00007e0c18307e00  DEFB $00,$00,$7e,$0c,$18,$30,$7e,	$00
  2060                          	; $1b
  2061  0c2d  3c30303030303c00  DEFB $3c,$30,$30,$30,$30,$30,$3c,	$00
  2062                          	; $1c
  2063  0c35  0c12307c3062fc00  DEFB $0c,$12,$30,$7c,$30,$62,$fc,	$00
  2064                          	; $1d
  2065  0c3d  3c0c0c0c0c0c3c00  DEFB $3c,$0c,$0c,$0c,$0c,$0c,$3c,	$00
  2066                          	; $1e
  2067  0c45  00183c7e18181818  DEFB $00,$18,$3c,$7e,$18,$18,$18,	$18
  2068                          	; $1f
  2069  0c4d  0010307f7f301000  DEFB $00,$10,$30,$7f,$7f,$30,$10,	$00
  2070                          	; $20
  2071  0c55  0000000000000000  DEFB $00,$00,$00,$00,$00,$00,$00,	$00
  2072                          	; $21
  2073  0c5d  1818181800001800  DEFB $18,$18,$18,$18,$00,$00,$18,	$00
  2074                          	; $22
  2075  0c65  6666660000000000  DEFB $66,$66,$66,$00,$00,$00,$00,	$00
  2076                          	; $23
  2077  0c6d  6666ff66ff666600  DEFB $66,$66,$ff,$66,$ff,$66,$66,	$00
  2078                          	; $24
  2079  0c75  183e603c067c1800  DEFB $18,$3e,$60,$3c,$06,$7c,$18,	$00
  2080                          	; $25
  2081  0c7d  62660c1830664600  DEFB $62,$66,$0c,$18,$30,$66,$46,	$00
  2082                          	; $26
  2083  0c85  3c663c3867663f00  DEFB $3c,$66,$3c,$38,$67,$66,$3f,	$00
  2084                          	; $27
  2085  0c8d  060c180000000000  DEFB $06,$0c,$18,$00,$00,$00,$00,	$00
  2086                          	; $28
  2087  0c95  0c18303030180c00  DEFB $0c,$18,$30,$30,$30,$18,$0c,	$00
  2088                          	; $29
  2089  0c9d  30180c0c0c183000  DEFB $30,$18,$0c,$0c,$0c,$18,$30,	$00
  2090                          	; $2a
  2091  0ca5  00663cff3c660000  DEFB $00,$66,$3c,$ff,$3c,$66,$00,	$00
  2092                          	; $2b
  2093  0cad  0018187e18180000  DEFB $00,$18,$18,$7e,$18,$18,$00,	$00
  2094                          	; $2c
  2095  0cb5  0000000000181830  DEFB $00,$00,$00,$00,$00,$18,$18,	$30
  2096                          	; $2d
  2097  0cbd  0000007e00000000  DEFB $00,$00,$00,$7e,$00,$00,$00,	$00
  2098                          	; $2e
  2099  0cc5  0000000000181800  DEFB $00,$00,$00,$00,$00,$18,$18,	$00
  2100                          	; $2f
  2101  0ccd  0003060c18306000  DEFB $00,$03,$06,$0c,$18,$30,$60,	$00
  2102                          	; $30
  2103  0cd5  3c666e7666663c00  DEFB $3c,$66,$6e,$76,$66,$66,$3c,	$00
  2104                          	; $31
  2105  0cdd  1818381818187e00  DEFB $18,$18,$38,$18,$18,$18,$7e,	$00
  2106                          	; $32
  2107  0ce5  3c66060c30607e00  DEFB $3c,$66,$06,$0c,$30,$60,$7e,	$00
  2108                          	; $33
  2109  0ced  3c66061c06663c00  DEFB $3c,$66,$06,$1c,$06,$66,$3c,	$00
  2110                          	; $34
  2111  0cf5  060e1e667f060600  DEFB $06,$0e,$1e,$66,$7f,$06,$06,	$00
  2112                          	; $35
  2113  0cfd  7e607c0606663c00  DEFB $7e,$60,$7c,$06,$06,$66,$3c,	$00
  2114                          	; $36
  2115  0d05  3c66607c66663c00  DEFB $3c,$66,$60,$7c,$66,$66,$3c,	$00
  2116                          	; $37
  2117  0d0d  7e660c1818181800  DEFB $7e,$66,$0c,$18,$18,$18,$18,	$00
  2118                          	; $38
  2119  0d15  3c66663c66663c00  DEFB $3c,$66,$66,$3c,$66,$66,$3c,	$00
  2120                          	; $39
  2121  0d1d  3c66663e06663c00  DEFB $3c,$66,$66,$3e,$06,$66,$3c,	$00
  2122                          	; $3a
  2123  0d25  0000180000180000  DEFB $00,$00,$18,$00,$00,$18,$00,	$00
  2124                          	; $3b
  2125  0d2d  0000180000181830  DEFB $00,$00,$18,$00,$00,$18,$18,	$30
  2126                          	; $3c
  2127  0d35  0e18306030180e00  DEFB $0e,$18,$30,$60,$30,$18,$0e,	$00
  2128                          	; $3d
  2129  0d3d  00007e007e000000  DEFB $00,$00,$7e,$00,$7e,$00,$00,	$00
  2130                          	; $3e
  2131  0d45  70180c060c187000  DEFB $70,$18,$0c,$06,$0c,$18,$70,	$00
  2132                          	; $3f
  2133  0d4d  3c66060c18001800  DEFB $3c,$66,$06,$0c,$18,$00,$18,	$00
  2134                          	; $40
  2135  0d55  000000ffff000000  DEFB $00,$00,$00,$ff,$ff,$00,$00,	$00
  2136                          	; $41
  2137  0d5d  183c667e66666600  DEFB $18,$3c,$66,$7e,$66,$66,$66,	$00
  2138                          	; $42
  2139  0d65  7c66667c66667c00  DEFB $7c,$66,$66,$7c,$66,$66,$7c,	$00
  2140                          	; $43
  2141  0d6d  3c66606060663c00  DEFB $3c,$66,$60,$60,$60,$66,$3c,	$00
  2142                          	; $44
  2143  0d75  786c6666666c7800  DEFB $78,$6c,$66,$66,$66,$6c,$78,	$00
  2144                          	; $45
  2145  0d7d  7e60607860607e00  DEFB $7e,$60,$60,$78,$60,$60,$7e,	$00
  2146                          	; $46
  2147  0d85  7e60607860606000  DEFB $7e,$60,$60,$78,$60,$60,$60,	$00
  2148                          	; $47
  2149  0d8d  3c66606e66663c00  DEFB $3c,$66,$60,$6e,$66,$66,$3c,	$00
  2150                          	; $48
  2151  0d95  6666667e66666600  DEFB $66,$66,$66,$7e,$66,$66,$66,	$00
  2152                          	; $49
  2153  0d9d  3c18181818183c00  DEFB $3c,$18,$18,$18,$18,$18,$3c,	$00
  2154                          	; $4a
  2155  0da5  1e0c0c0c0c6c3800  DEFB $1e,$0c,$0c,$0c,$0c,$6c,$38,	$00
  2156                          	; $4b
  2157  0dad  666c7870786c6600  DEFB $66,$6c,$78,$70,$78,$6c,$66,	$00
  2158                          	; $4c
  2159  0db5  6060606060607e00  DEFB $60,$60,$60,$60,$60,$60,$7e,	$00
  2160                          	; $4d
  2161  0dbd  63777f6b63636300  DEFB $63,$77,$7f,$6b,$63,$63,$63,	$00
  2162                          	; $4e
  2163  0dc5  66767e7e6e666600  DEFB $66,$76,$7e,$7e,$6e,$66,$66,	$00
  2164                          	; $4f
  2165  0dcd  3c66666666663c00  DEFB $3c,$66,$66,$66,$66,$66,$3c,	$00
  2166                          	; $50
  2167  0dd5  7c66667c60606000  DEFB $7c,$66,$66,$7c,$60,$60,$60,	$00
  2168                          	; $51
  2169  0ddd  3c666666663c0e00  DEFB $3c,$66,$66,$66,$66,$3c,$0e,	$00
  2170                          	; $52
  2171  0de5  7c66667c786c6600  DEFB $7c,$66,$66,$7c,$78,$6c,$66,	$00
  2172                          	; $53
  2173  0ded  3c66603c06663c00  DEFB $3c,$66,$60,$3c,$06,$66,$3c,	$00
  2174                          	; $54
  2175  0df5  7e18181818181800  DEFB $7e,$18,$18,$18,$18,$18,$18,	$00
  2176                          	; $55
  2177  0dfd  6666666666663c00  DEFB $66,$66,$66,$66,$66,$66,$3c,	$00
  2178                          	; $56
  2179  0e05  66666666663c1800  DEFB $66,$66,$66,$66,$66,$3c,$18,	$00
  2180                          	; $57
  2181  0e0d  6363636b7f776300  DEFB $63,$63,$63,$6b,$7f,$77,$63,	$00
  2182                          	; $58
  2183  0e15  66663c183c666600  DEFB $66,$66,$3c,$18,$3c,$66,$66,	$00
  2184                          	; $59
  2185  0e1d  6666663c18181800  DEFB $66,$66,$66,$3c,$18,$18,$18,	$00
  2186                          	; $5a
  2187  0e25  7e060c1830607e00  DEFB $7e,$06,$0c,$18,$30,$60,$7e,	$00
  2188                          	; $5b
  2189  0e2d  181818ffff181818  DEFB $18,$18,$18,$ff,$ff,$18,$18,	$18
  2190                          	; $5c
  2191  0e35  c0c03030c0c03030  DEFB $c0,$c0,$30,$30,$c0,$c0,$30,	$30
  2192                          	; $5d
  2193  0e3d  1818181818181818  DEFB $18,$18,$18,$18,$18,$18,$18,	$18
  2194                          	; $5e
  2195  0e45  3333cccc3333cccc  DEFB $33,$33,$cc,$cc,$33,$33,$cc,	$cc
  2196                          	; $5f
  2197  0e4d  3399cc663399cc66  DEFB $33,$99,$cc,$66,$33,$99,$cc,	$66
  2198                          	; $60
  2199  0e55  0000000000000000  DEFB $00,$00,$00,$00,$00,$00,$00,	$00
  2200                          	; $61
  2201  0e5d  f0f0f0f0f0f0f0f0  DEFB $f0,$f0,$f0,$f0,$f0,$f0,$f0,	$f0
  2202                          	; $62
  2203  0e65  00000000ffffffff  DEFB $00,$00,$00,$00,$ff,$ff,$ff,	$ff
  2204                          	; $63
  2205  0e6d  ff00000000000000  DEFB $ff,$00,$00,$00,$00,$00,$00,	$00
  2206                          	; $64
  2207  0e75  00000000000000ff  DEFB $00,$00,$00,$00,$00,$00,$00,	$ff
  2208                          	; $65
  2209  0e7d  c0c0c0c0c0c0c0c0  DEFB $c0,$c0,$c0,$c0,$c0,$c0,$c0,	$c0
  2210                          	; $66
  2211  0e85  cccc3333cccc3333  DEFB $cc,$cc,$33,$33,$cc,$cc,$33,	$33
  2212                          	; $67
  2213  0e8d  0303030303030303  DEFB $03,$03,$03,$03,$03,$03,$03,	$03
  2214                          	; $68
  2215  0e95  00000000cccc3333  DEFB $00,$00,$00,$00,$cc,$cc,$33,	$33
  2216                          	; $69
  2217  0e9d  cc993366cc993366  DEFB $cc,$99,$33,$66,$cc,$99,$33,	$66
  2218                          	; $6a
  2219  0ea5  0303030303030303  DEFB $03,$03,$03,$03,$03,$03,$03,	$03
  2220                          	; $6b
  2221  0ead  1818181f1f181818  DEFB $18,$18,$18,$1f,$1f,$18,$18,	$18
  2222                          	; $6c
  2223  0eb5  000000000f0f0f0f  DEFB $00,$00,$00,$00,$0f,$0f,$0f,	$0f
  2224                          	; $6d
  2225  0ebd  1818181f1f000000  DEFB $18,$18,$18,$1f,$1f,$00,$00,	$00
  2226                          	; $6e
  2227  0ec5  000000f8f8181818  DEFB $00,$00,$00,$f8,$f8,$18,$18,	$18
  2228                          	; $6f
  2229  0ecd  000000000000ffff  DEFB $00,$00,$00,$00,$00,$00,$ff,	$ff
  2230                          	; $70
  2231  0ed5  0000001f1f181818  DEFB $00,$00,$00,$1f,$1f,$18,$18,	$18
  2232                          	; $71
  2233  0edd  181818ffff000000  DEFB $18,$18,$18,$ff,$ff,$00,$00,	$00
  2234                          	; $72
  2235  0ee5  000000ffff181818  DEFB $00,$00,$00,$ff,$ff,$18,$18,	$18
  2236                          	; $73
  2237  0eed  181818f8f8181818  DEFB $18,$18,$18,$f8,$f8,$18,$18,	$18
  2238                          	; $74
  2239  0ef5  c0c0c0c0c0c0c0c0  DEFB $c0,$c0,$c0,$c0,$c0,$c0,$c0,	$c0
  2240                          	; $75
  2241  0efd  e0e0e0e0e0e0e0e0  DEFB $e0,$e0,$e0,$e0,$e0,$e0,$e0,	$e0
  2242                          	; $76
  2243  0f05  0707070707070707  DEFB $07,$07,$07,$07,$07,$07,$07,	$07
  2244                          	; $77
  2245  0f0d  ffff000000000000  DEFB $ff,$ff,$00,$00,$00,$00,$00,	$00
  2246                          	; $78
  2247  0f15  ffffff0000000000  DEFB $ff,$ff,$ff,$00,$00,$00,$00,	$00
  2248                          	; $79
  2249  0f1d  0000000000ffffff  DEFB $00,$00,$00,$00,$00,$ff,$ff,	$ff
  2250                          	; $7a
  2251  0f25  0103066c78706000  DEFB $01,$03,$06,$6c,$78,$70,$60,	$00
  2252                          	; $7b
  2253  0f2d  00000000f0f0f0f0  DEFB $00,$00,$00,$00,$f0,$f0,$f0,	$f0
  2254                          	; $7c
  2255  0f35  0f0f0f0f00000000  DEFB $0f,$0f,$0f,$0f,$00,$00,$00,	$00
  2256                          	; $7d
  2257  0f3d  181818f8f8000000  DEFB $18,$18,$18,$f8,$f8,$00,$00,	$00
  2258                          	; $7e
  2259  0f45  f0f0f0f000000000  DEFB $f0,$f0,$f0,$f0,$00,$00,$00,	$00
  2260                          	; $7f
  2261  0f4d  f0f0f0f00f0f0f0f  DEFB $f0,$f0,$f0,$f0,$0f,$0f,$0f,	$0f
  2262                          	; $80
  2263  0f55  c39991919f99c3ff  DEFB $c3,$99,$91,$91,$9f,$99,$c3,	$ff
  2264                          	; $81
  2265  0f5d  ffffc3f9c199c1ff  DEFB $ff,$ff,$c3,$f9,$c1,$99,$c1,	$ff
  2266                          	; $82
  2267  0f65  ff9f9f83999983ff  DEFB $ff,$9f,$9f,$83,$99,$99,$83,	$ff
  2268                          	; $83
  2269  0f6d  ffffc39f9f9fc3ff  DEFB $ff,$ff,$c3,$9f,$9f,$9f,$c3,	$ff
  2270                          	; $84
  2271  0f75  fff9f9c19999c1ff  DEFB $ff,$f9,$f9,$c1,$99,$99,$c1,	$ff
  2272                          	; $85
  2273  0f7d  ffffc399819fc3ff  DEFB $ff,$ff,$c3,$99,$81,$9f,$c3,	$ff
  2274                          	; $86
  2275  0f85  fff1e7c1e7e7e7ff  DEFB $ff,$f1,$e7,$c1,$e7,$e7,$e7,	$ff
  2276                          	; $87
  2277  0f8d  ffffc19999c1f983  DEFB $ff,$ff,$c1,$99,$99,$c1,$f9,	$83
  2278                          	; $88
  2279  0f95  ff9f9f83999999ff  DEFB $ff,$9f,$9f,$83,$99,$99,$99,	$ff
  2280                          	; $89
  2281  0f9d  ffe7ffc7e7e7c3ff  DEFB $ff,$e7,$ff,$c7,$e7,$e7,$c3,	$ff
  2282                          	; $8a
  2283  0fa5  fff9fff9f9f9f9c3  DEFB $ff,$f9,$ff,$f9,$f9,$f9,$f9,	$c3
  2284                          	; $8b
  2285  0fad  ff9f9f93879399ff  DEFB $ff,$9f,$9f,$93,$87,$93,$99,	$ff
  2286                          	; $8c
  2287  0fb5  ffc7e7e7e7e7c3ff  DEFB $ff,$c7,$e7,$e7,$e7,$e7,$c3,	$ff
  2288                          	; $8d
  2289  0fbd  ffff998080949cff  DEFB $ff,$ff,$99,$80,$80,$94,$9c,	$ff
  2290                          	; $8e
  2291  0fc5  ffff8399999999ff  DEFB $ff,$ff,$83,$99,$99,$99,$99,	$ff
  2292                          	; $8f
  2293  0fcd  ffffc3999999c3ff  DEFB $ff,$ff,$c3,$99,$99,$99,$c3,	$ff
  2294                          	; $90
  2295  0fd5  ffff839999839f9f  DEFB $ff,$ff,$83,$99,$99,$83,$9f,	$9f
  2296                          	; $91
  2297  0fdd  ffffc19999c1f9f9  DEFB $ff,$ff,$c1,$99,$99,$c1,$f9,	$f9
  2298                          	; $92
  2299  0fe5  ffff83999f9f9fff  DEFB $ff,$ff,$83,$99,$9f,$9f,$9f,	$ff
  2300                          	; $93
  2301  0fed  ffffc19fc3f983ff  DEFB $ff,$ff,$c1,$9f,$c3,$f9,$83,	$ff
  2302                          	; $94
  2303  0ff5  ffe781e7e7e7f1ff  DEFB $ff,$e7,$81,$e7,$e7,$e7,$f1,	$ff
  2304                          	; $95
  2305  0ffd  ffff99999999c1ff  DEFB $ff,$ff,$99,$99,$99,$99,$c1,	$ff
  2306                          	; $96
  2307  1005  ffff999999c3e7ff  DEFB $ff,$ff,$99,$99,$99,$c3,$e7,	$ff
  2308                          	; $97
  2309  100d  ffff9c9480c1c9ff  DEFB $ff,$ff,$9c,$94,$80,$c1,$c9,	$ff
  2310                          	; $98
  2311  1015  ffff99c3e7c399ff  DEFB $ff,$ff,$99,$c3,$e7,$c3,$99,	$ff
  2312                          	; $99
  2313  101d  ffff999999c1f387  DEFB $ff,$ff,$99,$99,$99,$c1,$f3,	$87
  2314                          	; $9a
  2315  1025  ffff81f3e7cf81ff  DEFB $ff,$ff,$81,$f3,$e7,$cf,$81,	$ff
  2316                          	; $9b
  2317  102d  c3cfcfcfcfcfc3ff  DEFB $c3,$cf,$cf,$cf,$cf,$cf,$c3,	$ff
  2318                          	; $9c
  2319  1035  f3edcf83cf9d03ff  DEFB $f3,$ed,$cf,$83,$cf,$9d,$03,	$ff
  2320                          	; $9d
  2321  103d  c3f3f3f3f3f3c3ff  DEFB $c3,$f3,$f3,$f3,$f3,$f3,$c3,	$ff
  2322                          	; $9e
  2323  1045  ffe7c381e7e7e7e7  DEFB $ff,$e7,$c3,$81,$e7,$e7,$e7,	$e7
  2324                          	; $9f
  2325  104d  ffefcf8080cfefff  DEFB $ff,$ef,$cf,$80,$80,$cf,$ef,	$ff
  2326                          	; $a0
  2327  1055  ffffffffffffffff  DEFB $ff,$ff,$ff,$ff,$ff,$ff,$ff,	$ff
  2328                          	; $a1
  2329  105d  e7e7e7e7ffffe7ff  DEFB $e7,$e7,$e7,$e7,$ff,$ff,$e7,	$ff
  2330                          	; $a2
  2331  1065  999999ffffffffff  DEFB $99,$99,$99,$ff,$ff,$ff,$ff,	$ff
  2332                          	; $a3
  2333  106d  99990099009999ff  DEFB $99,$99,$00,$99,$00,$99,$99,	$ff
  2334                          	; $a4
  2335  1075  e7c19fc3f983e7ff  DEFB $e7,$c1,$9f,$c3,$f9,$83,$e7,	$ff
  2336                          	; $a5
  2337  107d  9d99f3e7cf99b9ff  DEFB $9d,$99,$f3,$e7,$cf,$99,$b9,	$ff
  2338                          	; $a6
  2339  1085  c399c3c79899c0ff  DEFB $c3,$99,$c3,$c7,$98,$99,$c0,	$ff
  2340                          	; $a7
  2341  108d  f9f3e7ffffffffff  DEFB $f9,$f3,$e7,$ff,$ff,$ff,$ff,	$ff
  2342                          	; $a8
  2343  1095  f3e7cfcfcfe7f3ff  DEFB $f3,$e7,$cf,$cf,$cf,$e7,$f3,	$ff
  2344                          	; $a9
  2345  109d  cfe7f3f3f3e7cfff  DEFB $cf,$e7,$f3,$f3,$f3,$e7,$cf,	$ff
  2346                          	; $aa
  2347  10a5  ff99c300c399ffff  DEFB $ff,$99,$c3,$00,$c3,$99,$ff,	$ff
  2348                          	; $ab
  2349  10ad  ffe7e781e7e7ffff  DEFB $ff,$e7,$e7,$81,$e7,$e7,$ff,	$ff
  2350                          	; $ac
  2351  10b5  ffffffffffe7e7cf  DEFB $ff,$ff,$ff,$ff,$ff,$e7,$e7,	$cf
  2352                          	; $ad
  2353  10bd  ffffff81ffffffff  DEFB $ff,$ff,$ff,$81,$ff,$ff,$ff,	$ff
  2354                          	; $ae
  2355  10c5  ffffffffffe7e7ff  DEFB $ff,$ff,$ff,$ff,$ff,$e7,$e7,	$ff
  2356                          	; $af
  2357  10cd  fffcf9f3e7cf9fff  DEFB $ff,$fc,$f9,$f3,$e7,$cf,$9f,	$ff
  2358                          	; $b0
  2359  10d5  c39991899999c3ff  DEFB $c3,$99,$91,$89,$99,$99,$c3,	$ff
  2360                          	; $b1
  2361  10dd  e7e7c7e7e7e781ff  DEFB $e7,$e7,$c7,$e7,$e7,$e7,$81,	$ff
  2362                          	; $b2
  2363  10e5  c399f9f3cf9f81ff  DEFB $c3,$99,$f9,$f3,$cf,$9f,$81,	$ff
  2364                          	; $b3
  2365  10ed  c399f9e3f999c3ff  DEFB $c3,$99,$f9,$e3,$f9,$99,$c3,	$ff
  2366                          	; $b4
  2367  10f5  f9f1e19980f9f9ff  DEFB $f9,$f1,$e1,$99,$80,$f9,$f9,	$ff
  2368                          	; $b5
  2369  10fd  819f83f9f999c3ff  DEFB $81,$9f,$83,$f9,$f9,$99,$c3,	$ff
  2370                          	; $b6
  2371  1105  c3999f839999c3ff  DEFB $c3,$99,$9f,$83,$99,$99,$c3,	$ff
  2372                          	; $b7
  2373  110d  8199f3e7e7e7e7ff  DEFB $81,$99,$f3,$e7,$e7,$e7,$e7,	$ff
  2374                          	; $b8
  2375  1115  c39999c39999c3ff  DEFB $c3,$99,$99,$c3,$99,$99,$c3,	$ff
  2376                          	; $b9
  2377  111d  c39999c1f999c3ff  DEFB $c3,$99,$99,$c1,$f9,$99,$c3,	$ff
  2378                          	; $ba
  2379  1125  ffffe7ffffe7ffff  DEFB $ff,$ff,$e7,$ff,$ff,$e7,$ff,	$ff
  2380                          	; $bb
  2381  112d  ffffe7ffffe7e7cf  DEFB $ff,$ff,$e7,$ff,$ff,$e7,$e7,	$cf
  2382                          	; $bc
  2383  1135  f1e7cf9fcfe7f1ff  DEFB $f1,$e7,$cf,$9f,$cf,$e7,$f1,	$ff
  2384                          	; $bd
  2385  113d  ffff81ff81ffffff  DEFB $ff,$ff,$81,$ff,$81,$ff,$ff,	$ff
  2386                          	; $be
  2387  1145  8fe7f3f9f3e78fff  DEFB $8f,$e7,$f3,$f9,$f3,$e7,$8f,	$ff
  2388                          	; $bf
  2389  114d  c399f9f3e7ffe7ff  DEFB $c3,$99,$f9,$f3,$e7,$ff,$e7,	$ff
  2390                          	; $c0
  2391  1155  ffffff0000ffffff  DEFB $ff,$ff,$ff,$00,$00,$ff,$ff,	$ff
  2392                          	; $c1
  2393  115d  e7c39981999999ff  DEFB $e7,$c3,$99,$81,$99,$99,$99,	$ff
  2394                          	; $c2
  2395  1165  83999983999983ff  DEFB $83,$99,$99,$83,$99,$99,$83,	$ff
  2396                          	; $c3
  2397  116d  c3999f9f9f99c3ff  DEFB $c3,$99,$9f,$9f,$9f,$99,$c3,	$ff
  2398                          	; $c4
  2399  1175  87939999999387ff  DEFB $87,$93,$99,$99,$99,$93,$87,	$ff
  2400                          	; $c5
  2401  117d  819f9f879f9f81ff  DEFB $81,$9f,$9f,$87,$9f,$9f,$81,	$ff
  2402                          	; $c6
  2403  1185  819f9f879f9f9fff  DEFB $81,$9f,$9f,$87,$9f,$9f,$9f,	$ff
  2404                          	; $c7
  2405  118d  c3999f919999c3ff  DEFB $c3,$99,$9f,$91,$99,$99,$c3,	$ff
  2406                          	; $c8
  2407  1195  99999981999999ff  DEFB $99,$99,$99,$81,$99,$99,$99,	$ff
  2408                          	; $c9
  2409  119d  c3e7e7e7e7e7c3ff  DEFB $c3,$e7,$e7,$e7,$e7,$e7,$c3,	$ff
  2410                          	; $ca
  2411  11a5  e1f3f3f3f393c7ff  DEFB $e1,$f3,$f3,$f3,$f3,$93,$c7,	$ff
  2412                          	; $cb
  2413  11ad  9993878f879399ff  DEFB $99,$93,$87,$8f,$87,$93,$99,	$ff
  2414                          	; $cc
  2415  11b5  9f9f9f9f9f9f81ff  DEFB $9f,$9f,$9f,$9f,$9f,$9f,$81,	$ff
  2416                          	; $cd
  2417  11bd  9c8880949c9c9cff  DEFB $9c,$88,$80,$94,$9c,$9c,$9c,	$ff
  2418                          	; $ce
  2419  11c5  99898181919999ff  DEFB $99,$89,$81,$81,$91,$99,$99,	$ff
  2420                          	; $cf
  2421  11cd  c39999999999c3ff  DEFB $c3,$99,$99,$99,$99,$99,$c3,	$ff
  2422                          	; $d0
  2423  11d5  839999839f9f9fff  DEFB $83,$99,$99,$83,$9f,$9f,$9f,	$ff
  2424                          	; $d1
  2425  11dd  c399999999c3f1ff  DEFB $c3,$99,$99,$99,$99,$c3,$f1,	$ff
  2426                          	; $d2
  2427  11e5  83999983879399ff  DEFB $83,$99,$99,$83,$87,$93,$99,	$ff
  2428                          	; $d3
  2429  11ed  c3999fc3f999c3ff  DEFB $c3,$99,$9f,$c3,$f9,$99,$c3,	$ff
  2430                          	; $d4
  2431  11f5  81e7e7e7e7e7e7ff  DEFB $81,$e7,$e7,$e7,$e7,$e7,$e7,	$ff
  2432                          	; $d5
  2433  11fd  999999999999c3ff  DEFB $99,$99,$99,$99,$99,$99,$c3,	$ff
  2434                          	; $d6
  2435  1205  9999999999c3e7ff  DEFB $99,$99,$99,$99,$99,$c3,$e7,	$ff
  2436                          	; $d7
  2437  120d  9c9c9c9480889cff  DEFB $9c,$9c,$9c,$94,$80,$88,$9c,	$ff
  2438                          	; $d8
  2439  1215  9999c3e7c39999ff  DEFB $99,$99,$c3,$e7,$c3,$99,$99,	$ff
  2440                          	; $d9
  2441  121d  999999c3e7e7e7ff  DEFB $99,$99,$99,$c3,$e7,$e7,$e7,	$ff
  2442                          	; $da
  2443  1225  81f9f3e7cf9f81ff  DEFB $81,$f9,$f3,$e7,$cf,$9f,$81,	$ff
  2444                          	; $db
  2445  122d  e7e7e70000e7e7e7  DEFB $e7,$e7,$e7,$00,$00,$e7,$e7,	$e7
  2446                          	; $dc
  2447  1235  3f3fcfcf3f3fcfcf  DEFB $3f,$3f,$cf,$cf,$3f,$3f,$cf,	$cf
  2448                          	; $dd
  2449  123d  e7e7e7e7e7e7e7e7  DEFB $e7,$e7,$e7,$e7,$e7,$e7,$e7,	$e7
  2450                          	; $de
  2451  1245  cccc3333cccc3333  DEFB $cc,$cc,$33,$33,$cc,$cc,$33,	$33
  2452                          	; $df
  2453  124d  cc663399cc663399  DEFB $cc,$66,$33,$99,$cc,$66,$33,	$99
  2454                          	; $e0
  2455  1255  ffffffffffffffff  DEFB $ff,$ff,$ff,$ff,$ff,$ff,$ff,	$ff
  2456                          	; $e1
  2457  125d  0f0f0f0f0f0f0f0f  DEFB $0f,$0f,$0f,$0f,$0f,$0f,$0f,	$0f
  2458                          	; $e2
  2459  1265  ffffffff00000000  DEFB $ff,$ff,$ff,$ff,$00,$00,$00,	$00
  2460                          	; $e3
  2461  126d  00ffffffffffffff  DEFB $00,$ff,$ff,$ff,$ff,$ff,$ff,	$ff
  2462                          	; $e4
  2463  1275  ffffffffffffff00  DEFB $ff,$ff,$ff,$ff,$ff,$ff,$ff,	$00
  2464                          	; $e5
  2465  127d  3f3f3f3f3f3f3f3f  DEFB $3f,$3f,$3f,$3f,$3f,$3f,$3f,	$3f
  2466                          	; $e6
  2467  1285  3333cccc3333cccc  DEFB $33,$33,$cc,$cc,$33,$33,$cc,	$cc
  2468                          	; $e7
  2469  128d  fcfcfcfcfcfcfcfc  DEFB $fc,$fc,$fc,$fc,$fc,$fc,$fc,	$fc
  2470                          	; $e8
  2471  1295  ffffffff3333cccc  DEFB $ff,$ff,$ff,$ff,$33,$33,$cc,	$cc
  2472                          	; $e9
  2473  129d  3366cc993366cc99  DEFB $33,$66,$cc,$99,$33,$66,$cc,	$99
  2474                          	; $ea
  2475  12a5  fcfcfcfcfcfcfcfc  DEFB $fc,$fc,$fc,$fc,$fc,$fc,$fc,	$fc
  2476                          	; $eb
  2477  12ad  e7e7e7e0e0e7e7e7  DEFB $e7,$e7,$e7,$e0,$e0,$e7,$e7,	$e7
  2478                          	; $ec
  2479  12b5  fffffffff0f0f0f0  DEFB $ff,$ff,$ff,$ff,$f0,$f0,$f0,	$f0
  2480                          	; $ed
  2481  12bd  e7e7e7e0e0ffffff  DEFB $e7,$e7,$e7,$e0,$e0,$ff,$ff,	$ff
  2482                          	; $ee
  2483  12c5  ffffff0707e7e7e7  DEFB $ff,$ff,$ff,$07,$07,$e7,$e7,	$e7
  2484                          	; $ef
  2485  12cd  ffffffffffff0000  DEFB $ff,$ff,$ff,$ff,$ff,$ff,$00,	$00
  2486                          	; $f0
  2487  12d5  ffffffe0e0e7e7e7  DEFB $ff,$ff,$ff,$e0,$e0,$e7,$e7,	$e7
  2488                          	; $f1
  2489  12dd  e7e7e70000ffffff  DEFB $e7,$e7,$e7,$00,$00,$ff,$ff,	$ff
  2490                          	; $f2
  2491  12e5  ffffff0000e7e7e7  DEFB $ff,$ff,$ff,$00,$00,$e7,$e7,	$e7
  2492                          	; $f3
  2493  12ed  e7e7e70707e7e7e7  DEFB $e7,$e7,$e7,$07,$07,$e7,$e7,	$e7
  2494                          	; $f4
  2495  12f5  3f3f3f3f3f3f3f3f  DEFB $3f,$3f,$3f,$3f,$3f,$3f,$3f,	$3f
  2496                          	; $f5
  2497  12fd  1f1f1f1f1f1f1f1f  DEFB $1f,$1f,$1f,$1f,$1f,$1f,$1f,	$1f
  2498                          	; $f6
  2499  1305  f8f8f8f8f8f8f8f8  DEFB $f8,$f8,$f8,$f8,$f8,$f8,$f8,	$f8
  2500                          	; $f7
  2501  130d  0000ffffffffffff  DEFB $00,$00,$ff,$ff,$ff,$ff,$ff,	$ff
  2502                          	; $f8
  2503  1315  000000ffffffffff  DEFB $00,$00,$00,$ff,$ff,$ff,$ff,	$ff
  2504                          	; $f9
  2505  131d  ffffffffff000000  DEFB $ff,$ff,$ff,$ff,$ff,$00,$00,	$00
  2506                          	; $fa
  2507  1325  fefcf993878f9fff  DEFB $fe,$fc,$f9,$93,$87,$8f,$9f,	$ff
  2508                          	; $fb
  2509  132d  ffffffff0f0f0f0f  DEFB $ff,$ff,$ff,$ff,$0f,$0f,$0f,	$0f
  2510                          	; $fc
  2511  1335  f0f0f0f0ffffffff  DEFB $f0,$f0,$f0,$f0,$ff,$ff,$ff,	$ff
  2512                          	; $fd
  2513  133d  e7e7e70707ffffff  DEFB $e7,$e7,$e7,$07,$07,$ff,$ff,	$ff
  2514                          	; $fe
  2515  1345  0f0f0f0fffffffff  DEFB $0f,$0f,$0f,$0f,$ff,$ff,$ff,	$ff
  2516                          AY8910STARTUP:
  2517  134d  c9                	RET
  2518                          MUSICPLAYER:
  2519  134e  c9                	RET
  2520                          PROTOTHREADINIT:
  2521  134f  c9                	RET
  2522                          ; peephole: pass 1, 67 changes.
  2523                          ; peephole: pass 2, 0 change.
  2524                          ; peephole: pass 3, 19 vars removed.
  2525                          ; peephole: pass 4, 4 changes.
  2526                          ; peephole: pass 5, 2 changes.
  2527                          ; peephole: pass 6, 0 change.
  2528                          ; peephole: pass 7, 0 var removed.
  2529                          ; peephole: pass 8, 0 var moved to dp, 0 var inlined.
  2530                          
